<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 14px;
    }
    
    #editor {
      min-height: 500px;
    }
    
    .tips {
      padding: 20px;
      background: #f0f9ff;
      border-top: 1px solid #e5e7eb;
    }
    
    .tips h3 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #1e40af;
    }
    
    .tips ul {
      list-style: none;
      padding-left: 0;
    }
    
    .tips li {
      padding: 5px 0;
      color: #64748b;
      font-size: 14px;
    }
    
    .tips kbd {
      display: inline-block;
      padding: 2px 6px;
      background: white;
      border: 1px solid #cbd5e1;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¨ LDesign Editor</h1>
      <p>åŠŸèƒ½å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒæŸ¥æ‰¾æ›¿æ¢ã€è¡¨æ ¼ã€ä»£ç å—ç­‰åŠŸèƒ½</p>
    </div>
    
    <div id="editor"></div>
    
    <div class="tips">
      <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
      <ul>
        <li>â€¢ æŒ‰ <kbd>Ctrl</kbd>+<kbd>F</kbd> æ‰“å¼€æŸ¥æ‰¾æ›¿æ¢å¯¹è¯æ¡†</li>
        <li>â€¢ æŒ‰ <kbd>Ctrl</kbd>+<kbd>H</kbd> ç›´æ¥è¿›å…¥æ›¿æ¢æ¨¡å¼</li>
        <li>â€¢ æ”¯æŒæ¨¡ç³Šæœç´¢ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ‰¹é‡æ›¿æ¢</li>
        <li>â€¢ é€‰ä¸­æ–‡æœ¬åæŒ‰ <kbd>Ctrl</kbd>+<kbd>F</kbd> è‡ªåŠ¨å¡«å……æœç´¢æ¡†</li>
      </ul>
    </div>
  </div>

  <script type="module">
    // åŠ¨æ€å¯¼å…¥ç¼–è¾‘å™¨æ¨¡å—
    async function initEditor() {
      try {
        // å°è¯•ä»æ„å»ºåçš„æ–‡ä»¶å¯¼å…¥
        const { Editor } = await import('./dist/editor.esm.js');
        
        const editor = new Editor({
          element: document.getElementById('editor'),
          toolbar: true,
          editable: true,
          content: `
            <h1>æ¬¢è¿ä½¿ç”¨ LDesign Editor!</h1>
            <p>è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒï¼š</p>
            <ul>
              <li><strong>æ–‡æœ¬æ ¼å¼åŒ–</strong>ï¼šåŠ ç²—ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ç­‰</li>
              <li><strong>æ ‡é¢˜çº§åˆ«</strong>ï¼šH1-H6 æ ‡é¢˜</li>
              <li><strong>åˆ—è¡¨</strong>ï¼šæœ‰åºåˆ—è¡¨ã€æ— åºåˆ—è¡¨ã€ä»»åŠ¡åˆ—è¡¨</li>
              <li><strong>è¡¨æ ¼</strong>ï¼šåˆ›å»ºå’Œç¼–è¾‘è¡¨æ ¼</li>
              <li><strong>ä»£ç å—</strong>ï¼šæ”¯æŒè¯­æ³•é«˜äº®</li>
              <li><strong>æŸ¥æ‰¾æ›¿æ¢</strong>ï¼šå¼ºå¤§çš„æ–‡æœ¬æœç´¢å’Œæ›¿æ¢åŠŸèƒ½</li>
            </ul>
            
            <h2>æµ‹è¯•æŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½</h2>
            <p>è¯•è¯•æŒ‰ <strong>Ctrl+F</strong> æ‰“å¼€æŸ¥æ‰¾å¯¹è¯æ¡†ï¼Œæœç´¢"ç¼–è¾‘å™¨"è¿™ä¸ªè¯ã€‚</p>
            <p>ç¼–è¾‘å™¨æ”¯æŒå¤šç§æœç´¢æ¨¡å¼ï¼Œç¼–è¾‘å™¨åŠŸèƒ½å¼ºå¤§ï¼Œç¼–è¾‘å™¨ä½¿ç”¨æ–¹ä¾¿ã€‚</p>
            
            <h2>ç¤ºä¾‹ä»£ç </h2>
            <pre><code>function hello() {
  console.log("Hello, LDesign Editor!");
}</code></pre>
            
            <p>æ›´å¤šåŠŸèƒ½ç­‰ä½ æ¢ç´¢ï¼</p>
          `
        });
        
        console.log('ç¼–è¾‘å™¨åˆå§‹åŒ–æˆåŠŸ');
        
      } catch (error) {
        console.error('åŠ è½½ç¼–è¾‘å™¨å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ:', error);
        
        // å¤‡ç”¨æ–¹æ¡ˆï¼šåˆ›å»ºç®€å•çš„ç¼–è¾‘å™¨
        createSimpleEditor();
      }
    }
    
    // ç®€å•ç¼–è¾‘å™¨ä½œä¸ºå¤‡ç”¨
    function createSimpleEditor() {
      const editorDiv = document.getElementById('editor');
      
      // åˆ›å»ºå·¥å…·æ 
      const toolbar = document.createElement('div');
      toolbar.style.cssText = `
        padding: 10px;
        background: #f8f9fa;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        gap: 8px;
      `;
      
      // æŸ¥æ‰¾æŒ‰é’®
      const findBtn = document.createElement('button');
      findBtn.innerHTML = 'ğŸ” æŸ¥æ‰¾æ›¿æ¢';
      findBtn.style.cssText = `
        padding: 8px 16px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      `;
      findBtn.onclick = () => openFindDialog();
      toolbar.appendChild(findBtn);
      
      // ç¼–è¾‘åŒºåŸŸ
      const content = document.createElement('div');
      content.contentEditable = true;
      content.style.cssText = `
        min-height: 400px;
        padding: 20px;
        outline: none;
      `;
      content.innerHTML = `
        <h1>æ¬¢è¿ä½¿ç”¨ LDesign Editor!</h1>
        <p>è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p>
        <p>ç¼–è¾‘å™¨æ”¯æŒæŸ¥æ‰¾å’Œæ›¿æ¢åŠŸèƒ½ã€‚è¯•è¯•æŒ‰ Ctrl+F æˆ–ç‚¹å‡»ä¸Šæ–¹çš„æŸ¥æ‰¾æŒ‰é’®ã€‚</p>
        <p>ç¼–è¾‘å™¨åŠŸèƒ½å¼ºå¤§ï¼Œç¼–è¾‘å™¨ä½¿ç”¨æ–¹ä¾¿ï¼Œç¼–è¾‘å™¨ä½“éªŒä¼˜ç§€ã€‚</p>
      `;
      
      editorDiv.appendChild(toolbar);
      editorDiv.appendChild(content);
      
      // ä¿å­˜å†…å®¹å…ƒç´ ä¾›æŸ¥æ‰¾ä½¿ç”¨
      window.editorContent = content;
    }
    
    // æŸ¥æ‰¾æ›¿æ¢å¯¹è¯æ¡† - è®¾ç½®ä¸ºå…¨å±€å‡½æ•°
    window.openFindDialog = function openFindDialog() {
      // è·å–é€‰ä¸­çš„æ–‡æœ¬
      const selection = window.getSelection();
      const initialText = selection.toString();
      
      // ç§»é™¤å·²å­˜åœ¨çš„å¯¹è¯æ¡†
      const existing = document.querySelector('.find-dialog-overlay');
      if (existing) {
        existing.remove();
      }
      
      // åˆ›å»ºå¯¹è¯æ¡†
      const overlay = document.createElement('div');
      overlay.className = 'find-dialog-overlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
      `;
      
      const dialog = document.createElement('div');
      dialog.style.cssText = `
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 500px;
        animation: slideIn 0.3s ease-out;
      `;
      
      dialog.innerHTML = `
        <div style="padding: 20px; border-bottom: 1px solid #e5e7eb;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <h2 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
              ğŸ” æŸ¥æ‰¾å’Œæ›¿æ¢
            </h2>
            <button class="close-btn" style="
              border: none;
              background: transparent;
              cursor: pointer;
              font-size: 24px;
              color: #6b7280;
            ">Ã—</button>
          </div>
        </div>
        
        <div style="padding: 24px;">
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">æŸ¥æ‰¾å†…å®¹</label>
            <input type="text" class="find-input" value="${initialText || ''}" placeholder="è¾“å…¥è¦æŸ¥æ‰¾çš„æ–‡æœ¬" style="
              width: 100%;
              padding: 10px;
              border: 1px solid #d1d5db;
              border-radius: 6px;
              font-size: 14px;
            ">
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">æ›¿æ¢ä¸º</label>
            <input type="text" class="replace-input" placeholder="è¾“å…¥æ›¿æ¢æ–‡æœ¬" style="
              width: 100%;
              padding: 10px;
              border: 1px solid #d1d5db;
              border-radius: 6px;
              font-size: 14px;
            ">
          </div>
          
          <div style="margin-bottom: 20px; padding: 12px; background: #f9fafb; border-radius: 6px;">
            <label style="margin-right: 16px;">
              <input type="checkbox" class="case-sensitive"> åŒºåˆ†å¤§å°å†™
            </label>
            <label style="margin-right: 16px;">
              <input type="checkbox" class="whole-word"> å…¨å­—åŒ¹é…
            </label>
            <label>
              <input type="checkbox" class="fuzzy-search"> æ¨¡ç³Šæœç´¢
            </label>
          </div>
          
          <div class="result-msg" style="
            display: none;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 16px;
            text-align: center;
            font-size: 14px;
          "></div>
        </div>
        
        <div style="padding: 20px; border-top: 1px solid #e5e7eb; display: flex; gap: 10px; justify-content: flex-end;">
          <button class="find-btn" style="
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
          ">æŸ¥æ‰¾</button>
          <button class="replace-btn" style="
            padding: 10px 20px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
          ">æ›¿æ¢</button>
          <button class="replace-all-btn" style="
            padding: 10px 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
          ">å…¨éƒ¨æ›¿æ¢</button>
        </div>
      `;
      
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);
      
      // æ·»åŠ åŠ¨ç”»æ ·å¼
      if (!document.getElementById('find-dialog-styles')) {
        const style = document.createElement('style');
        style.id = 'find-dialog-styles';
        style.textContent = `
          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateY(-20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          .text-highlight {
            background: #fef08a;
            padding: 2px;
            border-radius: 2px;
          }
        `;
        document.head.appendChild(style);
      }
      
      // ç»‘å®šäº‹ä»¶
      const closeBtn = dialog.querySelector('.close-btn');
      const findInput = dialog.querySelector('.find-input');
      const replaceInput = dialog.querySelector('.replace-input');
      const findBtn = dialog.querySelector('.find-btn');
      const replaceBtn = dialog.querySelector('.replace-btn');
      const replaceAllBtn = dialog.querySelector('.replace-all-btn');
      const resultMsg = dialog.querySelector('.result-msg');
      
      // å…³é—­å¯¹è¯æ¡†
      const closeDialog = () => overlay.remove();
      closeBtn.onclick = closeDialog;
      overlay.onclick = (e) => {
        if (e.target === overlay) closeDialog();
      };
      
      // æ˜¾ç¤ºæ¶ˆæ¯
      const showMsg = (msg, type = 'info') => {
        resultMsg.textContent = msg;
        resultMsg.style.display = 'block';
        resultMsg.style.background = type === 'success' ? '#f0fdf4' : '#fee2e2';
        resultMsg.style.color = type === 'success' ? '#16a34a' : '#dc2626';
        setTimeout(() => {
          resultMsg.style.display = 'none';
        }, 3000);
      };
      
      // æŸ¥æ‰¾åŠŸèƒ½
      findBtn.onclick = () => {
        const searchText = findInput.value;
        if (!searchText) {
          showMsg('è¯·è¾“å…¥æŸ¥æ‰¾å†…å®¹', 'error');
          return;
        }
        
        const content = window.editorContent || document.querySelector('[contenteditable]');
        if (!content) return;
        
        // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
        content.querySelectorAll('.text-highlight').forEach(el => {
          el.outerHTML = el.textContent;
        });
        
        const text = content.textContent;
        const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        const matches = text.match(regex);
        
        if (matches && matches.length > 0) {
          // é«˜äº®æ‰€æœ‰åŒ¹é…
          content.innerHTML = content.innerHTML.replace(regex, 
            '<span class="text-highlight">$&</span>');
          showMsg(`æ‰¾åˆ° ${matches.length} ä¸ªåŒ¹é…é¡¹`, 'success');
        } else {
          showMsg('æœªæ‰¾åˆ°åŒ¹é…é¡¹', 'error');
        }
      };
      
      // æ›¿æ¢åŠŸèƒ½
      replaceBtn.onclick = () => {
        const searchText = findInput.value;
        const replaceText = replaceInput.value;
        
        if (!searchText) {
          showMsg('è¯·è¾“å…¥æŸ¥æ‰¾å†…å®¹', 'error');
          return;
        }
        
        const content = window.editorContent || document.querySelector('[contenteditable]');
        if (!content) return;
        
        const text = content.textContent;
        const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'i');
        
        if (regex.test(text)) {
          content.textContent = text.replace(regex, replaceText);
          showMsg('æ›¿æ¢æˆåŠŸ', 'success');
        } else {
          showMsg('æœªæ‰¾åˆ°åŒ¹é…é¡¹', 'error');
        }
      };
      
      // å…¨éƒ¨æ›¿æ¢
      replaceAllBtn.onclick = () => {
        const searchText = findInput.value;
        const replaceText = replaceInput.value;
        
        if (!searchText) {
          showMsg('è¯·è¾“å…¥æŸ¥æ‰¾å†…å®¹', 'error');
          return;
        }
        
        if (confirm(`ç¡®å®šè¦å°†æ‰€æœ‰"${searchText}"æ›¿æ¢ä¸º"${replaceText || '(ç©º)'}"å—ï¼Ÿ`)) {
          const content = window.editorContent || document.querySelector('[contenteditable]');
          if (!content) return;
          
          const text = content.textContent;
          const regex = new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
          const matches = text.match(regex);
          
          if (matches && matches.length > 0) {
            content.textContent = text.replace(regex, replaceText);
            showMsg(`æˆåŠŸæ›¿æ¢ ${matches.length} å¤„`, 'success');
          } else {
            showMsg('æœªæ‰¾åˆ°åŒ¹é…é¡¹', 'error');
          }
        }
      };
      
      // èšç„¦åˆ°æŸ¥æ‰¾è¾“å…¥æ¡†
      setTimeout(() => findInput.focus(), 100);
    }
    
    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && (e.key === 'f' || e.key === 'F')) {
        e.preventDefault();
        openFindDialog();
      }
      if ((e.ctrlKey || e.metaKey) && (e.key === 'h' || e.key === 'H')) {
        e.preventDefault();
        openFindDialog();
      }
    });
    
    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    initEditor();
    
    // åŠ è½½æŸ¥æ‰¾æ›¿æ¢å¯¹è¯æ¡†æ³¨å…¥è„šæœ¬
    const script = document.createElement('script');
    script.src = './inject-find-dialog.js';
    document.body.appendChild(script);
  </script>
</body>
</html>