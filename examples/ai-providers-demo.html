<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI提供商演示 - @ldesign/editor</title>
  <link rel="stylesheet" href="../dist/editor.css">
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .ai-providers {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .provider-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .provider-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .provider-card.active {
      border: 2px solid #2196F3;
    }

    .provider-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .provider-name {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .provider-logo {
      width: 40px;
      height: 40px;
      background: #f0f0f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .provider-models {
      margin: 10px 0;
    }

    .provider-models select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .api-key-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #2196F3;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn:hover {
      background: #1976D2;
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .editor-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .editor-container {
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin: 20px 0;
    }

    .ai-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .result-section {
      background: #f8f9fa;
      border-radius: 4px;
      padding: 15px;
      margin-top: 20px;
      min-height: 100px;
    }

    .result-section.error {
      background: #ffebee;
      color: #c62828;
    }

    .result-section.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }

    .instructions {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .instructions h3 {
      margin-top: 0;
      color: #856404;
    }

    .instructions ul {
      margin-bottom: 0;
      padding-left: 20px;
    }

    .provider-status {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ddd;
      margin-left: 10px;
    }

    .provider-status.ready {
      background: #4CAF50;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>AI提供商演示</h1>
      <p>支持多种国内外大语言模型</p>
    </div>

    <div class="instructions">
      <h3>使用说明</h3>
      <ul>
        <li><strong>百度文心一言</strong>：API密钥格式为 "API_KEY:SECRET_KEY"</li>
        <li><strong>阿里通义千问</strong>：直接输入API密钥</li>
        <li><strong>讯飞星火</strong>：API密钥格式为 "APP_ID:API_KEY:API_SECRET"</li>
        <li><strong>智谱清言</strong>：直接输入API密钥</li>
        <li><strong>OpenAI/Claude</strong>：直接输入API密钥</li>
      </ul>
    </div>

    <div class="ai-providers">
      <!-- 百度文心一言 -->
      <div class="provider-card" data-provider="baidu">
        <div class="provider-header">
          <span class="provider-name">百度文心一言</span>
          <span class="provider-logo">百</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="ernie-bot">ERNIE-Bot</option>
            <option value="ernie-bot-turbo">ERNIE-Bot-Turbo</option>
            <option value="ernie-bot-4">ERNIE-Bot 4.0</option>
            <option value="ernie-3.5-8k">ERNIE 3.5 8K</option>
            <option value="ernie-3.5-128k">ERNIE 3.5 128K</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API_KEY:SECRET_KEY">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- 阿里通义千问 -->
      <div class="provider-card" data-provider="qwen">
        <div class="provider-header">
          <span class="provider-name">阿里通义千问</span>
          <span class="provider-logo">阿</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="qwen-turbo">通义千问-Turbo</option>
            <option value="qwen-plus">通义千问-Plus</option>
            <option value="qwen-max">通义千问-Max</option>
            <option value="qwen-max-1201">通义千问-Max-1201</option>
            <option value="qwen-max-longcontext">通义千问-超长上下文</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- 讯飞星火 -->
      <div class="provider-card" data-provider="spark">
        <div class="provider-header">
          <span class="provider-name">讯飞星火</span>
          <span class="provider-logo">讯</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="spark-1.5">星火1.5</option>
            <option value="spark-2.0">星火2.0</option>
            <option value="spark-3.0">星火3.0</option>
            <option value="spark-3.5">星火3.5</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="APP_ID:API_KEY:API_SECRET">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- 智谱清言 -->
      <div class="provider-card" data-provider="glm">
        <div class="provider-header">
          <span class="provider-name">智谱清言</span>
          <span class="provider-logo">智</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="glm-4">GLM-4</option>
            <option value="glm-4-air">GLM-4-Air</option>
            <option value="glm-4-airx">GLM-4-AirX</option>
            <option value="glm-4-flash">GLM-4-Flash</option>
            <option value="glm-3-turbo">GLM-3-Turbo</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- OpenAI -->
      <div class="provider-card" data-provider="openai">
        <div class="provider-header">
          <span class="provider-name">OpenAI</span>
          <span class="provider-logo">AI</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="gpt-3.5-turbo">GPT-3.5-Turbo</option>
            <option value="gpt-4">GPT-4</option>
            <option value="gpt-4-turbo">GPT-4-Turbo</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- Claude -->
      <div class="provider-card" data-provider="claude">
        <div class="provider-header">
          <span class="provider-name">Claude</span>
          <span class="provider-logo">C</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
            <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">激活</button>
      </div>

      <!-- DeepSeek -->
      <div class="provider-card" data-provider="deepseek">
        <div class="provider-header">
          <span class="provider-name">DeepSeek</span>
          <span class="provider-logo">DS</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="deepseek-chat">DeepSeek Chat</option>
            <option value="deepseek-coder">DeepSeek Coder</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">激活</button>
      </div>
    </div>

    <div class="editor-section">
      <h2>编辑器</h2>
      <div class="ai-actions">
        <button class="btn" onclick="aiCorrect()">🔧 纠错</button>
        <button class="btn" onclick="aiComplete()">✏️ 补全</button>
        <button class="btn" onclick="aiContinue()">📝 续写</button>
        <button class="btn" onclick="aiRewrite()">♻️ 重写</button>
        <button class="btn" onclick="aiSuggest()">💡 建议</button>
      </div>
      <div id="editor" class="editor-container"></div>
      <div id="result" class="result-section" style="display: none;">
        <div class="result-content"></div>
        <div class="stats"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { Editor, getAIService } from '../dist/editor.esm.js'

    let editor
    let aiService
    let activeProvider = null

    // 初始化编辑器
    function initEditor() {
      editor = new Editor({
        element: '#editor',
        plugins: ['FormattingPlugin', 'HeadingPlugin'],
        content: `<h2>AI功能测试文本</h2>
<p>这是一段用于测试AI功能的示例文本。你可以尝试以下功能：</p>
<ul>
  <li><strong>纠错</strong>：这里有一些拼写错误需要纠正，例如"错误de文本"、"测式"等。</li>
  <li><strong>补全</strong>：人工智能技术正在改变我们的生活方式，从</li>
  <li><strong>续写</strong>：选择一段文本，让AI继续创作</li>
  <li><strong>重写</strong>：将选中的文本重写得更专业</li>
  <li><strong>建议</strong>：获取改进文本的建议</li>
</ul>`
      })

      aiService = getAIService()
    }

    // 激活提供商
    document.querySelectorAll('.activate-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const card = e.target.closest('.provider-card')
        const provider = card.dataset.provider
        const apiKey = card.querySelector('.api-key-input').value
        const model = card.querySelector('.model-select').value

        if (!apiKey) {
          alert('请输入API密钥')
          return
        }

        try {
          // 更新配置
          const config = {
            providers: {
              [provider]: {
                apiKey,
                model
              }
            }
          }

          aiService.updateConfig(config)
          aiService.setProvider(provider)

          // 更新UI
          document.querySelectorAll('.provider-card').forEach(c => c.classList.remove('active'))
          card.classList.add('active')
          card.querySelector('.provider-status').classList.add('ready')

          activeProvider = provider
          showResult(`已激活 ${card.querySelector('.provider-name').textContent}`, 'success')
        } catch (error) {
          showResult(`激活失败: ${error.message}`, 'error')
        }
      })
    })

    // AI功能
    window.aiCorrect = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('请输入或选择一些文本', 'error')
        return
      }

      showResult('正在处理...', 'info')
      const startTime = performance.now()

      const response = await aiService.correct(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`错误: ${response.error}`, 'error')
      }
    }

    window.aiComplete = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('请输入一些文本作为上下文', 'error')
        return
      }

      showResult('正在生成...', 'info')
      const startTime = performance.now()

      const response = await aiService.complete(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`错误: ${response.error}`, 'error')
      }
    }

    window.aiContinue = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('请输入一些文本作为开头', 'error')
        return
      }

      showResult('正在续写...', 'info')
      const startTime = performance.now()

      const response = await aiService.continue(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`错误: ${response.error}`, 'error')
      }
    }

    window.aiRewrite = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('请选择要重写的文本', 'error')
        return
      }

      showResult('正在重写...', 'info')
      const startTime = performance.now()

      const response = await aiService.rewrite(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`错误: ${response.error}`, 'error')
      }
    }

    window.aiSuggest = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('请输入或选择一些文本', 'error')
        return
      }

      showResult('正在分析...', 'info')
      const startTime = performance.now()

      const response = await aiService.suggest(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`错误: ${response.error}`, 'error')
      }
    }

    // 显示结果
    function showResult(content, type, stats) {
      const resultEl = document.getElementById('result')
      const contentEl = resultEl.querySelector('.result-content')
      const statsEl = resultEl.querySelector('.stats')

      resultEl.style.display = 'block'
      resultEl.className = `result-section ${type}`
      contentEl.textContent = content

      if (stats) {
        const statsHtml = []
        if (stats.time) {
          statsHtml.push(`响应时间: ${stats.time.toFixed(0)}ms`)
        }
        if (stats.usage) {
          statsHtml.push(`输入: ${stats.usage.promptTokens} tokens`)
          statsHtml.push(`输出: ${stats.usage.completionTokens} tokens`)
          statsHtml.push(`总计: ${stats.usage.totalTokens} tokens`)
        }
        if (stats.provider) {
          statsHtml.push(`提供商: ${stats.provider}`)
        }
        statsEl.innerHTML = statsHtml.join(' | ')
      } else {
        statsEl.innerHTML = ''
      }
    }

    // 初始化
    initEditor()
  </script>
</body>

</html>





