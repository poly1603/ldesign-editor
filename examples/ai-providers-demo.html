<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIæä¾›å•†æ¼”ç¤º - @ldesign/editor</title>
  <link rel="stylesheet" href="../dist/editor.css">
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .ai-providers {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .provider-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .provider-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .provider-card.active {
      border: 2px solid #2196F3;
    }

    .provider-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .provider-name {
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }

    .provider-logo {
      width: 40px;
      height: 40px;
      background: #f0f0f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .provider-models {
      margin: 10px 0;
    }

    .provider-models select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .api-key-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #2196F3;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn:hover {
      background: #1976D2;
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .editor-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .editor-container {
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin: 20px 0;
    }

    .ai-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .result-section {
      background: #f8f9fa;
      border-radius: 4px;
      padding: 15px;
      margin-top: 20px;
      min-height: 100px;
    }

    .result-section.error {
      background: #ffebee;
      color: #c62828;
    }

    .result-section.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }

    .instructions {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .instructions h3 {
      margin-top: 0;
      color: #856404;
    }

    .instructions ul {
      margin-bottom: 0;
      padding-left: 20px;
    }

    .provider-status {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ddd;
      margin-left: 10px;
    }

    .provider-status.ready {
      background: #4CAF50;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>AIæä¾›å•†æ¼”ç¤º</h1>
      <p>æ”¯æŒå¤šç§å›½å†…å¤–å¤§è¯­è¨€æ¨¡å‹</p>
    </div>

    <div class="instructions">
      <h3>ä½¿ç”¨è¯´æ˜</h3>
      <ul>
        <li><strong>ç™¾åº¦æ–‡å¿ƒä¸€è¨€</strong>ï¼šAPIå¯†é’¥æ ¼å¼ä¸º "API_KEY:SECRET_KEY"</li>
        <li><strong>é˜¿é‡Œé€šä¹‰åƒé—®</strong>ï¼šç›´æ¥è¾“å…¥APIå¯†é’¥</li>
        <li><strong>è®¯é£æ˜Ÿç«</strong>ï¼šAPIå¯†é’¥æ ¼å¼ä¸º "APP_ID:API_KEY:API_SECRET"</li>
        <li><strong>æ™ºè°±æ¸…è¨€</strong>ï¼šç›´æ¥è¾“å…¥APIå¯†é’¥</li>
        <li><strong>OpenAI/Claude</strong>ï¼šç›´æ¥è¾“å…¥APIå¯†é’¥</li>
      </ul>
    </div>

    <div class="ai-providers">
      <!-- ç™¾åº¦æ–‡å¿ƒä¸€è¨€ -->
      <div class="provider-card" data-provider="baidu">
        <div class="provider-header">
          <span class="provider-name">ç™¾åº¦æ–‡å¿ƒä¸€è¨€</span>
          <span class="provider-logo">ç™¾</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="ernie-bot">ERNIE-Bot</option>
            <option value="ernie-bot-turbo">ERNIE-Bot-Turbo</option>
            <option value="ernie-bot-4">ERNIE-Bot 4.0</option>
            <option value="ernie-3.5-8k">ERNIE 3.5 8K</option>
            <option value="ernie-3.5-128k">ERNIE 3.5 128K</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API_KEY:SECRET_KEY">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- é˜¿é‡Œé€šä¹‰åƒé—® -->
      <div class="provider-card" data-provider="qwen">
        <div class="provider-header">
          <span class="provider-name">é˜¿é‡Œé€šä¹‰åƒé—®</span>
          <span class="provider-logo">é˜¿</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="qwen-turbo">é€šä¹‰åƒé—®-Turbo</option>
            <option value="qwen-plus">é€šä¹‰åƒé—®-Plus</option>
            <option value="qwen-max">é€šä¹‰åƒé—®-Max</option>
            <option value="qwen-max-1201">é€šä¹‰åƒé—®-Max-1201</option>
            <option value="qwen-max-longcontext">é€šä¹‰åƒé—®-è¶…é•¿ä¸Šä¸‹æ–‡</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- è®¯é£æ˜Ÿç« -->
      <div class="provider-card" data-provider="spark">
        <div class="provider-header">
          <span class="provider-name">è®¯é£æ˜Ÿç«</span>
          <span class="provider-logo">è®¯</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="spark-1.5">æ˜Ÿç«1.5</option>
            <option value="spark-2.0">æ˜Ÿç«2.0</option>
            <option value="spark-3.0">æ˜Ÿç«3.0</option>
            <option value="spark-3.5">æ˜Ÿç«3.5</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="APP_ID:API_KEY:API_SECRET">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- æ™ºè°±æ¸…è¨€ -->
      <div class="provider-card" data-provider="glm">
        <div class="provider-header">
          <span class="provider-name">æ™ºè°±æ¸…è¨€</span>
          <span class="provider-logo">æ™º</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="glm-4">GLM-4</option>
            <option value="glm-4-air">GLM-4-Air</option>
            <option value="glm-4-airx">GLM-4-AirX</option>
            <option value="glm-4-flash">GLM-4-Flash</option>
            <option value="glm-3-turbo">GLM-3-Turbo</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- OpenAI -->
      <div class="provider-card" data-provider="openai">
        <div class="provider-header">
          <span class="provider-name">OpenAI</span>
          <span class="provider-logo">AI</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="gpt-3.5-turbo">GPT-3.5-Turbo</option>
            <option value="gpt-4">GPT-4</option>
            <option value="gpt-4-turbo">GPT-4-Turbo</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- Claude -->
      <div class="provider-card" data-provider="claude">
        <div class="provider-header">
          <span class="provider-name">Claude</span>
          <span class="provider-logo">C</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
            <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>

      <!-- DeepSeek -->
      <div class="provider-card" data-provider="deepseek">
        <div class="provider-header">
          <span class="provider-name">DeepSeek</span>
          <span class="provider-logo">DS</span>
          <span class="provider-status"></span>
        </div>
        <div class="provider-models">
          <select class="model-select">
            <option value="deepseek-chat">DeepSeek Chat</option>
            <option value="deepseek-coder">DeepSeek Coder</option>
          </select>
        </div>
        <input type="password" class="api-key-input" placeholder="API Key">
        <button class="btn activate-btn">æ¿€æ´»</button>
      </div>
    </div>

    <div class="editor-section">
      <h2>ç¼–è¾‘å™¨</h2>
      <div class="ai-actions">
        <button class="btn" onclick="aiCorrect()">ğŸ”§ çº é”™</button>
        <button class="btn" onclick="aiComplete()">âœï¸ è¡¥å…¨</button>
        <button class="btn" onclick="aiContinue()">ğŸ“ ç»­å†™</button>
        <button class="btn" onclick="aiRewrite()">â™»ï¸ é‡å†™</button>
        <button class="btn" onclick="aiSuggest()">ğŸ’¡ å»ºè®®</button>
      </div>
      <div id="editor" class="editor-container"></div>
      <div id="result" class="result-section" style="display: none;">
        <div class="result-content"></div>
        <div class="stats"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { Editor, getAIService } from '../dist/editor.esm.js'

    let editor
    let aiService
    let activeProvider = null

    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    function initEditor() {
      editor = new Editor({
        element: '#editor',
        plugins: ['FormattingPlugin', 'HeadingPlugin'],
        content: `<h2>AIåŠŸèƒ½æµ‹è¯•æ–‡æœ¬</h2>
<p>è¿™æ˜¯ä¸€æ®µç”¨äºæµ‹è¯•AIåŠŸèƒ½çš„ç¤ºä¾‹æ–‡æœ¬ã€‚ä½ å¯ä»¥å°è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
  <li><strong>çº é”™</strong>ï¼šè¿™é‡Œæœ‰ä¸€äº›æ‹¼å†™é”™è¯¯éœ€è¦çº æ­£ï¼Œä¾‹å¦‚"é”™è¯¯deæ–‡æœ¬"ã€"æµ‹å¼"ç­‰ã€‚</li>
  <li><strong>è¡¥å…¨</strong>ï¼šäººå·¥æ™ºèƒ½æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼ï¼Œä»</li>
  <li><strong>ç»­å†™</strong>ï¼šé€‰æ‹©ä¸€æ®µæ–‡æœ¬ï¼Œè®©AIç»§ç»­åˆ›ä½œ</li>
  <li><strong>é‡å†™</strong>ï¼šå°†é€‰ä¸­çš„æ–‡æœ¬é‡å†™å¾—æ›´ä¸“ä¸š</li>
  <li><strong>å»ºè®®</strong>ï¼šè·å–æ”¹è¿›æ–‡æœ¬çš„å»ºè®®</li>
</ul>`
      })

      aiService = getAIService()
    }

    // æ¿€æ´»æä¾›å•†
    document.querySelectorAll('.activate-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const card = e.target.closest('.provider-card')
        const provider = card.dataset.provider
        const apiKey = card.querySelector('.api-key-input').value
        const model = card.querySelector('.model-select').value

        if (!apiKey) {
          alert('è¯·è¾“å…¥APIå¯†é’¥')
          return
        }

        try {
          // æ›´æ–°é…ç½®
          const config = {
            providers: {
              [provider]: {
                apiKey,
                model
              }
            }
          }

          aiService.updateConfig(config)
          aiService.setProvider(provider)

          // æ›´æ–°UI
          document.querySelectorAll('.provider-card').forEach(c => c.classList.remove('active'))
          card.classList.add('active')
          card.querySelector('.provider-status').classList.add('ready')

          activeProvider = provider
          showResult(`å·²æ¿€æ´» ${card.querySelector('.provider-name').textContent}`, 'success')
        } catch (error) {
          showResult(`æ¿€æ´»å¤±è´¥: ${error.message}`, 'error')
        }
      })
    })

    // AIåŠŸèƒ½
    window.aiCorrect = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('è¯·è¾“å…¥æˆ–é€‰æ‹©ä¸€äº›æ–‡æœ¬', 'error')
        return
      }

      showResult('æ­£åœ¨å¤„ç†...', 'info')
      const startTime = performance.now()

      const response = await aiService.correct(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`é”™è¯¯: ${response.error}`, 'error')
      }
    }

    window.aiComplete = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('è¯·è¾“å…¥ä¸€äº›æ–‡æœ¬ä½œä¸ºä¸Šä¸‹æ–‡', 'error')
        return
      }

      showResult('æ­£åœ¨ç”Ÿæˆ...', 'info')
      const startTime = performance.now()

      const response = await aiService.complete(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`é”™è¯¯: ${response.error}`, 'error')
      }
    }

    window.aiContinue = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('è¯·è¾“å…¥ä¸€äº›æ–‡æœ¬ä½œä¸ºå¼€å¤´', 'error')
        return
      }

      showResult('æ­£åœ¨ç»­å†™...', 'info')
      const startTime = performance.now()

      const response = await aiService.continue(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`é”™è¯¯: ${response.error}`, 'error')
      }
    }

    window.aiRewrite = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('è¯·é€‰æ‹©è¦é‡å†™çš„æ–‡æœ¬', 'error')
        return
      }

      showResult('æ­£åœ¨é‡å†™...', 'info')
      const startTime = performance.now()

      const response = await aiService.rewrite(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`é”™è¯¯: ${response.error}`, 'error')
      }
    }

    window.aiSuggest = async () => {
      const text = editor.getSelectedText() || editor.getText()
      if (!text) {
        showResult('è¯·è¾“å…¥æˆ–é€‰æ‹©ä¸€äº›æ–‡æœ¬', 'error')
        return
      }

      showResult('æ­£åœ¨åˆ†æ...', 'info')
      const startTime = performance.now()

      const response = await aiService.suggest(text)
      const endTime = performance.now()

      if (response.success) {
        showResult(response.text, 'success', {
          time: endTime - startTime,
          usage: response.usage,
          provider: activeProvider
        })
      } else {
        showResult(`é”™è¯¯: ${response.error}`, 'error')
      }
    }

    // æ˜¾ç¤ºç»“æœ
    function showResult(content, type, stats) {
      const resultEl = document.getElementById('result')
      const contentEl = resultEl.querySelector('.result-content')
      const statsEl = resultEl.querySelector('.stats')

      resultEl.style.display = 'block'
      resultEl.className = `result-section ${type}`
      contentEl.textContent = content

      if (stats) {
        const statsHtml = []
        if (stats.time) {
          statsHtml.push(`å“åº”æ—¶é—´: ${stats.time.toFixed(0)}ms`)
        }
        if (stats.usage) {
          statsHtml.push(`è¾“å…¥: ${stats.usage.promptTokens} tokens`)
          statsHtml.push(`è¾“å‡º: ${stats.usage.completionTokens} tokens`)
          statsHtml.push(`æ€»è®¡: ${stats.usage.totalTokens} tokens`)
        }
        if (stats.provider) {
          statsHtml.push(`æä¾›å•†: ${stats.provider}`)
        }
        statsEl.innerHTML = statsHtml.join(' | ')
      } else {
        statsEl.innerHTML = ''
      }
    }

    // åˆå§‹åŒ–
    initEditor()
  </script>
</body>

</html>





