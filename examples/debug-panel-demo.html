<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDesign Editor - è°ƒè¯•é¢æ¿æ¼”ç¤º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .header {
      padding: 30px;
      border-bottom: 1px solid #e8e8e8;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 8px 8px 0 0;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      font-size: 12px;
      color: #666;
      font-weight: 500;
    }

    .control-group button,
    .control-group select {
      padding: 8px 16px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .control-group button:hover {
      background: #f0f0f0;
      border-color: #999;
    }

    .control-group button.primary {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .control-group button.primary:hover {
      background: #5a67d8;
    }

    .editor-container {
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    .ldesign-editor {
      height: 100%;
    }

    .info-section {
      background: #e6f7ff;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .info-section h3 {
      font-size: 16px;
      margin-bottom: 8px;
      color: #1890ff;
    }

    .info-section ul {
      list-style: none;
      font-size: 14px;
    }

    .info-section li {
      padding: 4px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .test-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .test-action {
      padding: 12px;
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .test-action:hover {
      background: #e8e8e8;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .test-action .icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .test-action .title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .test-action .desc {
      font-size: 12px;
      color: #666;
    }

    .shortcut-info {
      background: #fff3cd;
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 13px;
      color: #856404;
      margin-top: 20px;
    }

    .shortcut-info code {
      background: rgba(0, 0, 0, 0.1);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>
        <span>ğŸ”§</span>
        è°ƒè¯•é¢æ¿æ¼”ç¤º
      </h1>
      <p>ä½“éªŒå¼ºå¤§çš„ç¼–è¾‘å™¨è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·</p>
    </div>

    <div class="content">
      <div class="info-section">
        <h3>ğŸ“Š è°ƒè¯•é¢æ¿åŠŸèƒ½</h3>
        <ul>
          <li>ğŸ“ˆ <strong>æ€§èƒ½ç›‘æ§</strong> - å®æ—¶FPSã€å†…å­˜ä½¿ç”¨ã€æ¸²æŸ“æ—¶é—´</li>
          <li>ğŸ’¾ <strong>å†…å­˜åˆ†æ</strong> - å†…å­˜æ³„æ¼æ£€æµ‹ã€å¯¹è±¡è¿½è¸ª</li>
          <li>ğŸŒ <strong>ç½‘ç»œè¿½è¸ª</strong> - è¯·æ±‚ç›‘æ§ã€å“åº”æ—¶é—´åˆ†æ</li>
          <li>ğŸ”Œ <strong>æ’ä»¶è°ƒè¯•</strong> - æ’ä»¶çŠ¶æ€ã€åŠ è½½æ—¶é—´ã€é”™è¯¯è¿½è¸ª</li>
          <li>ğŸ’» <strong>æ§åˆ¶å°</strong> - æ—¥å¿—æŸ¥çœ‹ã€é”™è¯¯æ•è·ã€æœç´¢è¿‡æ»¤</li>
          <li>ğŸŒ³ <strong>DOMæ£€æŸ¥</strong> - DOMç»“æ„å¯è§†åŒ–ã€å…ƒç´ é«˜äº®</li>
          <li>ğŸ“œ <strong>å†å²è®°å½•</strong> - æ“ä½œå†å²ã€æ—¶é—´è½´è§†å›¾</li>
          <li>âš™ï¸ <strong>é…ç½®ç®¡ç†</strong> - å®æ—¶é…ç½®è°ƒæ•´ã€å¯¼å…¥å¯¼å‡º</li>
        </ul>
      </div>

      <div class="controls">
        <div class="control-group">
          <label>è°ƒè¯•é¢æ¿æ§åˆ¶</label>
          <button id="toggleDebugPanel" class="primary">æ˜¾ç¤ºè°ƒè¯•é¢æ¿</button>
        </div>

        <div class="control-group">
          <label>é¢æ¿ä½ç½®</label>
          <select id="panelPosition">
            <option value="bottom">åº•éƒ¨</option>
            <option value="right">å³ä¾§</option>
            <option value="floating">æµ®åŠ¨</option>
          </select>
        </div>

        <div class="control-group">
          <label>åˆå§‹æ ‡ç­¾é¡µ</label>
          <select id="initialTab">
            <option value="performance">æ€§èƒ½</option>
            <option value="memory">å†…å­˜</option>
            <option value="network">ç½‘ç»œ</option>
            <option value="plugins">æ’ä»¶</option>
            <option value="console">æ§åˆ¶å°</option>
            <option value="dom">DOM</option>
            <option value="history">å†å²</option>
            <option value="config">é…ç½®</option>
          </select>
        </div>

        <div class="control-group">
          <label>ä¸»é¢˜</label>
          <select id="theme">
            <option value="auto">è‡ªåŠ¨</option>
            <option value="light">æµ…è‰²</option>
            <option value="dark">æ·±è‰²</option>
          </select>
        </div>
      </div>

      <div class="editor-container">
        <div id="editor"></div>
      </div>

      <h3 style="margin-bottom: 15px;">ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
      <div class="test-actions">
        <div class="test-action" onclick="testPerformance()">
          <div class="icon">âš¡</div>
          <div class="title">æ€§èƒ½å‹åŠ›æµ‹è¯•</div>
          <div class="desc">æ’å…¥å¤§é‡å†…å®¹æµ‹è¯•æ€§èƒ½</div>
        </div>

        <div class="test-action" onclick="testMemoryLeak()">
          <div class="icon">ğŸ’¾</div>
          <div class="title">å†…å­˜æ³„æ¼æµ‹è¯•</div>
          <div class="desc">åˆ›å»ºæ½œåœ¨çš„å†…å­˜æ³„æ¼</div>
        </div>

        <div class="test-action" onclick="testNetworkRequests()">
          <div class="icon">ğŸŒ</div>
          <div class="title">ç½‘ç»œè¯·æ±‚æµ‹è¯•</div>
          <div class="desc">å‘é€å¤šä¸ªAPIè¯·æ±‚</div>
        </div>

        <div class="test-action" onclick="testConsoleMessages()">
          <div class="icon">ğŸ’»</div>
          <div class="title">æ§åˆ¶å°æ¶ˆæ¯</div>
          <div class="desc">ç”Ÿæˆå„ç§æ—¥å¿—æ¶ˆæ¯</div>
        </div>

        <div class="test-action" onclick="testErrors()">
          <div class="icon">âŒ</div>
          <div class="title">é”™è¯¯ç”Ÿæˆ</div>
          <div class="desc">è§¦å‘å„ç§é”™è¯¯</div>
        </div>

        <div class="test-action" onclick="testDOMChanges()">
          <div class="icon">ğŸŒ³</div>
          <div class="title">DOMå˜æ›´</div>
          <div class="desc">å¤§é‡DOMæ“ä½œ</div>
        </div>

        <div class="test-action" onclick="testHistory()">
          <div class="icon">ğŸ“œ</div>
          <div class="title">å†å²è®°å½•</div>
          <div class="desc">ç”Ÿæˆç¼–è¾‘å†å²</div>
        </div>

        <div class="test-action" onclick="testPluginLoad()">
          <div class="icon">ğŸ”Œ</div>
          <div class="title">æ’ä»¶åŠ è½½</div>
          <div class="desc">åŠ¨æ€åŠ è½½æ’ä»¶</div>
        </div>
      </div>

      <div class="shortcut-info">
        ğŸ’¡ <strong>å¿«æ·é”®ï¼š</strong>
        <code>Ctrl/Cmd + Shift + D</code> åˆ‡æ¢è°ƒè¯•é¢æ¿ |
        <code>Ctrl/Cmd + Shift + P</code> åˆ‡æ¢åˆ°æ€§èƒ½æ ‡ç­¾ |
        <code>ESC</code> å…³é—­é¢æ¿
      </div>
    </div>
  </div>

  <script type="module">
    import { Editor } from '../dist/es/index.js'

    // ç¤ºä¾‹å†…å®¹
    const initialContent = `
      <h2>æ¬¢è¿ä½¿ç”¨ LDesign Editor è°ƒè¯•é¢æ¿ï¼</h2>
      <p>è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼Œå¸®åŠ©æ‚¨ï¼š</p>
      <ul>
        <li>ç›‘æ§ç¼–è¾‘å™¨æ€§èƒ½</li>
        <li>åˆ†æå†…å­˜ä½¿ç”¨</li>
        <li>è¿½è¸ªç½‘ç»œè¯·æ±‚</li>
        <li>è°ƒè¯•æ’ä»¶é—®é¢˜</li>
        <li>æŸ¥çœ‹æ“ä½œå†å²</li>
      </ul>
      <p>ç‚¹å‡»ä¸Šæ–¹çš„æµ‹è¯•æŒ‰é’®æ¥è§¦å‘å„ç§è°ƒè¯•åœºæ™¯ï¼Œè§‚å¯Ÿè°ƒè¯•é¢æ¿çš„å®æ—¶åé¦ˆã€‚</p>
    `

    // åˆå§‹åŒ–ç¼–è¾‘å™¨
    const editor = new Editor({
      content: initialContent,
      placeholder: 'å¼€å§‹è¾“å…¥...',
      debugPanel: {
        enabled: false,
        expanded: true,
        initialTab: 'performance',
        position: 'bottom',
        theme: 'auto',
        size: '350px',
        resizable: true,
        showInProduction: true
      },
      virtualScroll: {
        enabled: true
      },
      wasm: {
        enabled: true
      },
      onChange: (content) => {
        console.log('Content changed:', content.length + ' characters')
      }
    })

    editor.mount('#editor')
    window.editor = editor

    // æ§åˆ¶è°ƒè¯•é¢æ¿
    const toggleBtn = document.getElementById('toggleDebugPanel')
    let debugPanelEnabled = false

    toggleBtn.addEventListener('click', () => {
      if (!debugPanelEnabled) {
        // åˆ›å»ºè°ƒè¯•é¢æ¿
        editor.debugPanel = new editor.constructor.DebugPanel({
          editor: editor,
          expanded: true,
          initialTab: document.getElementById('initialTab').value,
          position: document.getElementById('panelPosition').value,
          theme: document.getElementById('theme').value,
          size: '350px',
          resizable: true,
          showInProduction: true
        })
        debugPanelEnabled = true
        toggleBtn.textContent = 'éšè—è°ƒè¯•é¢æ¿'
      } else {
        // å…³é—­è°ƒè¯•é¢æ¿
        editor.debugPanel?.close()
        debugPanelEnabled = false
        toggleBtn.textContent = 'æ˜¾ç¤ºè°ƒè¯•é¢æ¿'
      }
    })

    // ä½ç½®å˜æ›´
    document.getElementById('panelPosition').addEventListener('change', (e) => {
      if (editor.debugPanel) {
        // é‡æ–°åˆ›å»ºé¢æ¿ä»¥åº”ç”¨æ–°ä½ç½®
        editor.debugPanel.close()
        editor.debugPanel = new editor.constructor.DebugPanel({
          editor: editor,
          expanded: true,
          initialTab: document.getElementById('initialTab').value,
          position: e.target.value,
          theme: document.getElementById('theme').value,
          size: '350px',
          resizable: true,
          showInProduction: true
        })
      }
    })

    // æµ‹è¯•å‡½æ•°
    window.testPerformance = () => {
      console.time('Performance Test')
      const startTime = performance.now()

      // æ’å…¥å¤§é‡å†…å®¹
      for (let i = 0; i < 100; i++) {
        editor.insertText(`è¿™æ˜¯ç¬¬ ${i + 1} è¡Œæµ‹è¯•å†…å®¹ï¼Œç”¨äºæ€§èƒ½æµ‹è¯•ã€‚`)
        if (i < 99) editor.insertText('\n')
      }

      const endTime = performance.now()
      console.timeEnd('Performance Test')
      console.log(`æ’å…¥100è¡Œå†…å®¹è€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`)
    }

    window.testMemoryLeak = () => {
      console.log('å¼€å§‹å†…å­˜æ³„æ¼æµ‹è¯•...')

      // åˆ›å»ºå¤§æ•°ç»„ä½†ä¸é‡Šæ”¾
      const leakyArrays = []
      for (let i = 0; i < 10; i++) {
        const bigArray = new Array(1000000).fill(`Memory leak test ${i}`)
        leakyArrays.push(bigArray)
      }

      // åˆ›å»ºå¾ªç¯å¼•ç”¨
      const obj1 = { name: 'Object 1' }
      const obj2 = { name: 'Object 2' }
      obj1.ref = obj2
      obj2.ref = obj1

      console.log('å·²åˆ›å»ºæ½œåœ¨çš„å†…å­˜æ³„æ¼')
    }

    window.testNetworkRequests = async () => {
      console.log('å¼€å§‹ç½‘ç»œè¯·æ±‚æµ‹è¯•...')

      const urls = [
        'https://api.github.com/users/github',
        'https://jsonplaceholder.typicode.com/posts/1',
        'https://jsonplaceholder.typicode.com/users',
        'https://httpbin.org/delay/1',
        'https://httpbin.org/status/404'
      ]

      for (const url of urls) {
        try {
          const response = await fetch(url)
          console.log(`è¯·æ±‚å®Œæˆ: ${url} - çŠ¶æ€: ${response.status}`)
        } catch (error) {
          console.error(`è¯·æ±‚å¤±è´¥: ${url}`, error)
        }
      }
    }

    window.testConsoleMessages = () => {
      console.log('è¿™æ˜¯ä¸€æ¡æ™®é€šæ—¥å¿—æ¶ˆæ¯')
      console.info('è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯')
      console.warn('è¿™æ˜¯ä¸€æ¡è­¦å‘Šæ¶ˆæ¯ï¼Œæé†’æ‚¨æ³¨æ„æŸäº›é—®é¢˜')
      console.error('è¿™æ˜¯ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œè¡¨ç¤ºå‡ºç°äº†ä¸¥é‡é—®é¢˜')
      console.debug('è¿™æ˜¯ä¸€æ¡è°ƒè¯•æ¶ˆæ¯ï¼Œç”¨äºå¼€å‘è°ƒè¯•')

      // å¤æ‚å¯¹è±¡
      console.log('å¤æ‚å¯¹è±¡:', {
        name: 'Test Object',
        array: [1, 2, 3, 4, 5],
        nested: {
          deep: {
            value: 'Deep nested value'
          }
        },
        date: new Date(),
        function: () => 'Function result'
      })

      // å¤šä¸ªå‚æ•°
      console.log('å¤šä¸ªå‚æ•°:', 'String', 123, true, null, undefined, { key: 'value' })

      // é‡å¤æ¶ˆæ¯
      for (let i = 0; i < 5; i++) {
        console.log('é‡å¤çš„æ¶ˆæ¯')
      }
    }

    window.testErrors = () => {
      // è¯­æ³•é”™è¯¯
      try {
        eval('invalid javascript syntax {{')
      } catch (error) {
        console.error('è¯­æ³•é”™è¯¯:', error)
      }

      // ç±»å‹é”™è¯¯
      try {
        const nullValue = null
        nullValue.someMethod()
      } catch (error) {
        console.error('ç±»å‹é”™è¯¯:', error)
      }

      // å¼•ç”¨é”™è¯¯
      try {
        undefinedVariable.doSomething()
      } catch (error) {
        console.error('å¼•ç”¨é”™è¯¯:', error)
      }

      // Promise é”™è¯¯
      Promise.reject('Promise rejection error').catch(() => { })

      // æŠ›å‡ºé”™è¯¯
      setTimeout(() => {
        throw new Error('å¼‚æ­¥é”™è¯¯')
      }, 100)
    }

    window.testDOMChanges = () => {
      console.log('å¼€å§‹DOMå˜æ›´æµ‹è¯•...')

      const content = editor.getElement()

      // åˆ›å»ºå¤šä¸ªå…ƒç´ 
      for (let i = 0; i < 20; i++) {
        const div = document.createElement('div')
        div.className = `test-element-${i}`
        div.textContent = `æµ‹è¯•å…ƒç´  ${i}`
        div.style.padding = '5px'
        div.style.margin = '2px'
        div.style.background = `hsl(${i * 18}, 70%, 90%)`
        content.appendChild(div)
      }

      // ä¿®æ”¹å±æ€§
      setTimeout(() => {
        const elements = content.querySelectorAll('[class^="test-element"]')
        elements.forEach((el, index) => {
          el.style.transform = `translateX(${Math.sin(index) * 20}px)`
        })
      }, 500)

      // åˆ é™¤ä¸€äº›å…ƒç´ 
      setTimeout(() => {
        const elements = content.querySelectorAll('[class^="test-element"]')
        for (let i = 0; i < elements.length; i += 2) {
          elements[i].remove()
        }
      }, 1000)
    }

    window.testHistory = () => {
      console.log('ç”Ÿæˆç¼–è¾‘å†å²...')

      const actions = [
        () => editor.insertText('æ·»åŠ ä¸€äº›æ–‡æœ¬\n'),
        () => editor.insertText('å†æ·»åŠ ä¸€è¡Œ\n'),
        () => editor.execCommand('bold'),
        () => editor.execCommand('italic'),
        () => editor.insertText('æ ¼å¼åŒ–çš„æ–‡æœ¬\n'),
        () => editor.execCommand('undo'),
        () => editor.execCommand('redo'),
        () => editor.insertText('æœ€åä¸€è¡Œæ–‡æœ¬')
      ]

      let index = 0
      const interval = setInterval(() => {
        if (index < actions.length) {
          actions[index]()
          index++
        } else {
          clearInterval(interval)
          console.log('å†å²è®°å½•ç”Ÿæˆå®Œæˆ')
        }
      }, 500)
    }

    window.testPluginLoad = () => {
      console.log('æµ‹è¯•æ’ä»¶åŠ è½½...')

      // æ¨¡æ‹Ÿæ’ä»¶åŠ è½½
      const fakePlugin = {
        name: 'test-plugin',
        version: '1.0.0',
        description: 'æµ‹è¯•æ’ä»¶',
        author: 'Test Author',
        loadTime: Math.random() * 100 + 50
      }

      editor.emit('plugin-loaded', fakePlugin.name)
      console.log('æ’ä»¶å·²åŠ è½½:', fakePlugin)

      // æ¨¡æ‹Ÿæ’ä»¶é”™è¯¯
      setTimeout(() => {
        editor.emit('error', new Error(`æ’ä»¶ ${fakePlugin.name} æ‰§è¡Œå‡ºé”™`))
      }, 1000)
    }
  </script>
</body>

</html>

