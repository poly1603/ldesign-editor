# 调试指南

## 访问测试页面

在浏览器中打开: **http://localhost:9999/**

## 调试工具

### 1. 浏览器开发者工具

**打开方式**:
- Windows/Linux: `F12` 或 `Ctrl+Shift+I`
- Mac: `Cmd+Option+I`

**主要面板**:
- **Console**: 查看日志和错误
- **Elements**: 检查DOM结构和样式
- **Network**: 监控网络请求
- **Performance**: 性能分析
- **Application**: 查看localStorage/sessionStorage

### 2. 自动化测试工具

在浏览器中打开: `file:///path/to/tests/自动化测试脚本.html`

功能:
- 自动运行所有测试
- 实时显示测试结果
- 性能统计
- 详细日志

### 3. 功能测试清单

参考: `tests/功能测试清单.md`

系统地测试每个功能模块。

## 检查步骤

### 第一步: 基础功能检查

```javascript
// 在浏览器Console中执行

// 1. 检查编辑器是否加载
console.log('Editor:', typeof Editor)

// 2. 检查配置管理器
console.log('ConfigManager:', typeof getConfigManager)
const config = getConfigManager()
console.log('Config:', config)

// 3. 检查图标管理器
console.log('IconManager:', typeof getIconManager)
const iconManager = getIconManager()
console.log('Current IconSet:', iconManager.getCurrentIconSet())
console.log('Available IconSets:', iconManager.getAvailableIconSets())

// 4. 检查主题管理器
console.log('ThemeManager:', typeof getThemeManager)
const themeManager = getThemeManager()
console.log('Current Theme:', themeManager.getCurrentThemeName())
console.log('Available Themes:', themeManager.getAvailableThemes())

// 5. 检查多语言管理器
console.log('I18nManager:', typeof getI18n)
const i18n = getI18n()
console.log('Current Locale:', i18n.getLocale())
console.log('Available Locales:', i18n.getAvailableLocales())
```

### 第二步: 交互功能测试

```javascript
// 测试图标切换
iconManager.setDefaultIconSet('feather')
// 观察工具栏图标是否变化

// 测试主题切换
themeManager.setTheme('dark')
// 观察页面主题是否变化

// 测试语言切换
await i18n.setLocale('en-US')
// 观察UI文字是否变化
```

### 第三步: 设置面板测试

```javascript
// 打开设置面板
showSettingsPanel({
  onSave: (config) => {
    console.log('保存的配置:', config)
  },
  onClose: () => {
    console.log('面板已关闭')
  }
})
```

### 第四步: 配置持久化测试

```javascript
// 导出配置
const configJson = config.exportConfig()
console.log('导出的配置:', configJson)
localStorage.setItem('test-config', configJson)

// 导入配置
const saved = localStorage.getItem('test-config')
config.importConfig(saved)
console.log('配置已恢复')

// 重置配置
config.reset()
console.log('配置已重置')
```

### 第五步: UI组件工厂测试

```javascript
// 测试创建按钮
const btn = createButton({
  label: '测试按钮',
  type: 'primary',
  icon: 'save',
  onClick: () => console.log('点击了按钮')
})
document.body.appendChild(btn)

// 测试创建输入框
const input = createInput({
  placeholder: '测试输入',
  onChange: (value) => console.log('输入:', value)
})
document.body.appendChild(input)

// 测试创建下拉框
const select = createSelect({
  options: [
    { label: '选项1', value: 1 },
    { label: '选项2', value: 2 }
  ],
  onChange: (value) => console.log('选择:', value)
})
document.body.appendChild(select)
```

## 常见问题排查

### 问题1: 模块未定义

**症状**: `Uncaught ReferenceError: xxx is not defined`

**检查**:
1. 是否正确引入了库文件
2. 是否使用了正确的导入方式
3. 检查Network面板，确认文件已加载

**解决**:
```html
<!-- 确保正确引入 -->
<script type="module">
  import { Editor, getConfigManager } from './dist/index.js'
</script>
```

### 问题2: 图标不显示

**症状**: 工具栏或按钮中的图标显示不出来

**检查**:
```javascript
// 1. 检查图标管理器是否初始化
const iconManager = getIconManager()
console.log('IconManager:', iconManager)

// 2. 检查当前图标集
console.log('Current Set:', iconManager.getCurrentIconSet())

// 3. 检查图标是否存在
const icon = iconManager.getIcon('bold')
console.log('Bold Icon:', icon)

// 4. 尝试手动渲染
const iconHtml = iconManager.renderIcon('bold', { size: 24 })
console.log('Icon HTML:', iconHtml)
```

**解决**:
- 确认图标名称正确
- 确认图标集已加载
- 检查CSS样式是否正确

### 问题3: 主题不生效

**症状**: 切换主题后样式没有变化

**检查**:
```javascript
// 1. 检查主题管理器
const themeManager = getThemeManager()
console.log('ThemeManager:', themeManager)

// 2. 检查当前主题
console.log('Current Theme:', themeManager.getCurrentThemeName())

// 3. 检查CSS变量
const root = document.documentElement
console.log('Primary Color:', getComputedStyle(root).getPropertyValue('--editor-color-primary'))
```

**解决**:
- 确认CSS文件已引入
- 检查CSS变量是否正确应用
- 清除浏览器缓存

### 问题4: 语言切换未生效

**症状**: 切换语言后界面文字没有变化

**检查**:
```javascript
// 1. 检查I18n管理器
const i18n = getI18n()
console.log('I18n:', i18n)

// 2. 检查当前语言
console.log('Current Locale:', i18n.getLocale())

// 3. 测试翻译
console.log('Bold Text:', i18n.t('editor.toolbar.bold'))
```

**解决**:
- 确认使用了 `await` 等待语言切换
- 重新渲染需要翻译的组件
- 检查翻译键是否正确

### 问题5: 配置持久化失败

**症状**: 刷新页面后配置丢失

**检查**:
```javascript
// 1. 检查localStorage
console.log('Storage:', localStorage.getItem('editor-config'))

// 2. 测试导出
const config = getConfigManager()
const json = config.exportConfig()
console.log('Export:', json)

// 3. 测试导入
try {
  config.importConfig(json)
  console.log('Import Success')
} catch (error) {
  console.error('Import Error:', error)
}
```

**解决**:
- 确认浏览器支持localStorage
- 检查是否禁用了cookie
- 确认JSON格式正确

## 性能调试

### 1. 检查加载时间

```javascript
// 在Console中执行
window.performance.timing.loadEventEnd - window.performance.timing.navigationStart
```

### 2. 检查内存使用

1. 打开Performance面板
2. 点击"Record"
3. 进行一些操作
4. 停止录制
5. 查看内存使用图表

### 3. 检查渲染性能

```javascript
// 测试主题切换性能
console.time('Theme Switch')
themeManager.setTheme('dark')
console.timeEnd('Theme Switch')

// 测试图标渲染性能
console.time('Icon Render')
iconManager.renderIcon('bold')
console.timeEnd('Icon Render')
```

## 网络调试

### 1. 查看所有请求

打开Network面板，刷新页面，查看：
- JS文件是否加载成功
- CSS文件是否加载成功
- 图片资源是否加载成功
- 请求状态码是否正常

### 2. 检查CORS问题

如果看到CORS错误:
```
Access to ... from origin ... has been blocked by CORS policy
```

**解决**:
- 使用本地服务器而非file://协议
- 配置服务器允许CORS
- 使用开发代理

## 兼容性测试

### 测试不同浏览器

1. Chrome
2. Firefox
3. Safari
4. Edge

### 测试不同设备

1. 桌面端 (1920x1080)
2. 平板端 (768x1024)
3. 移动端 (375x667)

### 使用设备模拟

Chrome DevTools:
1. 按 `Ctrl+Shift+M` 打开设备模拟
2. 选择不同设备
3. 测试响应式布局

## 日志和监控

### 1. 启用详细日志

```javascript
// 设置日志级别
localStorage.setItem('debug', 'editor:*')

// 刷新页面，查看详细日志
```

### 2. 监控事件

```javascript
// 监听配置变化
const config = getConfigManager()
config.on('config:changed', (data) => {
  console.log('Config Changed:', data)
})

// 监听图标集变化
const iconManager = getIconManager()
iconManager.on('iconset:changed', (data) => {
  console.log('IconSet Changed:', data)
})

// 监听主题变化
const themeManager = getThemeManager()
themeManager.on('themeChange', (data) => {
  console.log('Theme Changed:', data)
})
```

### 3. 性能监控

```javascript
// 监控长任务
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log('Long Task:', entry)
  }
})
observer.observe({ entryTypes: ['longtask'] })
```

## 建议新增的功能

基于测试结果，可能需要考虑添加：

### 1. 键盘快捷键面板
显示所有可用的快捷键

### 2. 撤销历史面板
可视化显示撤销/重做历史

### 3. 实时协作功能
多人同时编辑

### 4. 版本控制
文档版本管理和对比

### 5. 导入导出增强
支持更多格式（Word、PDF等）

### 6. 插件市场
在线安装和管理插件

### 7. 性能监控面板
实时显示编辑器性能指标

### 8. 辅助功能增强
更好的屏幕阅读器支持

## 报告问题

发现问题后，请收集以下信息：

1. **问题描述**: 详细描述问题
2. **重现步骤**: 如何重现问题
3. **预期结果**: 期望的行为
4. **实际结果**: 实际的行为
5. **环境信息**: 
   - 浏览器版本
   - 操作系统
   - 编辑器版本
6. **截图/视频**: 如果可能
7. **Console日志**: 相关的错误信息
8. **Network截图**: 网络请求情况

## 联系方式

如有问题，请：
1. 查看文档
2. 搜索已知问题
3. 提交Issue
4. 联系开发团队

---

**祝测试顺利！** 🎉






