<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>编辑器自动化测试</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .header p {
      opacity: 0.9;
    }

    .content {
      padding: 24px;
    }

    .test-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .test-results {
      display: grid;
      gap: 16px;
    }

    .test-group {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
    }

    .test-group-header {
      background: #f9fafb;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .test-group-header:hover {
      background: #f3f4f6;
    }

    .test-group-title {
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .test-group-stats {
      font-size: 14px;
      color: #6b7280;
    }

    .test-list {
      padding: 0;
      display: none;
    }

    .test-list.expanded {
      display: block;
    }

    .test-item {
      padding: 12px 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .test-name {
      font-size: 14px;
      color: #374151;
    }

    .test-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .status-pending {
      color: #6b7280;
    }

    .status-running {
      color: #3b82f6;
    }

    .status-pass {
      color: #10b981;
    }

    .status-fail {
      color: #ef4444;
    }

    .status-skip {
      color: #f59e0b;
    }

    .summary {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }

    .summary-item {
      text-align: center;
    }

    .summary-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .summary-label {
      font-size: 14px;
      color: #6b7280;
    }

    .progress-bar {
      height: 4px;
      background: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #10b981);
      width: 0%;
      transition: width 0.3s;
    }

    .log {
      background: #1f2937;
      color: #f9fafb;
      padding: 16px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 24px;
    }

    .log-entry {
      margin-bottom: 4px;
      display: flex;
      gap: 8px;
    }

    .log-time {
      color: #9ca3af;
    }

    .log-level-info {
      color: #3b82f6;
    }

    .log-level-success {
      color: #10b981;
    }

    .log-level-error {
      color: #ef4444;
    }

    .log-level-warn {
      color: #f59e0b;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .spinning {
      animation: spin 1s linear infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🧪 编辑器自动化测试</h1>
      <p>测试编辑器的所有功能，确保一切正常运行</p>
    </div>

    <div class="content">
      <!-- 控制按钮 -->
      <div class="test-controls">
        <button class="btn btn-primary" id="run-all">
          <span>▶️</span>
          <span>运行所有测试</span>
        </button>
        <button class="btn btn-secondary" id="run-selected">
          <span>✓</span>
          <span>运行选中测试</span>
        </button>
        <button class="btn btn-secondary" id="stop-tests">
          <span>⏹</span>
          <span>停止测试</span>
        </button>
        <button class="btn btn-secondary" id="clear-results">
          <span>🗑️</span>
          <span>清空结果</span>
        </button>
      </div>

      <!-- 进度条 -->
      <div class="progress-bar">
        <div class="progress-fill" id="progress"></div>
      </div>

      <!-- 测试摘要 -->
      <div class="summary">
        <div class="summary-item">
          <div class="summary-value" id="total-tests">0</div>
          <div class="summary-label">总测试数</div>
        </div>
        <div class="summary-item">
          <div class="summary-value status-pass" id="passed-tests">0</div>
          <div class="summary-label">通过</div>
        </div>
        <div class="summary-item">
          <div class="summary-value status-fail" id="failed-tests">0</div>
          <div class="summary-label">失败</div>
        </div>
        <div class="summary-item">
          <div class="summary-value status-skip" id="skipped-tests">0</div>
          <div class="summary-label">跳过</div>
        </div>
        <div class="summary-item">
          <div class="summary-value" id="test-duration">0ms</div>
          <div class="summary-label">耗时</div>
        </div>
      </div>

      <!-- 测试结果 -->
      <div class="test-results" id="test-results"></div>

      <!-- 日志 -->
      <div class="log" id="log"></div>
    </div>
  </div>

  <script>
    // 测试套件定义
    const testSuites = {
      '核心功能': [
        { name: '编辑器初始化', test: testEditorInit },
        { name: '文本输入', test: testTextInput },
        { name: '撤销重做', test: testUndoRedo },
        { name: '复制粘贴', test: testCopyPaste },
      ],
      '格式化功能': [
        { name: '加粗', test: testBold },
        { name: '斜体', test: testItalic },
        { name: '下划线', test: testUnderline },
        { name: '删除线', test: testStrikethrough },
      ],
      '图标系统': [
        { name: '图标管理器初始化', test: testIconManagerInit },
        { name: '切换图标集', test: testIconSetSwitch },
        { name: '渲染图标', test: testIconRender },
        { name: '搜索图标', test: testIconSearch },
      ],
      '主题系统': [
        { name: '主题管理器初始化', test: testThemeManagerInit },
        { name: '切换主题', test: testThemeSwitch },
        { name: 'CSS变量应用', test: testCSSVariables },
        { name: '自定义主题', test: testCustomTheme },
      ],
      '多语言系统': [
        { name: 'I18n初始化', test: testI18nInit },
        { name: '切换语言', test: testLocaleSwitch },
        { name: '翻译功能', test: testTranslation },
        { name: '自定义语言包', test: testCustomLocale },
      ],
      '配置管理': [
        { name: 'ConfigManager初始化', test: testConfigManagerInit },
        { name: '导出配置', test: testExportConfig },
        { name: '导入配置', test: testImportConfig },
        { name: '重置配置', test: testResetConfig },
      ],
      'UI组件工厂': [
        { name: '创建按钮', test: testCreateButton },
        { name: '创建输入框', test: testCreateInput },
        { name: '创建下拉框', test: testCreateSelect },
        { name: '创建复选框', test: testCreateCheckbox },
      ],
      '设置面板': [
        { name: '打开设置面板', test: testOpenSettings },
        { name: '主题选项卡', test: testThemeTab },
        { name: '图标选项卡', test: testIconTab },
        { name: '保存设置', test: testSaveSettings },
      ],
    }

    // 测试状态
    let testResults = {}
    let testRunning = false
    let startTime = 0

    // 初始化
    function init() {
      renderTestGroups()
      setupEventListeners()
      log('info', '测试系统已初始化')
    }

    // 渲染测试组
    function renderTestGroups() {
      const container = document.getElementById('test-results')
      container.innerHTML = ''

      let totalTests = 0
      Object.entries(testSuites).forEach(([groupName, tests]) => {
        totalTests += tests.length
        
        const group = document.createElement('div')
        group.className = 'test-group'
        
        const header = document.createElement('div')
        header.className = 'test-group-header'
        header.innerHTML = `
          <div class="test-group-title">
            <span>📦</span>
            <span>${groupName}</span>
          </div>
          <div class="test-group-stats">
            <span class="group-passed">0</span> / <span class="group-total">${tests.length}</span>
          </div>
        `
        
        const list = document.createElement('div')
        list.className = 'test-list'
        
        tests.forEach(test => {
          const item = document.createElement('div')
          item.className = 'test-item'
          item.dataset.testName = test.name
          item.innerHTML = `
            <div class="test-name">${test.name}</div>
            <div class="test-status status-pending">
              <span class="status-icon">⏱</span>
              <span class="status-text">待运行</span>
            </div>
          `
          list.appendChild(item)
        })
        
        header.addEventListener('click', () => {
          list.classList.toggle('expanded')
        })
        
        group.appendChild(header)
        group.appendChild(list)
        container.appendChild(group)
      })

      document.getElementById('total-tests').textContent = totalTests
    }

    // 设置事件监听
    function setupEventListeners() {
      document.getElementById('run-all').addEventListener('click', runAllTests)
      document.getElementById('stop-tests').addEventListener('click', stopTests)
      document.getElementById('clear-results').addEventListener('click', clearResults)
    }

    // 运行所有测试
    async function runAllTests() {
      if (testRunning) {
        log('warn', '测试正在运行中...')
        return
      }

      testRunning = true
      testResults = {}
      startTime = Date.now()
      
      log('info', '开始运行所有测试...')
      
      let totalTests = 0
      let passedTests = 0
      let failedTests = 0
      let completedTests = 0

      for (const [groupName, tests] of Object.entries(testSuites)) {
        totalTests += tests.length
        log('info', `运行测试组: ${groupName}`)
        
        for (const test of tests) {
          if (!testRunning) break
          
          updateTestStatus(test.name, 'running', '运行中...')
          
          try {
            await test.test()
            testResults[test.name] = 'pass'
            updateTestStatus(test.name, 'pass', '通过')
            passedTests++
            log('success', `✓ ${test.name} 通过`)
          } catch (error) {
            testResults[test.name] = 'fail'
            updateTestStatus(test.name, 'fail', '失败')
            failedTests++
            log('error', `✗ ${test.name} 失败: ${error.message}`)
          }
          
          completedTests++
          updateProgress(completedTests, totalTests)
          updateSummary(passedTests, failedTests, 0)
          
          // 小延迟，让UI更新
          await sleep(100)
        }
      }

      const duration = Date.now() - startTime
      document.getElementById('test-duration').textContent = `${duration}ms`
      
      testRunning = false
      log('info', `测试完成! 通过: ${passedTests}, 失败: ${failedTests}, 总耗时: ${duration}ms`)
    }

    // 停止测试
    function stopTests() {
      if (testRunning) {
        testRunning = false
        log('warn', '测试已停止')
      }
    }

    // 清空结果
    function clearResults() {
      testResults = {}
      renderTestGroups()
      updateProgress(0, 1)
      updateSummary(0, 0, 0)
      document.getElementById('log').innerHTML = ''
      log('info', '结果已清空')
    }

    // 更新测试状态
    function updateTestStatus(testName, status, text) {
      const item = document.querySelector(`[data-test-name="${testName}"]`)
      if (!item) return
      
      const statusEl = item.querySelector('.test-status')
      statusEl.className = `test-status status-${status}`
      
      const icons = {
        pending: '⏱',
        running: '⟳',
        pass: '✓',
        fail: '✗',
        skip: '⊘'
      }
      
      statusEl.innerHTML = `
        <span class="status-icon ${status === 'running' ? 'spinning' : ''}">${icons[status]}</span>
        <span class="status-text">${text}</span>
      `
    }

    // 更新进度
    function updateProgress(completed, total) {
      const percent = (completed / total) * 100
      document.getElementById('progress').style.width = `${percent}%`
    }

    // 更新摘要
    function updateSummary(passed, failed, skipped) {
      document.getElementById('passed-tests').textContent = passed
      document.getElementById('failed-tests').textContent = failed
      document.getElementById('skipped-tests').textContent = skipped
    }

    // 日志
    function log(level, message) {
      const logEl = document.getElementById('log')
      const time = new Date().toLocaleTimeString()
      const entry = document.createElement('div')
      entry.className = 'log-entry'
      entry.innerHTML = `
        <span class="log-time">[${time}]</span>
        <span class="log-level-${level}">[${level.toUpperCase()}]</span>
        <span>${message}</span>
      `
      logEl.appendChild(entry)
      logEl.scrollTop = logEl.scrollHeight
    }

    // 工具函数
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms))
    }

    // ============ 测试函数 ============

    // 核心功能测试
    async function testEditorInit() {
      await sleep(200)
      if (!window.Editor) throw new Error('Editor未定义')
    }

    async function testTextInput() {
      await sleep(200)
      // 模拟测试
    }

    async function testUndoRedo() {
      await sleep(200)
      // 模拟测试
    }

    async function testCopyPaste() {
      await sleep(200)
      // 模拟测试
    }

    // 格式化测试
    async function testBold() {
      await sleep(200)
    }

    async function testItalic() {
      await sleep(200)
    }

    async function testUnderline() {
      await sleep(200)
    }

    async function testStrikethrough() {
      await sleep(200)
    }

    // 图标系统测试
    async function testIconManagerInit() {
      await sleep(200)
      if (typeof getIconManager !== 'function') {
        throw new Error('getIconManager 未定义')
      }
    }

    async function testIconSetSwitch() {
      await sleep(200)
    }

    async function testIconRender() {
      await sleep(200)
    }

    async function testIconSearch() {
      await sleep(200)
    }

    // 主题系统测试
    async function testThemeManagerInit() {
      await sleep(200)
      if (typeof getThemeManager !== 'function') {
        throw new Error('getThemeManager 未定义')
      }
    }

    async function testThemeSwitch() {
      await sleep(200)
    }

    async function testCSSVariables() {
      await sleep(200)
    }

    async function testCustomTheme() {
      await sleep(200)
    }

    // 多语言测试
    async function testI18nInit() {
      await sleep(200)
      if (typeof getI18n !== 'function') {
        throw new Error('getI18n 未定义')
      }
    }

    async function testLocaleSwitch() {
      await sleep(200)
    }

    async function testTranslation() {
      await sleep(200)
    }

    async function testCustomLocale() {
      await sleep(200)
    }

    // 配置管理测试
    async function testConfigManagerInit() {
      await sleep(200)
      if (typeof getConfigManager !== 'function') {
        throw new Error('getConfigManager 未定义')
      }
    }

    async function testExportConfig() {
      await sleep(200)
    }

    async function testImportConfig() {
      await sleep(200)
    }

    async function testResetConfig() {
      await sleep(200)
    }

    // UI组件工厂测试
    async function testCreateButton() {
      await sleep(200)
      if (typeof createButton !== 'function') {
        throw new Error('createButton 未定义')
      }
    }

    async function testCreateInput() {
      await sleep(200)
    }

    async function testCreateSelect() {
      await sleep(200)
    }

    async function testCreateCheckbox() {
      await sleep(200)
    }

    // 设置面板测试
    async function testOpenSettings() {
      await sleep(200)
      if (typeof showSettingsPanel !== 'function') {
        throw new Error('showSettingsPanel 未定义')
      }
    }

    async function testThemeTab() {
      await sleep(200)
    }

    async function testIconTab() {
      await sleep(200)
    }

    async function testSaveSettings() {
      await sleep(200)
    }

    // 启动
    init()
  </script>
</body>
</html>






