{"version":3,"file":"image.cjs","sources":["../../../src/plugins/media/image.ts"],"sourcesContent":["/**\r\n * Image Plugin - Unified image handling plugin\r\n * Contains image insertion, context menu, and editing features\r\n */\r\n\r\nimport type { Plugin } from '../../types'\r\nimport { getLucideIcon } from '../../ui/icons/lucide'\r\n\r\n/**\r\n * Image Context Menu Manager\r\n */\r\nclass ImageContextMenu {\r\n  private menu: HTMLDivElement | null = null\r\n  private currentImage: HTMLImageElement | null = null\r\n  private editor: any\r\n\r\n  constructor(editor: any) {\r\n    this.editor = editor\r\n    this.init()\r\n  }\r\n\r\n  private init(): void {\r\n    // Listen for right-click events in the editor\r\n    if (this.editor.contentElement)\r\n      this.editor.contentElement.addEventListener('contextmenu', this.handleContextMenu.bind(this))\r\n\r\n    // Close menu when clicking elsewhere\r\n    document.addEventListener('click', () => this.hideMenu())\r\n\r\n    // Close menu with ESC key\r\n    document.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape')\r\n        this.hideMenu()\r\n    })\r\n  }\r\n\r\n  private handleContextMenu(e: MouseEvent): void {\r\n    const target = e.target as HTMLElement\r\n\r\n    // Check if clicked on an image\r\n    if (target.tagName === 'IMG') {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      this.currentImage = target as HTMLImageElement\r\n      this.showMenu(e.clientX, e.clientY)\r\n    }\r\n  }\r\n\r\n  private showMenu(x: number, y: number): void {\r\n    this.hideMenu()\r\n\r\n    // Create menu\r\n    this.menu = document.createElement('div')\r\n    this.menu.className = 'ldesign-image-menu'\r\n    this.menu.style.cssText = `\r\n      position: fixed;\r\n      left: ${x}px;\r\n      top: ${y}px;\r\n      background: white;\r\n      border: 1px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);\r\n      padding: 4px;\r\n      min-width: 200px;\r\n      z-index: 10000;\r\n      font-size: 14px;\r\n      color: #374151;\r\n      user-select: none;\r\n    `\r\n\r\n    // Menu items configuration\r\n    const items = [\r\n      {\r\n        label: 'Resize',\r\n        icon: 'maximize2',\r\n        submenu: [\r\n          { label: 'Original Size', action: () => this.setSize('auto', 'auto') },\r\n          { label: 'Fit Width', action: () => this.setSize('100%', 'auto') },\r\n          { label: 'Small (300px)', action: () => this.setSize('300px', 'auto') },\r\n          { label: 'Medium (500px)', action: () => this.setSize('500px', 'auto') },\r\n          { label: 'Large (800px)', action: () => this.setSize('800px', 'auto') },\r\n          { label: 'Custom...', action: () => this.setCustomSize() },\r\n        ],\r\n      },\r\n      {\r\n        label: 'Object Fit',\r\n        icon: 'square',\r\n        submenu: [\r\n          { label: 'contain', action: () => this.setObjectFit('contain') },\r\n          { label: 'cover', action: () => this.setObjectFit('cover') },\r\n          { label: 'fill', action: () => this.setObjectFit('fill') },\r\n          { label: 'none', action: () => this.setObjectFit('none') },\r\n          { label: 'scale-down', action: () => this.setObjectFit('scale-down') },\r\n        ],\r\n      },\r\n      {\r\n        label: 'Filters',\r\n        icon: 'sparkles',\r\n        submenu: [\r\n          { label: 'No Filter', action: () => this.setFilter('') },\r\n          { label: 'Blur', action: () => this.setFilter('blur(2px)') },\r\n          { label: 'Grayscale', action: () => this.setFilter('grayscale(100%)') },\r\n          { label: 'Sepia', action: () => this.setFilter('sepia(100%)') },\r\n          { label: 'Invert', action: () => this.setFilter('invert(100%)') },\r\n          { label: 'Brightness', action: () => this.setFilter('brightness(150%)') },\r\n          { label: 'Contrast', action: () => this.setFilter('contrast(150%)') },\r\n        ],\r\n      },\r\n      { divider: true },\r\n      { label: 'Copy Image', icon: 'copy', action: () => this.copyImage() },\r\n      { label: 'Image Info', icon: 'info', action: () => this.showInfo() },\r\n      { label: 'Set Title', icon: 'type', action: () => this.setTitle() },\r\n      { divider: true },\r\n      { label: 'Delete', icon: 'trash2', action: () => this.deleteImage() },\r\n    ]\r\n\r\n    // Render menu items\r\n    this.renderMenuItems(items, this.menu)\r\n\r\n    // Add to page\r\n    document.body.appendChild(this.menu)\r\n\r\n    // Adjust position\r\n    requestAnimationFrame(() => {\r\n      if (!this.menu)\r\n        return\r\n      const rect = this.menu.getBoundingClientRect()\r\n      if (x + rect.width > window.innerWidth)\r\n        this.menu.style.left = `${window.innerWidth - rect.width - 10}px`\r\n\r\n      if (y + rect.height > window.innerHeight)\r\n        this.menu.style.top = `${window.innerHeight - rect.height - 10}px`\r\n    })\r\n  }\r\n\r\n  private renderMenuItems(items: any[], container: HTMLElement, level: number = 0): void {\r\n    items.forEach((item) => {\r\n      if (item.divider) {\r\n        const divider = document.createElement('div')\r\n        divider.style.cssText = 'height: 1px; background: #e5e7eb; margin: 4px 0;'\r\n        container.appendChild(divider)\r\n      }\r\n      else {\r\n        const menuItem = document.createElement('div')\r\n        menuItem.style.cssText = `\r\n          padding: 8px 12px;\r\n          cursor: pointer;\r\n          border-radius: 4px;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n          transition: background 0.2s;\r\n          position: relative;\r\n        `\r\n\r\n        // Icon\r\n        if (item.icon) {\r\n          const icon = document.createElement('span')\r\n          icon.style.cssText = 'width: 16px; height: 16px; opacity: 0.7;'\r\n          icon.innerHTML = getLucideIcon(item.icon)\r\n          menuItem.appendChild(icon)\r\n        }\r\n\r\n        // Label\r\n        const label = document.createElement('span')\r\n        label.textContent = item.label\r\n        label.style.flex = '1'\r\n        menuItem.appendChild(label)\r\n\r\n        // Submenu arrow\r\n        if (item.submenu) {\r\n          const arrow = document.createElement('span')\r\n          arrow.style.cssText = 'width: 16px; height: 16px; opacity: 0.5;'\r\n          arrow.innerHTML = getLucideIcon('chevronRight')\r\n          menuItem.appendChild(arrow)\r\n\r\n          // Create submenu\r\n          const submenu = document.createElement('div')\r\n          submenu.style.cssText = `\r\n            position: absolute;\r\n            left: 100%;\r\n            top: 0;\r\n            background: white;\r\n            border: 1px solid #e5e7eb;\r\n            border-radius: 6px;\r\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n            padding: 4px;\r\n            min-width: 150px;\r\n            display: none;\r\n            margin-left: 4px;\r\n          `\r\n\r\n          this.renderMenuItems(item.submenu, submenu, level + 1)\r\n          menuItem.appendChild(submenu)\r\n\r\n          // Show submenu on hover\r\n          menuItem.onmouseenter = () => {\r\n            submenu.style.display = 'block'\r\n            menuItem.style.background = '#f3f4f6'\r\n          }\r\n\r\n          menuItem.onmouseleave = () => {\r\n            submenu.style.display = 'none'\r\n            menuItem.style.background = 'transparent'\r\n          }\r\n        }\r\n        else {\r\n          // Hover effect\r\n          menuItem.onmouseenter = () => {\r\n            menuItem.style.background = '#f3f4f6'\r\n          }\r\n\r\n          menuItem.onmouseleave = () => {\r\n            menuItem.style.background = 'transparent'\r\n          }\r\n\r\n          // Click action\r\n          if (item.action) {\r\n            menuItem.onclick = (e) => {\r\n              e.stopPropagation()\r\n              item.action()\r\n              this.hideMenu()\r\n            }\r\n          }\r\n        }\r\n\r\n        container.appendChild(menuItem)\r\n      }\r\n    })\r\n  }\r\n\r\n  private hideMenu(): void {\r\n    if (this.menu) {\r\n      this.menu.remove()\r\n      this.menu = null\r\n    }\r\n  }\r\n\r\n  // Feature implementations\r\n  private setSize(width: string, height: string): void {\r\n    if (!this.currentImage)\r\n      return\r\n    this.currentImage.style.width = width\r\n    this.currentImage.style.height = height\r\n    this.triggerChange()\r\n  }\r\n\r\n  private setCustomSize(): void {\r\n    if (!this.currentImage)\r\n      return\r\n    const width = prompt('Set width (e.g. 300px, 50%, auto):', this.currentImage.style.width || 'auto')\r\n    if (width !== null) {\r\n      this.currentImage.style.width = width\r\n      this.currentImage.style.height = 'auto'\r\n      this.triggerChange()\r\n    }\r\n  }\r\n\r\n  private setObjectFit(fit: string): void {\r\n    if (!this.currentImage)\r\n      return\r\n    this.currentImage.style.objectFit = fit as any\r\n    this.triggerChange()\r\n  }\r\n\r\n  private setFilter(filter: string): void {\r\n    if (!this.currentImage)\r\n      return\r\n    this.currentImage.style.filter = filter\r\n    this.triggerChange()\r\n  }\r\n\r\n  private setTitle(): void {\r\n    if (!this.currentImage)\r\n      return\r\n    const title = prompt('Set image title:', this.currentImage.title || '')\r\n    if (title !== null) {\r\n      this.currentImage.title = title\r\n      this.triggerChange()\r\n    }\r\n  }\r\n\r\n  private async copyImage(): Promise<void> {\r\n    if (!this.currentImage)\r\n      return\r\n    try {\r\n      await navigator.clipboard.writeText(this.currentImage.src)\r\n      alert('Image URL copied!')\r\n    }\r\n    catch (error) {\r\n      console.error('Copy failed:', error)\r\n    }\r\n  }\r\n\r\n  private showInfo(): void {\r\n    if (!this.currentImage)\r\n      return\r\n    alert(`Image Info:\\nTitle: ${this.currentImage.title || 'None'}\\nAlt text: ${this.currentImage.alt || 'None'}\\nOriginal size: ${this.currentImage.naturalWidth} × ${this.currentImage.naturalHeight}\\nDisplay size: ${this.currentImage.offsetWidth} × ${this.currentImage.offsetHeight}\\nURL: ${this.currentImage.src}`)\r\n  }\r\n\r\n  private deleteImage(): void {\r\n    if (!this.currentImage)\r\n      return\r\n    if (confirm('Delete this image?')) {\r\n      this.currentImage.remove()\r\n      this.currentImage = null\r\n      this.triggerChange()\r\n    }\r\n  }\r\n\r\n  private triggerChange(): void {\r\n    const event = new Event('input', { bubbles: true })\r\n    this.editor.contentElement?.dispatchEvent(event)\r\n  }\r\n}\r\n\r\n/**\r\n * Image Plugin\r\n */\r\nexport const ImagePlugin: Plugin = {\r\n  name: 'image',\r\n\r\n  install(editor: any) {\r\n    // Use unified context menu from MediaContextMenuPlugin to avoid duplicate bindings\r\n\r\n    // Register upload image command (insertImage is handled by MediaDialogPlugin)\r\n    if (!editor.commands.get('uploadImage')) {\r\n      editor.commands.register('uploadImage', () => {\r\n        const input = document.createElement('input')\r\n        input.type = 'file'\r\n        input.accept = 'image/*'\r\n        input.onchange = (e) => {\r\n          const file = (e.target as HTMLInputElement).files?.[0]\r\n          if (file) {\r\n            const reader = new FileReader()\r\n            reader.onload = (e) => {\r\n              const url = e.target?.result as string\r\n              // Insert image with default left alignment\r\n              const alt = file.name || 'Image'\r\n              const html = `<img src=\"${url}\" alt=\"${alt}\" style=\"max-width: 100%; height: auto; display: block; margin: 10px 0;\">`\r\n              if (typeof editor.insertHTML === 'function')\r\n                editor.insertHTML(html)\r\n              else\r\n                document.execCommand('insertHTML', false, html)\r\n            }\r\n            reader.readAsDataURL(file)\r\n          }\r\n        }\r\n        input.click()\r\n      })\r\n    }\r\n\r\n    console.log('[ImagePlugin] Loaded')\r\n  },\r\n}\r\n\r\nexport default ImagePlugin\r\n"],"names":["ImagePlugin","name","install","editor","commands","get","register","input","document","createElement","type","accept","onchange","e","file","target","files","reader","FileReader","onload","url","result","alt","html","insertHTML","execCommand","readAsDataURL","click","console","log"],"mappings":";;;;;;;;;;;;;AA+TO,MAAMA,WAAAA,GAAsB;AAAA,EACjCC,IAAAA,EAAM,OAAA;AAAA,EAENC,QAAQC,MAAAA,EAAa;AAInB,IAAA,IAAI,CAACA,MAAAA,CAAOC,QAAAA,CAASC,GAAAA,CAAI,aAAa,CAAA,EAAG;AACvCF,MAAAA,MAAAA,CAAOC,QAAAA,CAASE,QAAAA,CAAS,aAAA,EAAe,MAAM;AAC5C,QAAA,MAAMC,KAAAA,GAAQC,QAAAA,CAASC,aAAAA,CAAc,OAAO,CAAA;AAC5CF,QAAAA,KAAAA,CAAMG,IAAAA,GAAO,MAAA;AACbH,QAAAA,KAAAA,CAAMI,MAAAA,GAAS,SAAA;AACfJ,QAAAA,KAAAA,CAAMK,WAAYC,CAAAA,CAAAA,KAAM;AACtB,UAAA,MAAMC,IAAAA,GAAQD,CAAAA,CAAEE,MAAAA,CAA4BC,KAAAA,GAAQ,CAAC,CAAA;AACrD,UAAA,IAAIF,IAAAA,EAAM;AACR,YAAA,MAAMG,MAAAA,GAAS,IAAIC,UAAAA,EAAW;AAC9BD,YAAAA,MAAAA,CAAOE,MAAAA,GAAUN,CAAAA,EAAAA,KAAM;AACrB,cAAA,MAAMO,GAAAA,GAAMP,GAAEE,MAAAA,EAAQM,MAAAA;AAEtB,cAAA,MAAMC,GAAAA,GAAMR,KAAKb,IAAAA,IAAQ,OAAA;AACzB,cAAA,MAAMsB,IAAAA,GAAO,CAAA,UAAA,EAAaH,GAAG,CAAA,OAAA,EAAUE,GAAG,CAAA,yEAAA,CAAA;AAC1C,cAAA,IAAI,OAAOnB,OAAOqB,UAAAA,KAAe,UAAA;AAC/BrB,gBAAAA,MAAAA,CAAOqB,WAAWD,IAAI,CAAA;AAAA;AAEtBf,gBAAAA,QAAAA,CAASiB,WAAAA,CAAY,YAAA,EAAc,KAAA,EAAOF,IAAI,CAAA;AAAA,YAClD,CAAA;AACAN,YAAAA,MAAAA,CAAOS,cAAcZ,IAAI,CAAA;AAAA,UAC3B;AAAA,QACF,CAAA;AACAP,QAAAA,KAAAA,CAAMoB,KAAAA,EAAM;AAAA,MACd,CAAC,CAAA;AAAA,IACH;AAEAC,IAAAA,OAAAA,CAAQC,IAAI,sBAAsB,CAAA;AAAA,EACpC;AACF;;;;;;;;"}