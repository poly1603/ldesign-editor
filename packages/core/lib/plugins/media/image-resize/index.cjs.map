{"version":3,"file":"index.cjs","sources":["../../../../src/plugins/media/image-resize/index.ts"],"sourcesContent":["import type { Editor } from '../../../core/Editor'\r\nimport { Plugin } from '../../../core/Plugin'\r\nimport './styles.css'\r\n\r\nexport interface ImageResizeOptions {\r\n  minWidth?: number\r\n  minHeight?: number\r\n  maxWidth?: number\r\n  maxHeight?: number\r\n  preserveAspectRatio?: boolean\r\n  showDimensions?: boolean\r\n}\r\n\r\nexport class ImageResizePlugin extends Plugin {\r\n  name = 'imageResize'\r\n  config = {\r\n    name: 'imageResize',\r\n    commands: {},\r\n    keys: {},\r\n  }\r\n\r\n  private options: ImageResizeOptions\r\n  private currentImage: HTMLImageElement | null = null\r\n  private resizeOverlay: HTMLElement | null = null\r\n  private isResizing = false\r\n  private startX = 0\r\n  private startY = 0\r\n  private startWidth = 0\r\n  private startHeight = 0\r\n  private resizeHandle = ''\r\n  private aspectRatio = 1\r\n  private dimensionsDisplay: HTMLElement | null = null\r\n\r\n  constructor(options: ImageResizeOptions = {}) {\r\n    super()\r\n    this.options = {\r\n      minWidth: 50,\r\n      minHeight: 50,\r\n      maxWidth: 2000,\r\n      maxHeight: 2000,\r\n      preserveAspectRatio: true,\r\n      showDimensions: true,\r\n      ...options,\r\n    }\r\n  }\r\n\r\n  install(editor: Editor): void {\r\n    super.install(editor)\r\n    this.editor = editor\r\n    this.bindEvents()\r\n    console.log('[ImageResizePlugin] Installed with options:', this.options)\r\n  }\r\n\r\n  private bindEvents(): void {\r\n    const editorElement = this.editor.contentElement\r\n    if (!editorElement)\r\n      return\r\n\r\n    // Click on image to show resize handles\r\n    editorElement.addEventListener('click', this.handleImageClick.bind(this))\r\n\r\n    // Mouse move for resizing\r\n    document.addEventListener('mousemove', this.handleMouseMove.bind(this))\r\n\r\n    // Mouse up to stop resizing\r\n    document.addEventListener('mouseup', this.handleMouseUp.bind(this))\r\n\r\n    // Key press to cancel resize\r\n    document.addEventListener('keydown', this.handleKeyDown.bind(this))\r\n\r\n    // Editor blur to hide overlay\r\n    editorElement.addEventListener('blur', () => {\r\n      setTimeout(() => this.hideResizeOverlay(), 200)\r\n    })\r\n\r\n    // Double click to edit properties (already handled by media context menu)\r\n    editorElement.addEventListener('dblclick', (e) => {\r\n      const target = e.target as HTMLElement\r\n      if (target.tagName === 'IMG')\r\n        this.hideResizeOverlay()\r\n    })\r\n\r\n    console.log('[ImageResizePlugin] Events bound')\r\n  }\r\n\r\n  private handleImageClick(e: MouseEvent): void {\r\n    const target = e.target as HTMLElement\r\n\r\n    // Check if clicked on image\r\n    if (target.tagName === 'IMG') {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      this.showResizeOverlay(target as HTMLImageElement)\r\n    }\r\n    else if (!this.isResizing && !this.isResizeHandle(target)) {\r\n      // Clicked elsewhere, hide overlay\r\n      this.hideResizeOverlay()\r\n    }\r\n  }\r\n\r\n  private isResizeHandle(element: HTMLElement): boolean {\r\n    return element.classList.contains('image-resize-handle')\r\n      || (element.parentElement?.classList.contains('image-resize-overlay') ?? false)\r\n  }\r\n\r\n  private showResizeOverlay(img: HTMLImageElement): void {\r\n    console.log('[ImageResizePlugin] Showing resize overlay for image:', img.src)\r\n\r\n    // Hide existing overlay if any\r\n    this.hideResizeOverlay()\r\n\r\n    this.currentImage = img\r\n\r\n    // Create overlay container\r\n    this.resizeOverlay = document.createElement('div')\r\n    this.resizeOverlay.className = 'image-resize-overlay'\r\n\r\n    // Position overlay over image\r\n    this.updateOverlayPosition()\r\n\r\n    // Create resize handles\r\n    const handles = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w']\r\n    handles.forEach((handle) => {\r\n      const handleElement = document.createElement('div')\r\n      handleElement.className = `image-resize-handle handle-${handle}`\r\n      handleElement.dataset.handle = handle\r\n      handleElement.addEventListener('mousedown', this.startResize.bind(this))\r\n      this.resizeOverlay.appendChild(handleElement)\r\n    })\r\n\r\n    // Add dimensions display\r\n    if (this.options.showDimensions) {\r\n      this.dimensionsDisplay = document.createElement('div')\r\n      this.dimensionsDisplay.className = 'image-resize-dimensions'\r\n      this.updateDimensionsDisplay()\r\n      this.resizeOverlay.appendChild(this.dimensionsDisplay)\r\n    }\r\n\r\n    // Add overlay to editor\r\n    const editorElement = this.editor.contentElement\r\n    if (editorElement)\r\n      editorElement.appendChild(this.resizeOverlay)\r\n\r\n    // Store original aspect ratio\r\n    this.aspectRatio = img.naturalWidth / img.naturalHeight\r\n  }\r\n\r\n  private hideResizeOverlay(): void {\r\n    if (this.resizeOverlay) {\r\n      console.log('[ImageResizePlugin] Hiding resize overlay')\r\n      this.resizeOverlay.remove()\r\n      this.resizeOverlay = null\r\n      this.currentImage = null\r\n      this.dimensionsDisplay = null\r\n    }\r\n  }\r\n\r\n  private updateOverlayPosition(): void {\r\n    if (!this.resizeOverlay || !this.currentImage)\r\n      return\r\n\r\n    const editorElement = this.editor.contentElement\r\n    if (!editorElement)\r\n      return\r\n\r\n    const editorRect = editorElement.getBoundingClientRect()\r\n    const imgRect = this.currentImage.getBoundingClientRect()\r\n\r\n    this.resizeOverlay.style.left = `${imgRect.left - editorRect.left + editorElement.scrollLeft}px`\r\n    this.resizeOverlay.style.top = `${imgRect.top - editorRect.top + editorElement.scrollTop}px`\r\n    this.resizeOverlay.style.width = `${imgRect.width}px`\r\n    this.resizeOverlay.style.height = `${imgRect.height}px`\r\n  }\r\n\r\n  private updateDimensionsDisplay(): void {\r\n    if (!this.dimensionsDisplay || !this.currentImage)\r\n      return\r\n\r\n    const width = Math.round(this.currentImage.width)\r\n    const height = Math.round(this.currentImage.height)\r\n    this.dimensionsDisplay.textContent = `${width} × ${height}`\r\n  }\r\n\r\n  private startResize(e: MouseEvent): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n\r\n    const handle = e.target as HTMLElement\r\n    this.resizeHandle = handle.dataset.handle || ''\r\n\r\n    console.log('[ImageResizePlugin] Starting resize with handle:', this.resizeHandle)\r\n\r\n    this.isResizing = true\r\n    this.startX = e.clientX\r\n    this.startY = e.clientY\r\n    this.startWidth = this.currentImage.width\r\n    this.startHeight = this.currentImage.height\r\n\r\n    // Add resizing class for cursor\r\n    document.body.classList.add('image-resizing')\r\n\r\n    // Prevent text selection while resizing\r\n    e.preventDefault()\r\n  }\r\n\r\n  private handleMouseMove(e: MouseEvent): void {\r\n    if (!this.isResizing || !this.currentImage || !this.resizeOverlay)\r\n      return\r\n\r\n    const deltaX = e.clientX - this.startX\r\n    const deltaY = e.clientY - this.startY\r\n\r\n    let newWidth = this.startWidth\r\n    let newHeight = this.startHeight\r\n\r\n    // Calculate new dimensions based on handle\r\n    switch (this.resizeHandle) {\r\n      case 'e': // East\r\n        newWidth = this.startWidth + deltaX\r\n        if (this.options.preserveAspectRatio)\r\n          newHeight = newWidth / this.aspectRatio\r\n\r\n        break\r\n\r\n      case 'w': // West\r\n        newWidth = this.startWidth - deltaX\r\n        if (this.options.preserveAspectRatio)\r\n          newHeight = newWidth / this.aspectRatio\r\n\r\n        break\r\n\r\n      case 's': // South\r\n        newHeight = this.startHeight + deltaY\r\n        if (this.options.preserveAspectRatio)\r\n          newWidth = newHeight * this.aspectRatio\r\n\r\n        break\r\n\r\n      case 'n': // North\r\n        newHeight = this.startHeight - deltaY\r\n        if (this.options.preserveAspectRatio)\r\n          newWidth = newHeight * this.aspectRatio\r\n\r\n        break\r\n\r\n      case 'se': // Southeast\r\n        if (this.options.preserveAspectRatio) {\r\n          // Use the larger delta to maintain aspect ratio\r\n          if (Math.abs(deltaX) > Math.abs(deltaY * this.aspectRatio)) {\r\n            newWidth = this.startWidth + deltaX\r\n            newHeight = newWidth / this.aspectRatio\r\n          }\r\n          else {\r\n            newHeight = this.startHeight + deltaY\r\n            newWidth = newHeight * this.aspectRatio\r\n          }\r\n        }\r\n        else {\r\n          newWidth = this.startWidth + deltaX\r\n          newHeight = this.startHeight + deltaY\r\n        }\r\n        break\r\n\r\n      case 'sw': // Southwest\r\n        if (this.options.preserveAspectRatio) {\r\n          if (Math.abs(deltaX) > Math.abs(deltaY * this.aspectRatio)) {\r\n            newWidth = this.startWidth - deltaX\r\n            newHeight = newWidth / this.aspectRatio\r\n          }\r\n          else {\r\n            newHeight = this.startHeight + deltaY\r\n            newWidth = newHeight * this.aspectRatio\r\n          }\r\n        }\r\n        else {\r\n          newWidth = this.startWidth - deltaX\r\n          newHeight = this.startHeight + deltaY\r\n        }\r\n        break\r\n\r\n      case 'ne': // Northeast\r\n        if (this.options.preserveAspectRatio) {\r\n          if (Math.abs(deltaX) > Math.abs(deltaY * this.aspectRatio)) {\r\n            newWidth = this.startWidth + deltaX\r\n            newHeight = newWidth / this.aspectRatio\r\n          }\r\n          else {\r\n            newHeight = this.startHeight - deltaY\r\n            newWidth = newHeight * this.aspectRatio\r\n          }\r\n        }\r\n        else {\r\n          newWidth = this.startWidth + deltaX\r\n          newHeight = this.startHeight - deltaY\r\n        }\r\n        break\r\n\r\n      case 'nw': // Northwest\r\n        if (this.options.preserveAspectRatio) {\r\n          if (Math.abs(deltaX) > Math.abs(deltaY * this.aspectRatio)) {\r\n            newWidth = this.startWidth - deltaX\r\n            newHeight = newWidth / this.aspectRatio\r\n          }\r\n          else {\r\n            newHeight = this.startHeight - deltaY\r\n            newWidth = newHeight * this.aspectRatio\r\n          }\r\n        }\r\n        else {\r\n          newWidth = this.startWidth - deltaX\r\n          newHeight = this.startHeight - deltaY\r\n        }\r\n        break\r\n    }\r\n\r\n    // Apply constraints\r\n    newWidth = Math.max(this.options.minWidth!, Math.min(newWidth, this.options.maxWidth!))\r\n    newHeight = Math.max(this.options.minHeight!, Math.min(newHeight, this.options.maxHeight!))\r\n\r\n    // Apply new dimensions\r\n    this.currentImage.style.width = `${newWidth}px`\r\n    this.currentImage.style.height = `${newHeight}px`\r\n    this.currentImage.width = newWidth\r\n    this.currentImage.height = newHeight\r\n\r\n    // 保持图片原有的对齐方式，不自动居�?\r\n    // 如果图片没有明确的对齐样式，默认左对�?\r\n    if (!this.currentImage.style.display && !this.currentImage.style.margin) {\r\n      this.currentImage.style.display = 'inline-block'\r\n      this.currentImage.style.verticalAlign = 'top'\r\n    }\r\n\r\n    // Update overlay position and dimensions display\r\n    this.updateOverlayPosition()\r\n    this.updateDimensionsDisplay()\r\n\r\n    // Trigger content change event\r\n    this.editor.emit('change')\r\n  }\r\n\r\n  private handleMouseUp(e: MouseEvent): void {\r\n    if (this.isResizing) {\r\n      console.log('[ImageResizePlugin] Resize completed')\r\n      this.isResizing = false\r\n      document.body.classList.remove('image-resizing')\r\n\r\n      // Save the final dimensions to the image attributes\r\n      if (this.currentImage) {\r\n        this.currentImage.setAttribute('width', String(this.currentImage.width))\r\n        this.currentImage.setAttribute('height', String(this.currentImage.height))\r\n\r\n        // Trigger content save\r\n        this.editor.emit('change')\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleKeyDown(e: KeyboardEvent): void {\r\n    // ESC key to cancel resize\r\n    if (e.key === 'Escape') {\r\n      if (this.isResizing && this.currentImage) {\r\n        // Restore original dimensions\r\n        this.currentImage.style.width = `${this.startWidth}px`\r\n        this.currentImage.style.height = `${this.startHeight}px`\r\n        this.currentImage.width = this.startWidth\r\n        this.currentImage.height = this.startHeight\r\n        this.isResizing = false\r\n        document.body.classList.remove('image-resizing')\r\n      }\r\n      this.hideResizeOverlay()\r\n    }\r\n  }\r\n\r\n  destroy(): void {\r\n    this.hideResizeOverlay()\r\n\r\n    const editorElement = this.editor.contentElement\r\n    if (editorElement)\r\n      editorElement.removeEventListener('click', this.handleImageClick.bind(this))\r\n\r\n    document.removeEventListener('mousemove', this.handleMouseMove.bind(this))\r\n    document.removeEventListener('mouseup', this.handleMouseUp.bind(this))\r\n    document.removeEventListener('keydown', this.handleKeyDown.bind(this))\r\n\r\n    console.log('[ImageResizePlugin] Destroyed')\r\n  }\r\n}\r\n\r\nexport default ImageResizePlugin\r\n"],"names":["ImageResizePlugin","Plugin","constructor","options","name","config","commands","keys","currentImage","resizeOverlay","isResizing","startX","startY","startWidth","startHeight","resizeHandle","aspectRatio","dimensionsDisplay","minWidth","minHeight","maxWidth","maxHeight","preserveAspectRatio","showDimensions","install","editor","bindEvents","console","log","editorElement","contentElement","addEventListener","handleImageClick","bind","document","handleMouseMove","handleMouseUp","handleKeyDown","setTimeout","hideResizeOverlay","e","target","tagName","preventDefault","stopPropagation","showResizeOverlay","isResizeHandle","element","classList","contains","parentElement","img","src","createElement","className","updateOverlayPosition","handles","forEach","handle","handleElement","dataset","startResize","appendChild","updateDimensionsDisplay","naturalWidth","naturalHeight","remove","editorRect","getBoundingClientRect","imgRect","style","left","scrollLeft","top","scrollTop","width","height","Math","round","textContent","clientX","clientY","body","add","deltaX","deltaY","newWidth","newHeight","abs","max","min","display","margin","verticalAlign","emit","setAttribute","String","key","destroy","removeEventListener"],"mappings":"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"}