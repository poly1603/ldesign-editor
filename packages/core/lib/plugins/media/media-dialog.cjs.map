{"version":3,"file":"media-dialog.cjs","sources":["../../../src/plugins/media/media-dialog.ts"],"sourcesContent":["/**\r\n * Enhanced Media Dialog Plugin\r\n * Provides modern dialogs for inserting images, videos, and audio\r\n */\r\n\r\nimport type { Plugin, UploadHandler } from '../../types'\r\nimport { getLucideIcon } from '../../ui/icons/lucide'\r\n\r\n/**\r\n * Media Dialog Class\r\n */\r\nclass MediaDialog {\r\n  private dialog: HTMLDivElement | null = null\r\n  private overlay: HTMLDivElement | null = null\r\n  private callback: ((url: string, file?: File) => void) | null = null\r\n  private uploadHandler: UploadHandler | null = null\r\n  private activeProgresses: Map<string, any> = new Map()\r\n\r\n  /**\r\n   * Set upload handler\r\n   */\r\n  setUploadHandler(uploadHandler: UploadHandler | undefined) {\r\n    this.uploadHandler = uploadHandler || null\r\n  }\r\n\r\n  /**\r\n   * Show the media dialog\r\n   */\r\n  show(type: 'image' | 'video' | 'audio', callback: (url: string, file?: File) => void) {\r\n    console.log('[MediaDialog.show] Called with type:', type)\r\n    // Ensure any previous dialog is closed BEFORE setting the new callback\r\n    // Important: previously createDialog() would call close() which cleared the callback set here\r\n    // That caused this.callback to be null when clicking the Insert button.\r\n    this.close()\r\n    this.callback = callback\r\n    console.log('[MediaDialog.show] Callback set. Creating dialog now.')\r\n    this.createDialog(type)\r\n    console.log('[MediaDialog.show] createDialog completed')\r\n  }\r\n\r\n  /**\r\n   * Create the dialog elements\r\n   */\r\n  private createDialog(type: 'image' | 'video' | 'audio') {\r\n    console.log('[MediaDialog.createDialog] Starting creation for type:', type)\r\n\r\n    // Create overlay\r\n    this.overlay = document.createElement('div')\r\n    console.log('[MediaDialog.createDialog] Overlay created:', this.overlay)\r\n    this.overlay.className = 'ldesign-media-overlay'\r\n    this.overlay.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: rgba(0, 0, 0, 0.5);\r\n      backdrop-filter: blur(4px);\r\n      z-index: 99998;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      animation: fadeIn 0.2s ease;\r\n    `\r\n\r\n    // Create dialog\r\n    this.dialog = document.createElement('div')\r\n    this.dialog.className = 'ldesign-media-dialog'\r\n    this.dialog.style.cssText = `\r\n      background: white;\r\n      border-radius: 12px;\r\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n      width: 500px;\r\n      max-width: 90vw;\r\n      animation: slideUp 0.3s ease;\r\n      z-index: 99999;\r\n      overflow: hidden;\r\n    `\r\n\r\n    // Create dialog content\r\n    const typeLabels = {\r\n      image: '插入图片',\r\n      video: '插入视频',\r\n      audio: '插入音频',\r\n    }\r\n\r\n    const acceptTypes = {\r\n      image: 'image/*',\r\n      video: 'video/*',\r\n      audio: 'audio/*',\r\n    }\r\n\r\n    const icons = {\r\n      image: 'image',\r\n      video: 'image', // 使用 image 作为备用\r\n      audio: 'image', // 使用 image 作为备用\r\n    }\r\n\r\n    this.dialog.innerHTML = `\r\n      <div class=\"dialog-header\" style=\"padding: 20px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between;\">\r\n        <h3 style=\"margin: 0; font-size: 18px; font-weight: 600; color: #111827; display: flex; align-items: center; gap: 10px;\">\r\n          <span style=\"width: 24px; height: 24px; color: #3b82f6;\">${getLucideIcon(icons[type])}</span>\r\n          ${typeLabels[type]}\r\n        </h3>\r\n        <button class=\"close-btn\" style=\"background: none; border: none; cursor: pointer; padding: 4px; color: #6b7280; transition: color 0.2s;\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"dialog-tabs\" style=\"display: flex; border-bottom: 1px solid #e5e7eb; background: #f9fafb;\">\r\n        <button class=\"tab-btn active\" data-tab=\"local\" style=\"flex: 1; padding: 12px; background: white; border: none; border-bottom: 2px solid #3b82f6; cursor: pointer; font-weight: 500; color: #3b82f6; transition: all 0.2s;\">\r\n          <span style=\"display: flex; align-items: center; justify-content: center; gap: 6px;\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n              <polyline points=\"17 8 12 3 7 8\"/>\r\n              <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n            </svg>\r\n            本地文件\r\n          </span>\r\n        </button>\r\n        <button class=\"tab-btn\" data-tab=\"url\" style=\"flex: 1; padding: 12px; background: transparent; border: none; border-bottom: 2px solid transparent; cursor: pointer; font-weight: 500; color: #6b7280; transition: all 0.2s;\">\r\n          <span style=\"display: flex; align-items: center; justify-content: center; gap: 6px;\">\r\n            <span style=\"width: 16px; height: 16px;\">${getLucideIcon('link')}</span>\r\n            网络地址\r\n          </span>\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"dialog-body\" style=\"padding: 24px;\">\r\n        <!-- Local File Tab -->\r\n        <div class=\"tab-content\" data-tab=\"local\" style=\"display: block;\">\r\n          <div class=\"upload-area\" style=\"border: 2px dashed #d1d5db; border-radius: 8px; padding: 40px; text-align: center; background: #f9fafb; transition: all 0.3s; cursor: pointer;\">\r\n            <input type=\"file\" accept=\"${acceptTypes[type]}\" multiple style=\"display: none;\" class=\"file-input\">\r\n            <div style=\"width: 48px; height: 48px; margin: 0 auto 16px; color: #9ca3af;\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                <path d=\"M12 2v9\"/>\r\n                <path d=\"m16 6-4-4-4 4\"/>\r\n                <rect width=\"20\" height=\"8\" x=\"2\" y=\"14\" rx=\"2\"/>\r\n              </svg>\r\n            </div>\r\n            <p style=\"margin: 0 0 8px 0; font-size: 16px; color: #374151;\">点击或拖拽文件到这里</p>\r\n            <p style=\"margin: 0; font-size: 14px; color: #6b7280;\">支持 ${type === 'image' ? 'JPG, PNG, GIF, SVG' : type === 'video' ? 'MP4, WebM, OGG' : 'MP3, WAV, OGG'} 格式（可多选）</p>\r\n          </div>\r\n          <div class=\"file-preview\" style=\"margin-top: 16px; display: none;\">\r\n            <div style=\"padding: 12px; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 12px;\">\r\n              <span style=\"width: 32px; height: 32px; color: #3b82f6;\">${getLucideIcon(icons[type])}</span>\r\n              <div style=\"flex: 1;\">\r\n                <div class=\"file-name\" style=\"font-weight: 500; color: #111827;\"></div>\r\n                <div class=\"file-size\" style=\"font-size: 12px; color: #6b7280; margin-top: 2px;\"></div>\r\n              </div>\r\n              <button class=\"remove-file\" style=\"background: none; border: none; cursor: pointer; padding: 4px; color: #ef4444;\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n                </svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- URL Tab -->\r\n        <div class=\"tab-content\" data-tab=\"url\" style=\"display: none;\">\r\n          <div style=\"margin-bottom: 16px;\">\r\n            <label style=\"display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; color: #374151;\">\r\n              ${type === 'video' ? '视频地址（支持YouTube、Bilibili等，每行一个）' : type === 'audio' ? '音频地址（每行一个）' : '图片地址（每行一个）'}\r\n            </label>\r\n            <textarea class=\"url-input\" placeholder=\"https://example.com/image1.jpg&#10;https://example.com/image2.jpg\" rows=\"4\" style=\"width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; transition: border-color 0.2s; outline: none; resize: vertical; font-family: inherit;\"></textarea>\r\n          </div>\r\n          ${type === 'image'\r\n            ? `\r\n          <div style=\"margin-top: 16px; padding: 12px; background: #f0f9ff; border: 1px solid #bfdbfe; border-radius: 6px;\">\r\n            <p style=\"margin: 0 0 8px 0; font-size: 12px; color: #1e40af; font-weight: 500;\">支持的图片格式：</p>\r\n            <p style=\"margin: 0; font-size: 12px; color: #3730a3;\">�?直接链接：JPG, PNG, GIF, SVG, WebP</p>\r\n            <p style=\"margin: 0; font-size: 12px; color: #3730a3;\">�?图床服务：Imgur, 图床�?/p>\r\n          </div>\r\n          `\r\n            : ''}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"dialog-footer\" style=\"padding: 16px 24px; border-top: 1px solid #e5e7eb; display: none; justify-content: flex-end; gap: 12px; background: #f9fafb;\">\r\n        <button class=\"cancel-btn\" style=\"padding: 8px 16px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 14px; color: #374151; transition: all 0.2s;\">\r\n          取消\r\n        </button>\r\n        <button class=\"insert-btn\" style=\"padding: 8px 16px; background: #3b82f6; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; color: white; transition: all 0.2s;\" disabled>\r\n          插入\r\n        </button>\r\n      </div>\r\n    `\r\n\r\n    // Add styles\r\n    const style = document.createElement('style')\r\n    style.textContent = `\r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n      @keyframes slideUp {\r\n        from { transform: translateY(20px); opacity: 0; }\r\n        to { transform: translateY(0); opacity: 1; }\r\n      }\r\n      .ldesign-media-dialog .tab-btn:hover:not(.active) {\r\n        background: #f3f4f6;\r\n        color: #374151;\r\n      }\r\n      .ldesign-media-dialog .upload-area:hover {\r\n        border-color: #3b82f6;\r\n        background: #eff6ff;\r\n      }\r\n      .ldesign-media-dialog .upload-area.dragging {\r\n        border-color: #3b82f6;\r\n        background: #dbeafe;\r\n      }\r\n      .ldesign-media-dialog .url-input:focus {\r\n        border-color: #3b82f6;\r\n        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\r\n      }\r\n      .ldesign-media-dialog .cancel-btn:hover {\r\n        background: #f3f4f6;\r\n      }\r\n      .ldesign-media-dialog .insert-btn:hover:not(:disabled) {\r\n        background: #2563eb;\r\n      }\r\n      .ldesign-media-dialog .insert-btn:disabled {\r\n        opacity: 0.5;\r\n        cursor: not-allowed;\r\n      }\r\n      .ldesign-media-dialog .close-btn:hover {\r\n        color: #374151;\r\n      }\r\n    `\r\n    document.head.appendChild(style)\r\n\r\n    // Add event handlers\r\n    console.log('[MediaDialog.createDialog] Setting up event handlers')\r\n    this.setupEventHandlers()\r\n\r\n    // Append to body\r\n    console.log('[MediaDialog.createDialog] Appending dialog to overlay')\r\n    this.overlay.appendChild(this.dialog)\r\n    console.log('[MediaDialog.createDialog] Appending overlay to body')\r\n    console.log('[MediaDialog.createDialog] document.body exists:', !!document.body)\r\n    document.body.appendChild(this.overlay)\r\n    console.log('[MediaDialog.createDialog] Dialog appended to DOM successfully!')\r\n    console.log('[MediaDialog.createDialog] Overlay in DOM:', document.body.contains(this.overlay))\r\n  }\r\n\r\n  /**\r\n   * Setup event handlers\r\n   */\r\n  private setupEventHandlers() {\r\n    if (!this.dialog || !this.overlay)\r\n      return\r\n\r\n    let selectedFile: File | null = null\r\n    let selectedUrl: string = ''\r\n\r\n    // Tab switching\r\n    const tabBtns = this.dialog.querySelectorAll<HTMLButtonElement>('.tab-btn')\r\n    const tabContents = this.dialog.querySelectorAll<HTMLDivElement>('.tab-content')\r\n\r\n    tabBtns.forEach((btn) => {\r\n      btn.addEventListener('click', () => {\r\n        const tabName = btn.dataset.tab!\r\n\r\n        // Update active tab\r\n        tabBtns.forEach((b) => {\r\n          b.classList.toggle('active', b === btn)\r\n          if (b === btn) {\r\n            b.style.background = 'white'\r\n            b.style.borderBottomColor = '#3b82f6'\r\n            b.style.color = '#3b82f6'\r\n          }\r\n          else {\r\n            b.style.background = 'transparent'\r\n            b.style.borderBottomColor = 'transparent'\r\n            b.style.color = '#6b7280'\r\n          }\r\n        })\r\n\r\n        // Show corresponding content\r\n        tabContents.forEach((content) => {\r\n          content.style.display = content.dataset.tab === tabName ? 'block' : 'none'\r\n        })\r\n\r\n        // Show/hide footer based on active tab\r\n        const footer = this.dialog!.querySelector<HTMLDivElement>('.dialog-footer')!\r\n        if (tabName === 'local')\r\n          footer.style.display = 'none'\r\n        else\r\n          footer.style.display = 'flex'\r\n\r\n        // Update insert button state\r\n        this.updateInsertButton()\r\n      })\r\n    })\r\n\r\n    // File upload\r\n    const uploadArea = this.dialog.querySelector<HTMLDivElement>('.upload-area')!\r\n    const fileInput = this.dialog.querySelector<HTMLInputElement>('.file-input')!\r\n    const filePreview = this.dialog.querySelector<HTMLDivElement>('.file-preview')!\r\n\r\n    uploadArea.addEventListener('click', () => fileInput.click())\r\n\r\n    // Drag and drop\r\n    uploadArea.addEventListener('dragover', (e) => {\r\n      e.preventDefault()\r\n      uploadArea.classList.add('dragging')\r\n    })\r\n\r\n    uploadArea.addEventListener('dragleave', () => {\r\n      uploadArea.classList.remove('dragging')\r\n    })\r\n\r\n    uploadArea.addEventListener('drop', (e) => {\r\n      e.preventDefault()\r\n      uploadArea.classList.remove('dragging')\r\n\r\n      const files = e.dataTransfer?.files\r\n      if (files && files.length > 0) {\r\n        // 支持多文件拖放，自动插入\r\n        handleMultipleFiles(files)\r\n      }\r\n    })\r\n\r\n    fileInput.addEventListener('change', (e) => {\r\n      const files = (e.target as HTMLInputElement).files\r\n      if (files && files.length > 0) {\r\n        // 支持多文件选择，自动插�?\r\n        handleMultipleFiles(files)\r\n      }\r\n    })\r\n\r\n    // 处理多个文件，自动插�?\r\n    const handleMultipleFiles = async (files: FileList) => {\r\n      const cb = this.callback\r\n      if (!cb) {\r\n        console.warn('[MediaDialog] No callback available')\r\n        return\r\n      }\r\n\r\n      console.log(`[MediaDialog] Processing ${files.length} file(s) for auto-insertion`)\r\n\r\n      // 关闭对话�?\r\n      this.close()\r\n\r\n      // 处理每个文件\r\n      for (let i = 0; i < files.length; i++) {\r\n        const file = files[i]\r\n        try {\r\n          // 如果有上传处理器，先上传\r\n          if (this.uploadHandler) {\r\n            console.log(`[MediaDialog] Uploading file ${i + 1}/${files.length}: ${file.name}`)\r\n\r\n            // 创建并显示上传进度条\r\n            const progressUI = this.createUploadProgress(file.name, file.size)\r\n\r\n            try {\r\n              const url = await this.uploadHandler(file, (progress) => {\r\n                console.log(`[MediaDialog] Upload progress for ${file.name}: ${progress.percent}%`)\r\n                // 更新进度条\r\n                progressUI.updateProgress(\r\n                  progress.percent,\r\n                  `上传中... ${progress.loaded} / ${progress.total}`,\r\n                )\r\n              })\r\n\r\n              console.log(`[MediaDialog] File uploaded successfully: ${url}`)\r\n              progressUI.success('上传完成！')\r\n              cb(url, file)\r\n            }\r\n            catch (err) {\r\n              console.error(`[MediaDialog] Upload failed for ${file.name}:`, err)\r\n              progressUI.error('上传失败')\r\n              throw err\r\n            }\r\n          }\r\n          else {\r\n            // 没有上传处理器，使用 data URL\r\n            const reader = new FileReader()\r\n            const dataUrl = await new Promise<string>((resolve, reject) => {\r\n              reader.onload = e => resolve(e.target?.result as string)\r\n              reader.onerror = () => reject(new Error(`Failed to read file: ${file.name}`))\r\n              reader.readAsDataURL(file)\r\n            })\r\n\r\n            console.log(`[MediaDialog] Auto-inserting file ${i + 1}/${files.length}: ${file.name}`)\r\n            cb(dataUrl, file)\r\n          }\r\n        }\r\n        catch (err) {\r\n          console.error(`[MediaDialog] Error processing file ${file.name}:`, err)\r\n          // 继续处理下一个文�?\r\n        }\r\n      }\r\n    }\r\n\r\n    const handleFileSelect = (file: File) => {\r\n      selectedFile = file\r\n\r\n      // Show preview\r\n      filePreview.style.display = 'block'\r\n      const fileName = filePreview.querySelector('.file-name')!\r\n      const fileSize = filePreview.querySelector('.file-size')!\r\n\r\n      fileName.textContent = file.name\r\n      fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`\r\n\r\n      this.updateInsertButton()\r\n    }\r\n\r\n    // Remove file\r\n    const removeFileBtn = this.dialog.querySelector<HTMLButtonElement>('.remove-file')\r\n    removeFileBtn?.addEventListener('click', () => {\r\n      selectedFile = null\r\n      fileInput.value = ''\r\n      filePreview.style.display = 'none'\r\n      this.updateInsertButton()\r\n    })\r\n\r\n    // URL input\r\n    const urlInput = this.dialog.querySelector<HTMLTextAreaElement>('.url-input')!\r\n    urlInput.addEventListener('input', (e) => {\r\n      selectedUrl = (e.target as HTMLTextAreaElement).value\r\n      this.updateInsertButton()\r\n    })\r\n\r\n    // Update insert button state\r\n    const updateInsertButton = () => {\r\n      const insertBtn = this.dialog!.querySelector<HTMLButtonElement>('.insert-btn')!\r\n      const activeTab = this.dialog!.querySelector<HTMLButtonElement>('.tab-btn.active')!.dataset.tab\r\n\r\n      if (activeTab === 'local')\r\n        insertBtn.disabled = !selectedFile\r\n      else\r\n        insertBtn.disabled = !selectedUrl || !selectedUrl.trim()\r\n    }\r\n\r\n    this.updateInsertButton = updateInsertButton\r\n\r\n    // Close button\r\n    const closeBtn = this.dialog.querySelector<HTMLButtonElement>('.close-btn')!\r\n    closeBtn.addEventListener('click', () => this.close())\r\n\r\n    // Cancel button\r\n    const cancelBtn = this.dialog.querySelector<HTMLButtonElement>('.cancel-btn')!\r\n    cancelBtn.addEventListener('click', () => this.close())\r\n\r\n    // Insert button\r\n    const insertBtn = this.dialog.querySelector<HTMLButtonElement>('.insert-btn')!\r\n    insertBtn.addEventListener('click', () => {\r\n      const activeTab = this.dialog!.querySelector<HTMLButtonElement>('.tab-btn.active')!.dataset.tab\r\n      console.log('[MediaDialog] Insert button clicked. Active tab:', activeTab)\r\n\r\n      // Preserve callback before close(), because close() clears it\r\n      const cb = this.callback\r\n      if (!cb) {\r\n        console.warn('[MediaDialog] No callback set at insert time')\r\n        return\r\n      }\r\n\r\n      if (activeTab === 'url' && selectedUrl) {\r\n        // 支持多个 URL（每行一个）\r\n        const urls = selectedUrl.split('\\n')\r\n          .map(u => u.trim())\r\n          .filter(u => u.length > 0)\r\n\r\n        console.log(`[MediaDialog] Inserting ${urls.length} URL(s)`)\r\n\r\n        // Close dialog before insertion\r\n        this.close()\r\n\r\n        // Insert each URL\r\n        urls.forEach((url, index) => {\r\n          try {\r\n            console.log(`[MediaDialog] Inserting URL ${index + 1}/${urls.length}:`, url)\r\n            cb(url)\r\n          }\r\n          catch (err) {\r\n            console.error(`[MediaDialog] Error inserting URL ${url}:`, err)\r\n          }\r\n        })\r\n      }\r\n      else {\r\n        console.warn('[MediaDialog] Insert button clicked but no valid URL input')\r\n      }\r\n    })\r\n\r\n    // Close on overlay click\r\n    this.overlay.addEventListener('click', (e) => {\r\n      if (e.target === this.overlay)\r\n        this.close()\r\n    })\r\n\r\n    // Close on ESC key\r\n    const handleEsc = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape')\r\n        this.close()\r\n    }\r\n    document.addEventListener('keydown', handleEsc)\r\n    this.escHandler = handleEsc\r\n  }\r\n\r\n  private updateInsertButton: (() => void) | null = null\r\n  private escHandler: ((e: KeyboardEvent) => void) | null = null\r\n\r\n  /**\r\n   * 创建上传进度条\r\n   */\r\n  private createUploadProgress(fileName: string, fileSize: number): any {\r\n    const progressId = `progress-${Date.now()}`\r\n\r\n    const container = document.createElement('div')\r\n    container.className = 'upload-progress'\r\n    container.style.cssText = `\r\n      position: fixed;\r\n      bottom: 20px;\r\n      right: 20px;\r\n      width: 320px;\r\n      background: white;\r\n      border-radius: 8px;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      padding: 16px;\r\n      z-index: 10000;\r\n    `\r\n\r\n    container.innerHTML = `\r\n      <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px;\">\r\n        <div style=\"flex: 1;\">\r\n          <div style=\"font-weight: 600; font-size: 14px; margin-bottom: 4px;\">${fileName}</div>\r\n          <div class=\"status\" style=\"font-size: 12px; color: #6b7280;\">准备上传...</div>\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-bottom: 4px;\">\r\n          <span class=\"percent\">0%</span>\r\n          <span>${this.formatFileSize(fileSize)}</span>\r\n        </div>\r\n        <div style=\"height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;\">\r\n          <div class=\"progress-fill\" style=\"height: 100%; width: 0%; background: linear-gradient(90deg, #3b82f6, #10b981); transition: width 0.3s;\"></div>\r\n        </div>\r\n      </div>\r\n    `\r\n\r\n    document.body.appendChild(container)\r\n\r\n    const progressBar = container.querySelector('.progress-fill') as HTMLElement\r\n    const percentText = container.querySelector('.percent') as HTMLElement\r\n    const statusText = container.querySelector('.status') as HTMLElement\r\n\r\n    const progressAPI = {\r\n      updateProgress: (percent: number, status?: string) => {\r\n        progressBar.style.width = `${percent}%`\r\n        percentText.textContent = `${Math.round(percent)}%`\r\n        if (status)\r\n          statusText.textContent = status\r\n      },\r\n      success: (message: string = '上传完成！') => {\r\n        progressBar.style.background = '#10b981'\r\n        statusText.textContent = message\r\n        statusText.style.color = '#10b981'\r\n        setTimeout(() => {\r\n          container.remove()\r\n          this.activeProgresses.delete(progressId)\r\n        }, 2000)\r\n      },\r\n      error: (message: string = '上传失败') => {\r\n        progressBar.style.background = '#ef4444'\r\n        statusText.textContent = message\r\n        statusText.style.color = '#ef4444'\r\n        setTimeout(() => {\r\n          container.remove()\r\n          this.activeProgresses.delete(progressId)\r\n        }, 3000)\r\n      },\r\n    }\r\n\r\n    this.activeProgresses.set(progressId, progressAPI)\r\n    return progressAPI\r\n  }\r\n\r\n  /**\r\n   * 格式化文件大小\r\n   */\r\n  private formatFileSize(bytes: number): string {\r\n    if (bytes === 0)\r\n      return '0 B'\r\n    const units = ['B', 'KB', 'MB', 'GB']\r\n    const k = 1024\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n    return `${(bytes / k ** i).toFixed(2)} ${units[i]}`\r\n  }\r\n\r\n  /**\r\n   * Close the dialog\r\n   */\r\n  close() {\r\n    if (this.escHandler) {\r\n      document.removeEventListener('keydown', this.escHandler)\r\n      this.escHandler = null\r\n    }\r\n\r\n    if (this.overlay) {\r\n      this.overlay.style.animation = 'fadeIn 0.2s ease reverse'\r\n      setTimeout(() => {\r\n        this.overlay?.remove()\r\n        this.overlay = null\r\n      }, 200)\r\n    }\r\n\r\n    this.dialog = null\r\n    this.callback = null\r\n  }\r\n}\r\n\r\n// Single instance\r\nlet mediaDialog: MediaDialog | null = null\r\n\r\n/**\r\n * Media Dialog Plugin\r\n */\r\nexport const MediaDialogPlugin: Plugin = {\r\n  name: 'media-dialog',\r\n\r\n  install(editor: any) {\r\n    console.log('[MediaDialogPlugin] Installing plugin...')\r\n    // Initialize media dialog\r\n    if (!mediaDialog) {\r\n      console.log('[MediaDialogPlugin] Creating MediaDialog instance')\r\n      mediaDialog = new MediaDialog()\r\n    }\r\n\r\n    // 设置上传处理器（如果有）\r\n    if (editor.options?.uploadHandler) {\r\n      console.log('[MediaDialogPlugin] Setting upload handler from editor options')\r\n      mediaDialog.setUploadHandler(editor.options.uploadHandler)\r\n    }\r\n    else {\r\n      console.log('[MediaDialogPlugin] No upload handler configured, will use data URLs')\r\n    }\r\n\r\n    // Register image insertion command (only if not already registered)\r\n    if (!editor.commands.get('insertImage')) {\r\n      console.log('[MediaDialogPlugin] Registering command: insertImage')\r\n      editor.commands.register('insertImage', () => {\r\n        console.log('[MediaDialog] insertImage command triggered')\r\n        console.log('[MediaDialog] typeof editor.insertHTML:', typeof editor.insertHTML)\r\n        // 进入弹窗前保存当前选区，以便插入时能回到光标处\r\n        try { editor.saveSelection?.() }\r\n        catch {}\r\n        mediaDialog!.show('image', (url, file) => {\r\n          try {\r\n            console.log('[MediaDialog] Image callback - url:', url, 'file:', file)\r\n            const alt = file ? file.name : 'Image'\r\n            const html = `<img src=\"${url}\" alt=\"${alt}\" style=\"max-width: 100%; height: auto; display: block; margin: 10px 0;\">`\r\n            console.log('[MediaDialog] Inserting image HTML length:', html.length)\r\n\r\n            // 使用编辑器的 insertHTML 方法\r\n            if (typeof editor.insertHTML === 'function') {\r\n              editor.insertHTML(html)\r\n              console.log('[MediaDialog] Image inserted via editor.insertHTML')\r\n            }\r\n            else {\r\n              console.warn('[MediaDialog] editor.insertHTML not found, trying execCommand fallback')\r\n              document.execCommand('insertHTML', false, html)\r\n            }\r\n          }\r\n          catch (err) {\r\n            console.error('[MediaDialog] Error while inserting image:', err)\r\n          }\r\n        })\r\n        return true\r\n      })\r\n    }\r\n    else {\r\n      console.log('[MediaDialogPlugin] Command already exists: insertImage')\r\n    }\r\n\r\n    // Register video insertion command (only if not already registered)\r\n    if (!editor.commands.get('insertVideo')) {\r\n      console.log('[MediaDialogPlugin] Registering command: insertVideo')\r\n      editor.commands.register('insertVideo', () => {\r\n        console.log('[MediaDialog] insertVideo command triggered')\r\n        console.log('[MediaDialog] typeof editor.insertHTML:', typeof editor.insertHTML)\r\n        try { editor.saveSelection?.() }\r\n        catch {}\r\n        mediaDialog!.show('video', (url, file) => {\r\n          try {\r\n            console.log('[MediaDialog] Video callback - url:', url, 'file:', file)\r\n            let html = ''\r\n\r\n            // Check if it's a platform video\r\n            if (url.includes('youtube.com') || url.includes('youtu.be')) {\r\n              const videoId = url.split('v=')[1] || url.split('/').pop()\r\n              const embedUrl = `https://www.youtube.com/embed/${videoId}`\r\n              html = `<iframe width=\"560\" height=\"315\" src=\"${embedUrl}\" frameborder=\"0\" allowfullscreen style=\"display: block; margin: 10px 0;\"></iframe>`\r\n            }\r\n            else if (url.includes('bilibili.com')) {\r\n              const bvid = url.match(/BV\\w+/)?.[0]\r\n              if (bvid)\r\n                html = `<iframe src=\"//player.bilibili.com/player.html?bvid=${bvid}\" width=\"560\" height=\"315\" frameborder=\"0\" allowfullscreen style=\"display: block; margin: 10px 0;\"></iframe>`\r\n            }\r\n            else {\r\n              // Regular video\r\n              html = `<video controls style=\\\"max-width: 100%; height: auto; display: block; margin: 10px 0;\\\">\\n              <source src=\\\"${url}\\\" type=\\\"${file ? file.type : 'video/mp4'}\\\">\\n              您的浏览器不支持视频标签。\\n            </video>`\r\n            }\r\n\r\n            if (html) {\r\n              console.log('[MediaDialog] Inserting video HTML length:', html.length)\r\n              if (typeof editor.insertHTML === 'function') {\r\n                editor.insertHTML(html)\r\n                console.log('[MediaDialog] Video inserted via editor.insertHTML')\r\n              }\r\n              else {\r\n                console.warn('[MediaDialog] editor.insertHTML not found, trying execCommand fallback')\r\n                document.execCommand('insertHTML', false, html)\r\n              }\r\n            }\r\n            else {\r\n              console.warn('[MediaDialog] Video HTML not generated')\r\n            }\r\n          }\r\n          catch (err) {\r\n            console.error('[MediaDialog] Error while inserting video:', err)\r\n          }\r\n        })\r\n        return true\r\n      })\r\n    }\r\n    else {\r\n      console.log('[MediaDialogPlugin] Command already exists: insertVideo')\r\n    }\r\n\r\n    // Register audio insertion command (only if not already registered)\r\n    if (!editor.commands.get('insertAudio')) {\r\n      console.log('[MediaDialogPlugin] Registering command: insertAudio')\r\n      editor.commands.register('insertAudio', () => {\r\n        console.log('[MediaDialog] insertAudio command triggered')\r\n        console.log('[MediaDialog] typeof editor.insertHTML:', typeof editor.insertHTML)\r\n        try { editor.saveSelection?.() }\r\n        catch {}\r\n        mediaDialog!.show('audio', (url, file) => {\r\n          try {\r\n            console.log('[MediaDialog] Audio callback - url:', url, 'file:', file)\r\n            const html = `<audio controls style=\\\"width: 100%; max-width: 400px; display: block; margin: 10px 0;\\\">\\n            <source src=\\\"${url}\\\" type=\\\"${file ? file.type : 'audio/mpeg'}\\\">\\n            您的浏览器不支持音频标签。\\n          </audio>`\r\n\r\n            console.log('[MediaDialog] Inserting audio HTML length:', html.length)\r\n            if (typeof editor.insertHTML === 'function') {\r\n              editor.insertHTML(html)\r\n              console.log('[MediaDialog] Audio inserted via editor.insertHTML')\r\n            }\r\n            else {\r\n              console.warn('[MediaDialog] editor.insertHTML not found, trying execCommand fallback')\r\n              document.execCommand('insertHTML', false, html)\r\n            }\r\n          }\r\n          catch (err) {\r\n            console.error('[MediaDialog] Error while inserting audio:', err)\r\n          }\r\n        })\r\n        return true\r\n      })\r\n    }\r\n    else {\r\n      console.log('[MediaDialogPlugin] Command already exists: insertAudio')\r\n    }\r\n\r\n    console.log('[MediaDialogPlugin] Installation complete. Commands:', editor.commands.getCommands?.())\r\n  },\r\n}\r\n\r\nexport default MediaDialogPlugin\r\n"],"names":["MediaDialog","dialog","overlay","callback","uploadHandler","activeProgresses","Map","updateInsertButton","escHandler","setUploadHandler","show","type","console","log","close","createDialog","document","createElement","className","style","cssText","typeLabels","image","video","audio","acceptTypes","icons","innerHTML","getLucideIcon","textContent","head","appendChild","setupEventHandlers","body","contains","selectedFile","selectedUrl","tabBtns","querySelectorAll","tabContents","forEach","btn","addEventListener","tabName","dataset","tab","b","classList","toggle","background","borderBottomColor","color","content","display","footer","querySelector","uploadArea","fileInput","filePreview","click","e","preventDefault","add","remove","files","dataTransfer","length","handleMultipleFiles","target","cb","warn","i","file","name","progressUI","createUploadProgress","size","url","progress","percent","updateProgress","loaded","total","success","err","error","reader","FileReader","dataUrl","Promise","resolve","reject","onload","result","onerror","Error","readAsDataURL","removeFileBtn","value","urlInput","insertBtn","activeTab","disabled","trim","closeBtn","cancelBtn","urls","split","map","u","filter","index","handleEsc","key","fileName","fileSize","progressId","Date","now","container","formatFileSize","progressBar","percentText","statusText","progressAPI","status","width","Math","round","message","setTimeout","delete","set","bytes","units","k","floor","toFixed","removeEventListener","animation","mediaDialog","MediaDialogPlugin","install","editor","options","commands","get","register","insertHTML","saveSelection","alt","html","execCommand","includes","videoId","pop","embedUrl","bvid","match","getCommands"],"mappings":"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"}