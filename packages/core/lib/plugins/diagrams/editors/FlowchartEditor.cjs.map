{"version":3,"file":"FlowchartEditor.cjs","sources":["../../../../src/plugins/diagrams/editors/FlowchartEditor.ts"],"sourcesContent":["/**\r\n * ÊµÅÁ®ãÂõæÁºñËæëÂô®\r\n * ÁÆÄÂåñÂÆûÁé∞ÔºåÊîØÊåÅÂü∫Êú¨ÁöÑËäÇÁÇπÂàõÂª∫ÂíåËøûÊé•\r\n */\r\n\r\nimport type { DiagramEditor, DiagramOptions, FlowchartData } from '../types'\r\nimport { createLogger } from '../../../utils/logger'\r\n\r\nconst logger = createLogger('FlowchartEditor')\r\n\r\nexport class FlowchartEditor implements DiagramEditor {\r\n  private container?: HTMLElement\r\n  private data?: FlowchartData\r\n  private onSave?: (data: FlowchartData, options?: DiagramOptions) => void\r\n  private onCancel?: () => void\r\n\r\n  async render(container: HTMLElement, options: {\r\n    data: FlowchartData\r\n    onSave: (data: FlowchartData, options?: DiagramOptions) => void\r\n    onCancel: () => void\r\n  }): Promise<void> {\r\n    logger.info('Rendering flowchart editor')\r\n\r\n    this.container = container\r\n    this.data = JSON.parse(JSON.stringify(options.data))\r\n    this.onSave = options.onSave\r\n    this.onCancel = options.onCancel\r\n\r\n    this.createUI()\r\n  }\r\n\r\n  private createUI(): void {\r\n    if (!this.container || !this.data)\r\n      return\r\n\r\n    this.container.innerHTML = `\r\n      <div class=\"flowchart-editor\" style=\"display: flex; flex-direction: column; height: 100%;\">\r\n        <div style=\"padding: 15px; border-bottom: 1px solid #e0e0e0;\">\r\n          <h4 style=\"margin: 0 0 10px 0;\">ÊµÅÁ®ãÂõæËäÇÁÇπ</h4>\r\n          <div id=\"nodeList\" style=\"display: flex; flex-direction: column; gap: 8px; max-height: 300px; overflow-y: auto;\">\r\n            ${this.data.nodes.map((node, index) => `\r\n              <div style=\"display: flex; align-items: center; gap: 10px; padding: 8px; background: #f5f5f5; border-radius: 4px;\">\r\n                <span style=\"flex: 1; font-size: 14px;\">${this.getNodeIcon(node.type)} ${node.text}</span>\r\n                <button onclick=\"window.editFlowNode(${index})\" style=\"padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;\">ÁºñËæë</button>\r\n                <button onclick=\"window.deleteFlowNode(${index})\" style=\"padding: 4px 8px; border: 1px solid #f44336; color: #f44336; border-radius: 4px; cursor: pointer;\">Âà†Èô§</button>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n          <button id=\"addNode\" style=\"margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;\">\r\n            ‚ûï Ê∑ªÂä†ËäÇÁÇπ\r\n          </button>\r\n        </div>\r\n        \r\n        <div style=\"flex: 1; padding: 15px; overflow-y: auto;\">\r\n          <h4 style=\"margin: 0 0 10px 0;\">ËøûÊé•ÂÖ≥Á≥ª</h4>\r\n          <div id=\"edgeList\">\r\n            ${this.data.edges.map((edge, index) => {\r\n              const fromNode = this.data!.nodes.find(n => n.id === edge.from)\r\n              const toNode = this.data!.nodes.find(n => n.id === edge.to)\r\n              return `\r\n                <div style=\"display: flex; align-items: center; gap: 10px; padding: 8px; background: #f5f5f5; border-radius: 4px; margin-bottom: 8px;\">\r\n                  <span style=\"flex: 1; font-size: 14px;\">${fromNode?.text || edge.from} ‚Üí ${toNode?.text || edge.to}</span>\r\n                  <button onclick=\"window.deleteFlowEdge(${index})\" style=\"padding: 4px 8px; border: 1px solid #f44336; color: #f44336; border-radius: 4px; cursor: pointer;\">Âà†Èô§</button>\r\n                </div>\r\n              `\r\n            }).join('')}\r\n          </div>\r\n          <button id=\"addEdge\" style=\"margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;\">\r\n            ‚ûï Ê∑ªÂä†ËøûÊé•\r\n          </button>\r\n        </div>\r\n        \r\n        <div style=\"padding: 15px; border-top: 1px solid #e0e0e0; display: flex; justify-content: flex-end; gap: 10px;\">\r\n          <button id=\"cancel\" style=\"padding: 8px 20px; background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;\">ÂèñÊ∂à</button>\r\n          <button id=\"save\" style=\"padding: 8px 20px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;\">‰øùÂ≠ò</button>\r\n        </div>\r\n      </div>\r\n    `\r\n\r\n    this.bindEvents()\r\n  }\r\n\r\n  private bindEvents(): void {\r\n    // ÂÖ®Â±ÄÂáΩÊï∞\r\n    (window as any).editFlowNode = (index: number) => this.editNode(index);\r\n    (window as any).deleteFlowNode = (index: number) => this.deleteNode(index);\r\n    (window as any).deleteFlowEdge = (index: number) => this.deleteEdge(index)\r\n\r\n    this.container?.querySelector('#addNode')?.addEventListener('click', () => this.addNode())\r\n    this.container?.querySelector('#addEdge')?.addEventListener('click', () => this.addEdge())\r\n    this.container?.querySelector('#save')?.addEventListener('click', () => {\r\n      if (this.onSave && this.data)\r\n        this.onSave(this.data)\r\n    })\r\n    this.container?.querySelector('#cancel')?.addEventListener('click', () => this.onCancel?.())\r\n  }\r\n\r\n  private getNodeIcon(type: string): string {\r\n    const icons: Record<string, string> = {\r\n      start: '‚≠ï',\r\n      end: 'üî¥',\r\n      process: '‚ñ≠',\r\n      decision: '‚óÜ',\r\n      io: '‚¨ü',\r\n      subroutine: '‚ñ≠‚ñ≠',\r\n    }\r\n    return icons[type] || '‚ñ≠'\r\n  }\r\n\r\n  private addNode(): void {\r\n    if (!this.data)\r\n      return\r\n\r\n    const text = prompt('ËäÇÁÇπÊñáÊú¨Ôºö', 'Êñ∞ËäÇÁÇπ')\r\n    if (!text)\r\n      return\r\n\r\n    const type = prompt('ËäÇÁÇπÁ±ªÂûã (start/end/process/decision/io):', 'process') as any\r\n\r\n    this.data.nodes.push({\r\n      id: `node-${Date.now()}`,\r\n      type: type || 'process',\r\n      text,\r\n      x: 100 + this.data.nodes.length * 50,\r\n      y: 100,\r\n    })\r\n\r\n    this.createUI()\r\n  }\r\n\r\n  private editNode(index: number): void {\r\n    if (!this.data)\r\n      return\r\n\r\n    const node = this.data.nodes[index]\r\n    const newText = prompt('ÁºñËæëËäÇÁÇπÊñáÊú¨Ôºö', node.text)\r\n    if (newText !== null) {\r\n      node.text = newText\r\n      this.createUI()\r\n    }\r\n  }\r\n\r\n  private deleteNode(index: number): void {\r\n    if (!this.data || !confirm('Á°ÆÂÆöÂà†Èô§Ôºü'))\r\n      return\r\n\r\n    const nodeId = this.data.nodes[index].id\r\n    this.data.nodes.splice(index, 1)\r\n    this.data.edges = this.data.edges.filter(e => e.from !== nodeId && e.to !== nodeId)\r\n    this.createUI()\r\n  }\r\n\r\n  private addEdge(): void {\r\n    if (!this.data || this.data.nodes.length < 2) {\r\n      alert('Ëá≥Â∞ëÈúÄË¶Å2‰∏™ËäÇÁÇπÊâçËÉΩÊ∑ªÂä†ËøûÊé•')\r\n      return\r\n    }\r\n\r\n    const options = this.data.nodes.map(n => `${n.id}: ${n.text}`).join('\\n')\r\n    const from = prompt(`Ëµ∑ÂßãËäÇÁÇπID:\\n${options}`)\r\n    const to = prompt(`ÁõÆÊ†áËäÇÁÇπID:\\n${options}`)\r\n\r\n    if (from && to) {\r\n      this.data.edges.push({ from, to })\r\n      this.createUI()\r\n    }\r\n  }\r\n\r\n  private deleteEdge(index: number): void {\r\n    if (!this.data || !confirm('Á°ÆÂÆöÂà†Èô§Ôºü'))\r\n      return\r\n\r\n    this.data.edges.splice(index, 1)\r\n    this.createUI()\r\n  }\r\n\r\n  destroy(): void {\r\n    delete (window as any).editFlowNode\r\n    delete (window as any).deleteFlowNode\r\n    delete (window as any).deleteFlowEdge\r\n  }\r\n}\r\n"],"names":["logger","createLogger","FlowchartEditor","render","container","options","info","data","JSON","parse","stringify","onSave","onCancel","createUI","innerHTML","nodes","map","node","index","getNodeIcon","type","text","join","edges","edge","fromNode","find","n","id","from","toNode","to","bindEvents","window","editFlowNode","editNode","deleteFlowNode","deleteNode","deleteFlowEdge","deleteEdge","querySelector","addEventListener","addNode","addEdge","icons","start","end","process","decision","io","subroutine","prompt","push","Date","now","x","length","y","newText","confirm","nodeId","splice","filter","e","alert","destroy"],"mappings":"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"}