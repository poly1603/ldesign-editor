{"version":3,"file":"DiagramPlugin.cjs","sources":["../../../src/plugins/diagrams/DiagramPlugin.ts"],"sourcesContent":["/**\r\n * ÂõæË°®Êèí‰ª∂\r\n * Êèê‰æõÊÄùÁª¥ÂØºÂõæ„ÄÅÊµÅÁ®ãÂõæ„ÄÅUMLÂõæÁ≠âÂõæË°®ÁºñËæëÊîØÊåÅ\r\n */\r\n\r\nimport type { Plugin } from '../../core/Plugin'\r\nimport type { EditorInstance } from '../../types'\r\nimport type { DiagramData, DiagramOptions, DiagramType } from './types'\r\nimport { createLogger } from '../../utils/logger'\r\nimport { DiagramRenderer } from './DiagramRenderer'\r\nimport { DiagramToolbar } from './DiagramToolbar'\r\nimport { FlowchartEditor } from './editors/FlowchartEditor'\r\nimport { GanttEditor } from './editors/GanttEditor'\r\nimport { MindMapEditor } from './editors/MindMapEditor'\r\nimport { SequenceDiagramEditor } from './editors/SequenceDiagramEditor'\r\nimport { UMLEditor } from './editors/UMLEditor'\r\n\r\nconst logger = createLogger('DiagramPlugin')\r\n\r\nexport class DiagramPlugin implements Plugin {\r\n  name = 'diagram'\r\n  config = {\r\n    name: 'diagram',\r\n  }\n\r\n  version = '1.0.0'\r\n  description = 'È´òÁ∫ßÂõæË°®ÁºñËæëÊîØÊåÅ'\r\n\r\n  private editor?: EditorInstance\r\n  private renderer?: DiagramRenderer\r\n  private toolbar?: DiagramToolbar\r\n  private editors = new Map<DiagramType, any>()\r\n  private currentEditor?: any\r\n  private currentType?: DiagramType\r\n  private container?: HTMLElement\r\n\r\n  /**\r\n   * ÂàùÂßãÂåñÊèí‰ª∂\r\n   */\r\n  async install(editor: EditorInstance): Promise<void> {\r\n    logger.info('Initializing diagram plugin')\r\n    this.editor = editor\r\n\r\n    // ÂàùÂßãÂåñÊ∏≤ÊüìÂô®\r\n    this.renderer = new DiagramRenderer({\r\n      editor,\r\n    })\r\n\r\n    // ÂàùÂßãÂåñÂ∑•ÂÖ∑Ê†è\r\n    this.toolbar = new DiagramToolbar({\r\n      editor,\r\n      onInsertDiagram: type => this.insertDiagram(type),\r\n      onEditDiagram: node => this.editDiagram(node),\r\n    })\r\n\r\n    // Ê≥®ÂÜåÁºñËæëÂô®\r\n    this.registerEditors()\r\n\r\n    // Ê≥®ÂÜåÂëΩ‰ª§\r\n    this.registerCommands()\r\n\r\n    // Ê≥®ÂÜåËäÇÁÇπËßÜÂõæ\r\n    this.registerNodeViews()\r\n\r\n    // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨\r\n    this.setupEventListeners()\r\n\r\n    logger.info('Diagram plugin initialized')\r\n  }\r\n\r\n  /**\r\n   * Ê≥®ÂÜåÁºñËæëÂô®\r\n   */\r\n  private registerEditors(): void {\r\n    this.editors.set('mindmap', new MindMapEditor())\r\n    this.editors.set('flowchart', new FlowchartEditor())\r\n    this.editors.set('uml', new UMLEditor())\r\n    this.editors.set('sequence', new SequenceDiagramEditor())\r\n    this.editors.set('gantt', new GanttEditor())\r\n  }\r\n\r\n  /**\r\n   * Ê≥®ÂÜåÂëΩ‰ª§\r\n   */\r\n  private registerCommands(): void {\r\n    if (!this.editor) return\r\n    const { commands } = this.editor\r\n\r\n    // ÊèíÂÖ•ÂõæË°®ÂëΩ‰ª§\r\n    commands.register('insertMindMap', {\r\n      label: 'ÊèíÂÖ•ÊÄùÁª¥ÂØºÂõæ',\r\n      icon: 'üß†',\r\n      execute: () => this.insertDiagram('mindmap'),\r\n    })\r\n\r\n    commands.register('insertFlowchart', {\r\n      label: 'ÊèíÂÖ•ÊµÅÁ®ãÂõæ',\r\n      icon: 'üîÄ',\r\n      execute: () => this.insertDiagram('flowchart'),\r\n    })\r\n\r\n    commands.register('insertUML', {\r\n      label: 'ÊèíÂÖ•UMLÂõæ',\r\n      icon: 'üìê',\r\n      execute: () => this.insertDiagram('uml'),\r\n    })\r\n\r\n    commands.register('insertSequenceDiagram', {\r\n      label: 'ÊèíÂÖ•Êó∂Â∫èÂõæ',\r\n      icon: 'üìä',\r\n      execute: () => this.insertDiagram('sequence'),\r\n    })\r\n\r\n    commands.register('insertGantt', {\r\n      label: 'ÊèíÂÖ•ÁîòÁâπÂõæ',\r\n      icon: 'üìÖ',\r\n      execute: () => this.insertDiagram('gantt'),\r\n    })\r\n\r\n    // ÁºñËæëÂõæË°®ÂëΩ‰ª§\r\n    commands.register('editDiagram', {\r\n      label: 'ÁºñËæëÂõæË°®',\r\n      icon: '‚úèÔ∏è',\r\n      execute: () => {\r\n        const node = this.getSelectedDiagramNode()\r\n        if (node)\r\n          this.editDiagram(node)\r\n      },\r\n    })\r\n\r\n    // ÂØºÂá∫ÂõæË°®ÂëΩ‰ª§\r\n    commands.register('exportDiagram', {\r\n      label: 'ÂØºÂá∫ÂõæË°®',\r\n      icon: 'üíæ',\r\n      execute: () => this.exportDiagram(),\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Ê≥®ÂÜåËäÇÁÇπËßÜÂõæ\r\n   */\r\n  private registerNodeViews(): void {\r\n    if (!this.editor) return\r\n    const schema = (this.editor as any).schema\r\n    if (!schema) return\r\n\r\n    // Ê≥®ÂÜåÂõæË°®ËäÇÁÇπ\r\n    schema.nodes.diagram = {\r\n      attrs: {\r\n        type: { default: 'mindmap' },\r\n        data: { default: null },\r\n        width: { default: '100%' },\r\n        height: { default: 400 },\r\n      },\r\n      content: 'text*',\r\n      group: 'block',\r\n      draggable: true,\r\n      parseDOM: [{\r\n        tag: 'div[data-diagram]',\r\n        getAttrs: (dom: HTMLElement) => ({\r\n          type: dom.dataset.diagramType,\r\n          data: JSON.parse(dom.dataset.diagramData || '{}'),\r\n          width: dom.style.width,\r\n          height: dom.style.height,\r\n        }),\r\n      }],\r\n      toDOM: (node: any) => ['div', {\r\n        'data-diagram': 'true',\r\n        'data-diagram-type': node.attrs.type,\r\n        'data-diagram-data': JSON.stringify(node.attrs.data),\r\n        'style': `width: ${node.attrs.width}; height: ${node.attrs.height}px`,\r\n        'class': 'diagram-node',\r\n      }, 0],\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨\r\n   */\r\n  private setupEventListeners(): void {\r\n    if (!this.editor) return\r\n    const editor = this.editor\r\n\r\n    // ÁõëÂê¨ÈÄâÊã©ÂèòÂåñ\r\n    editor.on('selectionUpdate', () => {\r\n      const node = this.getSelectedDiagramNode()\r\n      this.toolbar?.updateState(!!node)\r\n    })\r\n\r\n    // ÁõëÂê¨ÂèåÂáªÁºñËæë\r\n    editor.contentElement?.addEventListener('dblclick', (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement\r\n      const diagramNode = target.closest('.diagram-node')\r\n      if (diagramNode)\r\n        this.editDiagram(diagramNode as HTMLElement)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ÊèíÂÖ•ÂõæË°®\r\n   */\r\n  async insertDiagram(type: DiagramType, data?: DiagramData): Promise<void> {\r\n    logger.info(`Inserting ${type} diagram`)\r\n\r\n    // ÂàõÂª∫ÁºñËæëÂô®\r\n    const editor = this.editors.get(type)\r\n    if (!editor) {\r\n      logger.error(`Unknown diagram type: ${type}`)\r\n      return\r\n    }\r\n\r\n    // ÊòæÁ§∫ÁºñËæëÂô®\r\n    this.currentType = type\r\n    this.currentEditor = editor\r\n\r\n    const result = await this.showEditor(editor, {\r\n      type,\r\n      data: data || this.getDefaultData(type),\r\n      isNew: true,\r\n    })\r\n\r\n    if (result) {\r\n      // ÊèíÂÖ•ÂõæË°®ËäÇÁÇπ\r\n      const { commands } = this.context!\r\n      commands.execute('insertNode', {\r\n        type: 'diagram',\r\n        attrs: {\r\n          type,\r\n          data: result.data,\r\n          width: result.options?.width || '100%',\r\n          height: result.options?.height || 400,\r\n        },\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÁºñËæëÂõæË°®\r\n   */\r\n  async editDiagram(node: HTMLElement): Promise<void> {\r\n    const type = node.dataset.diagramType as DiagramType\r\n    const data = JSON.parse(node.dataset.diagramData || '{}')\r\n\r\n    logger.info(`Editing ${type} diagram`)\r\n\r\n    const editor = this.editors.get(type)\r\n    if (!editor) {\r\n      logger.error(`Unknown diagram type: ${type}`)\r\n      return\r\n    }\r\n\r\n    this.currentType = type\r\n    this.currentEditor = editor\r\n\r\n    const result = await this.showEditor(editor, {\r\n      type,\r\n      data,\r\n      isNew: false,\r\n      node,\r\n    })\r\n\r\n    if (result) {\r\n      // Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ\r\n      node.dataset.diagramData = JSON.stringify(result.data)\r\n\r\n      // ÈáçÊñ∞Ê∏≤Êüì\r\n      this.renderer?.render(node, type, result.data)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÊòæÁ§∫ÁºñËæëÂô®\r\n   */\r\n  private async showEditor(editor: any, options: {\r\n    type: DiagramType\r\n    data: DiagramData\r\n    isNew: boolean\r\n    node?: HTMLElement\r\n  }): Promise<{ data: DiagramData, options?: DiagramOptions } | null> {\r\n    // ÂàõÂª∫ÁºñËæëÂô®ÂÆπÂô®\r\n    const modal = this.createModal()\r\n    document.body.appendChild(modal)\r\n\r\n    // Ê∏≤ÊüìÁºñËæëÂô®\r\n    const container = modal.querySelector('.diagram-editor-content') as HTMLElement\r\n    const result = await editor.render(container, {\r\n      data: options.data,\r\n      onSave: (data: DiagramData, opts?: DiagramOptions) => {\r\n        this.closeModal(modal)\r\n        return { data, options: opts }\r\n      },\r\n      onCancel: () => {\r\n        this.closeModal(modal)\r\n        return null\r\n      },\r\n    })\r\n\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * ÂàõÂª∫Ê®°ÊÄÅÊ°Ü\r\n   */\r\n  private createModal(): HTMLElement {\r\n    const modal = document.createElement('div')\r\n    modal.className = 'diagram-editor-modal'\r\n    modal.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: rgba(0, 0, 0, 0.5);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      z-index: 10000;\r\n    `\r\n\r\n    modal.innerHTML = `\r\n      <div class=\"diagram-editor-dialog\" style=\"\r\n        background: white;\r\n        border-radius: 8px;\r\n        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\r\n        width: 90%;\r\n        max-width: 1200px;\r\n        height: 80vh;\r\n        display: flex;\r\n        flex-direction: column;\r\n        overflow: hidden;\r\n      \">\r\n        <div class=\"diagram-editor-header\" style=\"\r\n          padding: 15px 20px;\r\n          border-bottom: 1px solid #e0e0e0;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: space-between;\r\n        \">\r\n          <h3 style=\"margin: 0; font-size: 18px;\">\r\n            ${this.getEditorTitle(this.currentType!)}\r\n          </h3>\r\n          <button class=\"close-btn\" style=\"\r\n            background: transparent;\r\n            border: none;\r\n            font-size: 24px;\r\n            cursor: pointer;\r\n            color: #999;\r\n          \">√ó</button>\r\n        </div>\r\n        <div class=\"diagram-editor-content\" style=\"\r\n          flex: 1;\r\n          overflow: auto;\r\n          padding: 20px;\r\n        \"></div>\r\n      </div>\r\n    `\r\n\r\n    // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠\r\n    modal.addEventListener('click', (e) => {\r\n      if (e.target === modal)\r\n        this.closeModal(modal)\r\n    })\r\n\r\n    // ÂÖ≥Èó≠ÊåâÈíÆ\r\n    const closeBtn = modal.querySelector('.close-btn')\r\n    closeBtn?.addEventListener('click', () => {\r\n      this.closeModal(modal)\r\n    })\r\n\r\n    return modal\r\n  }\r\n\r\n  /**\r\n   * ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü\r\n   */\r\n  private closeModal(modal: HTMLElement): void {\r\n    modal.remove()\r\n    this.currentEditor?.destroy?.()\r\n    this.currentEditor = null\r\n    this.currentType = undefined\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñÁºñËæëÂô®Ê†áÈ¢ò\r\n   */\r\n  private getEditorTitle(type: DiagramType): string {\r\n    const titles: Record<DiagramType, string> = {\r\n      mindmap: 'ÊÄùÁª¥ÂØºÂõæÁºñËæëÂô®',\r\n      flowchart: 'ÊµÅÁ®ãÂõæÁºñËæëÂô®',\r\n      uml: 'UMLÂõæÁºñËæëÂô®',\r\n      sequence: 'Êó∂Â∫èÂõæÁºñËæëÂô®',\r\n      gantt: 'ÁîòÁâπÂõæÁºñËæëÂô®',\r\n    }\r\n    return titles[type] || 'ÂõæË°®ÁºñËæëÂô®'\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñÈªòËÆ§Êï∞ÊçÆ\r\n   */\r\n  private getDefaultData(type: DiagramType): DiagramData {\r\n    switch (type) {\r\n      case 'mindmap':\r\n        return {\r\n          root: {\r\n            text: '‰∏≠ÂøÉ‰∏ªÈ¢ò',\r\n            children: [\r\n              { text: 'ÂàÜÊîØ1', children: [] },\r\n              { text: 'ÂàÜÊîØ2', children: [] },\r\n              { text: 'ÂàÜÊîØ3', children: [] },\r\n            ],\r\n          },\r\n        }\r\n\r\n      case 'flowchart':\r\n        return {\r\n          nodes: [\r\n            { id: '1', type: 'start', text: 'ÂºÄÂßã', x: 100, y: 50 },\r\n            { id: '2', type: 'process', text: 'Â§ÑÁêÜ', x: 100, y: 150 },\r\n            { id: '3', type: 'end', text: 'ÁªìÊùü', x: 100, y: 250 },\r\n          ],\r\n          edges: [\r\n            { from: '1', to: '2' },\r\n            { from: '2', to: '3' },\r\n          ],\r\n        }\r\n\r\n      case 'uml':\r\n        return {\r\n          classes: [\r\n            {\r\n              name: 'User',\r\n              attributes: ['id: number', 'name: string'],\r\n              methods: ['login()', 'logout()'],\r\n            },\r\n          ],\r\n          relationships: [],\r\n        }\r\n\r\n      case 'sequence':\r\n        return {\r\n          actors: ['Áî®Êà∑', 'Á≥ªÁªü'],\r\n          messages: [\r\n            { from: 'Áî®Êà∑', to: 'Á≥ªÁªü', text: 'ÁôªÂΩïËØ∑Ê±Ç' },\r\n            { from: 'Á≥ªÁªü', to: 'Áî®Êà∑', text: 'ËøîÂõûÁªìÊûú' },\r\n          ],\r\n        }\r\n\r\n      case 'gantt':\r\n        return {\r\n          tasks: [\r\n            {\r\n              name: '‰ªªÂä°1',\r\n              start: new Date().toISOString(),\r\n              end: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),\r\n              progress: 0,\r\n            },\r\n          ],\r\n        }\r\n\r\n      default:\r\n        return {}\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÂØºÂá∫ÂõæË°®\r\n   */\r\n  async exportDiagram(): Promise<void> {\r\n    const node = this.getSelectedDiagramNode()\r\n    if (!node)\r\n      return\r\n\r\n    const type = node.dataset.diagramType as DiagramType\r\n    const data = JSON.parse(node.dataset.diagramData || '{}')\r\n\r\n    // ËÆ©Ê∏≤ÊüìÂô®ÂØºÂá∫\r\n    await this.renderer?.export(node, type, data)\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÂõæË°®ËäÇÁÇπ\r\n   */\r\n  private getSelectedDiagramNode(): HTMLElement | null {\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return null\r\n\r\n    const range = selection.getRangeAt(0)\r\n    const container = range.commonAncestorContainer\r\n    const element = container.nodeType === Node.TEXT_NODE\r\n      ? container.parentElement\r\n      : container as HTMLElement\r\n\r\n    return element?.closest('.diagram-node') || null\r\n  }\r\n\r\n  /**\r\n   * ÈîÄÊØÅÊèí‰ª∂\r\n   */\r\n  destroy(): void {\r\n    logger.info('Destroying diagram plugin')\r\n\r\n    // Ê∏ÖÁêÜÁºñËæëÂô®\r\n    this.editors.forEach(editor => editor.destroy?.())\r\n    this.editors.clear()\r\n\r\n    // Ê∏ÖÁêÜÁªÑ‰ª∂\r\n    this.renderer?.destroy()\r\n    this.toolbar?.destroy()\r\n\r\n    // Ê∏ÖÁêÜÂΩìÂâçÁºñËæëÂô®\r\n    if (this.currentEditor)\r\n      this.currentEditor.destroy?.()\r\n\r\n    logger.info('Diagram plugin destroyed')\r\n  }\r\n}\r\n"],"names":["logger","createLogger","DiagramPlugin","name","config","version","description","editors","Map","install","editor","info","renderer","DiagramRenderer","toolbar","DiagramToolbar","onInsertDiagram","type","insertDiagram","onEditDiagram","node","editDiagram","registerEditors","registerCommands","registerNodeViews","setupEventListeners","set","MindMapEditor","FlowchartEditor","UMLEditor","SequenceDiagramEditor","GanttEditor","commands","register","label","icon","execute","getSelectedDiagramNode","exportDiagram","schema","nodes","diagram","attrs","default","data","width","height","content","group","draggable","parseDOM","tag","getAttrs","dom","dataset","diagramType","JSON","parse","diagramData","style","toDOM","stringify","on","updateState","contentElement","addEventListener","e","target","diagramNode","closest","get","error","currentType","currentEditor","result","showEditor","getDefaultData","isNew","context","options","render","modal","createModal","document","body","appendChild","container","querySelector","onSave","opts","closeModal","onCancel","createElement","className","cssText","innerHTML","getEditorTitle","closeBtn","remove","destroy","undefined","titles","mindmap","flowchart","uml","sequence","gantt","root","text","children","id","x","y","edges","from","to","classes","attributes","methods","relationships","actors","messages","tasks","start","Date","toISOString","end","now","progress","export","selection","window","getSelection","rangeCount","range","getRangeAt","commonAncestorContainer","element","nodeType","Node","TEXT_NODE","parentElement","forEach","clear"],"mappings":"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"}