{"version":3,"file":"heading.cjs","sources":["../../../src/plugins/text/heading.ts"],"sourcesContent":["/**\r\n * 标题插件\r\n * 提供 H1-H6 标题功能\r\n */\r\n\r\nimport type { Command, Plugin } from '../../types'\r\nimport { createPlugin } from '../../core/Plugin'\r\n\r\n/**\r\n * 设置标题命令\r\n */\r\nfunction setHeadingCommand(level: number): Command {\r\n  return (state, dispatch) => {\r\n    if (!dispatch)\r\n      return true\r\n\r\n    // 确保有选区\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0) {\r\n      console.warn('[Heading] No selection available')\r\n      return false\r\n    }\r\n\r\n    // 如果没有选中内容，选中当前段落\r\n    let range = selection.getRangeAt(0)\r\n    if (range.collapsed) {\r\n      // 获取当前所在的块级元素\r\n      const container = range.commonAncestorContainer\r\n      const block = container.nodeType === Node.TEXT_NODE\r\n        ? container.parentElement\r\n        : container as HTMLElement\r\n\r\n      if (block) {\r\n        // 找到最近的块级元素\r\n        let blockElement = block\r\n        while (blockElement && !['DIV', 'P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE'].includes(blockElement.tagName)) {\r\n          if (blockElement.parentElement)\r\n            blockElement = blockElement.parentElement\r\n          else\r\n            break\r\n        }\r\n\r\n        // 选中整个块元素的内容\r\n        if (blockElement) {\r\n          range = document.createRange()\r\n          range.selectNodeContents(blockElement)\r\n          selection.removeAllRanges()\r\n          selection.addRange(range)\r\n        }\r\n      }\r\n    }\r\n\r\n    // 使用大写标签名，这是 formatBlock 的标准格式\r\n    let success = document.execCommand('formatBlock', false, `H${level}`)\r\n\r\n    // 如果失败，尝试带尖括号的格式（某些浏览器需要）\r\n    if (!success)\r\n      success = document.execCommand('formatBlock', false, `<h${level}>`)\r\n\r\n    // 如果还是失败，尝试小写格式\r\n    if (!success)\r\n      success = document.execCommand('formatBlock', false, `h${level}`)\r\n\r\n    if (success)\r\n      console.log(`[Heading] Successfully set heading level ${level}`)\r\n    else\r\n      console.warn(`[Heading] Failed to set heading level ${level}`)\r\n\r\n    return success\r\n  }\r\n}\r\n\r\n/**\r\n * 设置段落命令\r\n */\r\nfunction setParagraphCommand(): Command {\r\n  return (state, dispatch) => {\r\n    if (!dispatch)\r\n      return true\r\n\r\n    // 确保有选区\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0) {\r\n      console.warn('[Heading] No selection available for paragraph')\r\n      return false\r\n    }\r\n\r\n    // 如果没有选中内容，选中当前段落\r\n    let range = selection.getRangeAt(0)\r\n    if (range.collapsed) {\r\n      // 获取当前所在的块级元素\r\n      const container = range.commonAncestorContainer\r\n      const block = container.nodeType === Node.TEXT_NODE\r\n        ? container.parentElement\r\n        : container as HTMLElement\r\n\r\n      if (block) {\r\n        // 找到最近的块级元素\r\n        let blockElement = block\r\n        while (blockElement && !['DIV', 'P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE'].includes(blockElement.tagName)) {\r\n          if (blockElement.parentElement)\r\n            blockElement = blockElement.parentElement\r\n          else\r\n            break\r\n        }\r\n\r\n        // 选中整个块元素的内容\r\n        if (blockElement) {\r\n          range = document.createRange()\r\n          range.selectNodeContents(blockElement)\r\n          selection.removeAllRanges()\r\n          selection.addRange(range)\r\n        }\r\n      }\r\n    }\r\n\r\n    // 尝试多种格式\r\n    let success = document.execCommand('formatBlock', false, 'P')\r\n\r\n    if (!success)\r\n      success = document.execCommand('formatBlock', false, '<p>')\r\n\r\n    if (!success)\r\n      success = document.execCommand('formatBlock', false, 'p')\r\n\r\n    if (success)\r\n      console.log('[Heading] Successfully set paragraph')\r\n    else\r\n      console.warn('[Heading] Failed to set paragraph')\r\n\r\n    return success\r\n  }\r\n}\r\n\r\n/**\r\n * 检查标题是否激活\r\n */\r\nfunction isHeadingActive(level: number) {\r\n  return () => {\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return false\r\n\r\n    const node = selection.anchorNode?.parentElement\r\n    return node?.tagName === `H${level}`\r\n  }\r\n}\r\n\r\n/**\r\n * 标题插件\r\n */\r\nexport const HeadingPlugin: Plugin = createPlugin({\r\n  name: 'heading',\r\n  commands: {\r\n    setHeading1: setHeadingCommand(1),\r\n    setHeading2: setHeadingCommand(2),\r\n    setHeading3: setHeadingCommand(3),\r\n    setHeading4: setHeadingCommand(4),\r\n    setHeading5: setHeadingCommand(5),\r\n    setHeading6: setHeadingCommand(6),\r\n    setParagraph: setParagraphCommand(),\r\n  },\r\n  keys: {\r\n    'Mod-Alt-1': setHeadingCommand(1),\r\n    'Mod-Alt-2': setHeadingCommand(2),\r\n    'Mod-Alt-3': setHeadingCommand(3),\r\n    'Mod-Alt-4': setHeadingCommand(4),\r\n    'Mod-Alt-5': setHeadingCommand(5),\r\n    'Mod-Alt-6': setHeadingCommand(6),\r\n    'Mod-Alt-0': setParagraphCommand(),\r\n  },\r\n  toolbar: [\r\n    {\r\n      name: 'heading1',\r\n      title: '标题 1',\r\n      icon: 'heading-1',\r\n      command: setHeadingCommand(1),\r\n      active: isHeadingActive(1),\r\n    },\r\n    {\r\n      name: 'heading2',\r\n      title: '标题 2',\r\n      icon: 'heading-2',\r\n      command: setHeadingCommand(2),\r\n      active: isHeadingActive(2),\r\n    },\r\n    {\r\n      name: 'heading3',\r\n      title: '标题 3',\r\n      icon: 'heading-3',\r\n      command: setHeadingCommand(3),\r\n      active: isHeadingActive(3),\r\n    },\r\n  ],\r\n})\r\n"],"names":["setHeadingCommand","level","state","dispatch","selection","window","getSelection","rangeCount","console","warn","range","getRangeAt","collapsed","container","commonAncestorContainer","block","nodeType","Node","TEXT_NODE","parentElement","blockElement","includes","tagName","document","createRange","selectNodeContents","removeAllRanges","addRange","success","execCommand","log","setParagraphCommand","isHeadingActive","node","anchorNode","HeadingPlugin","createPlugin","name","commands","setHeading1","setHeading2","setHeading3","setHeading4","setHeading5","setHeading6","setParagraph","keys","toolbar","title","icon","command","active"],"mappings":"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"}