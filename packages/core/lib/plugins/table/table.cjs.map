{"version":3,"file":"table.cjs","sources":["../../../src/plugins/table/table.ts"],"sourcesContent":["/**\r\n * è¡¨æ ¼æ’ä»¶\r\n */\r\n\r\nimport type { Command, Plugin } from '../../types'\r\nimport { registerContextMenu } from '../../core/ContextMenuManager'\r\nimport { createPlugin } from '../../core/Plugin'\r\n// import { showTableDialog } from '../ui/TableDialog'\r\n\r\n// createTableContextMenu å‡½æ•°å·²ç§»é™¤ï¼Œä½¿ç”¨ ContextMenuManager ç»Ÿä¸€ç®¡ç†\r\n\r\n// è¡¨æ ¼é€‰æ‹©åŠŸèƒ½\r\ninterface TableSelection {\r\n  startCell: HTMLTableCellElement | null\r\n  endCell: HTMLTableCellElement | null\r\n  selectedCells: Set<HTMLTableCellElement>\r\n}\r\n\r\nconst tableSelections = new WeakMap<HTMLTableElement, TableSelection>()\r\n\r\n/**\r\n * è®¾ç½®è¡¨æ ¼é€‰æ‹©åŠŸèƒ½ - ç®€åŒ–ç‰ˆ\r\n */\r\nfunction setupTableSelection(table: HTMLTableElement) {\r\n  let isSelecting = false\r\n  let startCell: HTMLTableCellElement | null = null\r\n  const selectedCells = new Set<HTMLTableCellElement>()\r\n  let cachedGrid: (HTMLTableCellElement | null)[][] | null = null\r\n\r\n  // æ¸…é™¤é€‰æ‹©\r\n  const clearSelection = () => {\r\n    selectedCells.forEach((cell) => {\r\n      cell.classList.remove('table-cell-selected')\r\n    })\r\n    selectedCells.clear()\r\n    startCell = null\r\n    isSelecting = false\r\n    cachedGrid = null // æ¸…é™¤ç¼“å­˜çš„ç½‘æ ¼\r\n    // ç§»é™¤selectingç±»\r\n    table.classList.remove('selecting')\r\n  }\r\n\r\n  // é€‰ä¸­æ•´åˆ—\r\n  const selectColumn = (colIndex: number) => {\r\n    clearSelection()\r\n    Array.from(table.rows).forEach((row) => {\r\n      const cell = row.cells[colIndex]\r\n      if (cell) {\r\n        cell.classList.add('table-cell-selected')\r\n        selectedCells.add(cell as HTMLTableCellElement)\r\n      }\r\n    })\r\n    saveSelection()\r\n  }\r\n\r\n  // é€‰ä¸­æ•´è¡Œ\r\n  const selectRow = (rowIndex: number) => {\r\n    clearSelection()\r\n    const row = table.rows[rowIndex]\r\n    if (row) {\r\n      Array.from(row.cells).forEach((cell) => {\r\n        cell.classList.add('table-cell-selected')\r\n        selectedCells.add(cell as HTMLTableCellElement)\r\n      })\r\n    }\r\n    saveSelection()\r\n  }\r\n\r\n  // è·å–å•å…ƒæ ¼çš„å®é™…ä½ç½®ï¼ˆè€ƒè™‘åˆå¹¶å•å…ƒæ ¼ï¼‰\r\n  const getCellPosition = (cell: HTMLTableCellElement, grid?: (HTMLTableCellElement | null)[][]): { row: number, col: number, rowEnd: number, colEnd: number } => {\r\n    // ä½¿ç”¨ä¼ å…¥çš„ç½‘æ ¼æˆ–åˆ›å»ºæ–°çš„\r\n    const logicalGrid = grid || createLogicalGrid()\r\n\r\n    // åœ¨ç½‘æ ¼ä¸­æŸ¥æ‰¾å•å…ƒæ ¼çš„ä½ç½®\r\n    let cellRow = -1; let cellCol = -1\r\n    let cellRowEnd = -1; let cellColEnd = -1\r\n\r\n    for (let r = 0; r < logicalGrid.length; r++) {\r\n      for (let c = 0; c < logicalGrid[r].length; c++) {\r\n        if (logicalGrid[r][c] === cell) {\r\n          if (cellRow === -1) {\r\n            cellRow = r\r\n            cellCol = c\r\n          }\r\n          cellRowEnd = r\r\n          cellColEnd = c\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      row: cellRow,\r\n      col: cellCol,\r\n      rowEnd: cellRowEnd,\r\n      colEnd: cellColEnd,\r\n    }\r\n  }\r\n\r\n  // åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è·Ÿè¸ªè¡¨æ ¼çš„é€»è¾‘ç»“æ„\r\n  const createLogicalGrid = () => {\r\n    const rowCount = table.rows.length\r\n    const colCount = Math.max(...Array.from(table.rows).map((row) => {\r\n      let count = 0\r\n      Array.from(row.cells).forEach((cell) => {\r\n        count += Number.parseInt(cell.getAttribute('colspan') || '1')\r\n      })\r\n      return count\r\n    }))\r\n\r\n    // åˆ›å»ºäºŒç»´æ•°ç»„ï¼Œè®°å½•æ¯ä¸ªé€»è¾‘ä½ç½®å¯¹åº”çš„å®é™…å•å…ƒæ ¼\r\n    const grid: (HTMLTableCellElement | null)[][] = new Array(rowCount).fill(null).map(() => new Array(colCount).fill(null))\r\n\r\n    for (let r = 0; r < table.rows.length; r++) {\r\n      const row = table.rows[r]\r\n      let logicalCol = 0\r\n\r\n      for (let c = 0; c < row.cells.length; c++) {\r\n        const cell = row.cells[c] as HTMLTableCellElement\r\n        const rowspan = Number.parseInt(cell.getAttribute('rowspan') || '1')\r\n        const colspan = Number.parseInt(cell.getAttribute('colspan') || '1')\r\n\r\n        // æ‰¾åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨çš„é€»è¾‘åˆ—\r\n        while (logicalCol < colCount && grid[r][logicalCol] !== null) {\r\n          logicalCol++\r\n        }\r\n\r\n        // å¡«å……åˆå¹¶çš„å•å…ƒæ ¼åŒºåŸŸ\r\n        for (let dr = 0; dr < rowspan && r + dr < rowCount; dr++) {\r\n          for (let dc = 0; dc < colspan && logicalCol + dc < colCount; dc++)\r\n            grid[r + dr][logicalCol + dc] = cell\r\n        }\r\n\r\n        logicalCol += colspan\r\n      }\r\n    }\r\n\r\n    return grid\r\n  }\r\n\r\n  // æ›´æ–°é€‰æ‹©åŒºåŸŸ\r\n  const updateSelection = (endCell: HTMLTableCellElement) => {\r\n    if (!startCell)\r\n      return\r\n\r\n    // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©\r\n    selectedCells.forEach((cell) => {\r\n      cell.classList.remove('table-cell-selected')\r\n    })\r\n    selectedCells.clear()\r\n\r\n    // åˆ›å»ºæˆ–ä½¿ç”¨ç¼“å­˜çš„é€»è¾‘ç½‘æ ¼\r\n    if (!cachedGrid)\r\n      cachedGrid = createLogicalGrid()\r\n\r\n    const grid = cachedGrid\r\n\r\n    // è·å–èµ·å§‹å’Œç»“æŸå•å…ƒæ ¼çš„é€»è¾‘ä½ç½®\r\n    const startPos = getCellPosition(startCell, grid)\r\n    const endPos = getCellPosition(endCell, grid)\r\n\r\n    // è®¡ç®—é€‰æ‹©èŒƒå›´ï¼ˆè€ƒè™‘åˆå¹¶å•å…ƒæ ¼çš„å®Œæ•´åŒºåŸŸï¼‰\r\n    let minRow = Math.min(startPos.row, endPos.row)\r\n    let maxRow = Math.max(startPos.rowEnd, endPos.rowEnd)\r\n    let minCol = Math.min(startPos.col, endPos.col)\r\n    let maxCol = Math.max(startPos.colEnd, endPos.colEnd)\r\n\r\n    // æ‰©å±•é€‰æ‹©èŒƒå›´ä»¥åŒ…å«æ‰€æœ‰éƒ¨åˆ†é€‰ä¸­çš„åˆå¹¶å•å…ƒæ ¼\r\n    let expanded = true\r\n    while (expanded) {\r\n      expanded = false\r\n\r\n      for (let r = minRow; r <= maxRow && r < grid.length; r++) {\r\n        for (let c = minCol; c <= maxCol && c < grid[r].length; c++) {\r\n          const cell = grid[r][c]\r\n          if (cell && !selectedCells.has(cell)) {\r\n            const pos = getCellPosition(cell)\r\n            if (pos.row < minRow) {\r\n              minRow = pos.row\r\n              expanded = true\r\n            }\r\n            if (pos.rowEnd > maxRow) {\r\n              maxRow = pos.rowEnd\r\n              expanded = true\r\n            }\r\n            if (pos.col < minCol) {\r\n              minCol = pos.col\r\n              expanded = true\r\n            }\r\n            if (pos.colEnd > maxCol) {\r\n              maxCol = pos.colEnd\r\n              expanded = true\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // é€‰ä¸­èŒƒå›´å†…çš„æ‰€æœ‰å•å…ƒæ ¼\r\n    const addedCells = new Set<HTMLTableCellElement>()\r\n    for (let r = minRow; r <= maxRow && r < grid.length; r++) {\r\n      for (let c = minCol; c <= maxCol && c < grid[r].length; c++) {\r\n        const cell = grid[r][c]\r\n        if (cell && !addedCells.has(cell)) {\r\n          cell.classList.add('table-cell-selected')\r\n          selectedCells.add(cell)\r\n          addedCells.add(cell)\r\n        }\r\n      }\r\n    }\r\n\r\n    saveSelection()\r\n  }\r\n\r\n  // ä¿å­˜é€‰æ‹©çŠ¶æ€\r\n  const saveSelection = () => {\r\n    tableSelections.set(table, {\r\n      startCell,\r\n      endCell: null,\r\n      selectedCells,\r\n    })\r\n  }\r\n\r\n  // è¡¨å¤´å³é”®é€‰ä¸­æ•´åˆ—\r\n  table.addEventListener('contextmenu', (e) => {\r\n    const cell = (e.target as HTMLElement).closest('th') as HTMLTableCellElement\r\n    if (cell) {\r\n      const row = cell.parentElement as HTMLTableRowElement\r\n      const colIndex = Array.from(row.cells).indexOf(cell)\r\n      selectColumn(colIndex)\r\n    }\r\n  })\r\n\r\n  // é¼ æ ‡æŒ‰ä¸‹å¼€å§‹é€‰æ‹©\r\n  table.addEventListener('mousedown', (e) => {\r\n    // å¦‚æœæ˜¯å³é”®ï¼Œä¸å¤„ç†\r\n    if (e.button === 2)\r\n      return\r\n\r\n    const target = e.target as HTMLElement\r\n    const cell = target.closest('td, th') as HTMLTableCellElement\r\n    if (!cell)\r\n      return\r\n\r\n    // å¿½ç•¥è°ƒæ•´åˆ—å®½çš„æ‰‹æŸ„\r\n    if (target.classList.contains('table-column-resizer'))\r\n      return\r\n\r\n    // å¦‚æœç‚¹å‡»çš„å°±æ˜¯å•å…ƒæ ¼æœ¬èº«ï¼ˆä¸æ˜¯æ‹–æ‹½é€‰æ‹©ï¼‰ï¼Œè®©å®ƒæ­£å¸¸è·å–ç„¦ç‚¹\r\n    if (target === cell || cell.contains(target)) {\r\n      // å¦‚æœæ²¡æœ‰æŒ‰ä½Shiftã€Ctrlæˆ–Alté”®ï¼Œå°±æ˜¯æ™®é€šç‚¹å‡»ï¼Œè®©å•å…ƒæ ¼æ­£å¸¸è·å–ç„¦ç‚¹\r\n      if (!e.shiftKey && !e.ctrlKey && !e.altKey) {\r\n        // æ¸…é™¤é€‰æ‹©ä½†ä¸é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè®©å•å…ƒæ ¼å¯ä»¥ç¼–è¾‘\r\n        clearSelection()\r\n        return\r\n      }\r\n    }\r\n\r\n    // Ctrl+ç‚¹å‡»é€‰ä¸­æ•´è¡Œ\r\n    if (e.ctrlKey) {\r\n      const row = cell.parentElement as HTMLTableRowElement\r\n      const rowIndex = Array.from(table.rows).indexOf(row)\r\n      selectRow(rowIndex)\r\n      e.preventDefault()\r\n      return\r\n    }\r\n\r\n    // Alt+ç‚¹å‡»é€‰ä¸­æ•´åˆ—\r\n    if (e.altKey) {\r\n      const row = cell.parentElement as HTMLTableRowElement\r\n      const colIndex = Array.from(row.cells).indexOf(cell)\r\n      selectColumn(colIndex)\r\n      e.preventDefault()\r\n      return\r\n    }\r\n\r\n    // Shift+ç‚¹å‡»è¿›è¡ŒèŒƒå›´é€‰æ‹©\r\n    if (e.shiftKey && startCell) {\r\n      e.preventDefault()\r\n      updateSelection(cell)\r\n      return\r\n    }\r\n\r\n    // å¼€å§‹æ‹–æ‹½é€‰æ‹©ï¼ˆåªåœ¨æŒ‰ä½Shiftæ—¶ï¼‰\r\n    if (e.shiftKey) {\r\n      clearSelection()\r\n      isSelecting = true\r\n      startCell = cell\r\n      cachedGrid = null\r\n      cell.classList.add('table-cell-selected')\r\n      selectedCells.add(cell)\r\n      saveSelection()\r\n      // æ·»åŠ selectingç±»æ¥ç¦ç”¨æ–‡æœ¬é€‰æ‹©\r\n      table.classList.add('selecting')\r\n      e.preventDefault()\r\n    }\r\n  })\r\n\r\n  // é¼ æ ‡ç§»åŠ¨æ›´æ–°é€‰æ‹©\r\n  table.addEventListener('mousemove', (e) => {\r\n    // åªæœ‰åœ¨æŒ‰ä½Shifté”®å¹¶ä¸”æ­£åœ¨é€‰æ‹©æ—¶æ‰æ›´æ–°\r\n    if (!isSelecting || !startCell || !e.shiftKey) {\r\n      if (isSelecting && !e.shiftKey) {\r\n        // å¦‚æœæ¾å¼€äº†Shifté”®ï¼Œåœæ­¢é€‰æ‹©\r\n        isSelecting = false\r\n      }\r\n      return\r\n    }\r\n\r\n    const cell = (e.target as HTMLElement).closest('td, th') as HTMLTableCellElement\r\n    if (cell && table.contains(cell))\r\n      updateSelection(cell)\r\n  })\r\n\r\n  // é¼ æ ‡æ¾å¼€ç»“æŸé€‰æ‹©\r\n  const handleMouseUp = () => {\r\n    isSelecting = false\r\n    // ç§»é™¤selectingç±»\r\n    table.classList.remove('selecting')\r\n  }\r\n  document.addEventListener('mouseup', handleMouseUp)\r\n\r\n  // åœ¨è¡¨æ ¼è¢«ç§»é™¤æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨\r\n  const cleanupObserver = new MutationObserver((mutations) => {\r\n    for (const mutation of mutations) {\r\n      if (mutation.type === 'childList' && mutation.removedNodes.length > 0) {\r\n        for (const node of mutation.removedNodes) {\r\n          if (node === table || (node as Element)?.contains?.(table)) {\r\n            document.removeEventListener('mouseup', handleMouseUp)\r\n            cleanupObserver.disconnect()\r\n            return\r\n          }\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  // ç›‘å¬çˆ¶å…ƒç´ çš„å˜åŒ–\r\n  if (table.parentElement)\r\n    cleanupObserver.observe(table.parentElement, { childList: true, subtree: true })\r\n\r\n  // é˜²æ­¢é€‰æ‹©æ—¶çš„æ–‡æœ¬é€‰ä¸­\r\n  table.addEventListener('selectstart', (e) => {\r\n    if (isSelecting)\r\n      e.preventDefault()\r\n  })\r\n\r\n  // æ·»åŠ åˆ—å®½è°ƒæ•´åŠŸèƒ½\r\n  setupColumnResize(table)\r\n\r\n  // ç›‘å¬è¡¨æ ¼ç»“æ„å˜åŒ–ï¼Œæ¸…é™¤ç¼“å­˜çš„ç½‘æ ¼\r\n  const observer = new MutationObserver(() => {\r\n    cachedGrid = null\r\n  })\r\n\r\n  observer.observe(table, {\r\n    childList: true,\r\n    subtree: true,\r\n    attributes: true,\r\n    attributeFilter: ['colspan', 'rowspan'],\r\n  })\r\n}\r\n\r\n/**\r\n * è®¾ç½®åˆ—å®½è°ƒæ•´åŠŸèƒ½\r\n */\r\nfunction setupColumnResize(table: HTMLTableElement) {\r\n  const headerCells = table.querySelectorAll('th')\r\n\r\n  headerCells.forEach((th, index) => {\r\n    // ä¸åœ¨æœ€åä¸€åˆ—æ·»åŠ è°ƒæ•´æ‰‹æŸ„\r\n    if (index === headerCells.length - 1)\r\n      return\r\n\r\n    const resizer = document.createElement('div')\r\n    resizer.className = 'table-column-resizer'\r\n    resizer.style.cssText = `\r\n      position: absolute;\r\n      right: -3px;\r\n      top: 0;\r\n      bottom: 0;\r\n      width: 6px;\r\n      cursor: col-resize;\r\n      z-index: 10;\r\n      background: transparent;\r\n    `\r\n\r\n    // æ‚¬åœæ•ˆæœ\r\n    resizer.addEventListener('mouseenter', () => {\r\n      resizer.style.background = 'rgba(59, 130, 246, 0.5)'\r\n    })\r\n\r\n    resizer.addEventListener('mouseleave', () => {\r\n      resizer.style.background = 'transparent'\r\n    })\r\n\r\n    // æ‹–æ‹½è°ƒæ•´åˆ—å®½\r\n    let startX = 0\r\n    let startWidth = 0\r\n    const currentColumn = index\r\n\r\n    resizer.addEventListener('mousedown', (e) => {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n\r\n      startX = e.clientX\r\n      startWidth = th.offsetWidth\r\n\r\n      // æ·»åŠ æ‹–æ‹½æ—¶çš„æ ·å¼\r\n      table.classList.add('resizing')\r\n      document.body.style.cursor = 'col-resize'\r\n\r\n      const handleMouseMove = (e: MouseEvent) => {\r\n        const diff = e.clientX - startX\r\n        const newWidth = Math.max(60, startWidth + diff)\r\n\r\n        // åªæ›´æ–°å·¦ä¾§åˆ—ï¼ˆå½“å‰åˆ—ï¼‰çš„æ‰€æœ‰å•å…ƒæ ¼å®½åº¦\r\n        Array.from(table.rows).forEach((row) => {\r\n          const cell = row.cells[currentColumn]\r\n          if (cell) {\r\n            cell.style.width = `${newWidth}px`\r\n            cell.style.minWidth = `${newWidth}px`\r\n            cell.style.maxWidth = `${newWidth}px`\r\n          }\r\n        })\r\n\r\n        // è®¾ç½®è¡¨æ ¼ä¸ºå›ºå®šå¸ƒå±€ï¼Œé˜²æ­¢å…¶ä»–åˆ—è‡ªåŠ¨è°ƒæ•´\r\n        table.style.tableLayout = 'fixed'\r\n      }\r\n\r\n      const handleMouseUp = () => {\r\n        document.removeEventListener('mousemove', handleMouseMove)\r\n        document.removeEventListener('mouseup', handleMouseUp)\r\n\r\n        // ç§»é™¤æ‹–æ‹½æ—¶çš„æ ·å¼\r\n        table.classList.remove('resizing')\r\n        document.body.style.cursor = ''\r\n\r\n        // è§¦å‘æ›´æ–°\r\n        const event = new Event('input', { bubbles: true })\r\n        table.dispatchEvent(event)\r\n      }\r\n\r\n      document.addEventListener('mousemove', handleMouseMove)\r\n      document.addEventListener('mouseup', handleMouseUp)\r\n    })\r\n\r\n    th.style.position = 'relative'\r\n    th.appendChild(resizer)\r\n  })\r\n}\r\n\r\n/**\r\n * è·å–é€‰ä¸­çš„å•å…ƒæ ¼\r\n */\r\nfunction getSelectedCells(table: HTMLTableElement): HTMLTableCellElement[] {\r\n  const selection = tableSelections.get(table)\r\n  if (!selection)\r\n    return []\r\n  return Array.from(selection.selectedCells)\r\n}\r\n\r\n// getCellPosition å‡½æ•°å·²ç»ä¸éœ€è¦ï¼Œç›´æ¥ä½¿ç”¨ DOM API\r\n\r\n// åœ¨ä¸Šæ–¹æ’å…¥è¡Œ\r\nfunction insertRowAbove(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetRow: HTMLTableRowElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TR') {\r\n      targetRow = node as HTMLTableRowElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetRow)\r\n    return\r\n\r\n  const newRow = targetRow.cloneNode(true) as HTMLTableRowElement\r\n  Array.from(newRow.cells).forEach((cell) => {\r\n    cell.innerHTML = '&nbsp;'\r\n  })\r\n  targetRow.parentNode?.insertBefore(newRow, targetRow)\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åœ¨ä¸‹æ–¹æ’å…¥è¡Œ\r\nfunction insertRowBelow(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetRow: HTMLTableRowElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TR') {\r\n      targetRow = node as HTMLTableRowElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetRow)\r\n    return\r\n\r\n  const newRow = targetRow.cloneNode(true) as HTMLTableRowElement\r\n  Array.from(newRow.cells).forEach((cell) => {\r\n    cell.innerHTML = '&nbsp;'\r\n  })\r\n  targetRow.parentNode?.insertBefore(newRow, targetRow.nextSibling)\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åœ¨å·¦ä¾§æ’å…¥åˆ—\r\nfunction insertColumnLeft(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const targetRow = targetCell.parentElement as HTMLTableRowElement\r\n  const colIndex = Array.from(targetRow.cells).indexOf(targetCell)\r\n\r\n  // åœ¨æ¯ä¸€è¡Œçš„å¯¹åº”ä½ç½®æ’å…¥å•å…ƒæ ¼\r\n  Array.from(table.rows).forEach((row) => {\r\n    const newCell = row.cells[colIndex].cloneNode(false) as HTMLElement\r\n    newCell.innerHTML = '&nbsp;'\r\n    newCell.setAttribute('contenteditable', 'true')\r\n    row.insertBefore(newCell, row.cells[colIndex])\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åœ¨å³ä¾§æ’å…¥åˆ—\r\nfunction insertColumnRight(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const targetRow = targetCell.parentElement as HTMLTableRowElement\r\n  const colIndex = Array.from(targetRow.cells).indexOf(targetCell)\r\n\r\n  // åœ¨æ¯ä¸€è¡Œçš„å¯¹åº”ä½ç½®æ’å…¥å•å…ƒæ ¼\r\n  Array.from(table.rows).forEach((row) => {\r\n    const newCell = row.cells[colIndex].cloneNode(false) as HTMLElement\r\n    newCell.innerHTML = '&nbsp;'\r\n    newCell.setAttribute('contenteditable', 'true')\r\n    if (colIndex + 1 < row.cells.length)\r\n      row.insertBefore(newCell, row.cells[colIndex + 1])\r\n    else\r\n      row.appendChild(newCell)\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åˆ é™¤å½“å‰è¡Œ\r\nfunction deleteCurrentRow(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetRow: HTMLTableRowElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TR') {\r\n      targetRow = node as HTMLTableRowElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetRow)\r\n    return\r\n\r\n  // è‡³å°‘ä¿ç•™ä¸€è¡Œ\r\n  const tbody = targetRow.parentElement\r\n  if (tbody && tbody.children.length > 1) {\r\n    targetRow.remove()\r\n\r\n    // è§¦å‘æ›´æ–°\r\n    const event = new Event('input', { bubbles: true })\r\n    table.dispatchEvent(event)\r\n  }\r\n}\r\n\r\n// åˆ é™¤å½“å‰åˆ—\r\nfunction deleteCurrentColumn(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const targetRow = targetCell.parentElement as HTMLTableRowElement\r\n  const colIndex = Array.from(targetRow.cells).indexOf(targetCell)\r\n\r\n  // è‡³å°‘ä¿ç•™ä¸€åˆ—\r\n  const firstRow = table.rows[0]\r\n  if (firstRow && firstRow.cells.length > 1) {\r\n    // ä»æ¯ä¸€è¡Œåˆ é™¤å¯¹åº”ä½ç½®çš„å•å…ƒæ ¼\r\n    Array.from(table.rows).forEach((row) => {\r\n      if (row.cells[colIndex])\r\n        row.cells[colIndex].remove()\r\n    })\r\n\r\n    // è§¦å‘æ›´æ–°\r\n    const event = new Event('input', { bubbles: true })\r\n    table.dispatchEvent(event)\r\n  }\r\n}\r\n\r\n// åˆ é™¤æ•´ä¸ªè¡¨æ ¼\r\nfunction deleteEntireTable(table: HTMLTableElement) {\r\n  // ç¡®è®¤åˆ é™¤\r\n  if (confirm('ç¡®å®šè¦åˆ é™¤æ•´ä¸ªè¡¨æ ¼å—ï¼Ÿ')) {\r\n    table.remove()\r\n\r\n    // è§¦å‘æ›´æ–°\r\n    const editorContent = document.querySelector('.ldesign-editor-content')\r\n    if (editorContent) {\r\n      const event = new Event('input', { bubbles: true })\r\n      editorContent.dispatchEvent(event)\r\n    }\r\n  }\r\n}\r\n\r\n// æ¸…é™¤è¡¨æ ¼å†…å®¹\r\nfunction clearTable(table: HTMLTableElement) {\r\n  const cells = table.querySelectorAll('td')\r\n  cells.forEach((cell) => {\r\n    cell.innerHTML = '&nbsp;'\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åˆå¹¶å•å…ƒæ ¼\r\nfunction mergeCells(table: HTMLTableElement) {\r\n  const selectedCells = getSelectedCells(table)\r\n\r\n  if (selectedCells.length < 2) {\r\n    alert('è¯·é€‰æ‹©å¤šä¸ªå•å…ƒæ ¼è¿›è¡Œåˆå¹¶')\r\n    return\r\n  }\r\n\r\n  // åˆ›å»ºé€»è¾‘ç½‘æ ¼æ¥å‡†ç¡®åˆ¤æ–­é€‰æ‹©åŒºåŸŸ\r\n  const createLogicalGrid = () => {\r\n    const rowCount = table.rows.length\r\n    const colCount = Math.max(...Array.from(table.rows).map((row) => {\r\n      let count = 0\r\n      Array.from(row.cells).forEach((cell) => {\r\n        count += Number.parseInt(cell.getAttribute('colspan') || '1')\r\n      })\r\n      return count\r\n    }))\r\n\r\n    const grid: (HTMLTableCellElement | null)[][] = new Array(rowCount).fill(null).map(() => new Array(colCount).fill(null))\r\n\r\n    for (let r = 0; r < table.rows.length; r++) {\r\n      const row = table.rows[r]\r\n      let logicalCol = 0\r\n\r\n      for (let c = 0; c < row.cells.length; c++) {\r\n        const cell = row.cells[c] as HTMLTableCellElement\r\n        const rowspan = Number.parseInt(cell.getAttribute('rowspan') || '1')\r\n        const colspan = Number.parseInt(cell.getAttribute('colspan') || '1')\r\n\r\n        while (logicalCol < colCount && grid[r][logicalCol] !== null) {\r\n          logicalCol++\r\n        }\r\n\r\n        for (let dr = 0; dr < rowspan && r + dr < rowCount; dr++) {\r\n          for (let dc = 0; dc < colspan && logicalCol + dc < colCount; dc++)\r\n            grid[r + dr][logicalCol + dc] = cell\r\n        }\r\n\r\n        logicalCol += colspan\r\n      }\r\n    }\r\n\r\n    return grid\r\n  }\r\n\r\n  const grid = createLogicalGrid()\r\n\r\n  // æ‰¾å‡ºé€‰ä¸­åŒºåŸŸçš„è¾¹ç•Œ\r\n  let minRow = Infinity; let maxRow = -1\r\n  let minCol = Infinity; let maxCol = -1\r\n  let topLeftCell: HTMLTableCellElement | null = null\r\n\r\n  // éå†é€»è¾‘ç½‘æ ¼æ‰¾å‡ºé€‰ä¸­å•å…ƒæ ¼çš„å®é™…èŒƒå›´\r\n  for (let r = 0; r < grid.length; r++) {\r\n    for (let c = 0; c < grid[r].length; c++) {\r\n      const cell = grid[r][c]\r\n      if (cell && selectedCells.includes(cell)) {\r\n        if (r < minRow) {\r\n          minRow = r\r\n          minCol = c // Reset column when finding new top row\r\n          topLeftCell = cell\r\n        }\r\n        else if (r === minRow && c < minCol) {\r\n          minCol = c\r\n          topLeftCell = cell\r\n        }\r\n        maxRow = Math.max(maxRow, r)\r\n        maxCol = Math.max(maxCol, c)\r\n      }\r\n    }\r\n  }\r\n\r\n  // æ£€æŸ¥é€‰æ‹©åŒºåŸŸæ˜¯å¦ä¸ºçŸ©å½¢\r\n  for (let r = minRow; r <= maxRow; r++) {\r\n    for (let c = minCol; c <= maxCol; c++) {\r\n      const cell = grid[r][c]\r\n      if (!cell || !selectedCells.includes(cell)) {\r\n        alert('è¯·é€‰æ‹©ä¸€ä¸ªå®Œæ•´çš„çŸ©å½¢åŒºåŸŸè¿›è¡Œåˆå¹¶')\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  // ä½¿ç”¨æ‰¾åˆ°çš„å·¦ä¸Šè§’å•å…ƒæ ¼\r\n  if (!topLeftCell) {\r\n    alert('æ— æ³•æ‰¾åˆ°åˆå¹¶çš„èµ·å§‹å•å…ƒæ ¼')\r\n    return\r\n  }\r\n\r\n  // æ”¶é›†æ‰€æœ‰å†…å®¹\r\n  const contents: string[] = []\r\n  const cellsToRemove = new Set<HTMLTableCellElement>()\r\n\r\n  selectedCells.forEach((cell) => {\r\n    const text = cell.textContent?.trim()\r\n    if (text && text !== '\\xA0' && text !== '')\r\n      contents.push(text)\r\n    if (cell !== topLeftCell)\r\n      cellsToRemove.add(cell)\r\n  })\r\n\r\n  // è®¾ç½®åˆå¹¶å±æ€§\r\n  const rowSpan = maxRow - minRow + 1\r\n  const colSpan = maxCol - minCol + 1\r\n  topLeftCell.setAttribute('rowspan', String(rowSpan))\r\n  topLeftCell.setAttribute('colspan', String(colSpan))\r\n  topLeftCell.textContent = contents.join(' ') || '\\xA0'\r\n\r\n  // åˆ é™¤å…¶ä»–å•å…ƒæ ¼\r\n  cellsToRemove.forEach((cell) => {\r\n    cell.remove()\r\n  })\r\n\r\n  // æ¸…é™¤é€‰æ‹©\r\n  selectedCells.forEach((cell) => {\r\n    cell.classList.remove('table-cell-selected')\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// æ‹†åˆ†å•å…ƒæ ¼\r\nfunction splitCell(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLTableCellElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLTableCellElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const colspan = Number.parseInt(targetCell.getAttribute('colspan') || '1')\r\n  const rowspan = Number.parseInt(targetCell.getAttribute('rowspan') || '1')\r\n\r\n  if (colspan === 1 && rowspan === 1) {\r\n    alert('è¯¥å•å…ƒæ ¼æœªè¢«åˆå¹¶ï¼Œæ— éœ€æ‹†åˆ†')\r\n    return\r\n  }\r\n\r\n  // ç§»é™¤åˆå¹¶å±æ€§\r\n  targetCell.removeAttribute('colspan')\r\n  targetCell.removeAttribute('rowspan')\r\n\r\n  // åœ¨å½“å‰å•å…ƒæ ¼åæ·»åŠ æ–°å•å…ƒæ ¼\r\n  const row = targetCell.parentElement as HTMLTableRowElement\r\n  for (let i = 1; i < colspan; i++) {\r\n    const newCell = document.createElement(targetCell.tagName.toLowerCase()) as HTMLTableCellElement\r\n    newCell.innerHTML = '&nbsp;'\r\n    newCell.setAttribute('contenteditable', 'true')\r\n    row.insertBefore(newCell, targetCell.nextSibling)\r\n  }\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// åˆ‡æ¢è¡¨å¤´\r\nfunction toggleTableHeader(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const row = targetCell.parentElement as HTMLTableRowElement\r\n  const cells = Array.from(row.cells)\r\n\r\n  // å¦‚æœå½“å‰è¡Œéƒ½æ˜¯THï¼Œè½¬æ¢ä¸ºTDï¼›å¦åˆ™è½¬æ¢ä¸ºTH\r\n  const isHeader = cells.every(cell => cell.tagName === 'TH')\r\n\r\n  cells.forEach((cell) => {\r\n    const newCell = document.createElement(isHeader ? 'td' : 'th')\r\n    newCell.innerHTML = cell.innerHTML\r\n    newCell.setAttribute('contenteditable', 'true')\r\n    // å¤åˆ¶å…¶ä»–å±æ€§\r\n    Array.from(cell.attributes).forEach((attr) => {\r\n      if (attr.name !== 'contenteditable')\r\n        newCell.setAttribute(attr.name, attr.value)\r\n    })\r\n    cell.parentNode?.replaceChild(newCell, cell)\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// è°ƒæ•´åˆ—å®½ - å¢åŠ \r\nfunction increaseColumnWidth(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const targetRow = targetCell.parentElement as HTMLTableRowElement\r\n  const colIndex = Array.from(targetRow.cells).indexOf(targetCell)\r\n\r\n  // å¢åŠ å½“å‰åˆ—çš„å®½åº¦\r\n  Array.from(table.rows).forEach((row) => {\r\n    const cell = row.cells[colIndex]\r\n    if (cell) {\r\n      const currentWidth = cell.offsetWidth\r\n      const newWidth = currentWidth + 20\r\n      cell.style.width = `${newWidth}px`\r\n      cell.style.minWidth = `${newWidth}px`\r\n    }\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n// è°ƒæ•´åˆ—å®½ - å‡å°‘\r\nfunction decreaseColumnWidth(table: HTMLTableElement) {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return\r\n\r\n  let node = selection.anchorNode\r\n  let targetCell: HTMLElement | null = null\r\n\r\n  while (node && node !== table) {\r\n    if (node.nodeName === 'TD' || node.nodeName === 'TH') {\r\n      targetCell = node as HTMLElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!targetCell)\r\n    return\r\n\r\n  const targetRow = targetCell.parentElement as HTMLTableRowElement\r\n  const colIndex = Array.from(targetRow.cells).indexOf(targetCell)\r\n\r\n  // å‡å°‘å½“å‰åˆ—çš„å®½åº¦\r\n  Array.from(table.rows).forEach((row) => {\r\n    const cell = row.cells[colIndex]\r\n    if (cell) {\r\n      const currentWidth = cell.offsetWidth\r\n      const newWidth = Math.max(60, currentWidth - 20) // æœ€å°60px\r\n      cell.style.width = `${newWidth}px`\r\n      cell.style.minWidth = `${newWidth}px`\r\n    }\r\n  })\r\n\r\n  // è§¦å‘æ›´æ–°\r\n  const event = new Event('input', { bubbles: true })\r\n  table.dispatchEvent(event)\r\n}\r\n\r\n/**\r\n * åˆ›å»ºè¡¨æ ¼å…ƒç´ \r\n */\r\nfunction createTableElement(rows: number, cols: number): HTMLElement {\r\n  // åˆ›å»ºè¡¨æ ¼åŒ…è£…å™¨\r\n  const wrapper = document.createElement('div')\r\n  wrapper.className = 'table-wrapper'\r\n  wrapper.style.position = 'relative'\r\n  wrapper.style.display = 'inline-block'\r\n\r\n  const table = document.createElement('table')\r\n  // è¡¨æ ¼æœ¬èº«ä¸è¦è®¾ç½® contenteditableï¼Œåªåœ¨å•å…ƒæ ¼ä¸Šè®¾ç½®\r\n  table.style.position = 'relative'\r\n\r\n  // ä¸å†ç›´æ¥ç»‘å®šå³é”®äº‹ä»¶ï¼Œä½¿ç”¨ ContextMenuManager\r\n\r\n  // åˆ›å»ºè¡¨å¤´\r\n  const thead = document.createElement('thead')\r\n  const headerRow = document.createElement('tr')\r\n  for (let j = 0; j < cols; j++) {\r\n    const th = document.createElement('th')\r\n    th.textContent = `åˆ— ${j + 1}`\r\n    th.setAttribute('contenteditable', 'true')\r\n    headerRow.appendChild(th)\r\n  }\r\n  thead.appendChild(headerRow)\r\n  table.appendChild(thead)\r\n\r\n  // åˆ›å»ºè¡¨ä½“ï¼ˆrowsæ˜¯æ•°æ®è¡Œæ•°ï¼Œä¸åŒ…æ‹¬è¡¨å¤´ï¼‰\r\n  const tbody = document.createElement('tbody')\r\n  for (let i = 0; i < rows; i++) {\r\n    const tr = document.createElement('tr')\r\n    for (let j = 0; j < cols; j++) {\r\n      const td = document.createElement('td')\r\n      // æ·»åŠ é»˜è®¤å†…å®¹ä»¥ç¡®ä¿å•å…ƒæ ¼æœ‰é«˜åº¦\r\n      td.innerHTML = '&nbsp;'\r\n      td.setAttribute('contenteditable', 'true')\r\n      tr.appendChild(td)\r\n    }\r\n    tbody.appendChild(tr)\r\n  }\r\n  table.appendChild(tbody)\r\n\r\n  // å°†è¡¨æ ¼æ·»åŠ åˆ°åŒ…è£…å™¨\r\n  wrapper.appendChild(table)\r\n\r\n  // è®¾ç½®é€‰æ‹©åŠŸèƒ½ï¼ˆéœ€è¦åœ¨è¡¨æ ¼æ·»åŠ åˆ°åŒ…è£…å™¨åï¼‰\r\n  setTimeout(() => setupTableSelection(table), 0)\r\n\r\n  return wrapper\r\n}\r\n\r\n/**\r\n * æ’å…¥è¡¨æ ¼\r\n */\r\nconst insertTable: Command = (state, dispatch) => {\r\n  console.log('ğŸ“‹ [Table] insertTable command called')\r\n  console.log('ğŸ“‹ [Table] dispatch:', dispatch ? 'exists' : 'null')\r\n\r\n  if (!dispatch) {\r\n    console.log('ğŸ“‹ [Table] No dispatch, returning true')\r\n    return true\r\n  }\r\n\r\n  console.log('ğŸ“‹ [Table] Creating simple table selector')\r\n\r\n  // åœ¨æ˜¾ç¤ºå¯¹è¯æ¡†ä¹‹å‰ï¼Œå…ˆä¿å­˜å½“å‰çš„é€‰åŒº\r\n  const editorContent = document.querySelector('.ldesign-editor-content') as HTMLElement\r\n  if (!editorContent) {\r\n    console.log('âŒ [Table] Editor content not found')\r\n    return false\r\n  }\r\n\r\n  // ä¿å­˜å½“å‰çš„é€‰åŒºä¿¡æ¯\r\n  const originalSelection = window.getSelection()\r\n  let savedRange: Range | null = null\r\n\r\n  if (originalSelection && originalSelection.rangeCount > 0) {\r\n    const range = originalSelection.getRangeAt(0)\r\n    if (editorContent.contains(range.commonAncestorContainer)) {\r\n      // å…‹éš†rangeä»¥ä¿å­˜ä½ç½®\r\n      savedRange = range.cloneRange()\r\n      console.log('ğŸ“‹ [Table] Saved selection range:', savedRange)\r\n    }\r\n  }\r\n\r\n  try {\r\n    // æŸ¥æ‰¾è¡¨æ ¼æŒ‰é’®ï¼Œç”¨äºå®šä½å¼¹çª—\r\n    const tableButton = document.querySelector('[data-name=\"table\"]') as HTMLElement\r\n    console.log('ğŸ“‹ [Table] Table button found:', !!tableButton)\r\n\r\n    // åˆ›å»ºç®€å•ç›´è§‚çš„è¡¨æ ¼é€‰æ‹©å™¨\r\n    const overlay = document.createElement('div')\r\n    overlay.className = 'editor-dialog-overlay editor-table-overlay'\r\n    // é€æ˜èƒŒæ™¯ï¼Œç‚¹å‡»å¤–éƒ¨å…³é—­\r\n    overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: transparent; z-index: 10000;'\r\n\r\n    const dialog = document.createElement('div')\r\n    dialog.className = 'editor-dialog editor-table-dialog'\r\n\r\n    // æ ¹æ®è¡¨æ ¼æŒ‰é’®å®šä½å¼¹çª—ï¼Œå¹¶ç¡®ä¿ä¸è¶…å‡ºå±å¹•\r\n    if (tableButton) {\r\n      const rect = tableButton.getBoundingClientRect()\r\n\r\n      // å…ˆæ·»åŠ åˆ°DOMä»¥è·å–å®é™…å°ºå¯¸\r\n      dialog.style.cssText = `\r\n        position: fixed;\r\n        left: -9999px;\r\n        top: -9999px;\r\n        background: white;\r\n        border-radius: 8px;\r\n        padding: 12px;\r\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\r\n        border: 1px solid #e5e7eb;\r\n        visibility: hidden;\r\n        max-width: 260px;\r\n      `\r\n      overlay.appendChild(dialog)\r\n      document.body.appendChild(overlay)\r\n\r\n      // è·å–å®é™…å°ºå¯¸\r\n      const dialogWidth = dialog.offsetWidth\r\n      const dialogHeight = dialog.offsetHeight\r\n      console.log('ğŸ“‹ [Table] Dialog actual size:', dialogWidth, 'x', dialogHeight)\r\n\r\n      // è®¡ç®—åˆå§‹ä½ç½®\r\n      let left = rect.left\r\n      let top = rect.bottom + 8\r\n\r\n      // æ£€æŸ¥å³è¾¹ç•Œ\r\n      const rightOverflow = (left + dialogWidth) - window.innerWidth\r\n      if (rightOverflow > 0)\r\n        left = left - rightOverflow - 16\r\n\r\n      // æ£€æŸ¥å·¦è¾¹ç•Œ\r\n      if (left < 16)\r\n        left = 16\r\n\r\n      // æ£€æŸ¥åº•éƒ¨è¾¹ç•Œ\r\n      const bottomOverflow = (top + dialogHeight) - window.innerHeight\r\n      if (bottomOverflow > 0) {\r\n        // å¦‚æœä¸‹æ–¹ç©ºé—´ä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸Šæ–¹\r\n        const topPosition = rect.top - dialogHeight - 8\r\n        if (topPosition >= 16) {\r\n          top = topPosition\r\n        }\r\n        else {\r\n          // ä¸Šæ–¹ä¹Ÿä¸è¶³ï¼Œæ˜¾ç¤ºåœ¨è§†å£ä¸­é—´åä¸Š\r\n          top = Math.max(16, (window.innerHeight - dialogHeight) / 2 - 50)\r\n        }\r\n      }\r\n\r\n      // æ£€æŸ¥é¡¶éƒ¨è¾¹ç•Œ\r\n      if (top < 16)\r\n        top = 16\r\n\r\n      console.log('ğŸ“‹ [Table] Final position:', left, top)\r\n\r\n      // åº”ç”¨æœ€ç»ˆä½ç½®\r\n      dialog.style.cssText = `\r\n        position: fixed;\r\n        left: ${left}px;\r\n        top: ${top}px;\r\n        background: white;\r\n        border-radius: 8px;\r\n        padding: 12px;\r\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\r\n        border: 1px solid #e5e7eb;\r\n        visibility: visible;\r\n        max-width: 260px;\r\n      `\r\n\r\n      // å·²ç»æ·»åŠ åˆ°DOMï¼Œä¸éœ€è¦å†æ¬¡æ·»åŠ \r\n    }\r\n    else {\r\n      // å¦‚æœæ²¡æ‰¾åˆ°æŒ‰é’®ï¼Œå±…ä¸­æ˜¾ç¤º\r\n      dialog.style.cssText = 'position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); border: 1px solid #e5e7eb; max-width: 260px;'\r\n      overlay.appendChild(dialog)\r\n      document.body.appendChild(overlay)\r\n    }\r\n\r\n    // åˆ›å»ºç®€å•çš„ç½‘æ ¼é€‰æ‹©å™¨\r\n    dialog.innerHTML = `\r\n      <style>\r\n        .editor-table-dialog-title {\r\n          font-size: 14px;\r\n          font-weight: 600;\r\n          color: #374151;\r\n          margin-bottom: 12px;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 6px;\r\n        }\r\n        .editor-table-dialog-title svg {\r\n          width: 16px;\r\n          height: 16px;\r\n          color: #6b7280;\r\n        }\r\n        .grid-table {\r\n          display: grid;\r\n          gap: 3px;\r\n          background: #f9fafb;\r\n          padding: 6px;\r\n          border: 1px solid #e5e7eb;\r\n          border-radius: 6px;\r\n        }\r\n        .grid-cell {\r\n          background: white;\r\n          border: 1px solid #e5e7eb;\r\n          border-radius: 2px;\r\n          cursor: pointer;\r\n          transition: all 0.15s ease;\r\n          min-width: 0;\r\n          min-height: 0;\r\n          aspect-ratio: 1;\r\n          box-sizing: border-box;\r\n        }\r\n        .grid-cell:hover {\r\n          background: #dbeafe;\r\n          border-color: #93c5fd;\r\n          box-shadow: 0 0 0 1px #93c5fd inset;\r\n        }\r\n        .grid-cell.selected {\r\n          background: #3b82f6;\r\n          border-color: #2563eb;\r\n          box-shadow: 0 0 0 1px #2563eb inset;\r\n        }\r\n        .grid-cell:active {\r\n          background: #2563eb;\r\n          border-color: #1e40af;\r\n          box-shadow: 0 0 0 1px #1e40af inset;\r\n        }\r\n        .grid-info {\r\n          margin-top: 10px;\r\n          text-align: center;\r\n          font-size: 14px;\r\n          color: #1f2937;\r\n          font-weight: 600;\r\n          padding: 6px 8px;\r\n          background: #f3f4f6;\r\n          border-radius: 4px;\r\n        }\r\n        .close-hint {\r\n          margin-top: 6px;\r\n          text-align: center;\r\n          font-size: 12px;\r\n          color: #9ca3af;\r\n        }\r\n      </style>\r\n      \r\n      <div class=\"editor-table-dialog-title\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/>\r\n          <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"/>\r\n          <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"/>\r\n        </svg>\r\n        <span>é€‰æ‹©è¡¨æ ¼å¤§å°</span>\r\n      </div>\r\n      <div class=\"grid-table\" id=\"grid-table\"></div>\r\n      <div class=\"grid-info\" id=\"grid-info\">0 Ã— 0 è¡¨æ ¼</div>\r\n      <div class=\"close-hint\">ç‚¹å‡»ç¡®è®¤ Â· ESCå–æ¶ˆ</div>\r\n    `\r\n\r\n    // å¦‚æœè¿˜æ²¡æœ‰æ·»åŠ åˆ°DOMï¼ˆétableButtonæƒ…å†µå·²ç»æ·»åŠ äº†ï¼‰\r\n    if (!document.body.contains(overlay)) {\r\n      overlay.appendChild(dialog)\r\n      document.body.appendChild(overlay)\r\n    }\r\n\r\n    console.log('ğŸ“‹ [Table] Dialog created and appended')\r\n\r\n    // åˆ›å»ºç½‘æ ¼å•å…ƒæ ¼\r\n    const gridTable = dialog.querySelector('#grid-table') as HTMLElement\r\n    const gridInfo = dialog.querySelector('#grid-info') as HTMLElement\r\n\r\n    // åŠ¨æ€è®¡ç®—ç½‘æ ¼åˆ—æ•°å’Œè¡Œæ•°\r\n    const cellSize = 24 // å•å…ƒæ ¼æœ€å°å°ºå¯¸\r\n    const gap = 3 // å•å…ƒæ ¼é—´è·\r\n    const padding = 6 // ç½‘æ ¼å®¹å™¨å†…è¾¹è·\r\n    const border = 2 // è¾¹æ¡†\r\n    const maxRows = 8 // æœ€å¤§è¡Œæ•°\r\n\r\n    // è·å–å¯¹è¯æ¡†çš„å®é™…å®½åº¦\r\n    const dialogWidth = dialog.offsetWidth\r\n    const dialogPadding = 12 * 2 // dialog çš„ padding\r\n\r\n    // è®¡ç®—ç½‘æ ¼å®¹å™¨çš„å¯ç”¨å®½åº¦\r\n    const availableWidth = dialogWidth - dialogPadding - padding * 2 - border\r\n\r\n    // è®¡ç®—å¯ä»¥å®¹çº³å¤šå°‘åˆ—ï¼ˆè‡³å°‘6åˆ—ï¼Œæœ€å¤š15åˆ—ï¼‰\r\n    const cols = Math.max(6, Math.min(15, Math.floor((availableWidth + gap) / (cellSize + gap))))\r\n    const rows = maxRows\r\n\r\n    console.log('ğŸ“‹ [Table] Grid size:', cols, 'x', rows, 'available width:', availableWidth)\r\n\r\n    // è®¾ç½®ç½‘æ ¼å¸ƒå±€\r\n    gridTable.style.gridTemplateColumns = `repeat(${cols}, 1fr)`\r\n    gridTable.style.gridTemplateRows = `repeat(${rows}, 1fr)`\r\n\r\n    // è®¡ç®—ç½‘æ ¼å®¹å™¨çš„å®é™…å®½åº¦å’Œé«˜åº¦\r\n    const gridWidth = cols * cellSize + (cols - 1) * gap + padding * 2\r\n    const gridHeight = rows * cellSize + (rows - 1) * gap + padding * 2\r\n    gridTable.style.width = `${gridWidth}px`\r\n    gridTable.style.height = `${gridHeight}px`\r\n\r\n    // åˆ›å»ºç½‘æ ¼å•å…ƒæ ¼\r\n    const totalCells = cols * rows\r\n    for (let i = 0; i < totalCells; i++) {\r\n      const cell = document.createElement('div')\r\n      cell.className = 'grid-cell'\r\n      cell.dataset.row = String(Math.floor(i / cols) + 1)\r\n      cell.dataset.col = String((i % cols) + 1)\r\n      gridTable.appendChild(cell)\r\n    }\r\n\r\n    const closeDialog = () => {\r\n      overlay.remove()\r\n    }\r\n\r\n    // æ’å…¥è¡¨æ ¼çš„å‡½æ•° - å…ˆå®šä¹‰ï¼Œåä½¿ç”¨\r\n    const insertTableWithSize = (rows: number, cols: number) => {\r\n      console.log(`ğŸ“‹ [Table] Inserting table: ${rows}x${cols}`)\r\n      closeDialog()\r\n\r\n      if (rows < 1 || cols < 1 || rows > 100 || cols > 20) {\r\n        console.log('âŒ [Table] Invalid table size')\r\n        return\r\n      }\r\n\r\n      // è·å–ç¼–è¾‘å™¨å†…å®¹åŒºåŸŸï¼ˆè¿™é‡Œä¸éœ€è¦é‡å¤è·å–ï¼‰\r\n      if (!editorContent) {\r\n        console.log('âŒ [Table] Editor content not found')\r\n        return\r\n      }\r\n\r\n      // èšç„¦åˆ°ç¼–è¾‘å™¨\r\n      editorContent.focus()\r\n\r\n      const selection = window.getSelection()\r\n      console.log('ğŸ“‹ [Table] Selection after focus:', selection)\r\n\r\n      // è·å–æˆ–åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„æ’å…¥ç‚¹\r\n      let range: Range\r\n\r\n      // ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„é€‰åŒº\r\n      if (savedRange && selection) {\r\n        // æ¢å¤ä¹‹å‰ä¿å­˜çš„é€‰åŒº\r\n        range = savedRange\r\n        selection.removeAllRanges()\r\n        selection.addRange(range)\r\n        console.log('ğŸ“‹ [Table] Using saved range at cursor position')\r\n      }\r\n      else {\r\n        // å¦‚æœæ²¡æœ‰ä¿å­˜çš„é€‰åŒºï¼Œåœ¨ç¼–è¾‘å™¨æœ«å°¾æ’å…¥\r\n        console.log('âš ï¸ [Table] No saved range, appending at end')\r\n\r\n        const tableWrapper = createTableElement(rows, cols)\r\n        const p = document.createElement('p')\r\n        p.innerHTML = '<br>'\r\n\r\n        // æ‰¾åˆ°æœ€åä¸€ä¸ªæ®µè½\r\n        const lastP = editorContent.querySelector('p:last-of-type')\r\n        if (lastP) {\r\n          lastP.insertAdjacentElement('afterend', tableWrapper)\r\n          tableWrapper.insertAdjacentElement('afterend', p)\r\n        }\r\n        else {\r\n          editorContent.appendChild(tableWrapper)\r\n          editorContent.appendChild(p)\r\n        }\r\n\r\n        console.log('ğŸ“‹ [Table] Table appended to editor')\r\n\r\n        // è§¦å‘æ›´æ–°\r\n        const event = new Event('input', { bubbles: true })\r\n        editorContent.dispatchEvent(event)\r\n        return\r\n      }\r\n\r\n      // åˆ›å»ºè¡¨æ ¼å…ƒç´ \r\n      const tableWrapper = createTableElement(rows, cols)\r\n      const table = tableWrapper.querySelector('table')\r\n      console.log('ğŸ“‹ [Table] Table element created:', table)\r\n\r\n      // è°ƒè¯•ï¼šæ£€æŸ¥æ’å…¥å‰çš„çŠ¶æ€\r\n      console.log('ğŸ“‹ [Table] Before insertion - Editor HTML length:', editorContent.innerHTML.length)\r\n      console.log('ğŸ“‹ [Table] Before insertion - Editor children:', editorContent.children.length)\r\n\r\n      // æ’å…¥è¡¨æ ¼\r\n      try {\r\n        // åœ¨å½“å‰ä½ç½®æ’å…¥è¡¨æ ¼\r\n        range.deleteContents()\r\n\r\n        // å¦‚æœæ˜¯åœ¨æ®µè½ä¸­ï¼Œåˆ†å‰²æ®µè½\r\n        const container = range.commonAncestorContainer\r\n        if (container.nodeType === Node.TEXT_NODE\r\n          || (container.nodeType === Node.ELEMENT_NODE\r\n            && (container as HTMLElement).tagName === 'P')) {\r\n          // åœ¨æ®µè½åæ’å…¥è¡¨æ ¼\r\n          const p = container.nodeType === Node.TEXT_NODE\r\n            ? container.parentElement\r\n            : container as HTMLElement\r\n\r\n          if (p && p.tagName === 'P') {\r\n            // åœ¨æ®µè½åæ’å…¥\r\n            p.insertAdjacentElement('afterend', tableWrapper)\r\n\r\n            // æ·»åŠ ä¸€ä¸ªæ–°æ®µè½\r\n            const newP = document.createElement('p')\r\n            newP.innerHTML = '<br>'\r\n            tableWrapper.insertAdjacentElement('afterend', newP)\r\n\r\n            console.log('ğŸ“‹ [Table] Inserted after paragraph')\r\n          }\r\n          else {\r\n            range.insertNode(tableWrapper)\r\n            console.log('ğŸ“‹ [Table] Inserted at range')\r\n          }\r\n        }\r\n        else {\r\n          range.insertNode(tableWrapper)\r\n          console.log('ğŸ“‹ [Table] Inserted at range')\r\n        }\r\n      }\r\n      catch (error) {\r\n        console.log('âš ï¸ [Table] Error inserting, appending to end:', error)\r\n        editorContent.appendChild(tableWrapper)\r\n      }\r\n\r\n      // ç¡®ä¿è¡¨æ ¼åæœ‰æ®µè½\r\n      let nextP = tableWrapper.nextElementSibling\r\n      if (!nextP || nextP.tagName !== 'P') {\r\n        nextP = document.createElement('p')\r\n        nextP.innerHTML = '<br>'\r\n        tableWrapper.insertAdjacentElement('afterend', nextP)\r\n      }\r\n\r\n      // è°ƒè¯•ï¼šæ£€æŸ¥æ’å…¥åçš„çŠ¶æ€\r\n      console.log('ğŸ“‹ [Table] After insertion - Table parent:', table.parentElement?.className)\r\n      console.log('ğŸ“‹ [Table] After insertion - Editor HTML length:', editorContent.innerHTML.length)\r\n      console.log('ğŸ“‹ [Table] After insertion - Editor children:', editorContent.children.length)\r\n      console.log('ğŸ“‹ [Table] After insertion - Table in DOM:', document.body.contains(table))\r\n\r\n      // éªŒè¯è¡¨æ ¼ç¡®å®åœ¨ç¼–è¾‘å™¨ä¸­\r\n      const tables = editorContent.querySelectorAll('table')\r\n      console.log('ğŸ“‹ [Table] Tables in editor:', tables.length)\r\n\r\n      // å°†å…‰æ ‡è®¾ç½®åˆ°è¡¨æ ¼åçš„æ®µè½ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥\r\n      setTimeout(() => {\r\n        const newRange = document.createRange()\r\n        newRange.selectNodeContents(nextP)\r\n        newRange.collapse(false) // å…‰æ ‡åœ¨æ®µè½æœ«å°¾\r\n\r\n        const newSelection = window.getSelection()\r\n        if (newSelection) {\r\n          newSelection.removeAllRanges()\r\n          newSelection.addRange(newRange)\r\n\r\n          // ç¡®ä¿ç¼–è¾‘å™¨ä¿æŒç„¦ç‚¹\r\n          editorContent.focus()\r\n\r\n          console.log('ğŸ“‹ [Table] Cursor set to paragraph after table')\r\n        }\r\n\r\n        // æ»šåŠ¨åˆ°è¡¨æ ¼ä½ç½®ï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°\r\n        table.scrollIntoView({ behavior: 'smooth', block: 'nearest' })\r\n      }, 50)\r\n\r\n      // è§¦å‘æ›´æ–°äº‹ä»¶\r\n      const inputEvent = new Event('input', { bubbles: true, cancelable: true })\r\n      const changeEvent = new Event('change', { bubbles: true })\r\n\r\n      editorContent.dispatchEvent(inputEvent)\r\n      editorContent.dispatchEvent(changeEvent)\r\n\r\n      console.log('âœ… [Table] All events dispatched')\r\n\r\n      // å»¶è¿Ÿå†æ¬¡æ£€æŸ¥\r\n      setTimeout(() => {\r\n        console.log('ğŸ“‹ [Table] Delayed check - Table still in DOM:', document.body.contains(table))\r\n        console.log('ğŸ“‹ [Table] Delayed check - Editor HTML length:', editorContent.innerHTML.length)\r\n        const tablesAfter = editorContent.querySelectorAll('table')\r\n        console.log('ğŸ“‹ [Table] Delayed check - Tables in editor:', tablesAfter.length)\r\n      }, 100)\r\n    }\r\n\r\n    // æ›´æ–°ç½‘æ ¼é€‰æ‹©å™¨æ˜¾ç¤º\r\n    const updateGridSelection = (rows: number, cols: number) => {\r\n      const cells = gridTable.querySelectorAll('.grid-cell')\r\n      cells.forEach((cell) => {\r\n        const cellEl = cell as HTMLElement\r\n        const r = Number.parseInt(cellEl.dataset.row || '0')\r\n        const c = Number.parseInt(cellEl.dataset.col || '0')\r\n\r\n        if (r <= rows && c <= cols)\r\n          cellEl.classList.add('selected')\r\n        else\r\n          cellEl.classList.remove('selected')\r\n      })\r\n\r\n      gridInfo.textContent = `${rows} Ã— ${cols} è¡¨æ ¼`\r\n    }\r\n\r\n    // ç½‘æ ¼é¼ æ ‡æ‚¬åœäº‹ä»¶\r\n    gridTable.addEventListener('mouseover', (e) => {\r\n      const target = e.target as HTMLElement\r\n      if (target.classList.contains('grid-cell')) {\r\n        const rows = Number.parseInt(target.dataset.row || '0')\r\n        const cols = Number.parseInt(target.dataset.col || '0')\r\n        updateGridSelection(rows, cols)\r\n      }\r\n    })\r\n\r\n    // ç½‘æ ¼ç‚¹å‡»äº‹ä»¶ - ç›´æ¥æ’å…¥\r\n    gridTable.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement\r\n      if (target.classList.contains('grid-cell')) {\r\n        const rows = Number.parseInt(target.dataset.row || '0')\r\n        const cols = Number.parseInt(target.dataset.col || '0')\r\n        insertTableWithSize(rows, cols)\r\n      }\r\n    })\r\n\r\n    // ç½‘æ ¼é¼ æ ‡ç¦»å¼€äº‹ä»¶\r\n    gridTable.addEventListener('mouseleave', () => {\r\n      updateGridSelection(0, 0)\r\n    })\r\n\r\n    // ç‚¹å‡»å¤–éƒ¨å…³é—­\r\n    overlay.addEventListener('click', (e) => {\r\n      if (e.target === overlay)\r\n        closeDialog()\r\n    })\r\n\r\n    // ESC é”®å…³é—­\r\n    const handleKeydown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        closeDialog()\r\n        document.removeEventListener('keydown', handleKeydown)\r\n      }\r\n    }\r\n    document.addEventListener('keydown', handleKeydown)\r\n\r\n    console.log('âœ… [Table] Dialog setup complete')\r\n  }\r\n  catch (error) {\r\n    console.error('âŒ [Table] Error creating dialog:', error)\r\n    console.error('âŒ [Table] Error stack:', (error as Error).stack)\r\n  }\r\n\r\n  console.log('âœ… [Table] Command returning true')\r\n  return true\r\n}\r\n\r\n/**\r\n * åœ¨è¡¨æ ¼ä¸­æ·»åŠ è¡Œ\r\n */\r\nconst addTableRow: Command = (state, dispatch) => {\r\n  if (!dispatch)\r\n    return true\r\n\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return false\r\n\r\n  let node = selection.anchorNode\r\n  let tr: HTMLTableRowElement | null = null\r\n\r\n  // æŸ¥æ‰¾å½“å‰è¡Œ\r\n  while (node && node !== document.body) {\r\n    if (node.nodeName === 'TR') {\r\n      tr = node as HTMLTableRowElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!tr)\r\n    return false\r\n\r\n  // å¤åˆ¶å½“å‰è¡Œ\r\n  const newRow = tr.cloneNode(true) as HTMLTableRowElement\r\n  Array.from(newRow.cells).forEach((cell) => {\r\n    cell.textContent = ' '\r\n  })\r\n\r\n  tr.parentNode?.insertBefore(newRow, tr.nextSibling)\r\n  return true\r\n}\r\n\r\n/**\r\n * åœ¨è¡¨æ ¼ä¸­æ·»åŠ åˆ—\r\n */\r\nconst addTableColumn: Command = (state, dispatch) => {\r\n  if (!dispatch)\r\n    return true\r\n\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return false\r\n\r\n  let node = selection.anchorNode\r\n  let table: HTMLTableElement | null = null\r\n\r\n  // æŸ¥æ‰¾è¡¨æ ¼\r\n  while (node && node !== document.body) {\r\n    if (node.nodeName === 'TABLE') {\r\n      table = node as HTMLTableElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (!table)\r\n    return false\r\n\r\n  // åœ¨æ¯è¡Œæœ«å°¾æ·»åŠ å•å…ƒæ ¼\r\n  Array.from(table.rows).forEach((row) => {\r\n    const cell = row.insertCell(-1)\r\n    cell.textContent = ' '\r\n    cell.style.border = '1px solid #ddd'\r\n    cell.style.padding = '8px'\r\n  })\r\n\r\n  return true\r\n}\r\n\r\n/**\r\n * åˆ é™¤è¡¨æ ¼\r\n */\r\nconst deleteTableCommand: Command = (state, dispatch) => {\r\n  if (!dispatch)\r\n    return true\r\n\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return false\r\n\r\n  let node = selection.anchorNode\r\n  let table: HTMLTableElement | null = null\r\n\r\n  while (node && node !== document.body) {\r\n    if (node.nodeName === 'TABLE') {\r\n      table = node as HTMLTableElement\r\n      break\r\n    }\r\n    node = node.parentNode\r\n  }\r\n\r\n  if (table) {\r\n    table.remove()\r\n    return true\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * æ£€æŸ¥æ˜¯å¦åœ¨è¡¨æ ¼ä¸­\r\n */\r\nfunction isInTable() {\r\n  return () => {\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return false\r\n\r\n    let node = selection.anchorNode\r\n    while (node && node !== document.body) {\r\n      if (node.nodeName === 'TABLE')\r\n        return true\r\n      node = node.parentNode\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * è¡¨æ ¼æ’ä»¶\r\n */\r\nexport const TablePlugin: Plugin = createPlugin({\r\n  name: 'table',\r\n  commands: {\r\n    insertTable,\r\n    addTableRow,\r\n    addTableColumn,\r\n    deleteTableCommand,\r\n  },\r\n  toolbar: [{\r\n    name: 'table',\r\n    title: 'è¡¨æ ¼',\r\n    icon: 'table',\r\n    command: insertTable,\r\n    active: isInTable(),\r\n  }],\r\n  // åˆå§‹åŒ–æ—¶æ³¨å†Œè¡¨æ ¼å³é”®èœå•\r\n  init: (editor: any) => {\r\n    console.log('[TablePlugin] init è¢«è°ƒç”¨')\r\n\r\n    // å»¶è¿Ÿæ³¨å†Œï¼Œç¡®ä¿ ContextMenuManager å·²ç»åˆå§‹åŒ–\r\n    setTimeout(() => {\r\n      console.log('[TablePlugin] å¼€å§‹æ³¨å†Œè¡¨æ ¼å³é”®èœå•')\r\n\r\n      // æ³¨å†Œè¡¨æ ¼å³é”®èœå•åˆ° ContextMenuManager\r\n      registerContextMenu({\r\n        id: 'table-context-menu',\r\n        selector: '.ldesign-editor-content table, .ldesign-editor-content table td, .ldesign-editor-content table th',\r\n        priority: 100, // è®¾ç½®æ›´é«˜ä¼˜å…ˆçº§\r\n        condition: (element) => {\r\n          // ç¡®ä¿å…ƒç´ åœ¨è¡¨æ ¼å†…\r\n          const table = element.closest('table')\r\n          return !!table && table.closest('.ldesign-editor-content') !== null\r\n        },\r\n        items: (context) => {\r\n          console.log('[TablePlugin] ç”Ÿæˆè¡¨æ ¼èœå•é¡¹, context:', context)\r\n\r\n          // æ‰¾åˆ°è¡¨æ ¼å…ƒç´ \r\n          const table = context.element.closest('table') as HTMLTableElement\r\n          if (!table) {\r\n            console.log('[TablePlugin] æœªæ‰¾åˆ°è¡¨æ ¼å…ƒç´ ')\r\n            return []\r\n          }\r\n\r\n          console.log('[TablePlugin] æ‰¾åˆ°è¡¨æ ¼å…ƒç´ :', table)\r\n\r\n          return [\r\n            { label: 'æ’å…¥ä¸Šæ–¹è¡Œ', action: () => insertRowAbove(table) },\r\n            { label: 'æ’å…¥ä¸‹æ–¹è¡Œ', action: () => insertRowBelow(table) },\r\n            { label: 'æ’å…¥å·¦ä¾§åˆ—', action: () => insertColumnLeft(table) },\r\n            { label: 'æ’å…¥å³ä¾¦åˆ—', action: () => insertColumnRight(table) },\r\n            { divider: true },\r\n            { label: 'åˆå¹¶å•å…ƒæ ¼', action: () => mergeCells(table) },\r\n            { label: 'æ‹†åˆ†å•å…ƒæ ¼', action: () => splitCell(table) },\r\n            { label: 'è®¾ä¸ºè¡¨å¤´', action: () => toggleTableHeader(table) },\r\n            { divider: true },\r\n            { label: 'å¢åŠ åˆ—å®½', action: () => increaseColumnWidth(table) },\r\n            { label: 'å‡å°‘åˆ—å®½', action: () => decreaseColumnWidth(table) },\r\n            { divider: true },\r\n            { label: 'åˆ é™¤è¡Œ', action: () => deleteCurrentRow(table), className: 'danger' },\r\n            { label: 'åˆ é™¤åˆ—', action: () => deleteCurrentColumn(table), className: 'danger' },\r\n            { label: 'æ¸…ç©ºå†…å®¹', action: () => clearTable(table), className: 'danger' },\r\n            { divider: true },\r\n            { label: 'åˆ é™¤è¡¨æ ¼', action: () => deleteEntireTable(table), className: 'danger' },\r\n          ]\r\n        },\r\n      })\r\n\r\n      console.log('[TablePlugin] è¡¨æ ¼å³é”®èœå•å·²æ³¨å†Œ')\r\n    }, 100)\r\n  },\r\n})\r\n\r\n// Export table plugins as array\r\nexport const tablePlugins = []\r\n"],"names":["tableSelections","WeakMap","setupTableSelection","table","isSelecting","startCell","selectedCells","Set","cachedGrid","clearSelection","forEach","cell","classList","remove","clear","selectColumn","colIndex","Array","from","rows","row","cells","add","saveSelection","selectRow","rowIndex","getCellPosition","grid","logicalGrid","createLogicalGrid","cellRow","cellCol","cellRowEnd","cellColEnd","r","length","c","col","rowEnd","colEnd","rowCount","colCount","Math","max","map","count","Number","parseInt","getAttribute","fill","logicalCol","rowspan","colspan","dr","dc","updateSelection","endCell","startPos","endPos","minRow","min","maxRow","minCol","maxCol","expanded","has","pos","addedCells","set","addEventListener","e","target","closest","parentElement","indexOf","button","contains","shiftKey","ctrlKey","altKey","preventDefault","handleMouseUp","document","cleanupObserver","MutationObserver","mutations","mutation","type","removedNodes","node","removeEventListener","disconnect","observe","childList","subtree","setupColumnResize","observer","attributes","attributeFilter","headerCells","querySelectorAll","th","index","resizer","createElement","className","style","cssText","background","startX","startWidth","currentColumn","stopPropagation","clientX","offsetWidth","body","cursor","handleMouseMove","diff","newWidth","width","minWidth","maxWidth","tableLayout","event","Event","bubbles","dispatchEvent","position","appendChild","getSelectedCells","selection","get","insertRowAbove","window","getSelection","rangeCount","anchorNode","targetRow","nodeName","parentNode","newRow","cloneNode","innerHTML","insertBefore","insertRowBelow","nextSibling","insertColumnLeft","targetCell","newCell","setAttribute","insertColumnRight","deleteCurrentRow","tbody","children","deleteCurrentColumn","firstRow","deleteEntireTable","confirm","editorContent","querySelector","clearTable","mergeCells","alert","Infinity","topLeftCell","includes","contents","cellsToRemove","text","textContent","trim","push","rowSpan","colSpan","String","join","splitCell","removeAttribute","i","tagName","toLowerCase","toggleTableHeader","isHeader","every","attr","name","value","replaceChild","increaseColumnWidth","currentWidth","decreaseColumnWidth","createTableElement","cols","wrapper","display","thead","headerRow","j","tr","td","setTimeout","insertTable","state","dispatch","console","log","originalSelection","savedRange","range","getRangeAt","commonAncestorContainer","cloneRange","tableButton","overlay","dialog","rect","getBoundingClientRect","dialogWidth","dialogHeight","offsetHeight","left","top","bottom","rightOverflow","innerWidth","bottomOverflow","innerHeight","topPosition","gridTable","gridInfo","cellSize","gap","padding","border","maxRows","dialogPadding","availableWidth","floor","gridTemplateColumns","gridTemplateRows","gridWidth","gridHeight","height","totalCells","dataset","closeDialog","insertTableWithSize","focus","removeAllRanges","addRange","tableWrapper","p","lastP","insertAdjacentElement","deleteContents","container","nodeType","Node","TEXT_NODE","ELEMENT_NODE","newP","insertNode","error","nextP","nextElementSibling","tables","newRange","createRange","selectNodeContents","collapse","newSelection","scrollIntoView","behavior","block","inputEvent","cancelable","changeEvent","tablesAfter","updateGridSelection","cellEl","handleKeydown","key","stack","addTableRow","addTableColumn","insertCell","deleteTableCommand","isInTable","TablePlugin","createPlugin","commands","toolbar","title","icon","command","active","init","editor","registerContextMenu","id","selector","priority","condition","element","items","context","label","action","divider"],"mappings":"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"}