{"version":3,"file":"index.cjs","sources":["../../../src/plugins/template/index.ts"],"sourcesContent":["/**\r\n * 模板插件\r\n * 提供模板管理和应用功能\r\n */\r\n\r\nimport type { ApplyTemplateOptions, TemplateCategory } from '../../template/types'\r\nimport { createPlugin } from '../../core/Plugin'\r\nimport { TemplateManager } from '../../template/TemplateManager'\r\nimport { showTemplateDialog } from '../../ui/TemplateDialog'\r\n\r\n// 全局模板管理器实例\r\nlet globalTemplateManager: TemplateManager | null = null\r\n\r\n/**\r\n * 获取或创建模板管理器\r\n */\r\nfunction getTemplateManager(): TemplateManager {\r\n  if (!globalTemplateManager) {\r\n    globalTemplateManager = new TemplateManager({\r\n      storage: 'local',\r\n      maxCustomTemplates: 50,\r\n      enableVariables: true,\r\n    })\r\n    // 初始化\r\n    globalTemplateManager.init().catch((error) => {\r\n      console.error('Failed to initialize template manager:', error)\r\n    })\r\n  }\r\n  return globalTemplateManager\r\n}\r\n\r\nconst TemplatePlugin = createPlugin({\r\n  name: 'template',\r\n  config: {\r\n    toolbar: {\r\n      items: [\r\n        {\r\n          name: 'template',\r\n          tooltip: '模板',\r\n          icon: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/>\r\n            <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"/>\r\n            <line x1=\"3\" y1=\"9\" x2=\"9\" y2=\"9\"/>\r\n            <line x1=\"3\" y1=\"15\" x2=\"9\" y2=\"15\"/>\r\n            <line x1=\"12\" y1=\"7\" x2=\"18\" y2=\"7\"/>\r\n            <line x1=\"12\" y1=\"12\" x2=\"18\" y2=\"12\"/>\r\n            <line x1=\"12\" y1=\"17\" x2=\"18\" y2=\"17\"/>\r\n          </svg>`,\r\n          action: 'template:show-dialog',\r\n        },\r\n      ],\r\n    },\r\n  },\r\n\r\n  init(editor) {\r\n    const templateManager = getTemplateManager()\r\n\r\n    // 存储模板管理器到编辑器实例\r\n    ;(editor as any).templateManager = templateManager\r\n\r\n    // 注册命令：显示模板对话框\r\n    editor.commands.register('template:show-dialog', {\r\n      execute: () => {\r\n        showTemplateDialog(templateManager, async (template) => {\r\n          // 处理变量填充\r\n          const options: ApplyTemplateOptions = {\r\n            replaceContent: true,\r\n          }\r\n\r\n          if (template.variables && template.variables.length > 0) {\r\n            // 变量已在对话框中处理，这里直接应用\r\n            await templateManager.applyTemplate(editor, template.metadata.id, options)\r\n          }\r\n          else {\r\n            await templateManager.applyTemplate(editor, template.metadata.id, options)\r\n          }\r\n        })\r\n      },\r\n    })\r\n\r\n    // 注册命令：从当前内容创建模板\r\n    editor.commands.register('template:create-from-content', {\r\n      execute: async () => {\r\n        const content = editor.getContent()\r\n        if (!content || content === '<p><br></p>') {\r\n          alert('当前编辑器内容为空，无法创建模板')\r\n          return\r\n        }\r\n\r\n        // 显示创建模板对话框\r\n        showCreateTemplateDialog(editor, templateManager)\r\n      },\r\n    })\r\n\r\n    // 注册命令：应用模板\r\n    editor.commands.register('template:apply', {\r\n      execute: async (templateId: string, options?: ApplyTemplateOptions) => {\r\n        await templateManager.applyTemplate(editor, templateId, options)\r\n      },\r\n    })\r\n\r\n    // 注册命令：导出模板\r\n    editor.commands.register('template:export', {\r\n      execute: async (templateId: string) => {\r\n        try {\r\n          const jsonStr = await templateManager.exportTemplate(templateId)\r\n          downloadJSON(jsonStr, `template-${templateId}.json`)\r\n        }\r\n        catch (error) {\r\n          console.error('Failed to export template:', error)\r\n          alert('导出模板失败')\r\n        }\r\n      },\r\n    })\r\n\r\n    // 注册命令：导入模板\r\n    editor.commands.register('template:import', {\r\n      execute: async () => {\r\n        const input = document.createElement('input')\r\n        input.type = 'file'\r\n        input.accept = '.json'\r\n\r\n        input.addEventListener('change', async (e) => {\r\n          const file = (e.target as HTMLInputElement).files?.[0]\r\n          if (file) {\r\n            const reader = new FileReader()\r\n            reader.onload = async (event) => {\r\n              try {\r\n                const jsonStr = event.target?.result as string\r\n                await templateManager.importTemplate(jsonStr)\r\n                alert('模板导入成功！')\r\n              }\r\n              catch (error) {\r\n                alert(`模板导入失败：${error}`)\r\n              }\r\n            }\r\n            reader.readAsText(file)\r\n          }\r\n        })\r\n\r\n        input.click()\r\n      },\r\n    })\r\n\r\n    // 注册快捷键\r\n    editor.keymap.register({\r\n      'Ctrl+Shift+T': 'template:show-dialog',\r\n      'Cmd+Shift+T': 'template:show-dialog',\r\n    })\r\n\r\n    // 监听创建模板事件\r\n    editor.on('template:create-from-content', () => {\r\n      editor.commands.execute('template:create-from-content')\r\n    })\r\n\r\n    // 添加右键菜单项\r\n    if (editor.contextMenuManager) {\r\n      editor.contextMenuManager.registerItem({\r\n        id: 'template',\r\n        label: '模板',\r\n        submenu: [\r\n          {\r\n            id: 'apply-template',\r\n            label: '应用模板',\r\n            action: () => editor.commands.execute('template:show-dialog'),\r\n          },\r\n          {\r\n            id: 'create-template',\r\n            label: '从当前内容创建模板',\r\n            action: () => editor.commands.execute('template:create-from-content'),\r\n          },\r\n        ],\r\n      })\r\n    }\r\n  },\r\n\r\n  destroy() {\r\n    if (globalTemplateManager) {\r\n      globalTemplateManager.destroy()\r\n      globalTemplateManager = null\r\n    }\r\n  },\r\n})\r\n\r\n/**\r\n * 显示创建模板对话框\r\n */\r\nfunction showCreateTemplateDialog(editor: any, templateManager: TemplateManager): void {\r\n  const dialog = document.createElement('div')\r\n  dialog.className = 'template-create-dialog-overlay'\r\n\r\n  dialog.innerHTML = `\r\n    <div class=\"template-create-dialog\">\r\n      <div class=\"template-create-header\">\r\n        <h3>创建新模板</h3>\r\n        <button class=\"close-btn\">×</button>\r\n      </div>\r\n      <div class=\"template-create-content\">\r\n        <div class=\"form-group\">\r\n          <label for=\"template-name\">模板名称 <span class=\"required\">*</span></label>\r\n          <input type=\"text\" id=\"template-name\" placeholder=\"输入模板名称\" />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"template-desc\">模板描述</label>\r\n          <textarea id=\"template-desc\" placeholder=\"输入模板描述（可选）\" rows=\"3\"></textarea>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"template-category\">分类 <span class=\"required\">*</span></label>\r\n          <select id=\"template-category\">\r\n            <option value=\"business\">商务</option>\r\n            <option value=\"personal\">个人</option>\r\n            <option value=\"creative\">创意</option>\r\n            <option value=\"education\">教育</option>\r\n            <option value=\"technical\">技术</option>\r\n            <option value=\"custom\" selected>自定义</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"template-tags\">标签</label>\r\n          <input type=\"text\" id=\"template-tags\" placeholder=\"用逗号分隔多个标签\" />\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>\r\n            <input type=\"checkbox\" id=\"extract-variables\" checked />\r\n            自动提取变量（检测 {{variable}} 格式）\r\n          </label>\r\n        </div>\r\n      </div>\r\n      <div class=\"template-create-footer\">\r\n        <button class=\"btn-secondary cancel-btn\">取消</button>\r\n        <button class=\"btn-primary save-btn\">保存模板</button>\r\n      </div>\r\n    </div>\r\n  `\r\n\r\n  // 添加样式\r\n  addCreateDialogStyles()\r\n\r\n  document.body.appendChild(dialog)\r\n\r\n  // 绑定事件\r\n  const closeBtn = dialog.querySelector('.close-btn') as HTMLElement\r\n  const cancelBtn = dialog.querySelector('.cancel-btn') as HTMLElement\r\n  const saveBtn = dialog.querySelector('.save-btn') as HTMLElement\r\n\r\n  const close = () => document.body.removeChild(dialog)\r\n\r\n  closeBtn.addEventListener('click', close)\r\n  cancelBtn.addEventListener('click', close)\r\n\r\n  dialog.addEventListener('click', (e) => {\r\n    if (e.target === dialog)\r\n      close()\r\n  })\r\n\r\n  saveBtn.addEventListener('click', async () => {\r\n    const name = (dialog.querySelector('#template-name') as HTMLInputElement).value.trim()\r\n    const description = (dialog.querySelector('#template-desc') as HTMLTextAreaElement).value.trim()\r\n    const category = (dialog.querySelector('#template-category') as HTMLSelectElement).value as TemplateCategory\r\n    const tagsStr = (dialog.querySelector('#template-tags') as HTMLInputElement).value.trim()\r\n    // const extractVariables = (dialog.querySelector('#extract-variables') as HTMLInputElement).checked\r\n\r\n    if (!name) {\r\n      alert('请输入模板名称')\r\n      return\r\n    }\r\n\r\n    const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(Boolean) : []\r\n\r\n    try {\r\n      const template = await templateManager.createTemplateFromContent(editor, {\r\n        id: '',\r\n        name,\r\n        description,\r\n        category,\r\n        tags,\r\n        author: 'User',\r\n        isCustom: true,\r\n      })\r\n\r\n      alert('模板创建成功！')\r\n      close()\r\n    }\r\n    catch (error) {\r\n      alert(`创建模板失败：${error}`)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 下载 JSON 文件\r\n */\r\nfunction downloadJSON(jsonStr: string, filename: string): void {\r\n  const blob = new Blob([jsonStr], { type: 'application/json' })\r\n  const url = URL.createObjectURL(blob)\r\n  const a = document.createElement('a')\r\n  a.href = url\r\n  a.download = filename\r\n  document.body.appendChild(a)\r\n  a.click()\r\n  document.body.removeChild(a)\r\n  URL.revokeObjectURL(url)\r\n}\r\n\r\n/**\r\n * 添加创建对话框样式\r\n */\r\nfunction addCreateDialogStyles(): void {\r\n  if (document.getElementById('template-create-dialog-styles'))\r\n    return\r\n\r\n  const style = document.createElement('style')\r\n  style.id = 'template-create-dialog-styles'\r\n  style.textContent = `\r\n    .template-create-dialog-overlay {\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: rgba(0, 0, 0, 0.5);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      z-index: 10000;\r\n    }\r\n\r\n    .template-create-dialog {\r\n      background: white;\r\n      border-radius: 8px;\r\n      width: 500px;\r\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\r\n    }\r\n\r\n    .template-create-header {\r\n      padding: 20px;\r\n      border-bottom: 1px solid #e0e0e0;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n    }\r\n\r\n    .template-create-header h3 {\r\n      margin: 0;\r\n      font-size: 18px;\r\n      color: #333;\r\n    }\r\n\r\n    .template-create-content {\r\n      padding: 20px;\r\n    }\r\n\r\n    .form-group {\r\n      margin-bottom: 15px;\r\n    }\r\n\r\n    .form-group label {\r\n      display: block;\r\n      margin-bottom: 5px;\r\n      font-size: 14px;\r\n      color: #333;\r\n      font-weight: 500;\r\n    }\r\n\r\n    .form-group input[type=\"text\"],\r\n    .form-group textarea,\r\n    .form-group select {\r\n      width: 100%;\r\n      padding: 8px 12px;\r\n      border: 1px solid #ddd;\r\n      border-radius: 4px;\r\n      font-size: 14px;\r\n    }\r\n\r\n    .form-group textarea {\r\n      resize: vertical;\r\n    }\r\n\r\n    .form-group input[type=\"checkbox\"] {\r\n      margin-right: 8px;\r\n    }\r\n\r\n    .template-create-footer {\r\n      padding: 15px 20px;\r\n      border-top: 1px solid #e0e0e0;\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      gap: 10px;\r\n    }\r\n\r\n    .required {\r\n      color: #e74c3c;\r\n    }\r\n  `\r\n  document.head.appendChild(style)\r\n}\r\n\r\nexport default TemplatePlugin\r\nexport { getTemplateManager, TemplatePlugin }\r\n"],"names":["globalTemplateManager","getTemplateManager","TemplateManager","storage","maxCustomTemplates","enableVariables","init","catch","error","console","TemplatePlugin","createPlugin","name","config","toolbar","items","tooltip","icon","action","editor","templateManager","commands","register","execute","showTemplateDialog","template","options","replaceContent","variables","length","applyTemplate","metadata","id","content","getContent","alert","showCreateTemplateDialog","templateId","jsonStr","exportTemplate","downloadJSON","input","document","createElement","type","accept","addEventListener","e","file","target","files","reader","FileReader","onload","event","result","importTemplate","readAsText","click","keymap","on","contextMenuManager","registerItem","label","submenu","destroy","dialog","className","innerHTML","addCreateDialogStyles","body","appendChild","closeBtn","querySelector","cancelBtn","saveBtn","close","removeChild","value","trim","description","category","tagsStr","tags","split","map","t","filter","Boolean","createTemplateFromContent","author","isCustom","filename","blob","Blob","url","URL","createObjectURL","a","href","download","revokeObjectURL","getElementById","style","textContent","head"],"mappings":"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"}