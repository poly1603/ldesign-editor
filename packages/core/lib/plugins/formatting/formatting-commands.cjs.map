{"version":3,"file":"formatting-commands.cjs","sources":["../../../src/plugins/formatting/formatting-commands.ts"],"sourcesContent":["/**\r\n * 格式化命令插件\r\n * 注册所有格式化相关的命令\r\n */\r\n\r\nimport type { Plugin } from '../../types'\r\n\r\nconst FormattingCommandsPlugin: Plugin = {\r\n  name: 'FormattingCommands',\r\n  install(editor: any) {\r\n    // 对齐命令\r\n    editor.commands.register('alignLeft', () => {\r\n      document.execCommand('justifyLeft')\r\n      return true\r\n    })\r\n\r\n    editor.commands.register('alignCenter', () => {\r\n      document.execCommand('justifyCenter')\r\n      return true\r\n    })\r\n\r\n    editor.commands.register('alignRight', () => {\r\n      document.execCommand('justifyRight')\r\n      return true\r\n    })\r\n\r\n    editor.commands.register('alignJustify', () => {\r\n      document.execCommand('justifyFull')\r\n      return true\r\n    })\r\n\r\n    // 字体大小命令 - 接受参数\r\n    editor.commands.register('setFontSize', (state: any, dispatch: any, size: string) => {\r\n      const selection = window.getSelection()\r\n      if (selection && selection.rangeCount > 0) {\r\n        const span = document.createElement('span')\r\n        span.style.fontSize = size\r\n        const range = selection.getRangeAt(0)\r\n        try {\r\n          range.surroundContents(span)\r\n        }\r\n        catch (e) {\r\n          span.innerHTML = selection.toString()\r\n          range.deleteContents()\r\n          range.insertNode(span)\r\n        }\r\n      }\r\n      return true\r\n    })\r\n\r\n    // 字体命令\r\n    editor.commands.register('setFontFamily', (state: any, dispatch: any, fontFamily: string) => {\r\n      const selection = window.getSelection()\r\n      if (selection && selection.rangeCount > 0) {\r\n        const span = document.createElement('span')\r\n        span.style.fontFamily = fontFamily\r\n        const range = selection.getRangeAt(0)\r\n        try {\r\n          range.surroundContents(span)\r\n        }\r\n        catch (e) {\r\n          span.innerHTML = selection.toString()\r\n          range.deleteContents()\r\n          range.insertNode(span)\r\n        }\r\n      }\r\n      return true\r\n    })\r\n\r\n    // 文字颜色命令\r\n    editor.commands.register('setTextColor', (state: any, dispatch: any, color: string) => {\r\n      document.execCommand('foreColor', false, color)\r\n      return true\r\n    })\r\n\r\n    // 背景颜色命令\r\n    editor.commands.register('setBackgroundColor', (state: any, dispatch: any, color: string) => {\r\n      document.execCommand('hiliteColor', false, color)\r\n      return true\r\n    })\r\n\r\n    // 行高命令\r\n    editor.commands.register('setLineHeight', (state: any, dispatch: any, lineHeight: string) => {\r\n      const selection = window.getSelection()\r\n      if (selection && selection.rangeCount > 0) {\r\n        const div = document.createElement('div')\r\n        div.style.lineHeight = lineHeight\r\n        const range = selection.getRangeAt(0)\r\n        try {\r\n          range.surroundContents(div)\r\n        }\r\n        catch (e) {\r\n          div.innerHTML = selection.toString()\r\n          range.deleteContents()\r\n          range.insertNode(div)\r\n        }\r\n      }\r\n      return true\r\n    })\r\n\r\n    // 替换选中文本命令\r\n    editor.commands.register('replaceSelection', (state: any, dispatch: any, options: { text: string }) => {\r\n      const selection = window.getSelection()\r\n      if (!selection || selection.rangeCount === 0)\r\n        return false\r\n\r\n      const range = selection.getRangeAt(0)\r\n      if (!editor.contentElement?.contains(range.commonAncestorContainer))\r\n        return false\r\n\r\n      // 删除选中内容\r\n      range.deleteContents()\r\n\r\n      // 插入新文本\r\n      const textNode = document.createTextNode(options.text)\r\n      range.insertNode(textNode)\r\n\r\n      // 将光标移到插入文本之后\r\n      range.setStartAfter(textNode)\r\n      range.setEndAfter(textNode)\r\n      selection.removeAllRanges()\r\n      selection.addRange(range)\r\n\r\n      // 触发内容更新\r\n      editor.handleInput?.()\r\n\r\n      return true\r\n    })\r\n\r\n    // 插入文本命令\r\n    editor.commands.register('insertText', (state: any, dispatch: any, options: { text: string }) => {\r\n      const selection = window.getSelection()\r\n      if (!selection || selection.rangeCount === 0) {\r\n        // 如果没有选区，在编辑器末尾插入\r\n        if (editor.contentElement) {\r\n          editor.contentElement.focus()\r\n          const range = document.createRange()\r\n          range.selectNodeContents(editor.contentElement)\r\n          range.collapse(false)\r\n          selection?.removeAllRanges()\r\n          selection?.addRange(range)\r\n        }\r\n        else {\r\n          return false\r\n        }\r\n      }\r\n\r\n      const range = selection.getRangeAt(0)\r\n      if (!editor.contentElement?.contains(range.commonAncestorContainer))\r\n        return false\r\n\r\n      // 插入文本\r\n      const textNode = document.createTextNode(options.text)\r\n      range.insertNode(textNode)\r\n\r\n      // 将光标移到插入文本之后\r\n      range.setStartAfter(textNode)\r\n      range.setEndAfter(textNode)\r\n      selection.removeAllRanges()\r\n      selection.addRange(range)\r\n\r\n      // 触发内容更新\r\n      editor.handleInput?.()\r\n\r\n      return true\r\n    })\r\n\r\n    console.log('[FormattingCommandsPlugin] All formatting commands registered')\r\n  },\r\n}\r\n\r\nexport default FormattingCommandsPlugin\r\n"],"names":["FormattingCommandsPlugin","name","install","editor","commands","register","document","execCommand","state","dispatch","size","selection","window","getSelection","rangeCount","span","createElement","style","fontSize","range","getRangeAt","surroundContents","e","innerHTML","toString","deleteContents","insertNode","fontFamily","color","lineHeight","div","options","contentElement","contains","commonAncestorContainer","textNode","createTextNode","text","setStartAfter","setEndAfter","removeAllRanges","addRange","handleInput","focus","createRange","selectNodeContents","collapse","console","log"],"mappings":"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"}