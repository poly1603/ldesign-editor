{"version":3,"file":"align.cjs","sources":["../../../src/plugins/formatting/align.ts"],"sourcesContent":["/**\r\n * 对齐插件\r\n * 提供左对齐、居中、右对齐和两端对齐\r\n */\r\n\r\nimport type { Command, Plugin } from '../../types'\r\nimport { createPlugin } from '../../core/Plugin'\r\n\r\n/**\r\n * 设置对齐方式\r\n */\r\nfunction setAlign(align: 'left' | 'center' | 'right' | 'justify'): Command {\r\n  return (state, dispatch) => {\r\n    if (!dispatch)\r\n      return true\r\n\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return false\r\n\r\n    // 查找当前块级元素\r\n    let node = selection.anchorNode\r\n    let block: HTMLElement | null = null\r\n\r\n    while (node && node !== document.body) {\r\n      if (node instanceof HTMLElement && getComputedStyle(node).display === 'block') {\r\n        block = node\r\n        break\r\n      }\r\n      node = node.parentNode\r\n    }\r\n\r\n    if (block) {\r\n      block.style.textAlign = align\r\n      return true\r\n    }\r\n\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * 检查对齐方式\r\n */\r\nfunction isAlignActive(align: string) {\r\n  return () => {\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return false\r\n\r\n    let node = selection.anchorNode\r\n    let block: HTMLElement | null = null\r\n\r\n    while (node && node !== document.body) {\r\n      if (node instanceof HTMLElement && getComputedStyle(node).display === 'block') {\r\n        block = node\r\n        break\r\n      }\r\n      node = node.parentNode\r\n    }\r\n\r\n    return block?.style.textAlign === align\r\n  }\r\n}\r\n\r\n/**\r\n * 对齐插件\r\n */\r\nexport const AlignPlugin: Plugin = createPlugin({\r\n  name: 'align',\r\n  commands: {\r\n    alignLeft: setAlign('left'),\r\n    alignCenter: setAlign('center'),\r\n    alignRight: setAlign('right'),\r\n    alignJustify: setAlign('justify'),\r\n  },\r\n  keys: {\r\n    'Mod-Shift-L': setAlign('left'),\r\n    'Mod-Shift-E': setAlign('center'),\r\n    'Mod-Shift-R': setAlign('right'),\r\n    'Mod-Shift-J': setAlign('justify'),\r\n  },\r\n  toolbar: [\r\n    {\r\n      name: 'alignLeft',\r\n      title: '左对齐',\r\n      icon: 'align-left',\r\n      command: setAlign('left'),\r\n      active: isAlignActive('left'),\r\n    },\r\n    {\r\n      name: 'alignCenter',\r\n      title: '居中',\r\n      icon: 'align-center',\r\n      command: setAlign('center'),\r\n      active: isAlignActive('center'),\r\n    },\r\n    {\r\n      name: 'alignRight',\r\n      title: '右对齐',\r\n      icon: 'align-right',\r\n      command: setAlign('right'),\r\n      active: isAlignActive('right'),\r\n    },\r\n    {\r\n      name: 'alignJustify',\r\n      title: '两端对齐',\r\n      icon: 'align-justify',\r\n      command: setAlign('justify'),\r\n      active: isAlignActive('justify'),\r\n    },\r\n  ],\r\n})\r\n"],"names":["setAlign","align","state","dispatch","selection","window","getSelection","rangeCount","node","anchorNode","block","document","body","HTMLElement","getComputedStyle","display","parentNode","style","textAlign","isAlignActive","AlignPlugin","createPlugin","name","commands","alignLeft","alignCenter","alignRight","alignJustify","keys","toolbar","title","icon","command","active"],"mappings":"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"}