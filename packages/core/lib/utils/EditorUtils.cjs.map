{"version":3,"file":"EditorUtils.cjs","sources":["../../src/utils/EditorUtils.ts"],"sourcesContent":["/**\r\n * 编辑器工具函数集合\r\n * 统一管理常用的编辑器操作，避免重复代码\r\n */\r\n\r\n/**\r\n * 执行编辑器命令\r\n */\r\nexport function execCommand(command: string, value?: string): boolean {\r\n  try {\r\n    return document.execCommand(command, false, value)\r\n  }\r\n  catch (e) {\r\n    console.error(`[EditorUtils] execCommand '${command}' failed:`, e)\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * 获取当前选区\r\n */\r\nexport function getSelection(): Selection | null {\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0)\r\n    return null\r\n\r\n  return selection\r\n}\r\n\r\n/**\r\n * 获取选中的文本\r\n */\r\nexport function getSelectedText(): string {\r\n  const selection = getSelection()\r\n  return selection ? selection.toString() : ''\r\n}\r\n\r\n/**\r\n * 保存当前选区\r\n */\r\nexport function saveRange(): Range | null {\r\n  const selection = getSelection()\r\n  if (selection && selection.rangeCount > 0)\r\n    return selection.getRangeAt(0).cloneRange()\r\n\r\n  return null\r\n}\r\n\r\n/**\r\n * 恢复选区\r\n */\r\nexport function restoreRange(range: Range): boolean {\r\n  if (!range)\r\n    return false\r\n\r\n  try {\r\n    const selection = window.getSelection()\r\n    if (selection) {\r\n      selection.removeAllRanges()\r\n      selection.addRange(range)\r\n      return true\r\n    }\r\n  }\r\n  catch (e) {\r\n    console.error('[EditorUtils] restoreRange failed:', e)\r\n  }\r\n  return false\r\n}\r\n\r\n/**\r\n * 替换选中的文本\r\n */\r\nexport function replaceSelection(text: string, range?: Range | null): boolean {\r\n  // 如果提供了range，先恢复它\r\n  if (range)\r\n    restoreRange(range)\r\n\r\n  // 尝试使用execCommand\r\n  if (execCommand('insertText', text))\r\n    return true\r\n\r\n  // 备用方法：手动替换\r\n  const selection = getSelection()\r\n  if (selection && selection.rangeCount > 0) {\r\n    const currentRange = selection.getRangeAt(0)\r\n    currentRange.deleteContents()\r\n    const textNode = document.createTextNode(text)\r\n    currentRange.insertNode(textNode)\r\n\r\n    // 移动光标到插入文本之后\r\n    currentRange.setStartAfter(textNode)\r\n    currentRange.setEndAfter(textNode)\r\n    selection.removeAllRanges()\r\n    selection.addRange(currentRange)\r\n    return true\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * 在光标位置插入文本\r\n */\r\nexport function insertText(text: string, container?: HTMLElement): boolean {\r\n  const selection = getSelection()\r\n\r\n  // 如果没有选区且提供了容器，在容器末尾创建选区\r\n  if (!selection && container) {\r\n    container.focus()\r\n    const range = document.createRange()\r\n    range.selectNodeContents(container)\r\n    range.collapse(false)\r\n    const newSelection = window.getSelection()\r\n    newSelection?.removeAllRanges()\r\n    newSelection?.addRange(range)\r\n  }\r\n\r\n  return replaceSelection(text)\r\n}\r\n\r\n/**\r\n * 应用样式到选中文本\r\n */\r\nexport function applyStyle(style: string, value?: string): boolean {\r\n  switch (style) {\r\n    case 'bold':\r\n      return execCommand('bold')\r\n    case 'italic':\r\n      return execCommand('italic')\r\n    case 'underline':\r\n      return execCommand('underline')\r\n    case 'strike':\r\n      return execCommand('strikeThrough')\r\n    case 'color':\r\n      return execCommand('foreColor', value)\r\n    case 'background':\r\n      return execCommand('hiliteColor', value)\r\n    case 'fontSize':\r\n      return execCommand('fontSize', value)\r\n    case 'fontFamily':\r\n      return execCommand('fontName', value)\r\n    default:\r\n      return false\r\n  }\r\n}\r\n\r\n/**\r\n * 格式化文本对齐\r\n */\r\nexport function setAlignment(align: 'left' | 'center' | 'right' | 'justify'): boolean {\r\n  const commands = {\r\n    left: 'justifyLeft',\r\n    center: 'justifyCenter',\r\n    right: 'justifyRight',\r\n    justify: 'justifyFull',\r\n  }\r\n  return execCommand(commands[align])\r\n}\r\n\r\n/**\r\n * 插入HTML内容\r\n */\r\nexport function insertHTML(html: string): boolean {\r\n  return execCommand('insertHTML', html)\r\n}\r\n\r\n/**\r\n * 清除格式\r\n */\r\nexport function clearFormat(): boolean {\r\n  return execCommand('removeFormat')\r\n}\r\n\r\n/**\r\n * 撤销/重做\r\n */\r\nexport function undo(): boolean {\r\n  return execCommand('undo')\r\n}\r\n\r\nexport function redo(): boolean {\r\n  return execCommand('redo')\r\n}\r\n\r\n/**\r\n * 缩进操作\r\n */\r\nexport function indent(): boolean {\r\n  return execCommand('indent')\r\n}\r\n\r\nexport function outdent(): boolean {\r\n  return execCommand('outdent')\r\n}\r\n"],"names":["execCommand","command","value","document","e","console","error","getSelection","selection","window","rangeCount","getSelectedText","toString","saveRange","getRangeAt","cloneRange","restoreRange","range","removeAllRanges","addRange","replaceSelection","text","currentRange","deleteContents","textNode","createTextNode","insertNode","setStartAfter","setEndAfter"],"mappings":";;;;;;;;;;;AAQO,SAASA,WAAAA,CAAYC,SAAiBC,KAAAA,EAAyB;AACpE,EAAA,IAAI;AACF,IAAA,OAAOC,QAAAA,CAASH,WAAAA,CAAYC,OAAAA,EAAS,KAAA,EAAOC,KAAK,CAAA;AAAA,EACnD,SACOE,CAAAA,EAAG;AACRC,IAAAA,OAAAA,CAAQC,KAAAA,CAAM,CAAA,2BAAA,EAA8BL,OAAO,CAAA,SAAA,CAAA,EAAaG,CAAC,CAAA;AACjE,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKO,SAASG,YAAAA,GAAiC;AAC/C,EAAA,MAAMC,SAAAA,GAAYC,OAAOF,YAAAA,EAAa;AACtC,EAAA,IAAI,CAACC,SAAAA,IAAaA,SAAAA,CAAUE,UAAAA,KAAe,CAAA;AACzC,IAAA,OAAO,IAAA;AAET,EAAA,OAAOF,SAAAA;AACT;AAKO,SAASG,eAAAA,GAA0B;AACxC,EAAA,MAAMH,YAAYD,YAAAA,EAAa;AAC/B,EAAA,OAAOC,SAAAA,GAAYA,SAAAA,CAAUI,QAAAA,EAAS,GAAI,EAAA;AAC5C;AAKO,SAASC,SAAAA,GAA0B;AACxC,EAAA,MAAML,YAAYD,YAAAA,EAAa;AAC/B,EAAA,IAAIC,SAAAA,IAAaA,UAAUE,UAAAA,GAAa,CAAA;AACtC,IAAA,OAAOF,SAAAA,CAAUM,UAAAA,CAAW,CAAC,CAAA,CAAEC,UAAAA,EAAW;AAE5C,EAAA,OAAO,IAAA;AACT;AAKO,SAASC,aAAaC,KAAAA,EAAuB;AAClD,EAAA,IAAI,CAACA,KAAAA;AACH,IAAA,OAAO,KAAA;AAET,EAAA,IAAI;AACF,IAAA,MAAMT,SAAAA,GAAYC,OAAOF,YAAAA,EAAa;AACtC,IAAA,IAAIC,SAAAA,EAAW;AACbA,MAAAA,SAAAA,CAAUU,eAAAA,EAAgB;AAC1BV,MAAAA,SAAAA,CAAUW,SAASF,KAAK,CAAA;AACxB,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF,SACOb,CAAAA,EAAG;AACRC,IAAAA,OAAAA,CAAQC,KAAAA,CAAM,sCAAsCF,CAAC,CAAA;AAAA,EACvD;AACA,EAAA,OAAO,KAAA;AACT;AAKO,SAASgB,gBAAAA,CAAiBC,MAAcJ,KAAAA,EAA+B;AAE5E,EAAA,IAAIA,KAAAA;AACFD,IAAAA,YAAAA,CAAaC,KAAK,CAAA;AAGpB,EAAA,IAAIjB,WAAAA,CAAY,cAAcqB,IAAI,CAAA;AAChC,IAAA,OAAO,IAAA;AAGT,EAAA,MAAMb,YAAYD,YAAAA,EAAa;AAC/B,EAAA,IAAIC,SAAAA,IAAaA,SAAAA,CAAUE,UAAAA,GAAa,CAAA,EAAG;AACzC,IAAA,MAAMY,YAAAA,GAAed,SAAAA,CAAUM,UAAAA,CAAW,CAAC,CAAA;AAC3CQ,IAAAA,YAAAA,CAAaC,cAAAA,EAAe;AAC5B,IAAA,MAAMC,QAAAA,GAAWrB,QAAAA,CAASsB,cAAAA,CAAeJ,IAAI,CAAA;AAC7CC,IAAAA,YAAAA,CAAaI,WAAWF,QAAQ,CAAA;AAGhCF,IAAAA,YAAAA,CAAaK,cAAcH,QAAQ,CAAA;AACnCF,IAAAA,YAAAA,CAAaM,YAAYJ,QAAQ,CAAA;AACjChB,IAAAA,SAAAA,CAAUU,eAAAA,EAAgB;AAC1BV,IAAAA,SAAAA,CAAUW,SAASG,YAAY,CAAA;AAC/B,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,OAAO,KAAA;AACT;;;;;;;;;;;;"}