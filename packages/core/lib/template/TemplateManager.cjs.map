{"version":3,"file":"TemplateManager.cjs","sources":["../../src/template/TemplateManager.ts"],"sourcesContent":["/**\r\n * 模板管理器\r\n * 负责模板的存储、检索和应用\r\n */\r\n\r\nimport type {\r\n  ApplyTemplateOptions,\r\n  Template,\r\n  TemplateCategory,\r\n  TemplateManagerConfig,\r\n  TemplateMetadata,\r\n  TemplateStorage,\r\n} from './types'\r\nimport { EventEmitter } from '../core/EventEmitter'\r\nimport { LocalTemplateStorage } from './storage/LocalTemplateStorage'\r\nimport { builtinTemplates } from './templates'\r\n\r\nexport class TemplateManager extends EventEmitter {\r\n  private storage: TemplateStorage\r\n  private templates: Map<string, Template> = new Map()\r\n  private config: TemplateManagerConfig\r\n  private initialized: boolean = false\r\n\r\n  constructor(config: TemplateManagerConfig = {}) {\r\n    super()\r\n    this.config = {\r\n      storage: 'local',\r\n      maxCustomTemplates: 50,\r\n      enableVariables: true,\r\n      ...config,\r\n    }\r\n\r\n    // 初始化存储\r\n    if (config.customStorage)\r\n      this.storage = config.customStorage\r\n    else\r\n      this.storage = new LocalTemplateStorage()\r\n  }\r\n\r\n  /**\r\n   * 初始化模板管理器\r\n   */\r\n  async init(): Promise<void> {\r\n    if (this.initialized)\r\n      return\r\n\r\n    try {\r\n      // 加载内置模板\r\n      if (this.config.builtinTemplates) {\r\n        this.config.builtinTemplates.forEach((template) => {\r\n          this.templates.set(template.metadata.id, template)\r\n        })\r\n      }\r\n      else {\r\n        // 加载默认内置模板\r\n        builtinTemplates.forEach((template) => {\r\n          this.templates.set(template.metadata.id, template)\r\n        })\r\n      }\r\n\r\n      // 加载用户自定义模板\r\n      const customTemplates = await this.storage.getAll()\r\n      customTemplates.forEach((template) => {\r\n        this.templates.set(template.metadata.id, template)\r\n      })\r\n\r\n      this.initialized = true\r\n      this.emit('initialized')\r\n    }\r\n    catch (error) {\r\n      console.error('Failed to initialize template manager:', error)\r\n      this.emit('error', error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有模板\r\n   */\r\n  async getAllTemplates(): Promise<Template[]> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n    return Array.from(this.templates.values())\r\n  }\r\n\r\n  /**\r\n   * 根据ID获取模板\r\n   */\r\n  async getTemplate(id: string): Promise<Template | null> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n    return this.templates.get(id) || null\r\n  }\r\n\r\n  /**\r\n   * 根据分类获取模板\r\n   */\r\n  async getTemplatesByCategory(category: TemplateCategory): Promise<Template[]> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n    return Array.from(this.templates.values()).filter(\r\n      template => template.metadata.category === category,\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 搜索模板\r\n   */\r\n  async searchTemplates(query: string): Promise<Template[]> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n    const lowerQuery = query.toLowerCase()\r\n\r\n    return Array.from(this.templates.values()).filter((template) => {\r\n      const metadata = template.metadata\r\n      return (\r\n        metadata.name.toLowerCase().includes(lowerQuery)\r\n        || metadata.description?.toLowerCase().includes(lowerQuery)\r\n        || metadata.tags?.some(tag => tag.toLowerCase().includes(lowerQuery))\r\n      )\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 保存自定义模板\r\n   */\r\n  async saveCustomTemplate(template: Template): Promise<void> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n\r\n    // 检查自定义模板数量限制\r\n    const customTemplates = Array.from(this.templates.values()).filter(\r\n      t => t.metadata.isCustom,\r\n    )\r\n\r\n    if (customTemplates.length >= (this.config.maxCustomTemplates || 50))\r\n      throw new Error(`Maximum custom templates limit (${this.config.maxCustomTemplates}) reached`)\r\n\r\n    // 设置为自定义模板\r\n    template.metadata.isCustom = true\r\n    template.metadata.createdAt = new Date()\r\n    template.metadata.updatedAt = new Date()\r\n\r\n    // 保存到存储\r\n    await this.storage.save(template)\r\n\r\n    // 添加到内存缓存\r\n    this.templates.set(template.metadata.id, template)\r\n\r\n    this.emit('template:saved', template)\r\n  }\r\n\r\n  /**\r\n   * 更新模板\r\n   */\r\n  async updateTemplate(id: string, updates: Partial<Template>): Promise<void> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n\r\n    const template = this.templates.get(id)\r\n    if (!template)\r\n      throw new Error(`Template with id ${id} not found`)\r\n\r\n    // 不允许更新内置模板\r\n    if (template.metadata.isBuiltin)\r\n      throw new Error('Cannot update builtin templates')\r\n\r\n    // 更新模板\r\n    const updatedTemplate = {\r\n      ...template,\r\n      ...updates,\r\n      metadata: {\r\n        ...template.metadata,\r\n        ...updates.metadata,\r\n        updatedAt: new Date(),\r\n      },\r\n    }\r\n\r\n    // 保存到存储\r\n    await this.storage.update(id, updatedTemplate)\r\n\r\n    // 更新内存缓存\r\n    this.templates.set(id, updatedTemplate)\r\n\r\n    this.emit('template:updated', updatedTemplate)\r\n  }\r\n\r\n  /**\r\n   * 删除自定义模板\r\n   */\r\n  async deleteTemplate(id: string): Promise<void> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n\r\n    const template = this.templates.get(id)\r\n    if (!template)\r\n      throw new Error(`Template with id ${id} not found`)\r\n\r\n    // 不允许删除内置模板\r\n    if (template.metadata.isBuiltin)\r\n      throw new Error('Cannot delete builtin templates')\r\n\r\n    // 从存储中删除\r\n    await this.storage.delete(id)\r\n\r\n    // 从内存缓存中删除\r\n    this.templates.delete(id)\r\n\r\n    this.emit('template:deleted', id)\r\n  }\r\n\r\n  /**\r\n   * 应用模板到编辑器\r\n   */\r\n  async applyTemplate(\r\n    editor: any,\r\n    templateId: string,\r\n    options: ApplyTemplateOptions = {},\r\n  ): Promise<void> {\r\n    if (!this.initialized)\r\n      await this.init()\r\n\r\n    const template = this.templates.get(templateId)\r\n    if (!template)\r\n      throw new Error(`Template with id ${templateId} not found`)\r\n\r\n    let content = template.content\r\n\r\n    // 处理变量替换\r\n    if (this.config.enableVariables && template.variables && options.variables)\r\n      content = this.replaceVariables(content, options.variables)\r\n\r\n    // 应用样式\r\n    if (template.styles && !options.preserveStyles)\r\n      this.applyStyles(editor, template.styles)\r\n\r\n    // 应用内容\r\n    if (options.replaceContent !== false) {\r\n      editor.setContent(content)\r\n    }\r\n    else {\r\n      // 插入到当前位置\r\n      editor.insertContent(content)\r\n    }\r\n\r\n    this.emit('template:applied', {\r\n      template,\r\n      options,\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 替换模板变量\r\n   */\r\n  private replaceVariables(content: string, variables: Record<string, any>): string {\r\n    let result = content\r\n\r\n    Object.entries(variables).forEach(([key, value]) => {\r\n      const regex = new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g')\r\n      result = result.replace(regex, String(value))\r\n    })\r\n\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 应用样式到编辑器\r\n   */\r\n  private applyStyles(editor: any, styles: string): void {\r\n    // 创建或更新样式标签\r\n    const styleId = 'template-styles'\r\n    let styleEl = document.getElementById(styleId) as HTMLStyleElement\r\n\r\n    if (!styleEl) {\r\n      styleEl = document.createElement('style')\r\n      styleEl.id = styleId\r\n      document.head.appendChild(styleEl)\r\n    }\r\n\r\n    styleEl.textContent = styles\r\n  }\r\n\r\n  /**\r\n   * 从当前编辑器内容创建模板\r\n   */\r\n  async createTemplateFromContent(\r\n    editor: any,\r\n    metadata: TemplateMetadata,\r\n  ): Promise<Template> {\r\n    const content = editor.getContent()\r\n\r\n    const template: Template = {\r\n      metadata: {\r\n        ...metadata,\r\n        id: metadata.id || this.generateTemplateId(),\r\n        isCustom: true,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n      },\r\n      content,\r\n      variables: this.extractVariables(content),\r\n    }\r\n\r\n    await this.saveCustomTemplate(template)\r\n    return template\r\n  }\r\n\r\n  /**\r\n   * 提取内容中的变量\r\n   */\r\n  private extractVariables(content: string): any[] {\r\n    const variables: any[] = []\r\n    const regex = /\\{\\{(\\w+)\\}\\}/g\r\n    const matches = new Set<string>()\r\n\r\n    let match\r\n    while ((match = regex.exec(content)) !== null)\r\n      matches.add(match[1])\r\n\r\n    matches.forEach((key) => {\r\n      variables.push({\r\n        key,\r\n        label: key.charAt(0).toUpperCase() + key.slice(1),\r\n        type: 'text',\r\n        defaultValue: '',\r\n      })\r\n    })\r\n\r\n    return variables\r\n  }\r\n\r\n  /**\r\n   * 生成模板ID\r\n   */\r\n  private generateTemplateId(): string {\r\n    return `template-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n  }\r\n\r\n  /**\r\n   * 导出模板\r\n   */\r\n  async exportTemplate(id: string): Promise<string> {\r\n    const template = await this.getTemplate(id)\r\n    if (!template)\r\n      throw new Error(`Template with id ${id} not found`)\r\n\r\n    return JSON.stringify(template, null, 2)\r\n  }\r\n\r\n  /**\r\n   * 导入模板\r\n   */\r\n  async importTemplate(jsonStr: string): Promise<void> {\r\n    try {\r\n      const template = JSON.parse(jsonStr) as Template\r\n\r\n      // 生成新ID避免冲突\r\n      template.metadata.id = this.generateTemplateId()\r\n      template.metadata.isCustom = true\r\n      template.metadata.isBuiltin = false\r\n\r\n      await this.saveCustomTemplate(template)\r\n    }\r\n    catch (error) {\r\n      throw new Error(`Failed to import template: ${error}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 清理资源\r\n   */\r\n  destroy(): void {\r\n    this.templates.clear()\r\n    this.removeAllListeners()\r\n    this.initialized = false\r\n  }\r\n}\r\n"],"names":["TemplateManager","EventEmitter","constructor","config","templates","Map","initialized","storage","maxCustomTemplates","enableVariables","customStorage","LocalTemplateStorage","init","builtinTemplates","forEach","template","set","metadata","id","customTemplates","getAll","emit","error","console","getAllTemplates","Array","from","values","getTemplate","get","getTemplatesByCategory","category","filter","searchTemplates","query","lowerQuery","toLowerCase","name","includes","description","tags","some","tag","saveCustomTemplate","t","isCustom","length","Error","createdAt","Date","updatedAt","save","updateTemplate","updates","isBuiltin","updatedTemplate","update","deleteTemplate","delete","applyTemplate","editor","templateId","options","content","variables","replaceVariables","styles","preserveStyles","applyStyles","replaceContent","setContent","insertContent","result","Object","entries","key","value","regex","RegExp","replace","String","styleId","styleEl","document","getElementById","createElement","head","appendChild","textContent","createTemplateFromContent","getContent","generateTemplateId","extractVariables","matches","Set","match","exec","add","push","label","charAt","toUpperCase","slice","type","defaultValue","now","Math","random","toString","substr","exportTemplate","JSON","stringify","importTemplate","jsonStr","parse","destroy","clear","removeAllListeners"],"mappings":"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"}