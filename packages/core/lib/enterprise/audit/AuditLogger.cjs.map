{"version":3,"file":"AuditLogger.cjs","sources":["../../../src/enterprise/audit/AuditLogger.ts"],"sourcesContent":["/**\r\n * 审计日志系统\r\n * 记录所有编辑器操作，支持合规性审计\r\n */\r\n\r\nimport type { AuditConfig, AuditEvents, AuditLog, AuditQuery, AuditReport } from './types'\r\nimport { EventEmitter } from '../../core/EventEmitter'\r\nimport { createLogger } from '../../utils/logger'\r\n\r\nconst logger = createLogger('AuditLogger')\r\n\r\nexport class AuditLogger extends EventEmitter<AuditEvents> {\r\n  private config: Required<AuditConfig>\r\n  private logs: AuditLog[] = []\r\n  private db?: IDBDatabase\r\n  private maxLogs = 10000\r\n  private batchSize = 50\r\n  private batchTimer?: number\r\n  private pendingLogs: AuditLog[] = []\r\n\r\n  constructor(config: AuditConfig = {}) {\r\n    super()\r\n    this.config = {\r\n      enabled: true,\r\n      storage: 'indexeddb',\r\n      maxLogs: 10000,\r\n      batchSize: 50,\r\n      batchDelay: 1000,\r\n      persistToDisk: true,\r\n      serverSync: false,\r\n      serverUrl: '',\r\n      includeContent: true,\r\n      anonymize: false,\r\n      ...config,\r\n    }\r\n\r\n    this.maxLogs = this.config.maxLogs\r\n    this.batchSize = this.config.batchSize\r\n  }\r\n\r\n  /**\r\n   * 初始化\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (!this.config.enabled) {\r\n      logger.info('Audit logging is disabled')\r\n      return\r\n    }\r\n\r\n    logger.info('Initializing audit logger')\r\n\r\n    if (this.config.storage === 'indexeddb') {\r\n      await this.initDB()\r\n      await this.loadLogs()\r\n    }\r\n\r\n    logger.info('Audit logger initialized')\r\n  }\r\n\r\n  /**\r\n   * 初始化数据库\r\n   */\r\n  private async initDB(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open('ldesign-audit', 1)\r\n\r\n      request.onerror = () => reject(request.error)\r\n      request.onsuccess = () => {\r\n        this.db = request.result\r\n        resolve()\r\n      }\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result\r\n\r\n        if (!db.objectStoreNames.contains('logs')) {\r\n          const store = db.createObjectStore('logs', { keyPath: 'id' })\r\n          store.createIndex('userId', 'userId', { unique: false })\r\n          store.createIndex('action', 'action', { unique: false })\r\n          store.createIndex('timestamp', 'timestamp', { unique: false })\r\n          store.createIndex('resource', 'resource', { unique: false })\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 加载日志\r\n   */\r\n  private async loadLogs(): Promise<void> {\r\n    if (!this.db)\r\n      return\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction(['logs'], 'readonly')\r\n      const store = transaction.objectStore('logs')\r\n      const index = store.index('timestamp')\r\n\r\n      // 获取最近的日志\r\n      const request = index.openCursor(null, 'prev')\r\n      const logs: AuditLog[] = []\r\n      let count = 0\r\n\r\n      request.onsuccess = (event) => {\r\n        const cursor = (event.target as IDBRequest).result\r\n\r\n        if (cursor && count < 1000) {\r\n          logs.push(cursor.value)\r\n          count++\r\n          cursor.continue()\r\n        }\r\n        else {\r\n          this.logs = logs.reverse()\r\n          logger.info(`Loaded ${this.logs.length} audit logs`)\r\n          resolve()\r\n        }\r\n      }\r\n\r\n      request.onerror = () => reject(request.error)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 记录日志\r\n   */\r\n  log(log: Omit<AuditLog, 'id' | 'timestamp'>): void {\r\n    if (!this.config.enabled)\r\n      return\r\n\r\n    const auditLog: AuditLog = {\r\n      ...log,\r\n      id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      timestamp: Date.now(),\r\n    }\r\n\r\n    // 匿名化处理\r\n    if (this.config.anonymize) {\r\n      auditLog.userId = this.hashUserId(auditLog.userId)\r\n      if (auditLog.metadata?.ip)\r\n        auditLog.metadata.ip = this.hashIP(auditLog.metadata.ip)\r\n    }\r\n\r\n    // 添加到内存\r\n    this.logs.push(auditLog)\r\n\r\n    // 限制内存中的日志数量\r\n    if (this.logs.length > this.maxLogs)\r\n      this.logs.shift()\r\n\r\n    // 批量持久化\r\n    if (this.config.persistToDisk) {\r\n      this.pendingLogs.push(auditLog)\r\n      this.scheduleBatchSave()\r\n    }\r\n\r\n    // 触发事件\r\n    this.emit('log-created', auditLog)\r\n\r\n    logger.debug(`Audit log: ${log.action} by ${log.userId}`)\r\n  }\r\n\r\n  /**\r\n   * 批量保存\r\n   */\r\n  private scheduleBatchSave(): void {\r\n    if (this.batchTimer)\r\n      clearTimeout(this.batchTimer)\r\n\r\n    if (this.pendingLogs.length >= this.batchSize) {\r\n      this.saveBatch()\r\n    }\r\n    else {\r\n      this.batchTimer = window.setTimeout(() => {\r\n        this.saveBatch()\r\n      }, this.config.batchDelay)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 保存批次\r\n   */\r\n  private async saveBatch(): Promise<void> {\r\n    if (this.pendingLogs.length === 0)\r\n      return\r\n\r\n    const logsToSave = [...this.pendingLogs]\r\n    this.pendingLogs = []\r\n\r\n    // 保存到IndexedDB\r\n    if (this.db)\r\n      await this.saveToIndexedDB(logsToSave)\r\n\r\n    // 同步到服务器\r\n    if (this.config.serverSync && this.config.serverUrl)\r\n      await this.syncToServer(logsToSave)\r\n  }\r\n\r\n  /**\r\n   * 保存到IndexedDB\r\n   */\r\n  private async saveToIndexedDB(logs: AuditLog[]): Promise<void> {\r\n    if (!this.db)\r\n      return\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction(['logs'], 'readwrite')\r\n      const store = transaction.objectStore('logs')\r\n\r\n      logs.forEach(log => store.add(log))\r\n\r\n      transaction.oncomplete = () => {\r\n        logger.debug(`Saved ${logs.length} audit logs to IndexedDB`)\r\n        resolve()\r\n      }\r\n\r\n      transaction.onerror = () => reject(transaction.error)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 同步到服务器\r\n   */\r\n  private async syncToServer(logs: AuditLog[]): Promise<void> {\r\n    try {\r\n      const response = await fetch(this.config.serverUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ logs }),\r\n      })\r\n\r\n      if (!response.ok)\r\n        throw new Error(`Server sync failed: ${response.statusText}`)\r\n\r\n      logger.debug(`Synced ${logs.length} audit logs to server`)\r\n    }\r\n    catch (error) {\r\n      logger.error('Failed to sync audit logs:', error)\r\n      this.emit('sync-error', error as Error)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查询日志\r\n   */\r\n  async query(query: AuditQuery): Promise<AuditLog[]> {\r\n    let results = [...this.logs]\r\n\r\n    // 用户过滤\r\n    if (query.userId)\r\n      results = results.filter(log => log.userId === query.userId)\r\n\r\n    // 操作过滤\r\n    if (query.action)\r\n      results = results.filter(log => log.action === query.action)\r\n\r\n    // 资源过滤\r\n    if (query.resource)\r\n      results = results.filter(log => log.resource === query.resource)\r\n\r\n    // 时间范围过滤\r\n    if (query.startTime)\r\n      results = results.filter(log => log.timestamp >= query.startTime!)\r\n\r\n    if (query.endTime)\r\n      results = results.filter(log => log.timestamp <= query.endTime!)\r\n\r\n    // 排序\r\n    results.sort((a, b) => {\r\n      const field = query.sortBy || 'timestamp'\r\n      const order = query.sortOrder === 'asc' ? 1 : -1\r\n      return (a[field] > b[field] ? 1 : -1) * order\r\n    })\r\n\r\n    // 分页\r\n    if (query.limit) {\r\n      const offset = query.offset || 0\r\n      results = results.slice(offset, offset + query.limit)\r\n    }\r\n\r\n    return results\r\n  }\r\n\r\n  /**\r\n   * 生成报告\r\n   */\r\n  async generateReport(options: {\r\n    startTime?: number\r\n    endTime?: number\r\n    groupBy?: 'user' | 'action' | 'resource' | 'day'\r\n  }): Promise<AuditReport> {\r\n    const logs = await this.query({\r\n      startTime: options.startTime,\r\n      endTime: options.endTime,\r\n    })\r\n\r\n    const report: AuditReport = {\r\n      totalLogs: logs.length,\r\n      timeRange: {\r\n        start: options.startTime || logs[0]?.timestamp || Date.now(),\r\n        end: options.endTime || logs[logs.length - 1]?.timestamp || Date.now(),\r\n      },\r\n      statistics: this.calculateStatistics(logs),\r\n      groupedData: this.groupLogs(logs, options.groupBy || 'action'),\r\n      generatedAt: Date.now(),\r\n    }\r\n\r\n    return report\r\n  }\r\n\r\n  /**\r\n   * 计算统计信息\r\n   */\r\n  private calculateStatistics(logs: AuditLog[]): any {\r\n    const stats = {\r\n      totalActions: logs.length,\r\n      uniqueUsers: new Set(logs.map(l => l.userId)).size,\r\n      actionCounts: {} as Record<string, number>,\r\n      resourceCounts: {} as Record<string, number>,\r\n      peakHours: this.calculatePeakHours(logs),\r\n    }\r\n\r\n    logs.forEach((log) => {\r\n      stats.actionCounts[log.action] = (stats.actionCounts[log.action] || 0) + 1\r\n      if (log.resource)\r\n        stats.resourceCounts[log.resource] = (stats.resourceCounts[log.resource] || 0) + 1\r\n    })\r\n\r\n    return stats\r\n  }\r\n\r\n  /**\r\n   * 计算高峰时段\r\n   */\r\n  private calculatePeakHours(logs: AuditLog[]): number[] {\r\n    const hourCounts: Record<number, number> = {}\r\n\r\n    logs.forEach((log) => {\r\n      const hour = new Date(log.timestamp).getHours()\r\n      hourCounts[hour] = (hourCounts[hour] || 0) + 1\r\n    })\r\n\r\n    return Object.entries(hourCounts)\r\n      .sort((a, b) => b[1] - a[1])\r\n      .slice(0, 3)\r\n      .map(([hour]) => Number(hour))\r\n  }\r\n\r\n  /**\r\n   * 分组日志\r\n   */\r\n  private groupLogs(logs: AuditLog[], groupBy: string): Record<string, AuditLog[]> {\r\n    const grouped: Record<string, AuditLog[]> = {}\r\n\r\n    logs.forEach((log) => {\r\n      let key: string\r\n\r\n      switch (groupBy) {\r\n        case 'user':\r\n          key = log.userId\r\n          break\r\n        case 'action':\r\n          key = log.action\r\n          break\r\n        case 'resource':\r\n          key = log.resource || 'unknown'\r\n          break\r\n        case 'day':\r\n          key = new Date(log.timestamp).toISOString().split('T')[0]\r\n          break\r\n        default:\r\n          key = 'all'\r\n      }\r\n\r\n      if (!grouped[key])\r\n        grouped[key] = []\r\n\r\n      grouped[key].push(log)\r\n    })\r\n\r\n    return grouped\r\n  }\r\n\r\n  /**\r\n   * 导出日志\r\n   */\r\n  async export(format: 'json' | 'csv' | 'pdf' = 'json'): Promise<Blob> {\r\n    const logs = this.logs\r\n\r\n    switch (format) {\r\n      case 'json':\r\n        return new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' })\r\n\r\n      case 'csv':\r\n        return this.exportCSV(logs)\r\n\r\n      case 'pdf':\r\n        // PDF导出需要额外的库，这里简化处理\r\n        return new Blob([this.generateTextReport(logs)], { type: 'text/plain' })\r\n\r\n      default:\r\n        throw new Error(`Unsupported format: ${format}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 导出为CSV\r\n   */\r\n  private exportCSV(logs: AuditLog[]): Blob {\r\n    const headers = ['ID', '时间', '用户', '操作', '资源', '结果', 'IP地址']\r\n    const rows = logs.map(log => [\r\n      log.id,\r\n      new Date(log.timestamp).toISOString(),\r\n      log.userId,\r\n      log.action,\r\n      log.resource || '',\r\n      log.result || '',\r\n      log.metadata?.ip || '',\r\n    ])\r\n\r\n    const csv = [\r\n      headers.join(','),\r\n      ...rows.map(row => row.map(cell => `\"${cell}\"`).join(',')),\r\n    ].join('\\n')\r\n\r\n    return new Blob([csv], { type: 'text/csv' })\r\n  }\r\n\r\n  /**\r\n   * 生成文本报告\r\n   */\r\n  private generateTextReport(logs: AuditLog[]): string {\r\n    const report = [\r\n      '审计日志报告',\r\n      '='.repeat(50),\r\n      `生成时间: ${new Date().toLocaleString()}`,\r\n      `日志数量: ${logs.length}`,\r\n      '',\r\n      '详细记录:',\r\n      '-'.repeat(50),\r\n    ]\r\n\r\n    logs.forEach((log) => {\r\n      report.push(`[${new Date(log.timestamp).toLocaleString()}] ${log.userId} ${log.action} ${log.resource || ''}`)\r\n      if (log.metadata)\r\n        report.push(`  元数据: ${JSON.stringify(log.metadata)}`)\r\n\r\n      report.push('')\r\n    })\r\n\r\n    return report.join('\\n')\r\n  }\r\n\r\n  /**\r\n   * 清空日志\r\n   */\r\n  async clear(): Promise<void> {\r\n    this.logs = []\r\n\r\n    if (this.db) {\r\n      await new Promise<void>((resolve, reject) => {\r\n        const transaction = this.db!.transaction(['logs'], 'readwrite')\r\n        const store = transaction.objectStore('logs')\r\n        const request = store.clear()\r\n\r\n        request.onsuccess = () => {\r\n          logger.info('Audit logs cleared')\r\n          resolve()\r\n        }\r\n\r\n        request.onerror = () => reject(request.error)\r\n      })\r\n    }\r\n\r\n    this.emit('logs-cleared')\r\n  }\r\n\r\n  /**\r\n   * 哈希用户ID\r\n   */\r\n  private hashUserId(userId: string): string {\r\n    // 简单哈希（生产环境应使用更安全的方法）\r\n    let hash = 0\r\n    for (let i = 0; i < userId.length; i++) {\r\n      hash = ((hash << 5) - hash) + userId.charCodeAt(i)\r\n      hash = hash & hash\r\n    }\r\n    return `user-${Math.abs(hash).toString(36)}`\r\n  }\r\n\r\n  /**\r\n   * 哈希IP地址\r\n   */\r\n  private hashIP(ip: string): string {\r\n    const parts = ip.split('.')\r\n    if (parts.length === 4)\r\n      return `${parts[0]}.${parts[1]}.xxx.xxx`\r\n\r\n    return 'xxx.xxx.xxx.xxx'\r\n  }\r\n\r\n  /**\r\n   * 获取统计信息\r\n   */\r\n  getStats() {\r\n    return {\r\n      totalLogs: this.logs.length,\r\n      pendingLogs: this.pendingLogs.length,\r\n      uniqueUsers: new Set(this.logs.map(l => l.userId)).size,\r\n      uniqueActions: new Set(this.logs.map(l => l.action)).size,\r\n      oldestLog: this.logs[0]?.timestamp,\r\n      newestLog: this.logs[this.logs.length - 1]?.timestamp,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy(): void {\r\n    if (this.batchTimer)\r\n      clearTimeout(this.batchTimer)\r\n\r\n    // 立即保存pending的日志\r\n    if (this.pendingLogs.length > 0)\r\n      this.saveBatch()\r\n\r\n    this.db?.close()\r\n    this.removeAllListeners()\r\n    logger.info('Audit logger destroyed')\r\n  }\r\n}\r\n"],"names":["logger","createLogger","AuditLogger","EventEmitter","constructor","config","logs","maxLogs","batchSize","pendingLogs","enabled","storage","batchDelay","persistToDisk","serverSync","serverUrl","includeContent","anonymize","initialize","info","initDB","loadLogs","Promise","resolve","reject","request","indexedDB","open","onerror","error","onsuccess","db","result","onupgradeneeded","event","target","objectStoreNames","contains","store","createObjectStore","keyPath","createIndex","unique","transaction","objectStore","index","openCursor","count","cursor","push","value","continue","reverse","length","log","auditLog","id","Date","now","Math","random","toString","substr","timestamp","userId","hashUserId","metadata","ip","hashIP","shift","scheduleBatchSave","emit","debug","action","batchTimer","clearTimeout","saveBatch","window","setTimeout","logsToSave","saveToIndexedDB","syncToServer","forEach","add","oncomplete","response","fetch","method","headers","body","JSON","stringify","ok","Error","statusText","query","results","filter","resource","startTime","endTime","sort","a","b","field","sortBy","order","sortOrder","limit","offset","slice","generateReport","options","report","totalLogs","timeRange","start","end","statistics","calculateStatistics","groupedData","groupLogs","groupBy","generatedAt","stats","totalActions","uniqueUsers","Set","map","l","size","actionCounts","resourceCounts","peakHours","calculatePeakHours","hourCounts","hour","getHours","Object","entries","Number","grouped","key","toISOString","split","export","format","Blob","type","exportCSV","generateTextReport","rows","csv","join","row","cell","repeat","toLocaleString","clear","hash","i","charCodeAt","abs","parts","getStats","uniqueActions","oldestLog","newestLog","destroy","close","removeAllListeners"],"mappings":"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"}