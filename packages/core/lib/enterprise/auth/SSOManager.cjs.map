{"version":3,"file":"SSOManager.cjs","sources":["../../../src/enterprise/auth/SSOManager.ts"],"sourcesContent":["/**\r\n * SSO管理器\r\n * 支持OAuth2、SAML、OIDC、LDAP等多种SSO协议\r\n */\r\n\r\nimport type { AuthEvents, AuthResult, AuthStatus, OAuth2Token, SSOConfig, User } from './types'\r\nimport { EventEmitter } from '../../core/EventEmitter'\r\nimport { createLogger } from '../../utils/logger'\r\n\r\nconst logger = createLogger('SSOManager')\r\n\r\nexport class SSOManager extends EventEmitter<AuthEvents> {\r\n  private config: SSOConfig\r\n  private status: AuthStatus = 'unauthenticated'\r\n  private currentToken?: OAuth2Token\r\n  private currentUser?: User\r\n  private refreshTimer?: number\r\n\r\n  constructor(config: SSOConfig) {\r\n    super()\r\n    this.config = config\r\n  }\r\n\r\n  /**\r\n   * 登录\r\n   */\r\n  async login(): Promise<AuthResult> {\r\n    this.setStatus('authenticating')\r\n\r\n    try {\r\n      logger.info(`Authenticating with ${this.config.provider}`)\r\n\r\n      let result: AuthResult\r\n\r\n      switch (this.config.provider) {\r\n        case 'oauth2':\r\n        case 'oidc':\r\n          result = await this.loginOAuth2()\r\n          break\r\n\r\n        case 'saml':\r\n          result = await this.loginSAML()\r\n          break\r\n\r\n        case 'ldap':\r\n        case 'ad':\r\n          result = await this.loginLDAP()\r\n          break\r\n\r\n        default:\r\n          throw new Error(`Unsupported SSO provider: ${this.config.provider}`)\r\n      }\r\n\r\n      if (result.success && result.user) {\r\n        this.currentUser = result.user\r\n        this.currentToken = result.token\r\n        this.setStatus('authenticated')\r\n        this.emit('login', result.user)\r\n\r\n        // 启动token刷新\r\n        if (result.token)\r\n          this.startTokenRefresh(result.token)\r\n\r\n        logger.info(`Login successful: ${result.user.name}`)\r\n      }\r\n      else {\r\n        this.setStatus('error')\r\n        logger.error('Login failed:', result.error)\r\n      }\r\n\r\n      return result\r\n    }\r\n    catch (error) {\r\n      this.setStatus('error')\r\n      this.emit('auth-error', error as Error)\r\n      logger.error('Login error:', error)\r\n\r\n      return {\r\n        success: false,\r\n        error: (error as Error).message,\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * OAuth2/OIDC登录\r\n   */\r\n  private async loginOAuth2(): Promise<AuthResult> {\r\n    // 构建授权URL\r\n    const authUrl = new URL(this.config.authorizationUrl!)\r\n    authUrl.searchParams.set('client_id', this.config.clientId!)\r\n    authUrl.searchParams.set('redirect_uri', this.config.redirectUri!)\r\n    authUrl.searchParams.set('response_type', 'code')\r\n    authUrl.searchParams.set('scope', (this.config.scope || ['openid', 'profile', 'email']).join(' '))\r\n    authUrl.searchParams.set('state', this.generateState())\r\n\r\n    // 打开授权窗口\r\n    const authWindow = window.open(authUrl.toString(), 'sso-auth', 'width=600,height=700')\r\n\r\n    // 等待回调\r\n    const code = await this.waitForCallback(authWindow)\r\n\r\n    // 交换code获取token\r\n    const tokenResponse = await fetch(this.config.tokenUrl!, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: new URLSearchParams({\r\n        grant_type: 'authorization_code',\r\n        code,\r\n        client_id: this.config.clientId!,\r\n        client_secret: this.config.clientSecret!,\r\n        redirect_uri: this.config.redirectUri!,\r\n      }),\r\n    })\r\n\r\n    if (!tokenResponse.ok)\r\n      throw new Error('Failed to exchange code for token')\r\n\r\n    const tokenData = await tokenResponse.json()\r\n    const token: OAuth2Token = {\r\n      accessToken: tokenData.access_token,\r\n      refreshToken: tokenData.refresh_token,\r\n      tokenType: tokenData.token_type || 'Bearer',\r\n      expiresIn: tokenData.expires_in || 3600,\r\n      scope: tokenData.scope,\r\n      expiresAt: Date.now() + (tokenData.expires_in || 3600) * 1000,\r\n    }\r\n\r\n    // 获取用户信息\r\n    const userResponse = await fetch(this.config.userInfoUrl!, {\r\n      headers: {\r\n        Authorization: `${token.tokenType} ${token.accessToken}`,\r\n      },\r\n    })\r\n\r\n    if (!userResponse.ok)\r\n      throw new Error('Failed to fetch user info')\r\n\r\n    const userData = await userResponse.json()\r\n    const user: User = {\r\n      id: userData.sub || userData.id,\r\n      name: userData.name || userData.username,\r\n      email: userData.email,\r\n      avatar: userData.picture || userData.avatar,\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      user,\r\n      token,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * SAML登录\r\n   */\r\n  private async loginSAML(): Promise<AuthResult> {\r\n    // SAML登录流程\r\n    logger.info('SAML login not fully implemented in this demo')\r\n\r\n    // 简化实现：重定向到SAML IdP\r\n    if (this.config.saml?.singleSignOnServiceUrl)\r\n      window.location.href = this.config.saml.singleSignOnServiceUrl\r\n\r\n    return {\r\n      success: false,\r\n      error: 'SAML authentication requires server-side implementation',\r\n    }\r\n  }\r\n\r\n  /**\r\n   * LDAP登录\r\n   */\r\n  private async loginLDAP(): Promise<AuthResult> {\r\n    // LDAP认证需要服务器端支持\r\n    logger.info('LDAP authentication requires server-side support')\r\n\r\n    // 调用后端API进行LDAP认证\r\n    const response = await fetch('/api/auth/ldap', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        username: prompt('用户名:'),\r\n        password: prompt('密码:'),\r\n      }),\r\n    })\r\n\r\n    if (!response.ok)\r\n      throw new Error('LDAP authentication failed')\r\n\r\n    const data = await response.json()\r\n\r\n    return {\r\n      success: true,\r\n      user: data.user,\r\n      token: data.token,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 登出\r\n   */\r\n  async logout(): Promise<void> {\r\n    logger.info('Logging out')\r\n\r\n    this.stopTokenRefresh()\r\n    this.currentUser = undefined\r\n    this.currentToken = undefined\r\n    this.setStatus('unauthenticated')\r\n    this.emit('logout')\r\n\r\n    logger.info('Logged out successfully')\r\n  }\r\n\r\n  /**\r\n   * 刷新Token\r\n   */\r\n  async refreshToken(): Promise<OAuth2Token> {\r\n    if (!this.currentToken?.refreshToken)\r\n      throw new Error('No refresh token available')\r\n\r\n    logger.info('Refreshing token')\r\n\r\n    const response = await fetch(this.config.tokenUrl!, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: new URLSearchParams({\r\n        grant_type: 'refresh_token',\r\n        refresh_token: this.currentToken.refreshToken,\r\n        client_id: this.config.clientId!,\r\n        client_secret: this.config.clientSecret!,\r\n      }),\r\n    })\r\n\r\n    if (!response.ok)\r\n      throw new Error('Failed to refresh token')\r\n\r\n    const data = await response.json()\r\n    const newToken: OAuth2Token = {\r\n      accessToken: data.access_token,\r\n      refreshToken: data.refresh_token || this.currentToken.refreshToken,\r\n      tokenType: data.token_type || 'Bearer',\r\n      expiresIn: data.expires_in || 3600,\r\n      expiresAt: Date.now() + (data.expires_in || 3600) * 1000,\r\n    }\r\n\r\n    this.currentToken = newToken\r\n    this.emit('token-refreshed', newToken)\r\n\r\n    logger.info('Token refreshed successfully')\r\n\r\n    return newToken\r\n  }\r\n\r\n  /**\r\n   * 启动Token自动刷新\r\n   */\r\n  private startTokenRefresh(token: OAuth2Token): void {\r\n    // 在过期前5分钟刷新\r\n    const refreshTime = token.expiresAt - Date.now() - 5 * 60 * 1000\r\n\r\n    if (refreshTime > 0) {\r\n      this.refreshTimer = window.setTimeout(async () => {\r\n        try {\r\n          await this.refreshToken()\r\n        }\r\n        catch (error) {\r\n          logger.error('Token refresh failed:', error)\r\n          this.emit('auth-error', error as Error)\r\n        }\r\n      }, refreshTime)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 停止Token刷新\r\n   */\r\n  private stopTokenRefresh(): void {\r\n    if (this.refreshTimer) {\r\n      clearTimeout(this.refreshTimer)\r\n      this.refreshTimer = undefined\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 等待OAuth回调\r\n   */\r\n  private async waitForCallback(authWindow: Window | null): Promise<string> {\r\n    return new Promise((resolve, reject) => {\r\n      // 监听消息事件\r\n      const messageHandler = (event: MessageEvent) => {\r\n        if (event.data.type === 'oauth-callback') {\r\n          window.removeEventListener('message', messageHandler)\r\n          authWindow?.close()\r\n\r\n          if (event.data.code)\r\n            resolve(event.data.code)\r\n          else\r\n            reject(new Error(event.data.error || 'Authentication failed'))\r\n        }\r\n      }\r\n\r\n      window.addEventListener('message', messageHandler)\r\n\r\n      // 超时处理\r\n      setTimeout(() => {\r\n        window.removeEventListener('message', messageHandler)\r\n        authWindow?.close()\r\n        reject(new Error('Authentication timeout'))\r\n      }, 60000)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 生成state参数\r\n   */\r\n  private generateState(): string {\r\n    return Math.random().toString(36).substring(2, 15)\r\n  }\r\n\r\n  /**\r\n   * 设置状态\r\n   */\r\n  private setStatus(status: AuthStatus): void {\r\n    this.status = status\r\n    this.emit('auth-status', status)\r\n  }\r\n\r\n  /**\r\n   * 获取当前用户\r\n   */\r\n  getCurrentUser(): User | undefined {\r\n    return this.currentUser\r\n  }\r\n\r\n  /**\r\n   * 获取当前Token\r\n   */\r\n  getCurrentToken(): OAuth2Token | undefined {\r\n    return this.currentToken\r\n  }\r\n\r\n  /**\r\n   * 获取认证状态\r\n   */\r\n  getStatus(): AuthStatus {\r\n    return this.status\r\n  }\r\n\r\n  /**\r\n   * 是否已认证\r\n   */\r\n  isAuthenticated(): boolean {\r\n    return this.status === 'authenticated' && !!this.currentUser\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy(): void {\r\n    this.stopTokenRefresh()\r\n    this.removeAllListeners()\r\n    logger.info('SSO manager destroyed')\r\n  }\r\n}\r\n"],"names":["logger","createLogger","SSOManager","EventEmitter","constructor","config","status","login","setStatus","info","provider","result","loginOAuth2","loginSAML","loginLDAP","Error","success","user","currentUser","currentToken","token","emit","startTokenRefresh","name","error","message","authUrl","URL","authorizationUrl","searchParams","set","clientId","redirectUri","scope","join","generateState","authWindow","window","open","toString","code","waitForCallback","tokenResponse","fetch","tokenUrl","method","headers","body","URLSearchParams","grant_type","client_id","client_secret","clientSecret","redirect_uri","ok","tokenData","json","accessToken","access_token","refreshToken","refresh_token","tokenType","token_type","expiresIn","expires_in","expiresAt","Date","now","userResponse","userInfoUrl","Authorization","userData","id","sub","username","email","avatar","picture","saml","singleSignOnServiceUrl","location","href","response","JSON","stringify","prompt","password","data","logout","stopTokenRefresh","undefined","newToken","refreshTime","refreshTimer","setTimeout","clearTimeout","Promise","resolve","reject","messageHandler","event","type","removeEventListener","close","addEventListener","Math","random","substring","getCurrentUser","getCurrentToken","getStatus","isAuthenticated","destroy","removeAllListeners"],"mappings":"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"}