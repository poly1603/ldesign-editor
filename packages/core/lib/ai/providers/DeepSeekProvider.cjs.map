{"version":3,"file":"DeepSeekProvider.cjs","sources":["../../../src/ai/providers/DeepSeekProvider.ts"],"sourcesContent":["/**\r\n * DeepSeek AI 提供商实现\r\n */\r\n\r\nimport type {\r\n  AIModelConfig,\r\n  AIProviderInterface,\r\n  AIRequest,\r\n  AIRequestType,\r\n  AIResponse,\r\n} from '../types'\r\n\r\nexport class DeepSeekProvider implements AIProviderInterface {\r\n  name: 'deepseek' = 'deepseek'\r\n  config: AIModelConfig\r\n\r\n  constructor(config?: AIModelConfig) {\r\n    this.config = config || {\r\n      provider: 'deepseek',\r\n      model: 'deepseek-chat',\r\n      apiKey: 'sk-37b7e5f545814da1923cae055b498c9a',\r\n      apiEndpoint: 'https://api.deepseek.com/v1',\r\n      temperature: 0.7,\r\n      maxTokens: 2000,\r\n      stream: false,\r\n    }\r\n  }\r\n\r\n  async initialize(config: AIModelConfig): Promise<void> {\r\n    this.config = { ...this.config, ...config }\r\n    if (!this.validateConfig())\r\n      throw new Error('Invalid DeepSeek configuration')\r\n  }\r\n\r\n  validateConfig(): boolean {\r\n    return !!(this.config.apiKey && this.config.apiEndpoint && this.config.model)\r\n  }\r\n\r\n  async request(request: AIRequest): Promise<AIResponse> {\r\n    try {\r\n      const systemPrompt = this.getSystemPrompt(request.type)\r\n      const userPrompt = this.getUserPrompt(request)\r\n\r\n      const response = await fetch(`${this.config.apiEndpoint}/chat/completions`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this.config.apiKey}`,\r\n        },\r\n        body: JSON.stringify({\r\n          model: this.config.model,\r\n          messages: [\r\n            { role: 'system', content: systemPrompt },\r\n            { role: 'user', content: userPrompt },\r\n          ],\r\n          temperature: this.config.temperature || 0.7,\r\n          max_tokens: this.config.maxTokens || 2000,\r\n          stream: false,\r\n        }),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}))\r\n        throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`)\r\n      }\r\n\r\n      const data = await response.json()\r\n\r\n      if (data.error)\r\n        throw new Error(data.error.message || 'DeepSeek API error')\r\n\r\n      const content = data.choices?.[0]?.message?.content || ''\r\n\r\n      return {\r\n        success: true,\r\n        text: content,\r\n        suggestions: request.type === 'suggest' ? this.parseSuggestions(content) : undefined,\r\n        usage: data.usage\r\n          ? {\r\n            promptTokens: data.usage.prompt_tokens,\r\n            completionTokens: data.usage.completion_tokens,\r\n            totalTokens: data.usage.total_tokens,\r\n          }\r\n          : undefined,\r\n      }\r\n    }\r\n    catch (error) {\r\n      console.error('DeepSeek request error:', error)\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      }\r\n    }\r\n  }\r\n\r\n  private getSystemPrompt(type: AIRequestType): string {\r\n    const prompts: Record<AIRequestType, string> = {\r\n      correct: '你是一个专业的文本纠错助手。请纠正文本中的拼写、语法和标点错误。保持原意不变，只修正错误。直接返回纠正后的文本，不要解释。',\r\n      complete: '你是一个智能写作助手。根据上下文，为用户补全当前正在输入的内容。返回简洁、相关的补全建议。',\r\n      continue: '你是一个创意写作助手。根据已有内容，自然地续写后续内容。保持语言风格和主题一致。',\r\n      rewrite: '你是一个专业的文本重写助手。请改写文本，使其更加清晰、流畅和专业。保持原意，优化表达。',\r\n      suggest: '你是一个智能建议助手。根据上下文，提供相关的写作建议。返回3-5个简短的建议选项。',\r\n    }\r\n    return prompts[type] || prompts.correct\r\n  }\r\n\r\n  private getUserPrompt(request: AIRequest): string {\r\n    let prompt = `文本：${request.text}`\r\n\r\n    if (request.context)\r\n      prompt = `上下文：${request.context}\\n\\n${prompt}`\r\n\r\n    if (request.language)\r\n      prompt = `语言：${request.language}\\n\\n${prompt}`\r\n\r\n    return prompt\r\n  }\r\n\r\n  private parseSuggestions(content: string): string[] {\r\n    // 尝试解析建议列表\r\n    const suggestions: string[] = []\r\n    const lines = content.split('\\n').filter(line => line.trim())\r\n\r\n    for (const line of lines) {\r\n      // 移除数字标记、破折号等\r\n      const cleaned = line.replace(/^[\\d.\\-*\\s]+/, '').trim()\r\n      if (cleaned)\r\n        suggestions.push(cleaned)\r\n    }\r\n\r\n    return suggestions.slice(0, 5) // 最多返回5个建议\r\n  }\r\n\r\n  cleanup(): void {\r\n    // 清理资源（如果需要）\r\n  }\r\n}\r\n"],"names":["DeepSeekProvider","constructor","config","name","provider","model","apiKey","apiEndpoint","temperature","maxTokens","stream","initialize","validateConfig","Error","request","systemPrompt","getSystemPrompt","type","userPrompt","getUserPrompt","response","fetch","method","headers","body","JSON","stringify","messages","role","content","max_tokens","ok","errorData","json","catch","error","message","status","data","choices","success","text","suggestions","parseSuggestions","undefined","usage","promptTokens","prompt_tokens","completionTokens","completion_tokens","totalTokens","total_tokens","console","prompts","correct","complete","continue","rewrite","suggest","prompt","context","language","lines","split","filter","line","trim","cleaned","replace","push","slice","cleanup"],"mappings":"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"}