{"version":3,"file":"Toolbar.cjs","sources":["../../src/ui/Toolbar.ts"],"sourcesContent":["/**\r\n * 工具栏组件\r\n * 使用 Lucide 图标\r\n */\r\n\r\nimport type { EditorInstance as EditorType, ToolbarItem } from '../types'\r\nimport { FONT_FAMILIES, FONT_SIZES } from '../plugins/formatting/font'\r\nimport { LINE_HEIGHTS } from '../plugins/formatting/line-height'\r\nimport { DEFAULT_TOOLBAR_ITEMS } from './defaultToolbar'\r\nimport { showDropdown } from './Dropdown'\r\nimport { createIcon } from './icons'\r\nimport { insertMedia, showMediaInsert } from './MediaInsert'\r\nimport { bindTooltip } from './Tooltip'\r\nimport { showUnifiedDialog } from './UnifiedDialog'\r\nimport { showColorDropdown, showEmojiDropdown } from './UnifiedDropdown'\r\n\r\nexport interface ToolbarOptions {\r\n  items?: ToolbarItem[]\r\n  container?: HTMLElement\r\n  className?: string\r\n}\r\n\r\nexport class Toolbar {\r\n  private editor: EditorType\r\n  private options: ToolbarOptions\r\n  private element: HTMLElement\r\n  private buttons: Map<string, HTMLButtonElement> = new Map()\r\n\r\n  constructor(editor: EditorType, options: ToolbarOptions = {}) {\r\n    this.editor = editor\r\n    this.options = options\r\n\r\n    // 创建工具栏容器\r\n    this.element = document.createElement('div')\r\n    this.element.className = `ldesign-editor-toolbar ${options.className || ''}`\r\n\r\n    // 渲染工具栏项\r\n    this.render()\r\n\r\n    // 监听编辑器更新，更新按钮状态\r\n    this.editor.on('update', () => this.updateButtonStates())\r\n    this.editor.on('selectionUpdate', () => this.updateButtonStates())\r\n  }\r\n\r\n  /**\r\n   * 渲染工具栏\r\n   */\r\n  private render(): void {\r\n    console.log('[Toolbar] Starting render...')\r\n    console.log('[Toolbar] Options:', this.options)\r\n\r\n    const items = this.options.items || this.getDefaultItems()\r\n    console.log('[Toolbar] Items to render:', items.length, items)\r\n\r\n    items.forEach((item, index) => {\r\n      console.log(`[Toolbar] Creating button for: ${item.name}`)\r\n      // 创建按钮\r\n      const button = this.createButton(item)\r\n      this.buttons.set(item.name, button)\r\n      this.element.appendChild(button)\r\n\r\n      // 添加分隔符\r\n      if (this.shouldAddSeparator(index, items)) {\r\n        const separator = document.createElement('div')\r\n        separator.className = 'ldesign-editor-toolbar-separator'\r\n        this.element.appendChild(separator)\r\n      }\r\n    })\r\n\r\n    // 如果提供了容器，插入到容器中\r\n    if (this.options.container) {\r\n      console.log('[Toolbar] Appending to container:', this.options.container)\r\n      this.options.container.appendChild(this.element)\r\n    }\r\n    else {\r\n      console.log('[Toolbar] No container provided')\r\n    }\r\n\r\n    console.log('[Toolbar] Render complete. Element:', this.element)\r\n    console.log('[Toolbar] Element children:', this.element.children.length)\r\n  }\r\n\r\n  /**\r\n   * 创建按钮\r\n   */\r\n  private createButton(item: ToolbarItem): HTMLButtonElement {\r\n    const button = document.createElement('button')\r\n    button.className = 'ldesign-editor-toolbar-button'\r\n    button.type = 'button'\r\n    // 使用自定义 Tooltip，避免原生 title 样式受限\r\n    if (item.title)\r\n      bindTooltip(button, item.title)\r\n\r\n    button.setAttribute('data-name', item.name)\r\n\r\n    // 判断是否是下拉按钮（需要箭头指示器）\r\n    const isDropdown = ['heading', 'align', 'fontSize', 'fontFamily', 'lineHeight', 'textTransform', 'ai'].includes(item.name)\r\n\r\n    // 如果是下拉按钮，需要更宽的按钮容纳图标和箭头\r\n    if (isDropdown) {\r\n      button.style.width = 'auto'\r\n      button.style.minWidth = item.name === 'heading' ? '80px' : '48px' // 标题按钮需要更宽\r\n      button.style.paddingLeft = '8px'\r\n      button.style.paddingRight = '8px'\r\n      button.style.gap = '4px'\r\n      button.style.display = 'flex'\r\n      button.style.alignItems = 'center'\r\n      button.style.justifyContent = 'space-between'\r\n    }\r\n\r\n    // 如果是标题按钮，特殊处理\r\n    if (item.name === 'heading') {\r\n      // 不使用默认图标，而是创建实时更新的文本\r\n      const levelText = document.createElement('span')\r\n      levelText.className = 'heading-level-text'\r\n      levelText.style.fontSize = '14px'\r\n      levelText.style.fontWeight = '600'\r\n      levelText.style.marginRight = 'auto'\r\n      levelText.textContent = 'H1' // 默认显示\r\n      button.appendChild(levelText)\r\n\r\n      // 更新当前级别显示\r\n      const updateLevelText = () => {\r\n        const selection = window.getSelection()\r\n        if (!selection || selection.rangeCount === 0) {\r\n          levelText.textContent = '正文'\r\n          return\r\n        }\r\n\r\n        let element = selection.anchorNode\r\n        if (!element) {\r\n          levelText.textContent = '正文'\r\n          return\r\n        }\r\n\r\n        element = element.nodeType === Node.TEXT_NODE\r\n          ? element.parentElement\r\n          : element as HTMLElement\r\n\r\n        while (element && element !== document.body) {\r\n          const tagName = (element as HTMLElement).tagName?.toUpperCase()\r\n          switch (tagName) {\r\n            case 'H1': levelText.textContent = 'H1'; return\r\n            case 'H2': levelText.textContent = 'H2'; return\r\n            case 'H3': levelText.textContent = 'H3'; return\r\n            case 'H4': levelText.textContent = 'H4'; return\r\n            case 'H5': levelText.textContent = 'H5'; return\r\n            case 'H6': levelText.textContent = 'H6'; return\r\n            case 'P':\r\n            case 'DIV':\r\n              if (!(element as HTMLElement).closest('h1,h2,h3,h4,h5,h6')) {\r\n                levelText.textContent = '正文'\r\n                return\r\n              }\r\n              break\r\n          }\r\n          element = element.parentElement\r\n        }\r\n        levelText.textContent = '正文'\r\n      }\r\n\r\n      // 监听事件\r\n      button.addEventListener('mouseenter', updateLevelText)\r\n      document.addEventListener('selectionchange', updateLevelText)\r\n      if (this.editor.contentElement)\r\n        this.editor.contentElement.addEventListener('input', updateLevelText)\r\n\r\n      // 初始化显示\r\n      updateLevelText()\r\n    }\r\n    else {\r\n      // 其他按钮使用图标\r\n      const iconElement = createIcon(item.icon)\r\n      if (iconElement)\r\n        button.appendChild(iconElement)\r\n      else\r\n        button.textContent = item.title\r\n    }\r\n\r\n    // 如果是下拉按钮，添加向下箭头\r\n    if (isDropdown) {\r\n      const chevron = createIcon('chevron-down')\r\n      if (chevron) {\r\n        chevron.style.opacity = '0.6'\r\n        button.appendChild(chevron)\r\n      }\r\n    }\r\n\r\n    // 防止按钮获取焦点导致选区丢失\r\n    button.addEventListener('mousedown', (e) => {\r\n      e.preventDefault()\r\n    })\r\n\r\n    // 绑定点击事件\r\n    button.addEventListener('click', (e) => {\r\n      e.preventDefault()\r\n\r\n      // 特殊处理：颜色选择器（使用统一的下拉框）\r\n      if (item.name === 'textColor') {\r\n        showColorDropdown(button, (color) => {\r\n          this.editor.commands.execute('setTextColor', color)\r\n        }, true, '文字颜色')\r\n        return\r\n      }\r\n\r\n      if (item.name === 'backgroundColor') {\r\n        showColorDropdown(button, (color) => {\r\n          this.editor.commands.execute('setBackgroundColor', color)\r\n        }, true, '背景色')\r\n        return\r\n      }\r\n\r\n      // 特殊处理：标题级别下拉\r\n      if (item.name === 'heading') {\r\n        // 获取当前标题级别\r\n        const getCurrentLevel = () => {\r\n          const selection = window.getSelection()\r\n          if (!selection || selection.rangeCount === 0)\r\n            return 'p'\r\n\r\n          let element = selection.anchorNode\r\n          if (!element)\r\n            return 'p'\r\n\r\n          element = element.nodeType === Node.TEXT_NODE\r\n            ? element.parentElement\r\n            : element as HTMLElement\r\n\r\n          while (element && element !== document.body) {\r\n            const tagName = (element as HTMLElement).tagName?.toUpperCase()\r\n            if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(tagName))\r\n              return tagName.toLowerCase()\r\n\r\n            if (['P', 'DIV'].includes(tagName) && !(element as HTMLElement).closest('h1,h2,h3,h4,h5,h6'))\r\n              return 'p'\r\n\r\n            element = element.parentElement\r\n          }\r\n          return 'p'\r\n        }\r\n\r\n        const currentLevel = getCurrentLevel()\r\n\r\n        showDropdown(button, {\r\n          options: [\r\n            { label: '正文', value: 'p' },\r\n            { label: '标题 1', value: 'h1' },\r\n            { label: '标题 2', value: 'h2' },\r\n            { label: '标题 3', value: 'h3' },\r\n            { label: '标题 4', value: 'h4' },\r\n            { label: '标题 5', value: 'h5' },\r\n            { label: '标题 6', value: 'h6' },\r\n          ],\r\n          selectedValue: currentLevel, // 传递当前值\r\n          onSelect: (value) => {\r\n            const map: Record<string, string> = {\r\n              p: 'setParagraph',\r\n              h1: 'setHeading1',\r\n              h2: 'setHeading2',\r\n              h3: 'setHeading3',\r\n              h4: 'setHeading4',\r\n              h5: 'setHeading5',\r\n              h6: 'setHeading6',\r\n            }\r\n            const cmd = map[value]\r\n            if (cmd) {\r\n              this.editor.commands.execute(cmd)\r\n            }\r\n            else {\r\n              // 回退到原生命令\r\n              document.execCommand('formatBlock', false, value)\r\n            }\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：对齐方式下拉\r\n      if (item.name === 'align') {\r\n        showDropdown(button, {\r\n          options: [\r\n            { label: '左对齐', value: 'left' },\r\n            { label: '居中', value: 'center' },\r\n            { label: '右对齐', value: 'right' },\r\n            { label: '两端对齐', value: 'justify' },\r\n          ],\r\n          onSelect: (value) => {\r\n            const map: Record<string, string> = {\r\n              left: 'alignLeft',\r\n              center: 'alignCenter',\r\n              right: 'alignRight',\r\n              justify: 'alignJustify',\r\n            }\r\n            const cmd = map[value]\r\n            if (cmd)\r\n              this.editor.commands.execute(cmd)\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：字体大小选择器\r\n      if (item.name === 'fontSize') {\r\n        showDropdown(button, {\r\n          options: FONT_SIZES,\r\n          onSelect: (size) => {\r\n            this.editor.commands.execute('setFontSize', size)\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：字体家族选择器\r\n      if (item.name === 'fontFamily') {\r\n        showDropdown(button, {\r\n          options: FONT_FAMILIES,\r\n          onSelect: (family) => {\r\n            this.editor.commands.execute('setFontFamily', family)\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：行高选择器\r\n      if (item.name === 'lineHeight') {\r\n        showDropdown(button, {\r\n          options: LINE_HEIGHTS,\r\n          onSelect: (height) => {\r\n            this.editor.commands.execute('setLineHeight', height)\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：文本转换\r\n      if (item.name === 'textTransform') {\r\n        showDropdown(button, {\r\n          options: [\r\n            { label: '大写', value: 'toUpperCase' },\r\n            { label: '小写', value: 'toLowerCase' },\r\n            { label: '首字母大写', value: 'toCapitalize' },\r\n            { label: '句子大小写', value: 'toSentenceCase' },\r\n            { label: '全角转半角', value: 'toHalfWidth' },\r\n            { label: '半角转全角', value: 'toFullWidth' },\r\n          ],\r\n          onSelect: (command) => {\r\n            this.editor.commands.execute(command)\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：AI 功能下拉菜单\r\n      if (item.name === 'ai') {\r\n        showDropdown(button, {\r\n          options: [\r\n            { label: 'AI 纠错', value: 'ai-correct', icon: 'sparkles' },\r\n            { label: 'AI 补全', value: 'ai-complete', icon: 'lightbulb' },\r\n            { label: 'AI 续写', value: 'ai-continue', icon: 'pen-tool' },\r\n            { label: 'AI 重写', value: 'ai-rewrite', icon: 'refresh-cw' },\r\n            { label: '---', value: 'separator' }, // 分隔线\r\n            { label: 'AI 设置', value: 'ai-config', icon: 'settings' },\r\n          ],\r\n          onSelect: (command) => {\r\n            if (command === 'separator')\r\n              return\r\n\r\n            console.log('[Toolbar] AI dropdown selected:', command)\r\n            console.log('[Toolbar] Available commands:', this.editor.commands.getCommands())\r\n            console.log('[Toolbar] Has command?', this.editor.commands.has(command))\r\n\r\n            // 直接执行 AI 命令\r\n            if (this.editor.commands.has(command)) {\r\n              console.log('[Toolbar] Executing AI command:', command)\r\n              this.editor.commands.execute(command)\r\n            }\r\n            else {\r\n              console.warn(`[Toolbar] AI command '${command}' not found. Make sure AI plugin is loaded.`)\r\n              console.warn('[Toolbar] Available commands:', this.editor.commands.getCommands())\r\n            }\r\n          },\r\n          renderOption: (option) => {\r\n            // 自定义渲染分隔线\r\n            if (option.value === 'separator') {\r\n              const separator = document.createElement('div')\r\n              separator.style.cssText = 'height: 1px; background: #e0e0e0; margin: 4px 0;'\r\n              return separator\r\n            }\r\n            return null // 使用默认渲染\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：媒体插入\r\n      if (item.name === 'image') {\r\n        showMediaInsert(button, {\r\n          type: 'image',\r\n          onInsert: (urls, alt) => {\r\n            // 确保编辑器获得焦点\r\n            if (this.editor.contentElement)\r\n              this.editor.contentElement.focus()\r\n\r\n            insertMedia('image', urls, { alt })\r\n            if (this.editor.emit)\r\n              this.editor.emit('update')\r\n          },\r\n          multiple: true,\r\n        })\r\n        return\r\n      }\r\n\r\n      if (item.name === 'video') {\r\n        showMediaInsert(button, {\r\n          type: 'video',\r\n          onInsert: (urls, alt) => {\r\n            // 确保编辑器获得焦点\r\n            if (this.editor.contentElement)\r\n              this.editor.contentElement.focus()\r\n\r\n            insertMedia('video', urls)\r\n            if (this.editor.emit)\r\n              this.editor.emit('update')\r\n          },\r\n          multiple: false,\r\n        })\r\n        return\r\n      }\r\n\r\n      if (item.name === 'audio') {\r\n        showMediaInsert(button, {\r\n          type: 'audio',\r\n          onInsert: (urls, alt) => {\r\n            // 确保编辑器获得焦点\r\n            if (this.editor.contentElement)\r\n              this.editor.contentElement.focus()\r\n\r\n            insertMedia('audio', urls)\r\n            if (this.editor.emit)\r\n              this.editor.emit('update')\r\n          },\r\n          multiple: false,\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：表情选择器（使用统一的下拉框）\r\n      if (item.name === 'emoji') {\r\n        console.log('[Toolbar] Opening emoji picker')\r\n        showEmojiDropdown(button, (emoji) => {\r\n          console.log('[Toolbar] Inserting emoji:', emoji)\r\n          document.execCommand('insertText', false, emoji)\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：查找替换\r\n      if (item.name === 'search') {\r\n        console.log('[Toolbar] Opening find-replace dialog')\r\n\r\n        // 获取当前选中的文本\r\n        const selection = window.getSelection()\r\n        const selectedText = (selection && selection.toString().trim()) || ''\r\n\r\n        // 保存当前高亮状态\r\n        let currentHighlights: NodeListOf<Element> | null = null\r\n        let totalMatches = 0\r\n\r\n        showUnifiedDialog({\r\n          title: '查找和替换',\r\n          width: 520,\r\n          icon: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n            <path d=\"m21 21-4.35-4.35\"/>\r\n          </svg>`,\r\n          fields: [\r\n            {\r\n              id: 'findText',\r\n              type: 'text',\r\n              label: '查找内容',\r\n              placeholder: '输入要查找的文本',\r\n              required: true,\r\n              defaultValue: selectedText,\r\n            },\r\n            {\r\n              id: 'replaceText',\r\n              type: 'text',\r\n              label: '替换为',\r\n              placeholder: '输入替换文本',\r\n              required: false,\r\n            },\r\n            {\r\n              id: 'actionType',\r\n              type: 'select',\r\n              label: '操作',\r\n              defaultValue: 'find',\r\n              options: [\r\n                { label: '仅查找', value: 'find' },\r\n                { label: '查找并替换全部', value: 'replaceAll' },\r\n              ],\r\n            },\r\n            {\r\n              id: 'caseSensitive',\r\n              type: 'checkbox',\r\n              label: '区分大小写',\r\n              defaultValue: false,\r\n            },\r\n            {\r\n              id: 'wholeWord',\r\n              type: 'checkbox',\r\n              label: '全字匹配',\r\n              defaultValue: false,\r\n            },\r\n          ],\r\n          onSubmit: (data) => {\r\n            console.log('[Toolbar] Find/Replace data:', data)\r\n            const content = this.editor.contentElement\r\n            if (!content)\r\n              return\r\n\r\n            const findText = data.findText\r\n            const replaceText = data.replaceText || ''\r\n            const actionType = data.actionType || 'find'\r\n            const caseSensitive = data.caseSensitive\r\n            const wholeWord = data.wholeWord\r\n\r\n            // 创建正则表达式\r\n            const escaped = findText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\r\n            const wordBoundary = wholeWord ? '\\\\b' : ''\r\n            const pattern = new RegExp(\r\n              `${wordBoundary}${escaped}${wordBoundary}`,\r\n              caseSensitive ? 'g' : 'gi',\r\n            )\r\n\r\n            // 默认执行查找操作\r\n            console.log('[Find] Starting search for:', findText)\r\n            console.log('[Find] Options:', { caseSensitive, wholeWord })\r\n\r\n            // 清除之前的高亮\r\n            content.querySelectorAll('.editor-highlight').forEach((el: Element) => {\r\n              const text = el.textContent || ''\r\n              const textNode = document.createTextNode(text)\r\n              const parent = el.parentNode\r\n              if (parent)\r\n                parent.replaceChild(textNode, el)\r\n            })\r\n\r\n            // 高亮所有匹配项\r\n            let count = 0\r\n\r\n            // 递归处理所有文本节点\r\n            const processNode = (node: Node) => {\r\n              if (node.nodeType === Node.TEXT_NODE) {\r\n                const text = node.textContent || ''\r\n                if (!text.trim())\r\n                  return // 跳过空文本节点\r\n\r\n                // 重置正则表达式\r\n                pattern.lastIndex = 0\r\n                const matches: RegExpExecArray[] = []\r\n                let match: RegExpExecArray | null\r\n\r\n                while ((match = pattern.exec(text)) !== null) {\r\n                  matches.push([...match] as RegExpExecArray)\r\n                  count++\r\n                  // 防止无限循环\r\n                  if (!pattern.global)\r\n                    break\r\n                }\r\n\r\n                if (matches.length > 0) {\r\n                  const parent = node.parentNode\r\n                  if (!parent)\r\n                    return\r\n\r\n                  const fragment = document.createDocumentFragment()\r\n                  let lastIndex = 0\r\n\r\n                  matches.forEach((m) => {\r\n                    const matchIndex = m.index || 0\r\n                    const matchText = m[0]\r\n\r\n                    // 添加匹配前的文本\r\n                    if (matchIndex > lastIndex) {\r\n                      fragment.appendChild(\r\n                        document.createTextNode(text.substring(lastIndex, matchIndex)),\r\n                      )\r\n                    }\r\n\r\n                    // 添加高亮的匹配文本\r\n                    const highlight = document.createElement('span')\r\n                    highlight.className = 'editor-highlight'\r\n                    highlight.style.background = '#fef08a'\r\n                    highlight.style.padding = '1px 2px'\r\n                    highlight.style.borderRadius = '2px'\r\n                    highlight.textContent = matchText\r\n                    fragment.appendChild(highlight)\r\n\r\n                    lastIndex = matchIndex + matchText.length\r\n                  })\r\n\r\n                  // 添加剩余文本\r\n                  if (lastIndex < text.length) {\r\n                    fragment.appendChild(\r\n                      document.createTextNode(text.substring(lastIndex)),\r\n                    )\r\n                  }\r\n\r\n                  // 替换原节点\r\n                  parent.replaceChild(fragment, node)\r\n                }\r\n              }\r\n              else if (node.nodeType === Node.ELEMENT_NODE) {\r\n                // 跳过某些元素\r\n                const tagName = (node as HTMLElement).tagName?.toLowerCase()\r\n                if (tagName === 'script' || tagName === 'style' || tagName === 'noscript')\r\n                  return\r\n\r\n                // 递归处理子节点\r\n                const children = Array.from(node.childNodes)\r\n                children.forEach(child => processNode(child))\r\n              }\r\n            }\r\n\r\n            // 开始处理\r\n            processNode(content)\r\n\r\n            console.log('[Find] Found matches:', count)\r\n\r\n            if (count > 0) {\r\n              // 滚动到第一个匹配项\r\n              const firstMatch = content.querySelector('.editor-highlight')\r\n              if (firstMatch instanceof HTMLElement) {\r\n                firstMatch.scrollIntoView({ behavior: 'smooth', block: 'center' })\r\n                // 添加当前高亮\r\n                firstMatch.style.background = '#facc15'\r\n              }\r\n            }\r\n\r\n            // 保存匹配数量\r\n            totalMatches = count\r\n            currentHighlights = content.querySelectorAll('.editor-highlight')\r\n\r\n            // 根据操作类型执行不同操作\r\n            if (actionType === 'replaceAll' && count > 0) {\r\n              // 执行全部替换\r\n              if (!replaceText && replaceText !== '') {\r\n                alert('请输入替换文本')\r\n                return\r\n              }\r\n\r\n              if (confirm(`确定要将 ${count} 处 \"${findText}\" 替换为 \"${replaceText || '(空)'}\" 吗？`)) {\r\n                // 收集所有需要替换的节点组（处理连续的高亮节点）\r\n                const nodeGroups: Array<{ elements: HTMLElement[], parent: Node }> = []\r\n                const processedNodes = new Set<HTMLElement>()\r\n\r\n                currentHighlights.forEach((el) => {\r\n                  if (!(el instanceof HTMLElement) || !el.parentNode || processedNodes.has(el))\r\n                    return\r\n\r\n                  // 收集连续的高亮节点\r\n                  const group: HTMLElement[] = [el]\r\n                  processedNodes.add(el)\r\n\r\n                  // 检查后续兄弟节点是否也是高亮节点\r\n                  let nextSibling = el.nextSibling\r\n                  while (nextSibling) {\r\n                    if (nextSibling instanceof HTMLElement\r\n                      && nextSibling.classList.contains('editor-highlight')\r\n                      && !processedNodes.has(nextSibling)) {\r\n                      group.push(nextSibling)\r\n                      processedNodes.add(nextSibling)\r\n                      nextSibling = nextSibling.nextSibling\r\n                    }\r\n                    else if (nextSibling.nodeType === Node.TEXT_NODE\r\n                      && !nextSibling.textContent?.trim()) {\r\n                      // 跳过空白文本节点\r\n                      nextSibling = nextSibling.nextSibling\r\n                    }\r\n                    else {\r\n                      break\r\n                    }\r\n                  }\r\n\r\n                  nodeGroups.push({ elements: group, parent: el.parentNode })\r\n                })\r\n\r\n                // 执行替换\r\n                let replacedCount = 0\r\n                nodeGroups.forEach(({ elements, parent }) => {\r\n                  try {\r\n                    // 获取组中所有文本\r\n                    const fullText = elements.map(el => el.textContent || '').join('')\r\n                    console.log(`[Replace] Replacing \"${fullText}\" with \"${replaceText}\"`)\r\n\r\n                    // 创建替换文本节点\r\n                    const newTextNode = document.createTextNode(replaceText)\r\n\r\n                    // 替换第一个节点\r\n                    parent.replaceChild(newTextNode, elements[0])\r\n\r\n                    // 删除其余节点\r\n                    for (let i = 1; i < elements.length; i++) {\r\n                      if (elements[i].parentNode)\r\n                        elements[i].remove()\r\n                    }\r\n\r\n                    replacedCount++\r\n                  }\r\n                  catch (e) {\r\n                    console.error('替换失败:', e)\r\n                  }\r\n                })\r\n\r\n                // 显示成功消息\r\n                const successMessage = document.createElement('div')\r\n                successMessage.style.cssText = `\r\n                    position: fixed;\r\n                    bottom: 20px;\r\n                    right: 20px;\r\n                    background: #10b981;\r\n                    color: white;\r\n                    padding: 12px 20px;\r\n                    border-radius: 8px;\r\n                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\r\n                    z-index: 10001;\r\n                  `\r\n                successMessage.textContent = `成功替换 ${replacedCount} 处`\r\n                document.body.appendChild(successMessage)\r\n                setTimeout(() => successMessage.remove(), 3000)\r\n\r\n                console.log(`替换完成: 总计${count}处, 实际替换${replacedCount}处`)\r\n              }\r\n            }\r\n            else if (count > 0) {\r\n              // 仅查找 - 显示结果\r\n              const resultMessage = document.createElement('div')\r\n              resultMessage.style.cssText = `\r\n                  position: fixed;\r\n                  bottom: 20px;\r\n                  right: 20px;\r\n                  background: #3b82f6;\r\n                  color: white;\r\n                  padding: 12px 20px;\r\n                  border-radius: 8px;\r\n                  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\r\n                  z-index: 10001;\r\n                `\r\n              resultMessage.textContent = `找到 ${count} 个匹配项`\r\n              document.body.appendChild(resultMessage)\r\n              setTimeout(() => resultMessage.remove(), 3000)\r\n            }\r\n            else {\r\n              // 没有找到匹配项\r\n              alert(`未找到 \"${findText}\"`)\r\n            }\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 特殊处理：链接插入\r\n      if (item.name === 'link') {\r\n        console.log('[Toolbar] Opening link dialog')\r\n\r\n        // 获取当前选中的文本和范围\r\n        const selection = window.getSelection()\r\n        const selectedText = (selection && selection.toString().trim()) || ''\r\n        let savedRange = null\r\n\r\n        // 保存当前选区\r\n        if (selection && selection.rangeCount > 0)\r\n          savedRange = selection.getRangeAt(0).cloneRange()\r\n\r\n        showUnifiedDialog({\r\n          title: '插入链接',\r\n          width: 500,\r\n          icon: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n            <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path>\r\n            <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path>\r\n          </svg>`,\r\n          fields: [\r\n            {\r\n              id: 'text',\r\n              type: 'text',\r\n              label: '链接文本',\r\n              placeholder: '请输入链接文本',\r\n              required: !selectedText,\r\n              defaultValue: selectedText,\r\n              disabled: !!selectedText,\r\n            },\r\n            {\r\n              id: 'url',\r\n              type: 'url',\r\n              label: '链接地址',\r\n              placeholder: 'https://example.com',\r\n              required: true,\r\n              helpText: '请输入完整的URL地址，包括 http:// 或 https://',\r\n            },\r\n          ],\r\n          onSubmit: (data) => {\r\n            const text = selectedText || data.text\r\n            const url = data.url\r\n            console.log('[Toolbar] Inserting link:', text, url)\r\n\r\n            // 确保编辑器获得焦点\r\n            const editorContent = this.editor.contentElement\r\n            if (editorContent)\r\n              editorContent.focus()\r\n\r\n            // 恢复之前保存的选区\r\n            if (savedRange && selection) {\r\n              selection.removeAllRanges()\r\n              selection.addRange(savedRange)\r\n            }\r\n\r\n            if (selectedText) {\r\n              // 如果有选中文本，为选中的文本创建链接\r\n              const success = document.execCommand('createLink', false, url)\r\n              if (!success && selection && selection.rangeCount > 0) {\r\n                // 如果 execCommand 失败，使用替代方法\r\n                const range = selection.getRangeAt(0)\r\n                const link = document.createElement('a')\r\n                link.href = url\r\n                link.target = '_blank'\r\n                link.textContent = selectedText\r\n                range.deleteContents()\r\n                range.insertNode(link)\r\n                // 将光标移到链接后面\r\n                range.setStartAfter(link)\r\n                range.collapse(true)\r\n                selection.removeAllRanges()\r\n                selection.addRange(range)\r\n              }\r\n            }\r\n            else {\r\n              // 如果没有选中文本，插入新的链接\r\n              const link = document.createElement('a')\r\n              link.href = url\r\n              link.target = '_blank'\r\n              link.textContent = text\r\n\r\n              // 在当前光标位置插入链接\r\n              if (selection && selection.rangeCount > 0) {\r\n                const range = selection.getRangeAt(0)\r\n                range.deleteContents()\r\n                range.insertNode(link)\r\n                // 将光标移到链接后面\r\n                range.setStartAfter(link)\r\n                range.collapse(true)\r\n                selection.removeAllRanges()\r\n                selection.addRange(range)\r\n              }\r\n              else {\r\n                // 如果没有选区，尝试使用 insertHTML\r\n                const linkHtml = `<a href=\"${url}\" target=\"_blank\">${text}</a>`\r\n                document.execCommand('insertHTML', false, linkHtml)\r\n              }\r\n            }\r\n\r\n            // 触发更新事件\r\n            if (this.editor.emit)\r\n              this.editor.emit('update')\r\n          },\r\n        })\r\n        return\r\n      }\r\n\r\n      // 如果command是字符串（命令名称），通过命令管理器执行\r\n      if (typeof item.command === 'string') {\r\n        if (this.editor.commands && this.editor.commands.execute) {\r\n          console.log(`[Toolbar] Executing string command: ${item.command}`)\r\n          this.editor.commands.execute(item.command)\r\n          return\r\n        }\r\n      }\r\n\r\n      // 如果是函数，直接执行\r\n      if (typeof item.command === 'function') {\r\n        console.log(`[Toolbar] Executing function command for: ${item.name}`)\r\n        const state = this.editor.getState()\r\n        // 传递 editor 作为第三个参数\r\n        item.command(state, this.editor.dispatch.bind(this.editor), this.editor)\r\n      }\r\n    })\r\n\r\n    return button\r\n  }\r\n\r\n  /**\r\n   * 是否添加分隔符\r\n   */\r\n  private shouldAddSeparator(index: number, items: ToolbarItem[]): boolean {\r\n    // 在特定组之间添加分隔符\r\n    const separatorAfter = ['redo', 'code', 'heading', 'codeblock', 'taskList', 'indent', 'align', 'horizontalRule', 'fontFamily', 'backgroundColor', 'removeFormat']\r\n    return separatorAfter.includes(items[index].name) && index < items.length - 1\r\n  }\r\n\r\n  /**\r\n   * 更新按钮状态\r\n   */\r\n  private updateButtonStates(): void {\r\n    const items = this.options.items || this.getDefaultItems()\r\n    const state = this.editor.getState()\r\n\r\n    items.forEach((item) => {\r\n      const button = this.buttons.get(item.name)\r\n      if (!button)\r\n        return\r\n\r\n      // 更新激活状态\r\n      if (item.active) {\r\n        const isActive = item.active(state)\r\n        button.classList.toggle('active', isActive)\r\n      }\r\n\r\n      // 更新禁用状态\r\n      if (item.disabled) {\r\n        const isDisabled = item.disabled(state)\r\n        button.disabled = isDisabled\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取默认工具栏项\r\n   */\r\n  public getDefaultItems(): ToolbarItem[] {\r\n    const items: ToolbarItem[] = []\r\n\r\n    console.log('[Toolbar] Getting default items...')\r\n    const plugins = this.editor.plugins.getAll()\r\n    console.log('[Toolbar] Total plugins:', plugins.length)\r\n\r\n    // 从所有插件收集工具栏项\r\n    plugins.forEach((plugin) => {\r\n      console.log(`[Toolbar] Checking plugin: ${plugin.name}`, plugin)\r\n      if (plugin.config && plugin.config.toolbar) {\r\n        console.log(`[Toolbar] Found toolbar config in ${plugin.name}:`, plugin.config.toolbar)\r\n        items.push(...plugin.config.toolbar)\r\n      }\r\n      else {\r\n        console.log(`[Toolbar] No toolbar config in ${plugin.name}`)\r\n      }\r\n    })\r\n\r\n    console.log('[Toolbar] Total toolbar items collected from plugins:', items.length)\r\n\r\n    // 如果插件没有提供工具栏配置，使用默认配置\r\n    if (items.length === 0) {\r\n      console.log('[Toolbar] No items from plugins, using default toolbar')\r\n      return DEFAULT_TOOLBAR_ITEMS\r\n    }\r\n\r\n    return items\r\n  }\r\n\r\n  /**\r\n   * 获取工具栏元素\r\n   */\r\n  getElement(): HTMLElement {\r\n    return this.element\r\n  }\r\n\r\n  /**\r\n   * 销毁工具栏\r\n   */\r\n  destroy(): void {\r\n    this.buttons.clear()\r\n    this.element.remove()\r\n  }\r\n}\r\n"],"names":["Toolbar","constructor","editor","options","buttons","Map","element","document","createElement","className","render","on","updateButtonStates","console","log","items","getDefaultItems","length","forEach","item","index","name","button","createButton","set","appendChild","shouldAddSeparator","separator","container","children","type","title","bindTooltip","setAttribute","isDropdown","includes","style","width","minWidth","paddingLeft","paddingRight","gap","display","alignItems","justifyContent","levelText","fontSize","fontWeight","marginRight","textContent","updateLevelText","selection","window","getSelection","rangeCount","anchorNode","nodeType","Node","TEXT_NODE","parentElement","body","tagName","toUpperCase","closest","addEventListener","contentElement","iconElement","createIcon","icon","chevron","opacity","e","preventDefault","showColorDropdown","color","commands","execute","getCurrentLevel","toLowerCase","currentLevel","showDropdown","label","value","selectedValue","onSelect","map","p","h1","h2","h3","h4","h5","h6","cmd","execCommand","left","center","right","justify","FONT_SIZES","size","FONT_FAMILIES","family","LINE_HEIGHTS","height","command","getCommands","has","warn","renderOption","option","cssText","showMediaInsert","onInsert","urls","alt","focus","insertMedia","emit","multiple","showEmojiDropdown","emoji","selectedText","toString","trim","currentHighlights","showUnifiedDialog","fields","id","placeholder","required","defaultValue","onSubmit","data","content","findText","replaceText","actionType","caseSensitive","wholeWord","escaped","replace","wordBoundary","pattern","RegExp","querySelectorAll","el","text","textNode","createTextNode","parent","parentNode","replaceChild","count","processNode","node","lastIndex","matches","match","exec","push","global","fragment","createDocumentFragment","m","matchIndex","matchText","substring","highlight","background","padding","borderRadius","ELEMENT_NODE","Array","from","childNodes","child","firstMatch","querySelector","HTMLElement","scrollIntoView","behavior","block","alert","confirm","nodeGroups","processedNodes","Set","group","add","nextSibling","classList","contains","elements","replacedCount","fullText","join","newTextNode","i","remove","error","successMessage","setTimeout","resultMessage","savedRange","getRangeAt","cloneRange","disabled","helpText","url","editorContent","removeAllRanges","addRange","success","range","link","href","target","deleteContents","insertNode","setStartAfter","collapse","linkHtml","state","getState","dispatch","bind","separatorAfter","get","active","isActive","toggle","isDisabled","plugins","getAll","plugin","config","toolbar","DEFAULT_TOOLBAR_ITEMS","getElement","destroy","clear"],"mappings":"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"}