{"version":3,"file":"ToolbarManager.cjs","sources":["../../src/ui/ToolbarManager.ts"],"sourcesContent":["/**\r\n * 工具栏管理器\r\n * 支持动态配置、按需加载和性能优化\r\n */\r\n\r\nimport type { Editor } from '../core/Editor'\r\nimport type { ToolbarItem } from '../types'\r\nimport { EventEmitter } from '../core/EventEmitter'\r\nimport { getI18n } from '../i18n'\r\nimport { getIconManager } from '../icons/IconManager'\r\n\r\n/**\r\n * 工具栏组配置\r\n */\r\nexport interface ToolbarGroupConfig {\r\n  name: string\r\n  label?: string\r\n  items: string[]\r\n  visible?: boolean\r\n  collapsed?: boolean\r\n  order?: number\r\n}\r\n\r\n/**\r\n * 工具栏配置\r\n */\r\nexport interface ToolbarManagerConfig {\r\n  groups?: ToolbarGroupConfig[]\r\n  position?: 'top' | 'bottom' | 'float'\r\n  sticky?: boolean\r\n  compact?: boolean\r\n  showLabels?: boolean\r\n  lazyLoad?: boolean\r\n}\r\n\r\n/**\r\n * 工具栏项注册信息\r\n */\r\ninterface ToolbarItemRegistration {\r\n  item: ToolbarItem\r\n  element?: HTMLElement\r\n  loaded: boolean\r\n  visible: boolean\r\n  group?: string\r\n}\r\n\r\n/**\r\n * 工具栏管理器类\r\n */\r\nexport class ToolbarManager extends EventEmitter {\r\n  private editor: Editor\r\n  private config: ToolbarManagerConfig\r\n  private container: HTMLElement\r\n  private items: Map<string, ToolbarItemRegistration> = new Map()\r\n  private groups: Map<string, ToolbarGroupConfig> = new Map()\r\n  private visibleItems: Set<string> = new Set()\r\n  private observer?: IntersectionObserver\r\n\r\n  constructor(editor: Editor, config: ToolbarManagerConfig = {}) {\r\n    super()\r\n    this.editor = editor\r\n    this.config = {\r\n      position: 'top',\r\n      sticky: true,\r\n      compact: false,\r\n      showLabels: false,\r\n      lazyLoad: true,\r\n      ...config,\r\n    }\r\n\r\n    this.container = this.createContainer()\r\n    this.setupIntersectionObserver()\r\n  }\r\n\r\n  /**\r\n   * 创建容器\r\n   */\r\n  private createContainer(): HTMLElement {\r\n    const container = document.createElement('div')\r\n    container.className = 'editor-toolbar'\r\n\r\n    if (this.config.sticky)\r\n      container.classList.add('editor-toolbar-sticky')\r\n\r\n    if (this.config.compact)\r\n      container.classList.add('editor-toolbar-compact')\r\n\r\n    container.style.cssText = `\r\n      display: flex;\r\n      gap: 8px;\r\n      padding: 8px;\r\n      background: var(--editor-color-toolbar-background, #ffffff);\r\n      border-bottom: 1px solid var(--editor-color-border, #e5e7eb);\r\n      overflow-x: auto;\r\n    `\r\n\r\n    return container\r\n  }\r\n\r\n  /**\r\n   * 设置交叉观察器（用于按需加载）\r\n   */\r\n  private setupIntersectionObserver(): void {\r\n    if (!this.config.lazyLoad)\r\n      return\r\n\r\n    this.observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          const itemName = entry.target.getAttribute('data-item-name')\r\n          if (itemName && entry.isIntersecting)\r\n            this.loadItem(itemName)\r\n        })\r\n      },\r\n      { threshold: 0.1 },\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 注册工具栏项\r\n   */\r\n  registerItem(item: ToolbarItem, group?: string): void {\r\n    if (this.items.has(item.name)) {\r\n      console.warn(`Toolbar item \"${item.name}\" is already registered`)\r\n      return\r\n    }\r\n\r\n    this.items.set(item.name, {\r\n      item,\r\n      loaded: false,\r\n      visible: true,\r\n      group,\r\n    })\r\n\r\n    this.emit('item:registered', { name: item.name, group })\r\n  }\r\n\r\n  /**\r\n   * 批量注册工具栏项\r\n   */\r\n  registerBatch(items: ToolbarItem[], group?: string): void {\r\n    items.forEach(item => this.registerItem(item, group))\r\n  }\r\n\r\n  /**\r\n   * 注册工具栏组\r\n   */\r\n  registerGroup(config: ToolbarGroupConfig): void {\r\n    this.groups.set(config.name, {\r\n      visible: true,\r\n      collapsed: false,\r\n      order: 0,\r\n      ...config,\r\n    })\r\n\r\n    this.emit('group:registered', { name: config.name })\r\n  }\r\n\r\n  /**\r\n   * 加载工具栏项\r\n   */\r\n  private async loadItem(name: string): Promise<void> {\r\n    const registration = this.items.get(name)\r\n\r\n    if (!registration || registration.loaded)\r\n      return\r\n\r\n    try {\r\n      const element = await this.createItemElement(registration.item)\r\n      registration.element = element\r\n      registration.loaded = true\r\n\r\n      // 替换占位符\r\n      const placeholder = this.container.querySelector(`[data-item-name=\"${name}\"]`)\r\n      if (placeholder && element)\r\n        placeholder.replaceWith(element)\r\n\r\n      this.emit('item:loaded', { name })\r\n    }\r\n    catch (error) {\r\n      console.error(`Failed to load toolbar item \"${name}\":`, error)\r\n      this.emit('item:error', { name, error })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建工具栏项元素\r\n   */\r\n  private async createItemElement(item: ToolbarItem): Promise<HTMLElement> {\r\n    const button = document.createElement('button')\r\n    button.type = 'button'\r\n    button.className = 'toolbar-item'\r\n    button.setAttribute('data-item-name', item.name)\r\n\r\n    if (item.title) {\r\n      const i18n = getI18n()\r\n      button.title = i18n.t(item.title) || item.title\r\n    }\r\n\r\n    // 添加图标\r\n    if (item.icon) {\r\n      const iconManager = getIconManager()\r\n      const icon = iconManager.createIconElement(item.icon, { size: 18 })\r\n      button.appendChild(icon)\r\n    }\r\n\r\n    // 添加标签\r\n    if (this.config.showLabels && item.title) {\r\n      const label = document.createElement('span')\r\n      label.className = 'toolbar-item-label'\r\n      label.textContent = item.title\r\n      button.appendChild(label)\r\n    }\r\n\r\n    // 绑定事件\r\n    if (typeof item.command === 'function') {\r\n      button.addEventListener('click', (e) => {\r\n        e.preventDefault()\r\n        const state = this.editor.getState()\r\n        item.command(state, () => {}, this.editor)\r\n      })\r\n    }\r\n\r\n    // 应用样式\r\n    button.style.cssText = `\r\n      display: inline-flex;\r\n      align-items: center;\r\n      gap: 4px;\r\n      padding: 6px 10px;\r\n      border: none;\r\n      border-radius: 4px;\r\n      background: transparent;\r\n      color: var(--editor-color-text-primary, #374151);\r\n      cursor: pointer;\r\n      transition: all 0.2s;\r\n    `\r\n\r\n    button.addEventListener('mouseenter', () => {\r\n      button.style.background = 'var(--editor-color-toolbar-button-hover, #f3f4f6)'\r\n    })\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      button.style.background = 'transparent'\r\n    })\r\n\r\n    return button\r\n  }\r\n\r\n  /**\r\n   * 创建占位符元素\r\n   */\r\n  private createPlaceholder(name: string): HTMLElement {\r\n    const placeholder = document.createElement('div')\r\n    placeholder.className = 'toolbar-item-placeholder'\r\n    placeholder.setAttribute('data-item-name', name)\r\n    placeholder.style.cssText = `\r\n      width: 36px;\r\n      height: 32px;\r\n      background: var(--editor-color-background-paper, #f9fafb);\r\n      border-radius: 4px;\r\n    `\r\n    return placeholder\r\n  }\r\n\r\n  /**\r\n   * 渲染工具栏\r\n   */\r\n  render(): HTMLElement {\r\n    this.container.innerHTML = ''\r\n\r\n    if (this.config.groups && this.config.groups.length > 0)\r\n      this.renderGroups()\r\n    else\r\n      this.renderFlat()\r\n\r\n    return this.container\r\n  }\r\n\r\n  /**\r\n   * 渲染分组工具栏\r\n   */\r\n  private renderGroups(): void {\r\n    const sortedGroups = Array.from(this.groups.values())\r\n      .sort((a, b) => (a.order || 0) - (b.order || 0))\r\n\r\n    sortedGroups.forEach((group) => {\r\n      if (!group.visible)\r\n        return\r\n\r\n      const groupEl = document.createElement('div')\r\n      groupEl.className = 'toolbar-group'\r\n      groupEl.setAttribute('data-group-name', group.name)\r\n\r\n      if (group.label) {\r\n        const label = document.createElement('span')\r\n        label.className = 'toolbar-group-label'\r\n        label.textContent = group.label\r\n        groupEl.appendChild(label)\r\n      }\r\n\r\n      const itemsContainer = document.createElement('div')\r\n      itemsContainer.className = 'toolbar-group-items'\r\n      itemsContainer.style.cssText = `\r\n        display: flex;\r\n        gap: 4px;\r\n      `\r\n\r\n      group.items.forEach((itemName) => {\r\n        const registration = this.items.get(itemName)\r\n        if (!registration || !registration.visible)\r\n          return\r\n\r\n        if (this.config.lazyLoad && !registration.loaded) {\r\n          const placeholder = this.createPlaceholder(itemName)\r\n          itemsContainer.appendChild(placeholder)\r\n          this.observer?.observe(placeholder)\r\n        }\r\n        else {\r\n          this.loadItem(itemName).then(() => {\r\n            if (registration.element)\r\n              itemsContainer.appendChild(registration.element)\r\n          })\r\n        }\r\n      })\r\n\r\n      groupEl.appendChild(itemsContainer)\r\n      this.container.appendChild(groupEl)\r\n\r\n      // 添加分隔符\r\n      const separator = document.createElement('div')\r\n      separator.className = 'toolbar-separator'\r\n      separator.style.cssText = `\r\n        width: 1px;\r\n        height: 24px;\r\n        background: var(--editor-color-border, #e5e7eb);\r\n        margin: 0 4px;\r\n      `\r\n      this.container.appendChild(separator)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 渲染扁平工具栏\r\n   */\r\n  private renderFlat(): void {\r\n    this.items.forEach((registration, name) => {\r\n      if (!registration.visible)\r\n        return\r\n\r\n      if (this.config.lazyLoad && !registration.loaded) {\r\n        const placeholder = this.createPlaceholder(name)\r\n        this.container.appendChild(placeholder)\r\n        this.observer?.observe(placeholder)\r\n      }\r\n      else {\r\n        this.loadItem(name).then(() => {\r\n          if (registration.element)\r\n            this.container.appendChild(registration.element)\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 显示工具栏项\r\n   */\r\n  showItem(name: string): void {\r\n    const registration = this.items.get(name)\r\n    if (!registration)\r\n      return\r\n\r\n    registration.visible = true\r\n    this.visibleItems.add(name)\r\n\r\n    if (registration.element)\r\n      registration.element.style.display = 'inline-flex'\r\n\r\n    this.emit('item:shown', { name })\r\n  }\r\n\r\n  /**\r\n   * 隐藏工具栏项\r\n   */\r\n  hideItem(name: string): void {\r\n    const registration = this.items.get(name)\r\n    if (!registration)\r\n      return\r\n\r\n    registration.visible = false\r\n    this.visibleItems.delete(name)\r\n\r\n    if (registration.element)\r\n      registration.element.style.display = 'none'\r\n\r\n    this.emit('item:hidden', { name })\r\n  }\r\n\r\n  /**\r\n   * 显示工具栏组\r\n   */\r\n  showGroup(name: string): void {\r\n    const group = this.groups.get(name)\r\n    if (!group)\r\n      return\r\n\r\n    group.visible = true\r\n    group.items.forEach(item => this.showItem(item))\r\n\r\n    this.emit('group:shown', { name })\r\n  }\r\n\r\n  /**\r\n   * 隐藏工具栏组\r\n   */\r\n  hideGroup(name: string): void {\r\n    const group = this.groups.get(name)\r\n    if (!group)\r\n      return\r\n\r\n    group.visible = false\r\n    group.items.forEach(item => this.hideItem(item))\r\n\r\n    this.emit('group:hidden', { name })\r\n  }\r\n\r\n  /**\r\n   * 更新工具栏配置\r\n   */\r\n  updateConfig(config: Partial<ToolbarManagerConfig>): void {\r\n    this.config = { ...this.config, ...config }\r\n    this.render()\r\n    this.emit('config:updated', config)\r\n  }\r\n\r\n  /**\r\n   * 获取容器\r\n   */\r\n  getContainer(): HTMLElement {\r\n    return this.container\r\n  }\r\n\r\n  /**\r\n   * 获取统计信息\r\n   */\r\n  getStats(): {\r\n    total: number\r\n    loaded: number\r\n    visible: number\r\n    groups: number\r\n  } {\r\n    return {\r\n      total: this.items.size,\r\n      loaded: Array.from(this.items.values()).filter(r => r.loaded).length,\r\n      visible: this.visibleItems.size,\r\n      groups: this.groups.size,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy(): void {\r\n    this.observer?.disconnect()\r\n    this.container.remove()\r\n    this.items.clear()\r\n    this.groups.clear()\r\n    this.visibleItems.clear()\r\n    // EventEmitter 基类没有 removeAllListeners 方法\r\n    // 清空所有事件监听器\r\n  }\r\n}\r\n"],"names":["ToolbarManager","EventEmitter","constructor","editor","config","items","Map","groups","visibleItems","Set","position","sticky","compact","showLabels","lazyLoad","container","createContainer","setupIntersectionObserver","document","createElement","className","classList","add","style","cssText","observer","IntersectionObserver","entries","forEach","entry","itemName","target","getAttribute","isIntersecting","loadItem","threshold","registerItem","item","group","has","name","console","warn","set","loaded","visible","emit","registerBatch","registerGroup","collapsed","order","registration","get","element","createItemElement","placeholder","querySelector","replaceWith","error","button","type","setAttribute","title","i18n","getI18n","t","icon","iconManager","getIconManager","createIconElement","size","appendChild","label","textContent","command","addEventListener","e","preventDefault","state","getState","background","createPlaceholder","render","innerHTML","length","renderGroups","renderFlat","sortedGroups","Array","from","values","sort","a","b","groupEl","itemsContainer","observe","then","separator","showItem","display","hideItem","delete","showGroup","hideGroup","updateConfig","getContainer","getStats","total","filter","r","destroy","disconnect","remove","clear"],"mappings":";;;;;;;;;;;;;;;AAiDO,MAAMA,uBAAuBC,kBAAAA,CAAa;AAAA,EAS/CC,WAAAA,CAAYC,MAAAA,EAAgBC,MAAAA,GAA+B,EAAC,EAAG;AAC7D,IAAA,KAAA,EAAM;AANR,IAAA,IAAA,CAAQC,KAAAA,uBAAkDC,GAAAA,EAAI;AAC9D,IAAA,IAAA,CAAQC,MAAAA,uBAA8CD,GAAAA,EAAI;AAC1D,IAAA,IAAA,CAAQE,YAAAA,uBAAgCC,GAAAA,EAAI;AAK1C,IAAA,IAAA,CAAKN,MAAAA,GAASA,MAAAA;AACd,IAAA,IAAA,CAAKC,MAAAA,GAAS;AAAA,MACZM,QAAAA,EAAU,KAAA;AAAA,MACVC,MAAAA,EAAQ,IAAA;AAAA,MACRC,OAAAA,EAAS,KAAA;AAAA,MACTC,UAAAA,EAAY,KAAA;AAAA,MACZC,QAAAA,EAAU,IAAA;AAAA,MACV,GAAGV;AAAAA,KACL;AAEA,IAAA,IAAA,CAAKW,SAAAA,GAAY,KAAKC,eAAAA,EAAgB;AACtC,IAAA,IAAA,CAAKC,yBAAAA,EAA0B;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQD,eAAAA,GAA+B;AACrC,IAAA,MAAMD,SAAAA,GAAYG,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC9CJ,IAAAA,SAAAA,CAAUK,SAAAA,GAAY,gBAAA;AAEtB,IAAA,IAAI,KAAKhB,MAAAA,CAAOO,MAAAA;AACdI,MAAAA,SAAAA,CAAUM,SAAAA,CAAUC,IAAI,uBAAuB,CAAA;AAEjD,IAAA,IAAI,KAAKlB,MAAAA,CAAOQ,OAAAA;AACdG,MAAAA,SAAAA,CAAUM,SAAAA,CAAUC,IAAI,wBAAwB,CAAA;AAElDP,IAAAA,SAAAA,CAAUQ,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAS1B,IAAA,OAAOT,SAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQE,yBAAAA,GAAkC;AACxC,IAAA,IAAI,CAAC,KAAKb,MAAAA,CAAOU,QAAAA;AACf,MAAA;AAEF,IAAA,IAAA,CAAKW,QAAAA,GAAW,IAAIC,oBAAAA,CACjBC,CAAAA,OAAAA,KAAY;AACXA,MAAAA,OAAAA,CAAQC,QAASC,CAAAA,KAAAA,KAAU;AACzB,QAAA,MAAMC,QAAAA,GAAWD,KAAAA,CAAME,MAAAA,CAAOC,YAAAA,CAAa,gBAAgB,CAAA;AAC3D,QAAA,IAAIF,YAAYD,KAAAA,CAAMI,cAAAA;AACpB,UAAA,IAAA,CAAKC,SAASJ,QAAQ,CAAA;AAAA,MAC1B,CAAC,CAAA;AAAA,IACH,CAAA,EACA;AAAA,MAAEK,SAAAA,EAAW;AAAA,KACf,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKAC,YAAAA,CAAaC,MAAmBC,KAAAA,EAAsB;AACpD,IAAA,IAAI,IAAA,CAAKjC,KAAAA,CAAMkC,GAAAA,CAAIF,IAAAA,CAAKG,IAAI,CAAA,EAAG;AAC7BC,MAAAA,OAAAA,CAAQC,IAAAA,CAAK,CAAA,cAAA,EAAiBL,IAAAA,CAAKG,IAAI,CAAA,uBAAA,CAAyB,CAAA;AAChE,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAKnC,KAAAA,CAAMsC,GAAAA,CAAIN,IAAAA,CAAKG,IAAAA,EAAM;AAAA,MACxBH,IAAAA;AAAAA,MACAO,MAAAA,EAAQ,KAAA;AAAA,MACRC,OAAAA,EAAS,IAAA;AAAA,MACTP;AAAAA,KACD,CAAA;AAED,IAAA,IAAA,CAAKQ,KAAK,iBAAA,EAAmB;AAAA,MAAEN,MAAMH,IAAAA,CAAKG,IAAAA;AAAAA,MAAMF;AAAAA,KAAO,CAAA;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKAS,aAAAA,CAAc1C,OAAsBiC,KAAAA,EAAsB;AACxDjC,IAAAA,KAAAA,CAAMuB,QAAQS,CAAAA,IAAAA,KAAQ,IAAA,CAAKD,YAAAA,CAAaC,IAAAA,EAAMC,KAAK,CAAC,CAAA;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKAU,cAAc5C,MAAAA,EAAkC;AAC9C,IAAA,IAAA,CAAKG,MAAAA,CAAOoC,GAAAA,CAAIvC,MAAAA,CAAOoC,IAAAA,EAAM;AAAA,MAC3BK,OAAAA,EAAS,IAAA;AAAA,MACTI,SAAAA,EAAW,KAAA;AAAA,MACXC,KAAAA,EAAO,CAAA;AAAA,MACP,GAAG9C;AAAAA,KACJ,CAAA;AAED,IAAA,IAAA,CAAK0C,KAAK,kBAAA,EAAoB;AAAA,MAAEN,MAAMpC,MAAAA,CAAOoC;AAAAA,KAAM,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAcN,SAASM,IAAAA,EAA6B;AAClD,IAAA,MAAMW,YAAAA,GAAe,IAAA,CAAK9C,KAAAA,CAAM+C,GAAAA,CAAIZ,IAAI,CAAA;AAExC,IAAA,IAAI,CAACW,gBAAgBA,YAAAA,CAAaP,MAAAA;AAChC,MAAA;AAEF,IAAA,IAAI;AACF,MAAA,MAAMS,OAAAA,GAAU,MAAM,IAAA,CAAKC,iBAAAA,CAAkBH,aAAad,IAAI,CAAA;AAC9Dc,MAAAA,YAAAA,CAAaE,OAAAA,GAAUA,OAAAA;AACvBF,MAAAA,YAAAA,CAAaP,MAAAA,GAAS,IAAA;AAGtB,MAAA,MAAMW,cAAc,IAAA,CAAKxC,SAAAA,CAAUyC,aAAAA,CAAc,CAAA,iBAAA,EAAoBhB,IAAI,CAAA,EAAA,CAAI,CAAA;AAC7E,MAAA,IAAIe,WAAAA,IAAeF,OAAAA;AACjBE,QAAAA,WAAAA,CAAYE,YAAYJ,OAAO,CAAA;AAEjC,MAAA,IAAA,CAAKP,KAAK,aAAA,EAAe;AAAA,QAAEN;AAAAA,OAAM,CAAA;AAAA,IACnC,SACOkB,KAAAA,EAAO;AACZjB,MAAAA,OAAAA,CAAQiB,KAAAA,CAAM,CAAA,6BAAA,EAAgClB,IAAI,CAAA,EAAA,CAAA,EAAMkB,KAAK,CAAA;AAC7D,MAAA,IAAA,CAAKZ,KAAK,YAAA,EAAc;AAAA,QAAEN,IAAAA;AAAAA,QAAMkB;AAAAA,OAAO,CAAA;AAAA,IACzC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAcJ,kBAAkBjB,IAAAA,EAAyC;AACvE,IAAA,MAAMsB,MAAAA,GAASzC,QAAAA,CAASC,aAAAA,CAAc,QAAQ,CAAA;AAC9CwC,IAAAA,MAAAA,CAAOC,IAAAA,GAAO,QAAA;AACdD,IAAAA,MAAAA,CAAOvC,SAAAA,GAAY,cAAA;AACnBuC,IAAAA,MAAAA,CAAOE,YAAAA,CAAa,gBAAA,EAAkBxB,IAAAA,CAAKG,IAAI,CAAA;AAE/C,IAAA,IAAIH,KAAKyB,KAAAA,EAAO;AACd,MAAA,MAAMC,OAAOC,aAAAA,EAAQ;AACrBL,MAAAA,MAAAA,CAAOG,QAAQC,IAAAA,CAAKE,CAAAA,CAAE5B,IAAAA,CAAKyB,KAAK,KAAKzB,IAAAA,CAAKyB,KAAAA;AAAAA,IAC5C;AAGA,IAAA,IAAIzB,KAAK6B,IAAAA,EAAM;AACb,MAAA,MAAMC,cAAcC,0BAAAA,EAAe;AACnC,MAAA,MAAMF,IAAAA,GAAOC,WAAAA,CAAYE,iBAAAA,CAAkBhC,IAAAA,CAAK6B,IAAAA,EAAM;AAAA,QAAEI,IAAAA,EAAM;AAAA,OAAI,CAAA;AAClEX,MAAAA,MAAAA,CAAOY,YAAYL,IAAI,CAAA;AAAA,IACzB;AAGA,IAAA,IAAI,IAAA,CAAK9D,MAAAA,CAAOS,UAAAA,IAAcwB,IAAAA,CAAKyB,KAAAA,EAAO;AACxC,MAAA,MAAMU,KAAAA,GAAQtD,QAAAA,CAASC,aAAAA,CAAc,MAAM,CAAA;AAC3CqD,MAAAA,KAAAA,CAAMpD,SAAAA,GAAY,oBAAA;AAClBoD,MAAAA,KAAAA,CAAMC,cAAcpC,IAAAA,CAAKyB,KAAAA;AACzBH,MAAAA,MAAAA,CAAOY,YAAYC,KAAK,CAAA;AAAA,IAC1B;AAGA,IAAA,IAAI,OAAOnC,IAAAA,CAAKqC,OAAAA,KAAY,UAAA,EAAY;AACtCf,MAAAA,MAAAA,CAAOgB,gBAAAA,CAAiB,SAAUC,CAAAA,CAAAA,KAAM;AACtCA,QAAAA,CAAAA,CAAEC,cAAAA,EAAe;AACjB,QAAA,MAAMC,KAAAA,GAAQ,IAAA,CAAK3E,MAAAA,CAAO4E,QAAAA,EAAS;AACnC1C,QAAAA,IAAAA,CAAKqC,OAAAA,CAAQI,OAAO,MAAM;AAAA,QAAC,CAAA,EAAG,KAAK3E,MAAM,CAAA;AAAA,MAC3C,CAAC,CAAA;AAAA,IACH;AAGAwD,IAAAA,MAAAA,CAAOpC,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAavBmC,IAAAA,MAAAA,CAAOgB,gBAAAA,CAAiB,cAAc,MAAM;AAC1ChB,MAAAA,MAAAA,CAAOpC,MAAMyD,UAAAA,GAAa,mDAAA;AAAA,IAC5B,CAAC,CAAA;AAEDrB,IAAAA,MAAAA,CAAOgB,gBAAAA,CAAiB,cAAc,MAAM;AAC1ChB,MAAAA,MAAAA,CAAOpC,MAAMyD,UAAAA,GAAa,aAAA;AAAA,IAC5B,CAAC,CAAA;AAED,IAAA,OAAOrB,MAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQsB,kBAAkBzC,IAAAA,EAA2B;AACnD,IAAA,MAAMe,WAAAA,GAAcrC,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAChDoC,IAAAA,WAAAA,CAAYnC,SAAAA,GAAY,0BAAA;AACxBmC,IAAAA,WAAAA,CAAYM,YAAAA,CAAa,kBAAkBrB,IAAI,CAAA;AAC/Ce,IAAAA,WAAAA,CAAYhC,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAM5B,IAAA,OAAO+B,WAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA2B,MAAAA,GAAsB;AACpB,IAAA,IAAA,CAAKnE,UAAUoE,SAAAA,GAAY,EAAA;AAE3B,IAAA,IAAI,KAAK/E,MAAAA,CAAOG,MAAAA,IAAU,IAAA,CAAKH,MAAAA,CAAOG,OAAO6E,MAAAA,GAAS,CAAA;AACpD,MAAA,IAAA,CAAKC,YAAAA,EAAa;AAAA;AAElB,MAAA,IAAA,CAAKC,UAAAA,EAAW;AAElB,IAAA,OAAO,IAAA,CAAKvE,SAAAA;AAAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKQsE,YAAAA,GAAqB;AAC3B,IAAA,MAAME,eAAeC,KAAAA,CAAMC,IAAAA,CAAK,IAAA,CAAKlF,MAAAA,CAAOmF,QAAQ,CAAA,CACjDC,IAAAA,CAAK,CAACC,GAAGC,CAAAA,KAAAA,CAAOD,CAAAA,CAAE1C,SAAS,CAAA,KAAM2C,CAAAA,CAAE3C,SAAS,CAAA,CAAE,CAAA;AAEjDqC,IAAAA,YAAAA,CAAa3D,QAASU,CAAAA,KAAAA,KAAU;AAC9B,MAAA,IAAI,CAACA,KAAAA,CAAMO,OAAAA;AACT,QAAA;AAEF,MAAA,MAAMiD,OAAAA,GAAU5E,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC5C2E,MAAAA,OAAAA,CAAQ1E,SAAAA,GAAY,eAAA;AACpB0E,MAAAA,OAAAA,CAAQjC,YAAAA,CAAa,iBAAA,EAAmBvB,KAAAA,CAAME,IAAI,CAAA;AAElD,MAAA,IAAIF,MAAMkC,KAAAA,EAAO;AACf,QAAA,MAAMA,KAAAA,GAAQtD,QAAAA,CAASC,aAAAA,CAAc,MAAM,CAAA;AAC3CqD,QAAAA,KAAAA,CAAMpD,SAAAA,GAAY,qBAAA;AAClBoD,QAAAA,KAAAA,CAAMC,cAAcnC,KAAAA,CAAMkC,KAAAA;AAC1BsB,QAAAA,OAAAA,CAAQvB,YAAYC,KAAK,CAAA;AAAA,MAC3B;AAEA,MAAA,MAAMuB,cAAAA,GAAiB7E,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AACnD4E,MAAAA,cAAAA,CAAe3E,SAAAA,GAAY,qBAAA;AAC3B2E,MAAAA,cAAAA,CAAexE,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA,MAAA,CAAA;AAK/Bc,MAAAA,KAAAA,CAAMjC,KAAAA,CAAMuB,QAASE,CAAAA,QAAAA,KAAa;AAChC,QAAA,MAAMqB,YAAAA,GAAe,IAAA,CAAK9C,KAAAA,CAAM+C,GAAAA,CAAItB,QAAQ,CAAA;AAC5C,QAAA,IAAI,CAACqB,YAAAA,IAAgB,CAACA,YAAAA,CAAaN,OAAAA;AACjC,UAAA;AAEF,QAAA,IAAI,IAAA,CAAKzC,MAAAA,CAAOU,QAAAA,IAAY,CAACqC,aAAaP,MAAAA,EAAQ;AAChD,UAAA,MAAMW,WAAAA,GAAc,IAAA,CAAK0B,iBAAAA,CAAkBnD,QAAQ,CAAA;AACnDiE,UAAAA,cAAAA,CAAexB,YAAYhB,WAAW,CAAA;AACtC,UAAA,IAAA,CAAK9B,QAAAA,EAAUuE,QAAQzC,WAAW,CAAA;AAAA,QACpC,CAAA,MACK;AACH,UAAA,IAAA,CAAKrB,QAAAA,CAASJ,QAAQ,CAAA,CAAEmE,IAAAA,CAAK,MAAM;AACjC,YAAA,IAAI9C,YAAAA,CAAaE,OAAAA;AACf0C,cAAAA,cAAAA,CAAexB,WAAAA,CAAYpB,aAAaE,OAAO,CAAA;AAAA,UACnD,CAAC,CAAA;AAAA,QACH;AAAA,MACF,CAAC,CAAA;AAEDyC,MAAAA,OAAAA,CAAQvB,YAAYwB,cAAc,CAAA;AAClC,MAAA,IAAA,CAAKhF,SAAAA,CAAUwD,YAAYuB,OAAO,CAAA;AAGlC,MAAA,MAAMI,SAAAA,GAAYhF,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC9C+E,MAAAA,SAAAA,CAAU9E,SAAAA,GAAY,mBAAA;AACtB8E,MAAAA,SAAAA,CAAU3E,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA,MAAA,CAAA;AAM1B,MAAA,IAAA,CAAKT,SAAAA,CAAUwD,YAAY2B,SAAS,CAAA;AAAA,IACtC,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQZ,UAAAA,GAAmB;AACzB,IAAA,IAAA,CAAKjF,KAAAA,CAAMuB,OAAAA,CAAQ,CAACuB,YAAAA,EAAcX,IAAAA,KAAS;AACzC,MAAA,IAAI,CAACW,YAAAA,CAAaN,OAAAA;AAChB,QAAA;AAEF,MAAA,IAAI,IAAA,CAAKzC,MAAAA,CAAOU,QAAAA,IAAY,CAACqC,aAAaP,MAAAA,EAAQ;AAChD,QAAA,MAAMW,WAAAA,GAAc,IAAA,CAAK0B,iBAAAA,CAAkBzC,IAAI,CAAA;AAC/C,QAAA,IAAA,CAAKzB,SAAAA,CAAUwD,YAAYhB,WAAW,CAAA;AACtC,QAAA,IAAA,CAAK9B,QAAAA,EAAUuE,QAAQzC,WAAW,CAAA;AAAA,MACpC,CAAA,MACK;AACH,QAAA,IAAA,CAAKrB,QAAAA,CAASM,IAAI,CAAA,CAAEyD,IAAAA,CAAK,MAAM;AAC7B,UAAA,IAAI9C,YAAAA,CAAaE,OAAAA;AACf,YAAA,IAAA,CAAKtC,SAAAA,CAAUwD,WAAAA,CAAYpB,YAAAA,CAAaE,OAAO,CAAA;AAAA,QACnD,CAAC,CAAA;AAAA,MACH;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA8C,SAAS3D,IAAAA,EAAoB;AAC3B,IAAA,MAAMW,YAAAA,GAAe,IAAA,CAAK9C,KAAAA,CAAM+C,GAAAA,CAAIZ,IAAI,CAAA;AACxC,IAAA,IAAI,CAACW,YAAAA;AACH,MAAA;AAEFA,IAAAA,YAAAA,CAAaN,OAAAA,GAAU,IAAA;AACvB,IAAA,IAAA,CAAKrC,YAAAA,CAAac,IAAIkB,IAAI,CAAA;AAE1B,IAAA,IAAIW,YAAAA,CAAaE,OAAAA;AACfF,MAAAA,YAAAA,CAAaE,OAAAA,CAAQ9B,MAAM6E,OAAAA,GAAU,aAAA;AAEvC,IAAA,IAAA,CAAKtD,KAAK,YAAA,EAAc;AAAA,MAAEN;AAAAA,KAAM,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA6D,SAAS7D,IAAAA,EAAoB;AAC3B,IAAA,MAAMW,YAAAA,GAAe,IAAA,CAAK9C,KAAAA,CAAM+C,GAAAA,CAAIZ,IAAI,CAAA;AACxC,IAAA,IAAI,CAACW,YAAAA;AACH,MAAA;AAEFA,IAAAA,YAAAA,CAAaN,OAAAA,GAAU,KAAA;AACvB,IAAA,IAAA,CAAKrC,YAAAA,CAAa8F,OAAO9D,IAAI,CAAA;AAE7B,IAAA,IAAIW,YAAAA,CAAaE,OAAAA;AACfF,MAAAA,YAAAA,CAAaE,OAAAA,CAAQ9B,MAAM6E,OAAAA,GAAU,MAAA;AAEvC,IAAA,IAAA,CAAKtD,KAAK,aAAA,EAAe;AAAA,MAAEN;AAAAA,KAAM,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA+D,UAAU/D,IAAAA,EAAoB;AAC5B,IAAA,MAAMF,KAAAA,GAAQ,IAAA,CAAK/B,MAAAA,CAAO6C,GAAAA,CAAIZ,IAAI,CAAA;AAClC,IAAA,IAAI,CAACF,KAAAA;AACH,MAAA;AAEFA,IAAAA,KAAAA,CAAMO,OAAAA,GAAU,IAAA;AAChBP,IAAAA,KAAAA,CAAMjC,MAAMuB,OAAAA,CAAQS,CAAAA,IAAAA,KAAQ,IAAA,CAAK8D,QAAAA,CAAS9D,IAAI,CAAC,CAAA;AAE/C,IAAA,IAAA,CAAKS,KAAK,aAAA,EAAe;AAAA,MAAEN;AAAAA,KAAM,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKAgE,UAAUhE,IAAAA,EAAoB;AAC5B,IAAA,MAAMF,KAAAA,GAAQ,IAAA,CAAK/B,MAAAA,CAAO6C,GAAAA,CAAIZ,IAAI,CAAA;AAClC,IAAA,IAAI,CAACF,KAAAA;AACH,MAAA;AAEFA,IAAAA,KAAAA,CAAMO,OAAAA,GAAU,KAAA;AAChBP,IAAAA,KAAAA,CAAMjC,MAAMuB,OAAAA,CAAQS,CAAAA,IAAAA,KAAQ,IAAA,CAAKgE,QAAAA,CAAShE,IAAI,CAAC,CAAA;AAE/C,IAAA,IAAA,CAAKS,KAAK,cAAA,EAAgB;AAAA,MAAEN;AAAAA,KAAM,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKAiE,aAAarG,MAAAA,EAA6C;AACxD,IAAA,IAAA,CAAKA,MAAAA,GAAS;AAAA,MAAE,GAAG,IAAA,CAAKA,MAAAA;AAAAA,MAAQ,GAAGA;AAAAA,KAAO;AAC1C,IAAA,IAAA,CAAK8E,MAAAA,EAAO;AACZ,IAAA,IAAA,CAAKpC,IAAAA,CAAK,kBAAkB1C,MAAM,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKAsG,YAAAA,GAA4B;AAC1B,IAAA,OAAO,IAAA,CAAK3F,SAAAA;AAAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA4F,QAAAA,GAKE;AACA,IAAA,OAAO;AAAA,MACLC,KAAAA,EAAO,KAAKvG,KAAAA,CAAMiE,IAAAA;AAAAA,MAClB1B,MAAAA,EAAQ4C,KAAAA,CAAMC,IAAAA,CAAK,IAAA,CAAKpF,KAAAA,CAAMqF,MAAAA,EAAQ,CAAA,CAAEmB,MAAAA,CAAOC,CAAAA,CAAAA,KAAKA,CAAAA,CAAElE,MAAM,CAAA,CAAEwC,MAAAA;AAAAA,MAC9DvC,OAAAA,EAAS,KAAKrC,YAAAA,CAAa8D,IAAAA;AAAAA,MAC3B/D,MAAAA,EAAQ,KAAKA,MAAAA,CAAO+D;AAAAA,KACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKAyC,OAAAA,GAAgB;AACd,IAAA,IAAA,CAAKtF,UAAUuF,UAAAA,EAAW;AAC1B,IAAA,IAAA,CAAKjG,UAAUkG,MAAAA,EAAO;AACtB,IAAA,IAAA,CAAK5G,MAAM6G,KAAAA,EAAM;AACjB,IAAA,IAAA,CAAK3G,OAAO2G,KAAAA,EAAM;AAClB,IAAA,IAAA,CAAK1G,aAAa0G,KAAAA,EAAM;AAAA,EAG1B;AACF;;;;;;;"}