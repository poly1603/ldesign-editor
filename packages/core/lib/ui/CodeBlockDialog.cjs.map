{"version":3,"file":"CodeBlockDialog.cjs","sources":["../../src/ui/CodeBlockDialog.ts"],"sourcesContent":["/**\r\n * 代码块插入对话框\r\n * 类似 LinkDialog 的实现方式\r\n */\r\n\r\nexport interface CodeBlockDialogOptions {\r\n  selectedText?: string\r\n  onConfirm?: (code: string, language: string, theme: string) => void\r\n  onCancel?: () => void\r\n}\r\n\r\n/**\r\n * 显示代码块插入对话框\r\n */\r\nexport function showCodeBlockDialog(options: CodeBlockDialogOptions = {}): void {\r\n  const { selectedText = '', onConfirm, onCancel } = options\r\n\r\n  // 创建遮罩层\r\n  const overlay = document.createElement('div')\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n    animation: fadeIn 0.2s ease-out;\r\n  `\r\n\r\n  // 创建对话框\r\n  const dialog = document.createElement('div')\r\n  dialog.style.cssText = `\r\n    background: white;\r\n    border-radius: 12px;\r\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\r\n    width: 90%;\r\n    max-width: 900px;\r\n    max-height: 90vh;\r\n    display: flex;\r\n    flex-direction: column;\r\n    animation: slideUp 0.3s ease-out;\r\n  `\r\n\r\n  // 创建内容\r\n  dialog.innerHTML = `\r\n    <div style=\"padding: 24px;\">\r\n      <h3 style=\"\r\n        margin: 0 0 20px 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #1f2937;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      \">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n          <polyline points=\"16 18 22 12 16 6\"></polyline>\r\n          <polyline points=\"8 6 2 12 8 18\"></polyline>\r\n        </svg>\r\n        插入代码块\r\n      </h3>\r\n      \r\n      <!-- 选项区域 -->\r\n      <div style=\"display: flex; gap: 12px; margin-bottom: 16px;\">\r\n        <div style=\"flex: 1;\">\r\n          <label style=\"\r\n            display: block;\r\n            margin-bottom: 6px;\r\n            font-size: 14px;\r\n            font-weight: 500;\r\n            color: #374151;\r\n          \">编程语言</label>\r\n          <select id=\"codeblock-language-select\" style=\"\r\n            width: 100%;\r\n            padding: 10px 12px;\r\n            border: 1px solid #d1d5db;\r\n            border-radius: 6px;\r\n            font-size: 14px;\r\n            background: white;\r\n            color: #374151;\r\n            cursor: pointer;\r\n            outline: none;\r\n            transition: all 0.2s;\r\n            box-sizing: border-box;\r\n          \">\r\n            <option value=\"plaintext\">纯文本</option>\r\n            <option value=\"javascript\">JavaScript</option>\r\n            <option value=\"typescript\">TypeScript</option>\r\n            <option value=\"python\">Python</option>\r\n            <option value=\"java\">Java</option>\r\n            <option value=\"cpp\">C++</option>\r\n            <option value=\"c\">C</option>\r\n            <option value=\"csharp\">C#</option>\r\n            <option value=\"html\">HTML</option>\r\n            <option value=\"css\">CSS</option>\r\n            <option value=\"sql\">SQL</option>\r\n            <option value=\"json\">JSON</option>\r\n            <option value=\"xml\">XML</option>\r\n            <option value=\"markdown\">Markdown</option>\r\n            <option value=\"bash\">Bash/Shell</option>\r\n            <option value=\"php\">PHP</option>\r\n            <option value=\"ruby\">Ruby</option>\r\n            <option value=\"go\">Go</option>\r\n            <option value=\"rust\">Rust</option>\r\n            <option value=\"swift\">Swift</option>\r\n            <option value=\"kotlin\">Kotlin</option>\r\n            <option value=\"yaml\">YAML</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div style=\"flex: 1;\">\r\n          <label style=\"\r\n            display: block;\r\n            margin-bottom: 6px;\r\n            font-size: 14px;\r\n            font-weight: 500;\r\n            color: #374151;\r\n          \">主题样式</label>\r\n          <select id=\"codeblock-theme-select\" style=\"\r\n            width: 100%;\r\n            padding: 10px 12px;\r\n            border: 1px solid #d1d5db;\r\n            border-radius: 6px;\r\n            font-size: 14px;\r\n            background: white;\r\n            color: #374151;\r\n            cursor: pointer;\r\n            outline: none;\r\n            transition: all 0.2s;\r\n            box-sizing: border-box;\r\n          \">\r\n            <option value=\"oneDark\">One Dark (暗色)</option>\r\n            <option value=\"vsLight\">VS Light (亮色)</option>\r\n            <option value=\"monokai\">Monokai</option>\r\n            <option value=\"dracula\">Dracula</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- 代码编辑器区域 -->\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <label style=\"\r\n          display: block;\r\n          margin-bottom: 6px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          color: #374151;\r\n        \">代码内容</label>\r\n        <textarea id=\"codeblock-textarea\" placeholder=\"在此输入或粘贴代码...\" style=\"\r\n          width: 100%;\r\n          height: 400px;\r\n          padding: 12px;\r\n          border: 1px solid #d1d5db;\r\n          border-radius: 8px;\r\n          font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\r\n          font-size: 14px;\r\n          line-height: 1.5;\r\n          resize: vertical;\r\n          outline: none;\r\n          transition: all 0.2s;\r\n          box-sizing: border-box;\r\n        \">${selectedText}</textarea>\r\n        <div style=\"\r\n          margin-top: 6px;\r\n          font-size: 12px;\r\n          color: #6b7280;\r\n        \">提示：使用 Tab 键插入缩进，Ctrl+Enter 快速插入</div>\r\n      </div>\r\n      \r\n      <!-- 按钮区域 -->\r\n      <div style=\"\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n      \">\r\n        <button id=\"codeblock-cancel-btn\" style=\"\r\n          padding: 10px 20px;\r\n          border: 1px solid #d1d5db;\r\n          border-radius: 6px;\r\n          background: white;\r\n          color: #374151;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          cursor: pointer;\r\n          transition: all 0.2s;\r\n        \">取消</button>\r\n        <button id=\"codeblock-confirm-btn\" style=\"\r\n          padding: 10px 20px;\r\n          border: none;\r\n          border-radius: 6px;\r\n          background: #3b82f6;\r\n          color: white;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          cursor: pointer;\r\n          transition: all 0.2s;\r\n        \">插入代码</button>\r\n      </div>\r\n    </div>\r\n  `\r\n\r\n  overlay.appendChild(dialog)\r\n  document.body.appendChild(overlay)\r\n\r\n  // 添加动画样式\r\n  const style = document.createElement('style')\r\n  style.textContent = `\r\n    @keyframes fadeIn {\r\n      from {\r\n        opacity: 0;\r\n      }\r\n      to {\r\n        opacity: 1;\r\n      }\r\n    }\r\n    \r\n    @keyframes slideUp {\r\n      from {\r\n        transform: translateY(20px);\r\n        opacity: 0;\r\n      }\r\n      to {\r\n        transform: translateY(0);\r\n        opacity: 1;\r\n      }\r\n    }\r\n    \r\n    #codeblock-language-select:focus,\r\n    #codeblock-theme-select:focus,\r\n    #codeblock-textarea:focus {\r\n      border-color: #3b82f6 !important;\r\n      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;\r\n    }\r\n    \r\n    #codeblock-cancel-btn:hover {\r\n      background: #f9fafb !important;\r\n      border-color: #9ca3af !important;\r\n    }\r\n    \r\n    #codeblock-confirm-btn:hover {\r\n      background: #2563eb !important;\r\n    }\r\n    \r\n    #codeblock-confirm-btn:disabled {\r\n      background: #9ca3af !important;\r\n      cursor: not-allowed !important;\r\n    }\r\n  `\r\n  document.head.appendChild(style)\r\n\r\n  // 获取输入框和按钮\r\n  const textarea = document.getElementById('codeblock-textarea') as HTMLTextAreaElement\r\n  const languageSelect = document.getElementById('codeblock-language-select') as HTMLSelectElement\r\n  const themeSelect = document.getElementById('codeblock-theme-select') as HTMLSelectElement\r\n  const confirmBtn = document.getElementById('codeblock-confirm-btn') as HTMLButtonElement\r\n  const cancelBtn = document.getElementById('codeblock-cancel-btn') as HTMLButtonElement\r\n\r\n  // 处理Tab键\r\n  textarea.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Tab') {\r\n      e.preventDefault()\r\n      const start = textarea.selectionStart\r\n      const end = textarea.selectionEnd\r\n      const value = textarea.value\r\n      textarea.value = `${value.substring(0, start)}  ${value.substring(end)}`\r\n      textarea.selectionStart = textarea.selectionEnd = start + 2\r\n    }\r\n  })\r\n\r\n  // 自动聚焦到文本框\r\n  setTimeout(() => {\r\n    textarea.focus()\r\n  }, 100)\r\n\r\n  // 验证输入\r\n  const validateInputs = () => {\r\n    const code = textarea.value.trim()\r\n\r\n    if (code)\r\n      confirmBtn.disabled = false\r\n    else\r\n      confirmBtn.disabled = true\r\n  }\r\n\r\n  // 监听输入变化\r\n  textarea.addEventListener('input', validateInputs)\r\n\r\n  // 初始验证\r\n  validateInputs()\r\n\r\n  // 关闭对话框\r\n  const closeDialog = () => {\r\n    overlay.style.animation = 'fadeIn 0.2s ease-out reverse'\r\n    dialog.style.animation = 'slideUp 0.2s ease-out reverse'\r\n    setTimeout(() => {\r\n      overlay.remove()\r\n      style.remove()\r\n    }, 200)\r\n  }\r\n\r\n  // 确认按钮\r\n  confirmBtn.addEventListener('click', () => {\r\n    const code = textarea.value.trim()\r\n    const language = languageSelect.value\r\n    const theme = themeSelect.value\r\n\r\n    if (code && onConfirm) {\r\n      onConfirm(code, language, theme)\r\n      closeDialog()\r\n    }\r\n  })\r\n\r\n  // 取消按钮\r\n  cancelBtn.addEventListener('click', () => {\r\n    if (onCancel)\r\n      onCancel()\r\n\r\n    closeDialog()\r\n  })\r\n\r\n  // 点击遮罩层关闭\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      if (onCancel)\r\n        onCancel()\r\n\r\n      closeDialog()\r\n    }\r\n  })\r\n\r\n  // ESC键关闭\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      if (onCancel)\r\n        onCancel()\r\n\r\n      closeDialog()\r\n      document.removeEventListener('keydown', handleEsc)\r\n    }\r\n  }\r\n  document.addEventListener('keydown', handleEsc)\r\n\r\n  // Ctrl+Enter快速插入\r\n  textarea.addEventListener('keydown', (e) => {\r\n    if (e.ctrlKey && e.key === 'Enter' && !confirmBtn.disabled)\r\n      confirmBtn.click()\r\n  })\r\n}\r\n"],"names":["showCodeBlockDialog","options","selectedText","onConfirm","onCancel","overlay","document","createElement","style","cssText","dialog","innerHTML","appendChild","body","textContent","head","textarea","getElementById","languageSelect","themeSelect","confirmBtn","cancelBtn","addEventListener","e","key","preventDefault","start","selectionStart","end","selectionEnd","value","substring","setTimeout","focus","validateInputs","code","trim","disabled","closeDialog","animation","remove","language","theme","target","handleEsc","removeEventListener","ctrlKey","click"],"mappings":"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"}