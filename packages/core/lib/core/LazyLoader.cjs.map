{"version":3,"file":"LazyLoader.cjs","sources":["../../src/core/LazyLoader.ts"],"sourcesContent":["/**\r\n * 懒加载管理器\r\n * 实现真正的按需加载，减少初始加载时间\r\n *\r\n * 新增特性（v1.3.0）:\r\n * - 网络感知加载（根据网速调整策略）\r\n * - 预测性预加载（基于用户行为）\r\n * - 优先级队列（智能调度）\r\n * - 离线支持（Service Worker集成）\r\n *\r\n * @packageDocumentation\r\n */\r\n\r\nimport { createLogger } from '../utils/logger'\r\nimport { getPerformanceMonitor } from '../utils/PerformanceMonitor'\r\nimport { EventEmitter } from './EventEmitter'\r\n\r\nconst logger = createLogger('LazyLoader')\r\n\r\n/**\r\n * 加载器函数类型\r\n */\r\nexport type LoaderFunction<T> = () => Promise<T> | T\r\n\r\n/**\r\n * 网络连接类型\r\n */\r\nexport type NetworkType = 'slow-2g' | '2g' | '3g' | '4g' | 'wifi' | 'unknown'\r\n\r\n/**\r\n * 加载策略\r\n */\r\nexport type LoadStrategy = 'immediate' | 'idle' | 'visible' | 'interaction' | 'manual'\r\n\r\n/**\r\n * 加载选项\r\n */\r\nexport interface LoadOptions {\r\n  /** 超时时间（毫秒） */\r\n  timeout?: number\r\n  /** 重试次数 */\r\n  retry?: number\r\n  /** 是否缓存结果 */\r\n  cache?: boolean\r\n  /** 优先级（0-10，越大越优先） */\r\n  priority?: number\r\n  /** 加载策略 */\r\n  strategy?: LoadStrategy\r\n  /** 依赖项ID列表 */\r\n  dependencies?: string[]\r\n}\r\n\r\n/**\r\n * 加载项注册信息\r\n */\r\ninterface LoaderRegistration<T> {\r\n  id: string\r\n  loader: LoaderFunction<T>\r\n  options: LoadOptions\r\n  loaded: boolean\r\n  loading: boolean\r\n  result?: T\r\n  error?: Error\r\n  loadTime?: number\r\n}\r\n\r\n/**\r\n * 懒加载管理器类\r\n */\r\nexport class LazyLoader extends EventEmitter {\r\n  private loaders: Map<string, LoaderRegistration<any>> = new Map()\r\n  private loadQueue: string[] = []\r\n  private maxConcurrent: number = 3\r\n  private activeLoads: number = 0\r\n  private monitor = getPerformanceMonitor()\r\n\r\n  constructor(maxConcurrent: number = 3) {\r\n    super()\r\n    this.maxConcurrent = maxConcurrent\r\n  }\r\n\r\n  /**\r\n   * 注册加载器\r\n   */\r\n  register<T>(\r\n    id: string,\r\n    loader: LoaderFunction<T>,\r\n    options: LoadOptions = {},\r\n  ): void {\r\n    if (this.loaders.has(id)) {\r\n      console.warn(`Loader \"${id}\" is already registered`)\r\n      return\r\n    }\r\n\r\n    this.loaders.set(id, {\r\n      id,\r\n      loader,\r\n      options: {\r\n        timeout: 30000,\r\n        retry: 3,\r\n        cache: true,\r\n        priority: 0,\r\n        ...options,\r\n      },\r\n      loaded: false,\r\n      loading: false,\r\n    })\r\n\r\n    this.emit('loader:registered', { id })\r\n  }\r\n\r\n  /**\r\n   * 加载资源\r\n   */\r\n  async load<T>(id: string): Promise<T | null> {\r\n    const registration = this.loaders.get(id)\r\n\r\n    if (!registration) {\r\n      console.error(`Loader \"${id}\" not found`)\r\n      return null\r\n    }\r\n\r\n    // 如果已加载且启用缓存，直接返回\r\n    if (registration.loaded && registration.options.cache && registration.result)\r\n      return registration.result as T\r\n\r\n    // 如果正在加载，等待完成\r\n    if (registration.loading)\r\n      return this.waitForLoad<T>(id)\r\n\r\n    // 检查并发限制\r\n    if (this.activeLoads >= this.maxConcurrent) {\r\n      this.loadQueue.push(id)\r\n      return this.waitForLoad<T>(id)\r\n    }\r\n\r\n    return this.executeLoad<T>(registration)\r\n  }\r\n\r\n  /**\r\n   * 执行加载\r\n   */\r\n  private async executeLoad<T>(registration: LoaderRegistration<T>): Promise<T | null> {\r\n    registration.loading = true\r\n    this.activeLoads++\r\n\r\n    const startTime = performance.now()\r\n    this.monitor.start(`lazy-load:${registration.id}`)\r\n    this.emit('load:start', { id: registration.id })\r\n\r\n    try {\r\n      // 设置超时\r\n      const timeoutPromise = new Promise<never>((_, reject) => {\r\n        setTimeout(() => reject(new Error('Load timeout')), registration.options.timeout)\r\n      })\r\n\r\n      // 执行加载\r\n      const loadPromise = Promise.resolve(registration.loader())\r\n\r\n      const result = await Promise.race([loadPromise, timeoutPromise])\r\n\r\n      registration.result = result\r\n      registration.loaded = true\r\n      registration.loading = false\r\n      registration.loadTime = performance.now() - startTime\r\n\r\n      this.monitor.end(`lazy-load:${registration.id}`, {\r\n        success: true,\r\n        loadTime: registration.loadTime,\r\n      })\r\n\r\n      this.emit('load:success', {\r\n        id: registration.id,\r\n        loadTime: registration.loadTime,\r\n      })\r\n\r\n      this.activeLoads--\r\n      this.processQueue()\r\n\r\n      return result\r\n    }\r\n    catch (error) {\r\n      registration.error = error as Error\r\n      registration.loading = false\r\n      this.activeLoads--\r\n\r\n      this.monitor.end(`lazy-load:${registration.id}`, {\r\n        success: false,\r\n        error: (error as Error).message,\r\n      })\r\n\r\n      this.emit('load:error', {\r\n        id: registration.id,\r\n        error: error as Error,\r\n      })\r\n\r\n      // 重试\r\n      if (registration.options.retry && registration.options.retry > 0) {\r\n        registration.options.retry--\r\n        console.log(`Retrying load for \"${registration.id}\"...`)\r\n        return this.executeLoad(registration)\r\n      }\r\n\r\n      this.processQueue()\r\n\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 等待加载完成\r\n   */\r\n  private waitForLoad<T>(id: string): Promise<T | null> {\r\n    return new Promise((resolve) => {\r\n      const checkLoaded = (data: any) => {\r\n        if (data.id === id) {\r\n          this.off('load:success', checkLoaded)\r\n          this.off('load:error', checkLoaded)\r\n          const registration = this.loaders.get(id)\r\n          resolve(registration?.result || null)\r\n        }\r\n      }\r\n\r\n      this.on('load:success', checkLoaded)\r\n      this.on('load:error', checkLoaded)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 处理队列\r\n   */\r\n  private processQueue(): void {\r\n    while (this.loadQueue.length > 0 && this.activeLoads < this.maxConcurrent) {\r\n      const id = this.loadQueue.shift()!\r\n      const registration = this.loaders.get(id)\r\n\r\n      if (registration && !registration.loaded && !registration.loading)\r\n        this.executeLoad(registration)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量加载\r\n   */\r\n  async loadBatch(ids: string[]): Promise<Array<any | null>> {\r\n    // 按优先级排序\r\n    const sorted = ids\r\n      .map(id => ({\r\n        id,\r\n        priority: this.loaders.get(id)?.options.priority || 0,\r\n      }))\r\n      .sort((a, b) => b.priority - a.priority)\r\n      .map(item => item.id)\r\n\r\n    return Promise.all(sorted.map(id => this.load(id)))\r\n  }\r\n\r\n  /**\r\n   * 预加载\r\n   */\r\n  async preload(ids: string[]): Promise<void> {\r\n    // 低优先级后台加载\r\n    const lowPriorityIds = ids.map((id) => {\r\n      const registration = this.loaders.get(id)\r\n      if (registration)\r\n        registration.options.priority = -1\r\n\r\n      return id\r\n    })\r\n\r\n    // 不等待结果\r\n    this.loadBatch(lowPriorityIds).catch((error) => {\r\n      console.warn('Preload failed:', error)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 卸载资源\r\n   */\r\n  unload(id: string): void {\r\n    const registration = this.loaders.get(id)\r\n\r\n    if (registration) {\r\n      registration.loaded = false\r\n      registration.result = undefined\r\n      this.loadedFeatures.delete(id)\r\n      this.emit('load:unloaded', { id })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取加载统计\r\n   */\r\n  getStats(): {\r\n    total: number\r\n    loaded: number\r\n    loading: number\r\n    queued: number\r\n    failed: number\r\n  } {\r\n    const all = Array.from(this.loaders.values())\r\n\r\n    return {\r\n      total: all.length,\r\n      loaded: all.filter(l => l.loaded).length,\r\n      loading: all.filter(l => l.loading).length,\r\n      queued: this.loadQueue.length,\r\n      failed: all.filter(l => l.error).length,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取加载时间统计\r\n   */\r\n  getLoadTimes(): Array<{ id: string, time: number }> {\r\n    return Array.from(this.loaders.values())\r\n      .filter(l => l.loadTime !== undefined)\r\n      .map(l => ({ id: l.id, time: l.loadTime! }))\r\n      .sort((a, b) => b.time - a.time)\r\n  }\r\n\r\n  /**\r\n   * 清理\r\n   */\r\n  destroy(): void {\r\n    this.loaders.clear()\r\n    this.loadQueue = []\r\n    this.loadedFeatures.clear()\r\n    this.removeAllListeners()\r\n  }\r\n}\r\n\r\n// 全局单例\r\nlet globalLoader: LazyLoader | null = null\r\n\r\n/**\r\n * 获取全局懒加载管理器\r\n */\r\nexport function getLazyLoader(): LazyLoader {\r\n  if (!globalLoader)\r\n    globalLoader = new LazyLoader()\r\n\r\n  return globalLoader\r\n}\r\n\r\n/**\r\n * 重置全局懒加载管理器\r\n */\r\nexport function resetLazyLoader(): void {\r\n  if (globalLoader) {\r\n    globalLoader.destroy()\r\n    globalLoader = null\r\n  }\r\n}\r\n"],"names":["createLogger","LazyLoader","EventEmitter","constructor","maxConcurrent","loaders","Map","loadQueue","activeLoads","monitor","getPerformanceMonitor","register","id","loader","options","has","console","warn","set","timeout","retry","cache","priority","loaded","loading","emit","load","registration","get","error","result","waitForLoad","push","executeLoad","startTime","performance","now","start","timeoutPromise","Promise","_","reject","setTimeout","Error","loadPromise","resolve","race","loadTime","end","success","processQueue","message","log","checkLoaded","data","off","on","length","shift","loadBatch","ids","sorted","map","sort","a","b","item","all","preload","lowPriorityIds","catch","unload","undefined","loadedFeatures","delete","getStats","Array","from","values","total","filter","l","queued","failed","getLoadTimes","time","destroy","clear","removeAllListeners","globalLoader","getLazyLoader","resetLazyLoader"],"mappings":"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"}