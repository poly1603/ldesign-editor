{"version":3,"file":"EditorVirtualScroller.cjs","sources":["../../src/core/EditorVirtualScroller.ts"],"sourcesContent":["/**\r\n * 编辑器虚拟滚动适配器\r\n * 专门为富文本编辑器优化的虚拟滚动实现\r\n */\r\n\r\nimport type { Editor } from './Editor'\r\nimport type { VirtualScrollerItem } from './VirtualScroller'\r\nimport { createLogger } from '../utils/logger'\r\nimport { getPerformanceMonitor } from '../utils/PerformanceMonitor'\r\nimport { VirtualScroller } from './VirtualScroller'\r\n\r\nconst logger = createLogger('EditorVirtualScroller')\r\n\r\nexport interface EditorLine {\r\n  id: string\r\n  lineNumber: number\r\n  content: string\r\n  height?: number\r\n  isDirty?: boolean\r\n  syntaxTokens?: any[]\r\n}\r\n\r\nexport interface EditorVirtualScrollerOptions {\r\n  editor: Editor\r\n  lineHeight?: number\r\n  maxLines?: number\r\n  enableSyntaxHighlight?: boolean\r\n  enableLineNumbers?: boolean\r\n  enableWordWrap?: boolean\r\n}\r\n\r\nexport class EditorVirtualScroller {\r\n  private virtualScroller: VirtualScroller\r\n  private editor: Editor\r\n  private lines: EditorLine[] = []\r\n  private lineCache: Map<number, EditorLine> = new Map()\r\n  private syntaxWorker?: Worker\r\n  private options: Required<EditorVirtualScrollerOptions>\r\n  private performanceMonitor = getPerformanceMonitor()\r\n  private renderTimer: any\r\n  private isDirty = false\r\n\r\n  constructor(options: EditorVirtualScrollerOptions) {\r\n    this.editor = options.editor\r\n    this.options = {\r\n      lineHeight: 21,\r\n      maxLines: 1000000,\r\n      enableSyntaxHighlight: true,\r\n      enableLineNumbers: true,\r\n      enableWordWrap: true,\r\n      ...options,\r\n    }\r\n\r\n    // 创建容器\r\n    const container = this.createContainer()\r\n\r\n    // 初始化虚拟滚动器\r\n    this.virtualScroller = new VirtualScroller({\r\n      container,\r\n      itemHeight: this.options.lineHeight,\r\n      bufferSize: 10,\r\n      dynamicHeight: this.options.enableWordWrap,\r\n      scrollThrottle: 8,\r\n      renderer: this.renderLine.bind(this),\r\n    })\r\n\r\n    this.setupEventListeners()\r\n    this.initializeSyntaxWorker()\r\n  }\r\n\r\n  /**\r\n   * 设置编辑器内容\r\n   */\r\n  setContent(content: string): void {\r\n    const timer = this.performanceMonitor.startTimer('virtualscroll.setContent')\r\n\r\n    try {\r\n      const lines = this.parseContent(content)\r\n      this.lines = lines\r\n      this.lineCache.clear()\r\n\r\n      // 转换为虚拟滚动项\r\n      const items: VirtualScrollerItem[] = lines.map((line, index) => ({\r\n        id: line.id,\r\n        data: line,\r\n        height: this.estimateLineHeight(line),\r\n      }))\r\n\r\n      this.virtualScroller.setItems(items)\r\n      logger.info(`Loaded ${lines.length} lines`)\r\n    }\r\n    finally {\r\n      this.performanceMonitor.endTimer(timer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新指定行\r\n   */\r\n  updateLine(lineNumber: number, content: string): void {\r\n    if (lineNumber < 0 || lineNumber >= this.lines.length)\r\n      return\r\n\r\n    const line = this.lines[lineNumber]\r\n    line.content = content\r\n    line.isDirty = true\r\n\r\n    // 清除缓存\r\n    this.lineCache.delete(lineNumber)\r\n\r\n    // 刷新渲染\r\n    this.virtualScroller.refreshItem(line.id)\r\n\r\n    // 异步更新语法高亮\r\n    if (this.options.enableSyntaxHighlight)\r\n      this.requestSyntaxHighlight(lineNumber)\r\n  }\r\n\r\n  /**\r\n   * 插入行\r\n   */\r\n  insertLines(lineNumber: number, contents: string[]): void {\r\n    const newLines: EditorLine[] = contents.map((content, index) => ({\r\n      id: `line-${Date.now()}-${index}`,\r\n      lineNumber: lineNumber + index,\r\n      content,\r\n      isDirty: true,\r\n    }))\r\n\r\n    // 更新行号\r\n    for (let i = lineNumber; i < this.lines.length; i++)\r\n      this.lines[i].lineNumber += contents.length\r\n\r\n    this.lines.splice(lineNumber, 0, ...newLines)\r\n\r\n    // 转换为虚拟滚动项\r\n    const items: VirtualScrollerItem[] = newLines.map(line => ({\r\n      id: line.id,\r\n      data: line,\r\n      height: this.estimateLineHeight(line),\r\n    }))\r\n\r\n    this.virtualScroller.addItems(items, lineNumber)\r\n  }\r\n\r\n  /**\r\n   * 删除行\r\n   */\r\n  deleteLines(startLine: number, count: number): void {\r\n    const deletedLines = this.lines.splice(startLine, count)\r\n    const ids = deletedLines.map(line => line.id)\r\n\r\n    // 更新后续行号\r\n    for (let i = startLine; i < this.lines.length; i++)\r\n      this.lines[i].lineNumber -= count\r\n\r\n    // 清理缓存\r\n    deletedLines.forEach((line) => {\r\n      this.lineCache.delete(line.lineNumber)\r\n    })\r\n\r\n    this.virtualScroller.removeItems(ids)\r\n  }\r\n\r\n  /**\r\n   * 滚动到指定行\r\n   */\r\n  scrollToLine(lineNumber: number, position: 'start' | 'center' | 'end' = 'center'): void {\r\n    if (lineNumber < 0 || lineNumber >= this.lines.length)\r\n      return\r\n\r\n    const line = this.lines[lineNumber]\r\n    this.virtualScroller.scrollToItem(line.id, position)\r\n  }\r\n\r\n  /**\r\n   * 获取可见行范围\r\n   */\r\n  getVisibleLineRange(): { start: number, end: number } {\r\n    const visibleItems = this.virtualScroller.getVisibleItems()\r\n    if (visibleItems.length === 0)\r\n      return { start: 0, end: 0 }\r\n\r\n    const start = (visibleItems[0].data as EditorLine).lineNumber\r\n    const end = (visibleItems[visibleItems.length - 1].data as EditorLine).lineNumber\r\n\r\n    return { start, end }\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy(): void {\r\n    this.virtualScroller.destroy()\r\n    this.syntaxWorker?.terminate()\r\n    clearTimeout(this.renderTimer)\r\n  }\r\n\r\n  private createContainer(): HTMLElement {\r\n    const container = document.createElement('div')\r\n    container.className = 'editor-virtual-scroll-container'\r\n    container.style.cssText = `\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\r\n      font-size: 14px;\r\n      line-height: ${this.options.lineHeight}px;\r\n    `\r\n\r\n    // 插入到编辑器容器\r\n    const editorElement = this.editor.getElement()\r\n    editorElement.appendChild(container)\r\n\r\n    return container\r\n  }\r\n\r\n  private parseContent(content: string): EditorLine[] {\r\n    const lines = content.split('\\n')\r\n\r\n    // 限制最大行数\r\n    if (lines.length > this.options.maxLines) {\r\n      logger.warn(`Content exceeds max lines limit (${this.options.maxLines})`)\r\n      lines.length = this.options.maxLines\r\n    }\r\n\r\n    return lines.map((content, index) => ({\r\n      id: `line-${index}`,\r\n      lineNumber: index,\r\n      content,\r\n    }))\r\n  }\r\n\r\n  private estimateLineHeight(line: EditorLine): number {\r\n    if (!this.options.enableWordWrap)\r\n      return this.options.lineHeight\r\n\r\n    // 估算换行后的高度\r\n    const charsPerLine = 80 // 假设每行80个字符\r\n    const lines = Math.ceil(line.content.length / charsPerLine)\r\n    return lines * this.options.lineHeight\r\n  }\r\n\r\n  private renderLine(line: EditorLine, index: number): HTMLElement {\r\n    // 检查缓存\r\n    const cached = this.lineCache.get(line.lineNumber)\r\n    if (cached && !cached.isDirty)\r\n      return this.createLineElement(cached)\r\n\r\n    // 创建新元素\r\n    const element = this.createLineElement(line)\r\n\r\n    // 缓存\r\n    this.lineCache.set(line.lineNumber, { ...line, isDirty: false })\r\n\r\n    return element\r\n  }\r\n\r\n  private createLineElement(line: EditorLine): HTMLElement {\r\n    const element = document.createElement('div')\r\n    element.className = 'editor-line'\r\n    element.style.cssText = `\r\n      display: flex;\r\n      white-space: ${this.options.enableWordWrap ? 'pre-wrap' : 'pre'};\r\n      word-break: ${this.options.enableWordWrap ? 'break-word' : 'normal'};\r\n      min-height: ${this.options.lineHeight}px;\r\n    `\r\n\r\n    // 行号\r\n    if (this.options.enableLineNumbers) {\r\n      const lineNumber = document.createElement('span')\r\n      lineNumber.className = 'line-number'\r\n      lineNumber.style.cssText = `\r\n        display: inline-block;\r\n        width: 50px;\r\n        text-align: right;\r\n        padding-right: 10px;\r\n        color: #858585;\r\n        user-select: none;\r\n        flex-shrink: 0;\r\n      `\r\n      lineNumber.textContent = String(line.lineNumber + 1)\r\n      element.appendChild(lineNumber)\r\n    }\r\n\r\n    // 内容\r\n    const content = document.createElement('span')\r\n    content.className = 'line-content'\r\n    content.style.cssText = `\r\n      flex: 1;\r\n      padding-left: 10px;\r\n    `\r\n\r\n    if (line.syntaxTokens && this.options.enableSyntaxHighlight) {\r\n      // 应用语法高亮\r\n      content.innerHTML = this.applySyntaxHighlight(line.content, line.syntaxTokens)\r\n    }\r\n    else {\r\n      content.textContent = line.content || '\\u200B' // 空行使用零宽空格\r\n    }\r\n\r\n    element.appendChild(content)\r\n\r\n    return element\r\n  }\r\n\r\n  private applySyntaxHighlight(content: string, tokens: any[]): string {\r\n    let html = ''\r\n    let lastIndex = 0\r\n\r\n    tokens.forEach((token) => {\r\n      // 添加普通文本\r\n      if (token.start > lastIndex)\r\n        html += this.escapeHtml(content.slice(lastIndex, token.start))\r\n\r\n      // 添加高亮文本\r\n      const tokenText = content.slice(token.start, token.end)\r\n      html += `<span class=\"token-${token.type}\">${this.escapeHtml(tokenText)}</span>`\r\n\r\n      lastIndex = token.end\r\n    })\r\n\r\n    // 添加剩余文本\r\n    if (lastIndex < content.length)\r\n      html += this.escapeHtml(content.slice(lastIndex))\r\n\r\n    return html\r\n  }\r\n\r\n  private escapeHtml(text: string): string {\r\n    const div = document.createElement('div')\r\n    div.textContent = text\r\n    return div.innerHTML\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    // 监听滚动事件\r\n    this.virtualScroller.on('scroll', (metrics) => {\r\n      this.editor.emit('virtualScroll', metrics)\r\n    })\r\n\r\n    // 监听编辑器内容变化\r\n    this.editor.on('change', () => {\r\n      this.isDirty = true\r\n      this.scheduleRender()\r\n    })\r\n  }\r\n\r\n  private scheduleRender(): void {\r\n    if (this.renderTimer)\r\n      return\r\n\r\n    this.renderTimer = requestAnimationFrame(() => {\r\n      this.renderTimer = null\r\n      if (this.isDirty) {\r\n        this.isDirty = false\r\n        // 更新变化的内容\r\n        this.updateDirtyLines()\r\n      }\r\n    })\r\n  }\r\n\r\n  private updateDirtyLines(): void {\r\n    // 批量更新脏行\r\n    const dirtyLines = this.lines.filter(line => line.isDirty)\r\n    dirtyLines.forEach((line) => {\r\n      this.virtualScroller.refreshItem(line.id)\r\n      line.isDirty = false\r\n    })\r\n  }\r\n\r\n  private initializeSyntaxWorker(): void {\r\n    if (!this.options.enableSyntaxHighlight)\r\n      return\r\n\r\n    // 创建语法高亮 Worker\r\n    const workerCode = `\r\n      self.onmessage = function(e) {\r\n        const { lineNumber, content } = e.data\r\n        \r\n        // 简单的语法高亮示例\r\n        const tokens = []\r\n        \r\n        // 匹配关键字\r\n        const keywords = /\\\\b(function|const|let|var|if|else|for|while|return|class|extends)\\\\b/g\r\n        let match\r\n        while ((match = keywords.exec(content)) !== null) {\r\n          tokens.push({\r\n            type: 'keyword',\r\n            start: match.index,\r\n            end: match.index + match[0].length\r\n          })\r\n        }\r\n        \r\n        // 匹配字符串\r\n        const strings = /(['\"])(?:(?=(\\\\\\\\?))\\\\2.)*?\\\\1/g\r\n        while ((match = strings.exec(content)) !== null) {\r\n          tokens.push({\r\n            type: 'string',\r\n            start: match.index,\r\n            end: match.index + match[0].length\r\n          })\r\n        }\r\n        \r\n        // 匹配注释\r\n        const comments = /\\\\/\\\\/.*$/gm\r\n        while ((match = comments.exec(content)) !== null) {\r\n          tokens.push({\r\n            type: 'comment',\r\n            start: match.index,\r\n            end: match.index + match[0].length\r\n          })\r\n        }\r\n        \r\n        self.postMessage({ lineNumber, tokens })\r\n      }\r\n    `\r\n\r\n    const blob = new Blob([workerCode], { type: 'application/javascript' })\r\n    this.syntaxWorker = new Worker(URL.createObjectURL(blob))\r\n\r\n    this.syntaxWorker.onmessage = (e) => {\r\n      const { lineNumber, tokens } = e.data\r\n      const line = this.lines[lineNumber]\r\n      if (line) {\r\n        line.syntaxTokens = tokens\r\n        this.virtualScroller.refreshItem(line.id)\r\n      }\r\n    }\r\n  }\r\n\r\n  private requestSyntaxHighlight(lineNumber: number): void {\r\n    if (!this.syntaxWorker)\r\n      return\r\n\r\n    const line = this.lines[lineNumber]\r\n    if (line) {\r\n      this.syntaxWorker.postMessage({\r\n        lineNumber,\r\n        content: line.content,\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取性能指标\r\n   */\r\n  getPerformanceMetrics() {\r\n    const virtualScrollerMetrics = this.virtualScroller.getPerformanceMetrics()\r\n\r\n    return {\r\n      ...virtualScrollerMetrics,\r\n      totalLines: this.lines.length,\r\n      cachedLines: this.lineCache.size,\r\n      visibleRange: this.getVisibleLineRange(),\r\n    }\r\n  }\r\n}\r\n"],"names":["logger","createLogger","EditorVirtualScroller","constructor","options","lines","lineCache","Map","performanceMonitor","getPerformanceMonitor","isDirty","editor","lineHeight","maxLines","enableSyntaxHighlight","enableLineNumbers","enableWordWrap","container","createContainer","virtualScroller","VirtualScroller","itemHeight","bufferSize","dynamicHeight","scrollThrottle","renderer","renderLine","bind","setupEventListeners","initializeSyntaxWorker","setContent","content","timer","startTimer","parseContent","clear","items","map","line","index","id","data","height","estimateLineHeight","setItems","info","length","endTimer","updateLine","lineNumber","delete","refreshItem","requestSyntaxHighlight","insertLines","contents","newLines","Date","now","i","splice","addItems","deleteLines","startLine","count","deletedLines","ids","forEach","removeItems","scrollToLine","position","scrollToItem","getVisibleLineRange","visibleItems","getVisibleItems","start","end","destroy","syntaxWorker","terminate","clearTimeout","renderTimer","document","createElement","className","style","cssText","editorElement","getElement","appendChild","split","warn","charsPerLine","Math","ceil","cached","get","createLineElement","element","set","textContent","String","syntaxTokens","innerHTML","applySyntaxHighlight","tokens","html","lastIndex","token","escapeHtml","slice","tokenText","type","text","div","on","metrics","emit","scheduleRender","requestAnimationFrame","updateDirtyLines","dirtyLines","filter","workerCode","blob","Blob","Worker","URL","createObjectURL","onmessage","e","postMessage","getPerformanceMetrics","virtualScrollerMetrics","totalLines","cachedLines","size","visibleRange"],"mappings":";;;;;;;;;;;;;;;AAWA,MAAMA,MAAAA,GAASC,sBAAa,uBAAuB,CAAA;AAoB5C,MAAMC,qBAAAA,CAAsB;AAAA,EAWjCC,YAAYC,OAAAA,EAAuC;AARnD,IAAA,IAAA,CAAQC,QAAsB,EAAA;AAC9B,IAAA,IAAA,CAAQC,SAAAA,uBAAyCC,GAAAA,EAAI;AAGrD,IAAA,IAAA,CAAQC,qBAAqBC,wCAAAA,EAAsB;AAEnD,IAAA,IAAA,CAAQC,OAAAA,GAAU,KAAA;AAGhB,IAAA,IAAA,CAAKC,SAASP,OAAAA,CAAQO,MAAAA;AACtB,IAAA,IAAA,CAAKP,OAAAA,GAAU;AAAA,MACbQ,UAAAA,EAAY,EAAA;AAAA,MACZC,QAAAA,EAAU,GAAA;AAAA,MACVC,qBAAAA,EAAuB,IAAA;AAAA,MACvBC,iBAAAA,EAAmB,IAAA;AAAA,MACnBC,cAAAA,EAAgB,IAAA;AAAA,MAChB,GAAGZ;AAAAA,KACL;AAGA,IAAA,MAAMa,SAAAA,GAAY,KAAKC,eAAAA,EAAgB;AAGvC,IAAA,IAAA,CAAKC,eAAAA,GAAkB,IAAIC,+BAAAA,CAAgB;AAAA,MACzCH,SAAAA;AAAAA,MACAI,UAAAA,EAAY,KAAKjB,OAAAA,CAAQQ,UAAAA;AAAAA,MACzBU,UAAAA,EAAY,EAAA;AAAA,MACZC,aAAAA,EAAe,KAAKnB,OAAAA,CAAQY,cAAAA;AAAAA,MAC5BQ,cAAAA,EAAgB,CAAA;AAAA,MAChBC,QAAAA,EAAU,IAAA,CAAKC,UAAAA,CAAWC,IAAAA,CAAK,IAAI;AAAA,KACpC,CAAA;AAED,IAAA,IAAA,CAAKC,mBAAAA,EAAoB;AACzB,IAAA,IAAA,CAAKC,sBAAAA,EAAuB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKAC,WAAWC,OAAAA,EAAuB;AAChC,IAAA,MAAMC,KAAAA,GAAQ,IAAA,CAAKxB,kBAAAA,CAAmByB,UAAAA,CAAW,0BAA0B,CAAA;AAE3E,IAAA,IAAI;AACF,MAAA,MAAM5B,KAAAA,GAAQ,IAAA,CAAK6B,YAAAA,CAAaH,OAAO,CAAA;AACvC,MAAA,IAAA,CAAK1B,KAAAA,GAAQA,KAAAA;AACb,MAAA,IAAA,CAAKC,UAAU6B,KAAAA,EAAM;AAGrB,MAAA,MAAMC,KAAAA,GAA+B/B,KAAAA,CAAMgC,GAAAA,CAAI,CAACC,MAAMC,KAAAA,MAAW;AAAA,QAC/DC,IAAIF,IAAAA,CAAKE,EAAAA;AAAAA,QACTC,IAAAA,EAAMH,IAAAA;AAAAA,QACNI,MAAAA,EAAQ,IAAA,CAAKC,kBAAAA,CAAmBL,IAAI;AAAA,OACtC,CAAE,CAAA;AAEF,MAAA,IAAA,CAAKnB,eAAAA,CAAgByB,SAASR,KAAK,CAAA;AACnCpC,MAAAA,MAAAA,CAAO6C,IAAAA,CAAK,CAAA,OAAA,EAAUxC,KAAAA,CAAMyC,MAAM,CAAA,MAAA,CAAQ,CAAA;AAAA,IAC5C,CAAA,SAAC;AAEC,MAAA,IAAA,CAAKtC,kBAAAA,CAAmBuC,SAASf,KAAK,CAAA;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKAgB,UAAAA,CAAWC,YAAoBlB,OAAAA,EAAuB;AACpD,IAAA,IAAIkB,UAAAA,GAAa,CAAA,IAAKA,UAAAA,IAAc,IAAA,CAAK5C,KAAAA,CAAMyC,MAAAA;AAC7C,MAAA;AAEF,IAAA,MAAMR,IAAAA,GAAO,IAAA,CAAKjC,KAAAA,CAAM4C,UAAU,CAAA;AAClCX,IAAAA,IAAAA,CAAKP,OAAAA,GAAUA,OAAAA;AACfO,IAAAA,IAAAA,CAAK5B,OAAAA,GAAU,IAAA;AAGf,IAAA,IAAA,CAAKJ,SAAAA,CAAU4C,OAAOD,UAAU,CAAA;AAGhC,IAAA,IAAA,CAAK9B,eAAAA,CAAgBgC,WAAAA,CAAYb,IAAAA,CAAKE,EAAE,CAAA;AAGxC,IAAA,IAAI,KAAKpC,OAAAA,CAAQU,qBAAAA;AACf,MAAA,IAAA,CAAKsC,uBAAuBH,UAAU,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKAI,WAAAA,CAAYJ,YAAoBK,QAAAA,EAA0B;AACxD,IAAA,MAAMC,QAAAA,GAAyBD,QAAAA,CAASjB,GAAAA,CAAI,CAACN,SAASQ,KAAAA,MAAW;AAAA,MAC/DC,IAAI,CAAA,KAAA,EAAQgB,IAAAA,CAAKC,GAAAA,EAAK,IAAIlB,KAAK,CAAA,CAAA;AAAA,MAC/BU,YAAYA,UAAAA,GAAaV,KAAAA;AAAAA,MACzBR,OAAAA;AAAAA,MACArB,OAAAA,EAAS;AAAA,KACX,CAAE,CAAA;AAGF,IAAA,KAAA,IAASgD,CAAAA,GAAIT,UAAAA,EAAYS,CAAAA,GAAI,IAAA,CAAKrD,MAAMyC,MAAAA,EAAQY,CAAAA,EAAAA;AAC9C,MAAA,IAAA,CAAKrD,KAAAA,CAAMqD,CAAC,CAAA,CAAET,UAAAA,IAAcK,QAAAA,CAASR,MAAAA;AAEvC,IAAA,IAAA,CAAKzC,KAAAA,CAAMsD,MAAAA,CAAOV,UAAAA,EAAY,CAAA,EAAG,GAAGM,QAAQ,CAAA;AAG5C,IAAA,MAAMnB,KAAAA,GAA+BmB,QAAAA,CAASlB,GAAAA,CAAIC,CAAAA,IAAAA,MAAS;AAAA,MACzDE,IAAIF,IAAAA,CAAKE,EAAAA;AAAAA,MACTC,IAAAA,EAAMH,IAAAA;AAAAA,MACNI,MAAAA,EAAQ,IAAA,CAAKC,kBAAAA,CAAmBL,IAAI;AAAA,KACtC,CAAE,CAAA;AAEF,IAAA,IAAA,CAAKnB,eAAAA,CAAgByC,QAAAA,CAASxB,KAAAA,EAAOa,UAAU,CAAA;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKAY,WAAAA,CAAYC,WAAmBC,KAAAA,EAAqB;AAClD,IAAA,MAAMC,YAAAA,GAAe,IAAA,CAAK3D,KAAAA,CAAMsD,MAAAA,CAAOG,WAAWC,KAAK,CAAA;AACvD,IAAA,MAAME,GAAAA,GAAMD,YAAAA,CAAa3B,GAAAA,CAAIC,CAAAA,IAAAA,KAAQA,KAAKE,EAAE,CAAA;AAG5C,IAAA,KAAA,IAASkB,CAAAA,GAAII,SAAAA,EAAWJ,CAAAA,GAAI,IAAA,CAAKrD,MAAMyC,MAAAA,EAAQY,CAAAA,EAAAA;AAC7C,MAAA,IAAA,CAAKrD,KAAAA,CAAMqD,CAAC,CAAA,CAAET,UAAAA,IAAcc,KAAAA;AAG9BC,IAAAA,YAAAA,CAAaE,QAAS5B,CAAAA,IAAAA,KAAS;AAC7B,MAAA,IAAA,CAAKhC,SAAAA,CAAU4C,MAAAA,CAAOZ,IAAAA,CAAKW,UAAU,CAAA;AAAA,IACvC,CAAC,CAAA;AAED,IAAA,IAAA,CAAK9B,eAAAA,CAAgBgD,YAAYF,GAAG,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKAG,YAAAA,CAAanB,UAAAA,EAAoBoB,QAAAA,GAAuC,QAAA,EAAgB;AACtF,IAAA,IAAIpB,UAAAA,GAAa,CAAA,IAAKA,UAAAA,IAAc,IAAA,CAAK5C,KAAAA,CAAMyC,MAAAA;AAC7C,MAAA;AAEF,IAAA,MAAMR,IAAAA,GAAO,IAAA,CAAKjC,KAAAA,CAAM4C,UAAU,CAAA;AAClC,IAAA,IAAA,CAAK9B,eAAAA,CAAgBmD,YAAAA,CAAahC,IAAAA,CAAKE,EAAAA,EAAI6B,QAAQ,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKAE,mBAAAA,GAAsD;AACpD,IAAA,MAAMC,YAAAA,GAAe,IAAA,CAAKrD,eAAAA,CAAgBsD,eAAAA,EAAgB;AAC1D,IAAA,IAAID,aAAa1B,MAAAA,KAAW,CAAA;AAC1B,MAAA,OAAO;AAAA,QAAE4B,KAAAA,EAAO,CAAA;AAAA,QAAGC,GAAAA,EAAK;AAAA,OAAE;AAE5B,IAAA,MAAMD,KAAAA,GAASF,YAAAA,CAAa,CAAC,CAAA,CAAE/B,IAAAA,CAAoBQ,UAAAA;AACnD,IAAA,MAAM0B,MAAOH,YAAAA,CAAaA,YAAAA,CAAa1B,MAAAA,GAAS,CAAC,EAAEL,IAAAA,CAAoBQ,UAAAA;AAEvE,IAAA,OAAO;AAAA,MAAEyB,KAAAA;AAAAA,MAAOC;AAAAA,KAAI;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKAC,OAAAA,GAAgB;AACd,IAAA,IAAA,CAAKzD,gBAAgByD,OAAAA,EAAQ;AAC7B,IAAA,IAAA,CAAKC,cAAcC,SAAAA,EAAU;AAC7BC,IAAAA,YAAAA,CAAa,KAAKC,WAAW,CAAA;AAAA,EAC/B;AAAA,EAEQ9D,eAAAA,GAA+B;AACrC,IAAA,MAAMD,SAAAA,GAAYgE,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC9CjE,IAAAA,SAAAA,CAAUkE,SAAAA,GAAY,iCAAA;AACtBlE,IAAAA,SAAAA,CAAUmE,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAA,EAQT,IAAA,CAAKjF,QAAQQ,UAAU,CAAA;AAAA,IAAA,CAAA;AAIxC,IAAA,MAAM0E,aAAAA,GAAgB,IAAA,CAAK3E,MAAAA,CAAO4E,UAAAA,EAAW;AAC7CD,IAAAA,aAAAA,CAAcE,YAAYvE,SAAS,CAAA;AAEnC,IAAA,OAAOA,SAAAA;AAAAA,EACT;AAAA,EAEQiB,aAAaH,OAAAA,EAA+B;AAClD,IAAA,MAAM1B,KAAAA,GAAQ0B,OAAAA,CAAQ0D,KAAAA,CAAM,IAAI,CAAA;AAGhC,IAAA,IAAIpF,KAAAA,CAAMyC,MAAAA,GAAS,IAAA,CAAK1C,OAAAA,CAAQS,QAAAA,EAAU;AACxCb,MAAAA,MAAAA,CAAO0F,IAAAA,CAAK,CAAA,iCAAA,EAAoC,IAAA,CAAKtF,OAAAA,CAAQS,QAAQ,CAAA,CAAA,CAAG,CAAA;AACxER,MAAAA,KAAAA,CAAMyC,MAAAA,GAAS,KAAK1C,OAAAA,CAAQS,QAAAA;AAAAA,IAC9B;AAEA,IAAA,OAAOR,KAAAA,CAAMgC,GAAAA,CAAI,CAACN,QAAAA,EAASQ,KAAAA,MAAW;AAAA,MACpCC,EAAAA,EAAI,QAAQD,KAAK,CAAA,CAAA;AAAA,MACjBU,UAAAA,EAAYV,KAAAA;AAAAA,MACZR,OAAAA,EAAAA;AAAAA,KACF,CAAE,CAAA;AAAA,EACJ;AAAA,EAEQY,mBAAmBL,IAAAA,EAA0B;AACnD,IAAA,IAAI,CAAC,KAAKlC,OAAAA,CAAQY,cAAAA;AAChB,MAAA,OAAO,KAAKZ,OAAAA,CAAQQ,UAAAA;AAGtB,IAAA,MAAM+E,YAAAA,GAAe,EAAA;AACrB,IAAA,MAAMtF,QAAQuF,IAAAA,CAAKC,IAAAA,CAAKvD,IAAAA,CAAKP,OAAAA,CAAQe,SAAS6C,YAAY,CAAA;AAC1D,IAAA,OAAOtF,KAAAA,GAAQ,KAAKD,OAAAA,CAAQQ,UAAAA;AAAAA,EAC9B;AAAA,EAEQc,UAAAA,CAAWY,MAAkBC,KAAAA,EAA4B;AAE/D,IAAA,MAAMuD,MAAAA,GAAS,IAAA,CAAKxF,SAAAA,CAAUyF,GAAAA,CAAIzD,KAAKW,UAAU,CAAA;AACjD,IAAA,IAAI6C,MAAAA,IAAU,CAACA,MAAAA,CAAOpF,OAAAA;AACpB,MAAA,OAAO,IAAA,CAAKsF,kBAAkBF,MAAM,CAAA;AAGtC,IAAA,MAAMG,OAAAA,GAAU,IAAA,CAAKD,iBAAAA,CAAkB1D,IAAI,CAAA;AAG3C,IAAA,IAAA,CAAKhC,SAAAA,CAAU4F,GAAAA,CAAI5D,IAAAA,CAAKW,UAAAA,EAAY;AAAA,MAAE,GAAGX,IAAAA;AAAAA,MAAM5B,OAAAA,EAAS;AAAA,KAAO,CAAA;AAE/D,IAAA,OAAOuF,OAAAA;AAAAA,EACT;AAAA,EAEQD,kBAAkB1D,IAAAA,EAA+B;AACvD,IAAA,MAAM2D,OAAAA,GAAUhB,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC5Ce,IAAAA,OAAAA,CAAQd,SAAAA,GAAY,aAAA;AACpBc,IAAAA,OAAAA,CAAQb,MAAMC,OAAAA,GAAU;AAAA;AAAA,mBAAA,EAEP,IAAA,CAAKjF,OAAAA,CAAQY,cAAAA,GAAiB,UAAA,GAAa,KAAK,CAAA;AAAA,kBAAA,EACjD,IAAA,CAAKZ,OAAAA,CAAQY,cAAAA,GAAiB,YAAA,GAAe,QAAQ,CAAA;AAAA,kBAAA,EACrD,IAAA,CAAKZ,QAAQQ,UAAU,CAAA;AAAA,IAAA,CAAA;AAIvC,IAAA,IAAI,IAAA,CAAKR,QAAQW,iBAAAA,EAAmB;AAClC,MAAA,MAAMkC,UAAAA,GAAagC,QAAAA,CAASC,aAAAA,CAAc,MAAM,CAAA;AAChDjC,MAAAA,UAAAA,CAAWkC,SAAAA,GAAY,aAAA;AACvBlC,MAAAA,UAAAA,CAAWmC,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAA,CAAA;AAS3BpC,MAAAA,UAAAA,CAAWkD,WAAAA,GAAcC,MAAAA,CAAO9D,IAAAA,CAAKW,UAAAA,GAAa,CAAC,CAAA;AACnDgD,MAAAA,OAAAA,CAAQT,YAAYvC,UAAU,CAAA;AAAA,IAChC;AAGA,IAAA,MAAMlB,OAAAA,GAAUkD,QAAAA,CAASC,aAAAA,CAAc,MAAM,CAAA;AAC7CnD,IAAAA,OAAAA,CAAQoD,SAAAA,GAAY,cAAA;AACpBpD,IAAAA,OAAAA,CAAQqD,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA,IAAA,CAAA;AAKxB,IAAA,IAAI/C,IAAAA,CAAK+D,YAAAA,IAAgB,IAAA,CAAKjG,OAAAA,CAAQU,qBAAAA,EAAuB;AAE3DiB,MAAAA,OAAAA,CAAQuE,YAAY,IAAA,CAAKC,oBAAAA,CAAqBjE,IAAAA,CAAKP,OAAAA,EAASO,KAAK+D,YAAY,CAAA;AAAA,IAC/E,CAAA,MACK;AACHtE,MAAAA,OAAAA,CAAQoE,WAAAA,GAAc7D,KAAKP,OAAAA,IAAW,QAAA;AAAA,IACxC;AAEAkE,IAAAA,OAAAA,CAAQT,YAAYzD,OAAO,CAAA;AAE3B,IAAA,OAAOkE,OAAAA;AAAAA,EACT;AAAA,EAEQM,oBAAAA,CAAqBxE,SAAiByE,MAAAA,EAAuB;AACnE,IAAA,IAAIC,IAAAA,GAAO,EAAA;AACX,IAAA,IAAIC,SAAAA,GAAY,CAAA;AAEhBF,IAAAA,MAAAA,CAAOtC,QAASyC,CAAAA,KAAAA,KAAU;AAExB,MAAA,IAAIA,MAAMjC,KAAAA,GAAQgC,SAAAA;AAChBD,QAAAA,IAAAA,IAAQ,KAAKG,UAAAA,CAAW7E,OAAAA,CAAQ8E,MAAMH,SAAAA,EAAWC,KAAAA,CAAMjC,KAAK,CAAC,CAAA;AAG/D,MAAA,MAAMoC,YAAY/E,OAAAA,CAAQ8E,KAAAA,CAAMF,KAAAA,CAAMjC,KAAAA,EAAOiC,MAAMhC,GAAG,CAAA;AACtD8B,MAAAA,IAAAA,IAAQ,sBAAsBE,KAAAA,CAAMI,IAAI,KAAK,IAAA,CAAKH,UAAAA,CAAWE,SAAS,CAAC,CAAA,OAAA,CAAA;AAEvEJ,MAAAA,SAAAA,GAAYC,KAAAA,CAAMhC,GAAAA;AAAAA,IACpB,CAAC,CAAA;AAGD,IAAA,IAAI+B,YAAY3E,OAAAA,CAAQe,MAAAA;AACtB2D,MAAAA,IAAAA,IAAQ,IAAA,CAAKG,UAAAA,CAAW7E,OAAAA,CAAQ8E,KAAAA,CAAMH,SAAS,CAAC,CAAA;AAElD,IAAA,OAAOD,IAAAA;AAAAA,EACT;AAAA,EAEQG,WAAWI,IAAAA,EAAsB;AACvC,IAAA,MAAMC,GAAAA,GAAMhC,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AACxC+B,IAAAA,GAAAA,CAAId,WAAAA,GAAca,IAAAA;AAClB,IAAA,OAAOC,GAAAA,CAAIX,SAAAA;AAAAA,EACb;AAAA,EAEQ1E,mBAAAA,GAA4B;AAElC,IAAA,IAAA,CAAKT,eAAAA,CAAgB+F,EAAAA,CAAG,QAAA,EAAWC,CAAAA,OAAAA,KAAY;AAC7C,MAAA,IAAA,CAAKxG,MAAAA,CAAOyG,IAAAA,CAAK,eAAA,EAAiBD,OAAO,CAAA;AAAA,IAC3C,CAAC,CAAA;AAGD,IAAA,IAAA,CAAKxG,MAAAA,CAAOuG,EAAAA,CAAG,QAAA,EAAU,MAAM;AAC7B,MAAA,IAAA,CAAKxG,OAAAA,GAAU,IAAA;AACf,MAAA,IAAA,CAAK2G,cAAAA,EAAe;AAAA,IACtB,CAAC,CAAA;AAAA,EACH;AAAA,EAEQA,cAAAA,GAAuB;AAC7B,IAAA,IAAI,IAAA,CAAKrC,WAAAA;AACP,MAAA;AAEF,IAAA,IAAA,CAAKA,WAAAA,GAAcsC,sBAAsB,MAAM;AAC7C,MAAA,IAAA,CAAKtC,WAAAA,GAAc,IAAA;AACnB,MAAA,IAAI,KAAKtE,OAAAA,EAAS;AAChB,QAAA,IAAA,CAAKA,OAAAA,GAAU,KAAA;AAEf,QAAA,IAAA,CAAK6G,gBAAAA,EAAiB;AAAA,MACxB;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAAA,EAEQA,gBAAAA,GAAyB;AAE/B,IAAA,MAAMC,aAAa,IAAA,CAAKnH,KAAAA,CAAMoH,MAAAA,CAAOnF,CAAAA,IAAAA,KAAQA,KAAK5B,OAAO,CAAA;AACzD8G,IAAAA,UAAAA,CAAWtD,QAAS5B,CAAAA,IAAAA,KAAS;AAC3B,MAAA,IAAA,CAAKnB,eAAAA,CAAgBgC,WAAAA,CAAYb,IAAAA,CAAKE,EAAE,CAAA;AACxCF,MAAAA,IAAAA,CAAK5B,OAAAA,GAAU,KAAA;AAAA,IACjB,CAAC,CAAA;AAAA,EACH;AAAA,EAEQmB,sBAAAA,GAA+B;AACrC,IAAA,IAAI,CAAC,KAAKzB,OAAAA,CAAQU,qBAAAA;AAChB,MAAA;AAGF,IAAA,MAAM4G,UAAAA,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AA0CnB,IAAA,MAAMC,IAAAA,GAAO,IAAIC,IAAAA,CAAK,CAACF,UAAU,CAAA,EAAG;AAAA,MAAEX,IAAAA,EAAM;AAAA,KAA0B,CAAA;AACtE,IAAA,IAAA,CAAKlC,eAAe,IAAIgD,MAAAA,CAAOC,GAAAA,CAAIC,eAAAA,CAAgBJ,IAAI,CAAC,CAAA;AAExD,IAAA,IAAA,CAAK9C,YAAAA,CAAamD,YAAaC,CAAAA,CAAAA,KAAM;AACnC,MAAA,MAAM;AAAA,QAAEhF,UAAAA;AAAAA,QAAYuD;AAAAA,UAAWyB,CAAAA,CAAExF,IAAAA;AACjC,MAAA,MAAMH,IAAAA,GAAO,IAAA,CAAKjC,KAAAA,CAAM4C,UAAU,CAAA;AAClC,MAAA,IAAIX,IAAAA,EAAM;AACRA,QAAAA,IAAAA,CAAK+D,YAAAA,GAAeG,MAAAA;AACpB,QAAA,IAAA,CAAKrF,eAAAA,CAAgBgC,WAAAA,CAAYb,IAAAA,CAAKE,EAAE,CAAA;AAAA,MAC1C;AAAA,IACF,CAAA;AAAA,EACF;AAAA,EAEQY,uBAAuBH,UAAAA,EAA0B;AACvD,IAAA,IAAI,CAAC,IAAA,CAAK4B,YAAAA;AACR,MAAA;AAEF,IAAA,MAAMvC,IAAAA,GAAO,IAAA,CAAKjC,KAAAA,CAAM4C,UAAU,CAAA;AAClC,IAAA,IAAIX,IAAAA,EAAM;AACR,MAAA,IAAA,CAAKuC,aAAaqD,WAAAA,CAAY;AAAA,QAC5BjF,UAAAA;AAAAA,QACAlB,SAASO,IAAAA,CAAKP;AAAAA,OACf,CAAA;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKAoG,qBAAAA,GAAwB;AACtB,IAAA,MAAMC,sBAAAA,GAAyB,IAAA,CAAKjH,eAAAA,CAAgBgH,qBAAAA,EAAsB;AAE1E,IAAA,OAAO;AAAA,MACL,GAAGC,sBAAAA;AAAAA,MACHC,UAAAA,EAAY,KAAKhI,KAAAA,CAAMyC,MAAAA;AAAAA,MACvBwF,WAAAA,EAAa,KAAKhI,SAAAA,CAAUiI,IAAAA;AAAAA,MAC5BC,YAAAA,EAAc,KAAKjE,mBAAAA;AAAoB,KACzC;AAAA,EACF;AACF;;;;;;;"}