{"version":3,"file":"ErrorBoundary.cjs","sources":["../../src/core/ErrorBoundary.ts"],"sourcesContent":["/**\r\n * 错误边界\r\n * 捕获和处理插件错误，防止影响整个编辑器\r\n */\r\n\r\nimport { createLogger } from '../utils/logger'\r\nimport { EventEmitter } from './EventEmitter'\r\n\r\nconst logger = createLogger('ErrorBoundary')\r\n\r\nexport interface ErrorInfo {\r\n  error: Error\r\n  source: string\r\n  timestamp: number\r\n  recovered: boolean\r\n  context?: Record<string, any>\r\n}\r\n\r\nexport interface ErrorBoundaryConfig {\r\n  maxErrors?: number\r\n  recoveryAttempts?: number\r\n  reportErrors?: boolean\r\n  onError?: (info: ErrorInfo) => void\r\n}\r\n\r\n/**\r\n * 错误边界类\r\n */\r\nexport class ErrorBoundary extends EventEmitter {\r\n  private config: ErrorBoundaryConfig\r\n  private errors: ErrorInfo[] = []\r\n  private errorCounts: Map<string, number> = new Map()\r\n  private maxHistorySize: number = 100\r\n\r\n  constructor(config: ErrorBoundaryConfig = {}) {\r\n    super()\r\n    this.config = {\r\n      maxErrors: 10,\r\n      recoveryAttempts: 3,\r\n      reportErrors: true,\r\n      ...config,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 捕获错误\r\n   */\r\n  captureError(error: Error, source: string, context?: Record<string, any>): ErrorInfo {\r\n    const info: ErrorInfo = {\r\n      error,\r\n      source,\r\n      timestamp: Date.now(),\r\n      recovered: false,\r\n      context,\r\n    }\r\n\r\n    // 记录错误\r\n    this.errors.push(info)\r\n\r\n    // 限制历史记录大小\r\n    if (this.errors.length > this.maxHistorySize)\r\n      this.errors.shift()\r\n\r\n    // 更新错误计数\r\n    const count = (this.errorCounts.get(source) || 0) + 1\r\n    this.errorCounts.set(source, count)\r\n\r\n    // 记录日志\r\n    logger.error(`Error in ${source}:`, error)\r\n    if (context)\r\n      logger.error('Context:', context)\r\n\r\n    // 触发回调\r\n    if (this.config.onError)\r\n      this.config.onError(info)\r\n\r\n    // 触发事件\r\n    this.emit('error', info)\r\n\r\n    // 检查是否超过最大错误数\r\n    if (count >= this.config.maxErrors!) {\r\n      this.emit('max-errors-exceeded', { source, count })\r\n      logger.warn(`Source \"${source}\" has exceeded max errors (${count})`)\r\n    }\r\n\r\n    return info\r\n  }\r\n\r\n  /**\r\n   * 包装函数，自动捕获错误\r\n   */\r\n  wrap<T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    source: string,\r\n    fallback?: (...args: Parameters<T>) => ReturnType<T>,\r\n  ): T {\r\n    return ((...args: Parameters<T>) => {\r\n      try {\r\n        const result = fn(...args)\r\n\r\n        // 处理Promise\r\n        if (result instanceof Promise) {\r\n          return result.catch((error) => {\r\n            this.captureError(error, source)\r\n\r\n            if (fallback)\r\n              return fallback(...args)\r\n\r\n            throw error\r\n          })\r\n        }\r\n\r\n        return result\r\n      }\r\n      catch (error) {\r\n        this.captureError(error as Error, source)\r\n\r\n        if (fallback)\r\n          return fallback(...args)\r\n\r\n        throw error\r\n      }\r\n    }) as T\r\n  }\r\n\r\n  /**\r\n   * 尝试恢复\r\n   */\r\n  async tryRecover<T>(\r\n    fn: () => T | Promise<T>,\r\n    source: string,\r\n    options: {\r\n      attempts?: number\r\n      delay?: number\r\n      onRetry?: (attempt: number, error: Error) => void\r\n    } = {},\r\n  ): Promise<T> {\r\n    const attempts = options.attempts || this.config.recoveryAttempts!\r\n    const delay = options.delay || 1000\r\n\r\n    let lastError: Error\r\n\r\n    for (let attempt = 1; attempt <= attempts; attempt++) {\r\n      try {\r\n        const result = await fn()\r\n\r\n        // 恢复成功\r\n        if (attempt > 1) {\r\n          logger.info(`Recovered from error in ${source} after ${attempt} attempts`)\r\n          this.emit('recovered', { source, attempts: attempt })\r\n        }\r\n\r\n        return result\r\n      }\r\n      catch (error) {\r\n        lastError = error as Error\r\n\r\n        // 记录错误\r\n        this.captureError(lastError, source, {\r\n          attempt,\r\n          totalAttempts: attempts,\r\n        })\r\n\r\n        if (attempt < attempts) {\r\n          if (options.onRetry)\r\n            options.onRetry(attempt, lastError)\r\n\r\n          // 等待后重试\r\n          await new Promise(resolve => setTimeout(resolve, delay * attempt))\r\n        }\r\n      }\r\n    }\r\n\r\n    // 所有尝试都失败\r\n    logger.error(`Failed to recover from error in ${source} after ${attempts} attempts`)\r\n    this.emit('recovery-failed', { source, attempts })\r\n\r\n    throw lastError!\r\n  }\r\n\r\n  /**\r\n   * 获取错误历史\r\n   */\r\n  getErrors(source?: string): ErrorInfo[] {\r\n    if (source)\r\n      return this.errors.filter(e => e.source === source)\r\n\r\n    return [...this.errors]\r\n  }\r\n\r\n  /**\r\n   * 获取错误计数\r\n   */\r\n  getErrorCount(source?: string): number {\r\n    if (source)\r\n      return this.errorCounts.get(source) || 0\r\n\r\n    return Array.from(this.errorCounts.values()).reduce((sum, count) => sum + count, 0)\r\n  }\r\n\r\n  /**\r\n   * 获取错误率\r\n   */\r\n  getErrorRate(source: string, timeWindow: number = 60000): number {\r\n    const now = Date.now()\r\n    const recentErrors = this.errors.filter(e =>\r\n      e.source === source && (now - e.timestamp) <= timeWindow,\r\n    )\r\n\r\n    return recentErrors.length / (timeWindow / 1000) // 每秒错误数\r\n  }\r\n\r\n  /**\r\n   * 检查源是否健康\r\n   */\r\n  isHealthy(source: string): boolean {\r\n    const count = this.errorCounts.get(source) || 0\r\n    const rate = this.getErrorRate(source)\r\n\r\n    return count < this.config.maxErrors! && rate < 1\r\n  }\r\n\r\n  /**\r\n   * 重置错误计数\r\n   */\r\n  resetErrors(source?: string): void {\r\n    if (source) {\r\n      this.errorCounts.delete(source)\r\n      this.errors = this.errors.filter(e => e.source !== source)\r\n    }\r\n    else {\r\n      this.errorCounts.clear()\r\n      this.errors = []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 生成错误报告\r\n   */\r\n  generateReport(): string {\r\n    const totalErrors = this.getErrorCount()\r\n    const sources = Array.from(this.errorCounts.entries())\r\n      .sort((a, b) => b[1] - a[1])\r\n\r\n    let report = '错误边界报告\\n'\r\n    report += '=============\\n\\n'\r\n    report += `总错误数: ${totalErrors}\\n`\r\n    report += `错误源数: ${sources.length}\\n\\n`\r\n\r\n    report += '错误统计:\\n'\r\n    sources.forEach(([source, count]) => {\r\n      const rate = this.getErrorRate(source).toFixed(2)\r\n      const healthy = this.isHealthy(source) ? '✓' : '✗'\r\n      report += `  ${healthy} ${source}: ${count} (${rate}/s)\\n`\r\n    })\r\n\r\n    report += '\\n最近错误:\\n'\r\n    this.errors.slice(-10).forEach((error) => {\r\n      const time = new Date(error.timestamp).toLocaleTimeString()\r\n      report += `  [${time}] ${error.source}: ${error.error.message}\\n`\r\n    })\r\n\r\n    return report\r\n  }\r\n\r\n  /**\r\n   * 清理\r\n   */\r\n  destroy(): void {\r\n    this.errors = []\r\n    this.errorCounts.clear()\r\n    this.removeAllListeners()\r\n  }\r\n}\r\n\r\n// 全局实例\r\nlet globalBoundary: ErrorBoundary | null = null\r\n\r\n/**\r\n * 获取全局错误边界\r\n */\r\nexport function getErrorBoundary(config?: ErrorBoundaryConfig): ErrorBoundary {\r\n  if (!globalBoundary)\r\n    globalBoundary = new ErrorBoundary(config)\r\n\r\n  return globalBoundary\r\n}\r\n\r\n/**\r\n * 便捷函数：捕获错误\r\n */\r\nexport function captureError(error: Error, source: string, context?: Record<string, any>): void {\r\n  getErrorBoundary().captureError(error, source, context)\r\n}\r\n\r\n/**\r\n * 便捷函数：包装函数\r\n */\r\nexport function withErrorBoundary<T extends (...args: any[]) => any>(\r\n  fn: T,\r\n  source: string,\r\n  fallback?: (...args: Parameters<T>) => ReturnType<T>,\r\n): T {\r\n  return getErrorBoundary().wrap(fn, source, fallback)\r\n}\r\n"],"names":["logger","createLogger","ErrorBoundary","EventEmitter","constructor","config","errors","errorCounts","Map","maxHistorySize","maxErrors","recoveryAttempts","reportErrors","captureError","error","source","context","info","timestamp","Date","now","recovered","push","length","shift","count","get","set","onError","emit","warn","wrap","fn","fallback","args","result","Promise","catch","tryRecover","options","attempts","delay","lastError","attempt","totalAttempts","onRetry","resolve","setTimeout","getErrors","filter","e","getErrorCount","Array","from","values","reduce","sum","getErrorRate","timeWindow","recentErrors","isHealthy","rate","resetErrors","delete","clear","generateReport","totalErrors","sources","entries","sort","a","b","report","forEach","toFixed","healthy","slice","time","toLocaleTimeString","message","destroy","removeAllListeners","globalBoundary","getErrorBoundary","withErrorBoundary"],"mappings":"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"}