{"version":3,"file":"Editor.cjs","sources":["../../src/core/Editor.ts"],"sourcesContent":["/**\r\n * Editor - 编辑器核心类\r\n * 管理编辑器的所有功能\r\n *\r\n * @example\r\n * ```typescript\r\n * // 最简用法 - 无任何插件\r\n * const editor = new Editor({ element: '#editor' })\r\n *\r\n * // 链式注册插件\r\n * editor\r\n *   .use(BoldPlugin)\r\n *   .use(ItalicPlugin)\r\n *   .use(HeadingPlugin)\r\n *\r\n * // 使用预设\r\n * import { standardPlugins } from '@ldesign/editor-core/presets'\r\n * const editor = new Editor({ element: '#editor', plugins: standardPlugins })\r\n * ```\r\n */\r\n\r\nimport type { EditorOptions, EditorState, Plugin as PluginType, SchemaSpec, Transaction } from '../types'\r\nimport type { DOMPatch } from './IncrementalRenderer'\r\nimport type { Schema } from './Schema'\r\nimport { DebugPanel } from '../devtools/DebugPanel'\r\nimport { DEFAULT_TOOLBAR_ITEMS } from '../ui/defaultToolbar'\r\nimport { Toolbar } from '../ui/Toolbar'\r\nimport { createLogger } from '../utils/logger'\r\nimport { WasmAccelerator } from '../wasm/WasmAccelerator'\r\nimport { CommandManager, KeymapManager } from './Command'\r\nimport { Document } from './Document'\r\nimport { EditorVirtualScroller } from './EditorVirtualScroller'\r\nimport { EventEmitter } from './EventEmitter'\r\nimport { IncrementalRenderer } from './IncrementalRenderer'\r\nimport { PluginManager } from './Plugin'\r\nimport { defaultSchema } from './Schema'\r\nimport { Selection, SelectionManager } from './Selection'\r\n\r\nconst logger = createLogger('Editor')\r\n\r\nexport class Editor {\r\n  // 版本信息\r\n  public static version = '1.3.0'\r\n  public version = '1.3.0'\r\n\r\n  // 核心组件\r\n  private eventEmitter: EventEmitter\r\n  private schema: Schema\r\n  private document: Document\r\n  private selectionManager: SelectionManager\r\n\r\n  // 管理器\r\n  public commands: CommandManager\r\n  public keymap: KeymapManager\r\n  public plugins: PluginManager\r\n  public contextMenuManager?: any // 右键菜单管理器\r\n  public toolbar?: Toolbar // 工具栏\r\n  public virtualScroller?: EditorVirtualScroller // 虚拟滚动器\r\n  public incrementalRenderer?: IncrementalRenderer // 增量渲染器\r\n  public wasmAccelerator?: WasmAccelerator // WebAssembly加速器\r\n  public debugPanel?: DebugPanel // 调试面板\r\n\r\n  // 选项\r\n  public options: EditorOptions\r\n  private editable: boolean = true\r\n\r\n  // DOM\r\n  private element: HTMLElement | null = null\r\n  public contentElement: HTMLElement | null = null\r\n  private toolbarElement: HTMLElement | null = null\r\n\r\n  // 状态\r\n  private destroyed: boolean = false\r\n\r\n  // DOM 选区快照（用于在弹窗交互后恢复插入位置）\r\n  private savedRange: Range | null = null\r\n\r\n  constructor(options: EditorOptions = {}) {\r\n    this.options = options\r\n    this.editable = options.editable !== false\r\n\r\n    // 初始化核心组件\r\n    this.eventEmitter = new EventEmitter()\r\n    this.schema = defaultSchema\r\n    this.document = new Document(options.content, this.schema)\r\n    this.selectionManager = new SelectionManager(this)\r\n\r\n    // 初始化管理器\r\n    this.commands = new CommandManager(this)\r\n    this.keymap = new KeymapManager(this)\r\n    this.plugins = new PluginManager(this)\r\n\r\n    // 初始化 DOM\r\n    if (options.element)\r\n      this.mount(options.element)\r\n\r\n    // 注册插件 - 只加载用户明确指定的插件，默认为空\r\n    const pluginsToLoad = options.plugins || []\r\n\r\n    if (pluginsToLoad.length > 0) {\r\n      logger.debug('Loading plugins, total:', pluginsToLoad.length)\r\n      pluginsToLoad.forEach((plugin, index) => {\r\n        if (typeof plugin === 'string') {\r\n          logger.debug(`Loading builtin plugin [${index}]: \"${plugin}\"`)\r\n          this.loadBuiltinPlugin(plugin)\r\n        }\r\n        else {\r\n          logger.debug(`Loading plugin [${index}]: \"${plugin.name || 'unnamed'}\"`)\r\n          this.plugins.register(plugin)\r\n        }\r\n      })\r\n      logger.debug('All plugins loaded')\r\n    }\r\n\r\n    // 初始化事件监听\r\n    this.setupEventListeners()\r\n  }\r\n\r\n  /**\r\n   * 链式注册插件\r\n   * @param plugin - 插件实例或插件名称\r\n   * @returns 编辑器实例（支持链式调用）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * editor\r\n   *   .use(BoldPlugin)\r\n   *   .use(ItalicPlugin)\r\n   *   .use(new CustomPlugin({ option: 'value' }))\r\n   * ```\r\n   */\r\n  use(plugin: PluginType | string): this {\r\n    if (typeof plugin === 'string') {\r\n      this.loadBuiltinPlugin(plugin)\r\n    }\r\n    else {\r\n      this.plugins.register(plugin)\r\n    }\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 批量注册插件\r\n   * @param plugins - 插件数组\r\n   * @returns 编辑器实例（支持链式调用）\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * import { standardPlugins } from '@ldesign/editor-core/presets'\r\n   * editor.usePlugins(standardPlugins)\r\n   * ```\r\n   */\r\n  usePlugins(plugins: (PluginType | string)[]): this {\r\n    plugins.forEach(plugin => this.use(plugin))\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 挂载编辑器\r\n   */\r\n  mount(element: HTMLElement | string): void {\r\n    if (typeof element === 'string') {\r\n      const el = document.querySelector(element)\r\n      if (!el)\r\n        throw new Error(`Element \"${element}\" not found`)\r\n\r\n      this.element = el as HTMLElement\r\n    }\r\n    else {\r\n      this.element = element\r\n    }\r\n\r\n    // 创建编辑器 DOM 结构\r\n    this.element.classList.add('ldesign-editor')\r\n    this.element.classList.add('ldesign-editor-wrapper')\r\n\r\n    // 创建工具栏容器 (默认创建)\r\n    if (this.options.toolbar !== false) {\r\n      this.toolbarElement = document.createElement('div')\r\n      this.toolbarElement.classList.add('ldesign-toolbar')\r\n      this.element.appendChild(this.toolbarElement)\r\n\r\n      // 创建工具栏实例\r\n      this.toolbar = new Toolbar(this, {\r\n        container: this.toolbarElement,\r\n        items: this.options.toolbarItems || DEFAULT_TOOLBAR_ITEMS,\r\n      })\r\n    }\r\n\r\n    // 创建编辑器内容区域\r\n    this.contentElement = document.createElement('div')\r\n    this.contentElement.classList.add('ldesign-editor-content')\r\n    this.contentElement.contentEditable = String(this.editable)\r\n\r\n    // 设置占位符\r\n    if (this.options.placeholder)\r\n      this.contentElement.dataset.placeholder = this.options.placeholder\r\n\r\n    this.element.appendChild(this.contentElement)\r\n\r\n    // 初始化增量渲染器\r\n    if (this.options.incrementalRender?.enabled !== false) {\r\n      this.incrementalRenderer = new IncrementalRenderer({\r\n        batchDelay: this.options.incrementalRender?.batchDelay,\r\n        maxBatchSize: this.options.incrementalRender?.maxBatchSize,\r\n        useRAF: this.options.incrementalRender?.useRAF !== false,\r\n        useWorker: this.options.incrementalRender?.useWorker,\r\n        useVirtualDOM: this.options.incrementalRender?.useVirtualDOM,\r\n      })\r\n\r\n      // 观察内容元素的变化\r\n      this.incrementalRenderer.observeElement(this.contentElement)\r\n    }\r\n\r\n    // 初始化WebAssembly加速器\r\n    if (this.options.wasm?.enabled !== false && WasmAccelerator.isSupported()) {\r\n      this.wasmAccelerator = new WasmAccelerator({\r\n        enabled: this.options.wasm?.enabled !== false,\r\n        enableDiff: this.options.wasm?.enableDiff !== false,\r\n        enableParser: this.options.wasm?.enableParser !== false,\r\n        useWorker: this.options.wasm?.useWorker,\r\n        warmupStrategy: this.options.wasm?.warmupStrategy || 'lazy',\r\n      })\r\n\r\n      // 预热WASM模块（异步）\r\n      if (this.options.wasm?.warmupStrategy === 'eager') {\r\n        this.wasmAccelerator.initialize().catch((error) => {\r\n          logger.warn('WASM initialization failed:', error)\r\n        })\r\n      }\r\n    }\r\n\r\n    // 初始化虚拟滚动（如果启用）\r\n    if (this.options.virtualScroll?.enabled) {\r\n      this.virtualScroller = new EditorVirtualScroller({\r\n        editor: this,\r\n        lineHeight: this.options.virtualScroll.lineHeight,\r\n        maxLines: this.options.virtualScroll.maxLines,\r\n        enableSyntaxHighlight: this.options.virtualScroll.enableSyntaxHighlight,\r\n        enableLineNumbers: this.options.virtualScroll.enableLineNumbers,\r\n        enableWordWrap: this.options.virtualScroll.enableWordWrap,\r\n      })\r\n\r\n      // 使用虚拟滚动渲染\r\n      this.virtualScroller.setContent(this.document.toText())\r\n    }\r\n    else {\r\n      // 普通渲染\r\n      this.render()\r\n    }\r\n\r\n    // 自动聚焦\r\n    if (this.options.autofocus)\r\n      this.focus()\r\n\r\n    // 初始化调试面板\r\n    if (this.options.debugPanel?.enabled) {\r\n      this.debugPanel = new DebugPanel({\r\n        editor: this,\r\n        expanded: this.options.debugPanel.expanded,\r\n        initialTab: this.options.debugPanel.initialTab,\r\n        theme: this.options.debugPanel.theme,\r\n        position: this.options.debugPanel.position,\r\n        size: this.options.debugPanel.size,\r\n        resizable: this.options.debugPanel.resizable,\r\n        showInProduction: this.options.debugPanel.showInProduction,\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置事件监听\r\n   */\r\n  private setupEventListeners(): void {\r\n    if (!this.contentElement)\r\n      return\r\n\r\n    // 键盘事件\r\n    this.contentElement.addEventListener('keydown', (e) => {\r\n      if (this.keymap.handleKeyDown(e))\r\n        e.preventDefault()\r\n    })\r\n\r\n    // 输入事件\r\n    this.contentElement.addEventListener('input', (_e) => {\r\n      this.handleInput()\r\n    })\r\n\r\n    // 选区变化\r\n    document.addEventListener('selectionchange', () => {\r\n      const sel = window.getSelection()\r\n      if (this.contentElement && this.contentElement.contains(sel?.anchorNode || null)) {\r\n        // 同步到内部 Selection 模型\r\n        this.selectionManager.syncFromDOM()\r\n        this.emit('selectionUpdate', this.getSelection())\r\n        // 保存 DOM 级别的 Range 以便弹窗关闭后恢复\r\n        if (sel && sel.rangeCount > 0) {\r\n          try {\r\n            this.savedRange = sel.getRangeAt(0).cloneRange()\r\n          }\r\n          catch { }\r\n        }\r\n      }\r\n    })\r\n\r\n    // 聚焦和失焦\r\n    this.contentElement.addEventListener('focus', () => {\r\n      this.emit('focus')\r\n      this.options.onFocus?.()\r\n    })\r\n\r\n    this.contentElement.addEventListener('blur', () => {\r\n      this.emit('blur')\r\n      this.options.onBlur?.()\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 处理输入\r\n   */\r\n  private handleInput(): void {\r\n    if (!this.contentElement)\r\n      return\r\n\r\n    // 更新文档\r\n    const html = this.contentElement.innerHTML\r\n    this.document = new Document(html, this.schema)\r\n\r\n    // 触发更新事件\r\n    this.emit('update', this.getState())\r\n    this.options.onUpdate?.(this.getState())\r\n    this.options.onChange?.(this.getHTML())\r\n  }\r\n\r\n  /**\r\n   * 渲染内容\r\n   */\r\n  private render(): void {\r\n    if (!this.contentElement)\r\n      return\r\n\r\n    const html = this.document.toHTML()\r\n\r\n    if (this.incrementalRenderer) {\r\n      // 使用增量渲染\r\n      this.renderIncremental(html)\r\n    }\r\n    else {\r\n      // 保存当前选区\r\n      const selection = this.getSelection()\r\n\r\n      // 更新内容\r\n      this.contentElement.innerHTML = html\r\n\r\n      // 恢复选区\r\n      if (selection)\r\n        this.setSelection(selection)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 增量渲染内容\r\n   */\r\n  private renderIncremental(newHTML: string): void {\r\n    if (!this.contentElement || !this.incrementalRenderer)\r\n      return\r\n\r\n    // 创建临时DOM来解析新HTML\r\n    const tempDiv = document.createElement('div')\r\n    tempDiv.innerHTML = newHTML\r\n\r\n    // 计算差异并生成补丁\r\n    const patches = this.calculatePatches(this.contentElement, tempDiv)\r\n\r\n    // 应用补丁\r\n    if (patches.length > 0)\r\n      this.incrementalRenderer.queuePatches(patches)\r\n  }\r\n\r\n  /**\r\n   * 计算DOM补丁\r\n   */\r\n  private calculatePatches(oldRoot: Element, newRoot: Element): DOMPatch[] {\r\n    const patches: DOMPatch[] = []\r\n\r\n    // 简单的差异算法（实际应该使用更复杂的算法）\r\n    const oldChildren = Array.from(oldRoot.children)\r\n    const newChildren = Array.from(newRoot.children)\r\n\r\n    // 处理删除的节点\r\n    oldChildren.forEach((oldChild, index) => {\r\n      if (!newChildren[index]) {\r\n        patches.push({\r\n          type: 'remove',\r\n          target: oldChild,\r\n        })\r\n      }\r\n    })\r\n\r\n    // 处理新增和更新的节点\r\n    newChildren.forEach((newChild, index) => {\r\n      const oldChild = oldChildren[index]\r\n\r\n      if (!oldChild) {\r\n        // 新增节点\r\n        patches.push({\r\n          type: 'insert',\r\n          parent: oldRoot,\r\n          newNode: newChild.cloneNode(true),\r\n          index,\r\n        })\r\n      }\r\n      else if (oldChild.outerHTML !== newChild.outerHTML) {\r\n        // 更新节点\r\n        patches.push({\r\n          type: 'update',\r\n          target: oldChild,\r\n          newNode: newChild.cloneNode(true),\r\n        })\r\n      }\r\n    })\r\n\r\n    return patches\r\n  }\r\n\r\n  /**\r\n   * 加载内置插件\r\n   */\r\n  private loadBuiltinPlugin(name: string): void {\r\n    // 动态导入插件\r\n    switch (name) {\r\n      case 'image':\r\n        import('../plugins/media/image').then((module) => {\r\n          this.plugins.register(module.ImagePlugin)\r\n        })\r\n        break\r\n      case 'formatting':\r\n        import('../plugins/formatting').then((module) => {\r\n          if (module.BoldPlugin)\r\n            this.plugins.register(module.BoldPlugin)\r\n          if (module.ItalicPlugin)\r\n            this.plugins.register(module.ItalicPlugin)\r\n          if (module.UnderlinePlugin)\r\n            this.plugins.register(module.UnderlinePlugin)\r\n        })\r\n        break\r\n      // 其他插件可以在这里添加\r\n      default:\r\n        logger.warn(`未知插件: ${name}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取编辑器容器元素\r\n   */\r\n  getElement(): HTMLElement {\r\n    if (!this.element)\r\n      throw new Error('Editor not mounted')\r\n\r\n    return this.element\r\n  }\r\n\r\n  /**\r\n   * 获取编辑器状态\r\n   */\r\n  getState(): EditorState {\r\n    return {\r\n      doc: this.document.toJSON(),\r\n      selection: this.getSelection().toJSON(),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分发事务\r\n   */\r\n  dispatch(tr: Transaction): void {\r\n    // 更新文档\r\n    this.document = new Document(tr.doc, this.schema)\r\n\r\n    // 更新选区\r\n    if (tr.selection)\r\n      this.setSelection(Selection.fromJSON(tr.selection))\r\n\r\n    // 重新渲染\r\n    this.render()\r\n\r\n    // 触发更新事件\r\n    this.emit('update', this.getState())\r\n    this.options.onUpdate?.(this.getState())\r\n    this.options.onChange?.(this.getHTML())\r\n  }\r\n\r\n  /**\r\n   * 获取选区\r\n   */\r\n  getSelection(): Selection {\r\n    return this.selectionManager.getSelection()\r\n  }\r\n\r\n  /**\r\n   * 设置选区\r\n   */\r\n  setSelection(selection: Selection): void {\r\n    this.selectionManager.setSelection(selection)\r\n  }\r\n\r\n  /**\r\n   * 保存当前 DOM 选区（仅当选区在编辑器内部时）\r\n   */\r\n  saveSelection(): void {\r\n    if (!this.contentElement)\r\n      return\r\n    const sel = window.getSelection()\r\n    if (!sel || sel.rangeCount === 0)\r\n      return\r\n    const range = sel.getRangeAt(0)\r\n    if (this.contentElement.contains(range.commonAncestorContainer)) {\r\n      try {\r\n        this.savedRange = range.cloneRange()\r\n        logger.debug('DOM selection saved')\r\n      }\r\n      catch (e) {\r\n        logger.warn('Failed to save selection:', e)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 恢复先前保存的 DOM 选区\r\n   * 返回是否恢复成功\r\n   */\r\n  restoreSelection(): boolean {\r\n    if (!this.contentElement || !this.savedRange)\r\n      return false\r\n    try {\r\n      if (!this.contentElement.contains(this.savedRange.commonAncestorContainer))\r\n        return false\r\n\r\n      const sel = window.getSelection()\r\n      sel?.removeAllRanges()\r\n      sel?.addRange(this.savedRange)\r\n      logger.debug('DOM selection restored')\r\n      return true\r\n    }\r\n    catch (e) {\r\n      logger.warn('Failed to restore selection:', e)\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取 HTML 内容\r\n   */\r\n  getHTML(): string {\r\n    return this.document.toHTML()\r\n  }\r\n\r\n  /**\r\n   * 获取选中的纯文本\r\n   */\r\n  getSelectedText(): string {\r\n    if (!this.contentElement)\r\n      return ''\r\n\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return ''\r\n\r\n    const range = selection.getRangeAt(0)\r\n    if (!this.contentElement.contains(range.commonAncestorContainer))\r\n      return ''\r\n\r\n    // 获取选中的纯文本\r\n    return selection.toString()\r\n  }\r\n\r\n  /**\r\n   * 设置 HTML 内容\r\n   */\r\n  setHTML(html: string): void {\r\n    this.document = new Document(html, this.schema)\r\n    this.render()\r\n  }\r\n\r\n  /**\r\n   * 获取 JSON 内容\r\n   */\r\n  getJSON(): any {\r\n    return this.document.toJSON()\r\n  }\r\n\r\n  /**\r\n   * 设置 JSON 内容\r\n   */\r\n  setJSON(json: any): void {\r\n    this.document = Document.fromJSON(json, this.schema)\r\n    this.render()\r\n  }\r\n\r\n  /**\r\n   * 插入 HTML 内容到当前光标位置\r\n   */\r\n  insertHTML(html: string): void {\r\n    if (!this.contentElement)\r\n      return\r\n\r\n    const beforeLen = this.contentElement.innerHTML.length\r\n    logger.debug('insertHTML called. Before length:', beforeLen)\r\n    logger.debug('html length:', html?.length)\r\n\r\n    // 获取当前选区\r\n    let selection = window.getSelection()\r\n    logger.debug('Initial selection:', selection)\r\n    if (!selection || selection.rangeCount === 0) {\r\n      // 尝试恢复之前保存的选区\r\n      const restored = this.restoreSelection()\r\n      selection = window.getSelection()\r\n      if (!restored || !selection || selection.rangeCount === 0) {\r\n        // 如果没有选区，退化到在编辑器末尾插入\r\n        logger.warn('No selection, creating range at end of editor')\r\n        this.contentElement.focus()\r\n        const range = document.createRange()\r\n        range.selectNodeContents(this.contentElement)\r\n        range.collapse(false)\r\n        selection = window.getSelection()\r\n        selection?.removeAllRanges()\r\n        selection?.addRange(range)\r\n      }\r\n    }\r\n\r\n    let range = selection!.getRangeAt(0)\r\n    logger.debug('Range obtained. Collapsed:', range.collapsed)\r\n\r\n    // 确保选区在编辑器内\r\n    if (!this.contentElement.contains(range.commonAncestorContainer)) {\r\n      logger.warn('Selection is not in editor; attempting to restore saved selection')\r\n      const restored = this.restoreSelection()\r\n      selection = window.getSelection()\r\n      if (restored && selection && selection.rangeCount > 0 && this.contentElement.contains(selection.getRangeAt(0).commonAncestorContainer)) {\r\n        range = selection.getRangeAt(0)\r\n      }\r\n      else {\r\n        logger.warn('Saved selection unavailable; moving caret to end')\r\n        this.contentElement.focus()\r\n        const newRange = document.createRange()\r\n        newRange.selectNodeContents(this.contentElement)\r\n        newRange.collapse(false)\r\n        selection!.removeAllRanges()\r\n        selection!.addRange(newRange)\r\n        range = newRange\r\n      }\r\n    }\r\n\r\n    // 再次确保焦点在编辑器\r\n    this.contentElement.focus()\r\n\r\n    // 尝试使用 execCommand，如果失败或无效果则使用手动插入\r\n    let success = false\r\n    try {\r\n      success = document.execCommand('insertHTML', false, html)\r\n      logger.debug('execCommand(\"insertHTML\") returned:', success)\r\n    }\r\n    catch (err) {\r\n      logger.warn('execCommand threw error, will use manual insertion:', err)\r\n      success = false\r\n    }\r\n\r\n    // 检测 execCommand 是否无效果（内容长度未变化）\r\n    const afterLenCandidate = this.contentElement.innerHTML.length\r\n    const noChange = afterLenCandidate === beforeLen\r\n    if (!success || noChange) {\r\n      if (success && noChange)\r\n        logger.warn('execCommand reported success but content did not change, falling back to manual insertion')\r\n      else\r\n        logger.debug('Falling back to manual insertion')\r\n\r\n      // 手动插入 HTML\r\n      const tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = html\r\n\r\n      // 删除选中的内容\r\n      try {\r\n        range.deleteContents()\r\n      }\r\n      catch (err) {\r\n        logger.warn('deleteContents error:', err)\r\n      }\r\n\r\n      // 插入新内容\r\n      const fragment = document.createDocumentFragment()\r\n      while (tempDiv.firstChild)\r\n        fragment.appendChild(tempDiv.firstChild)\r\n\r\n      try {\r\n        range.insertNode(fragment)\r\n      }\r\n      catch (err) {\r\n        logger.error('insertNode error:', err)\r\n      }\r\n\r\n      // 移动光标到插入内容之后\r\n      try {\r\n        range.collapse(false)\r\n        selection!.removeAllRanges()\r\n        selection!.addRange(range)\r\n      }\r\n      catch (err) {\r\n        logger.warn('Reselection error:', err)\r\n      }\r\n    }\r\n\r\n    const afterLen = this.contentElement.innerHTML.length\r\n    logger.debug('After length:', afterLen, 'Delta:', afterLen - beforeLen)\r\n\r\n    // 简要诊断：统计媒体标签数量\r\n    try {\r\n      const snapshot = this.contentElement.innerHTML\r\n      const imgCount = (snapshot.match(/<img\\b/gi) || []).length\r\n      const videoCount = (snapshot.match(/<video\\b/gi) || []).length\r\n      const audioCount = (snapshot.match(/<audio\\b/gi) || []).length\r\n      logger.debug('Media counts -> img:', imgCount, 'video:', videoCount, 'audio:', audioCount)\r\n    }\r\n    catch { }\r\n\r\n    // 将插入位置滚动到可见区域\r\n    try {\r\n      const selNow = window.getSelection()\r\n      const anchor = selNow?.anchorNode as (Node | null)\r\n      let targetEl: HTMLElement | null = null\r\n      if (anchor) {\r\n        if ((anchor as any).nodeType === 3)\r\n          targetEl = (anchor as any).parentElement || null\r\n        else if ((anchor as any).nodeType === 1)\r\n          targetEl = anchor as any as HTMLElement\r\n        else\r\n          targetEl = (anchor as any).parentElement || null\r\n      }\r\n      // 优先滚动选区附近的元素，其次滚动到底部\r\n      if (targetEl && this.contentElement?.contains(targetEl))\r\n        targetEl.scrollIntoView({ block: 'nearest', inline: 'nearest', behavior: 'smooth' })\r\n      else if (this.contentElement)\r\n        this.contentElement.scrollTop = this.contentElement.scrollHeight\r\n    }\r\n    catch (err) {\r\n      logger.warn('scrollIntoView failed:', err)\r\n    }\r\n\r\n    // 触发更新事件\r\n    this.handleInput()\r\n  }\r\n\r\n  /**\r\n   * 清空内容\r\n   */\r\n  clear(): void {\r\n    this.setHTML('<p></p>')\r\n  }\r\n\r\n  /**\r\n   * 聚焦编辑器\r\n   */\r\n  focus(): void {\r\n    this.contentElement?.focus()\r\n  }\r\n\r\n  /**\r\n   * 失焦编辑器\r\n   */\r\n  blur(): void {\r\n    this.contentElement?.blur()\r\n  }\r\n\r\n  /**\r\n   * 设置是否可编辑\r\n   */\r\n  setEditable(editable: boolean): void {\r\n    this.editable = editable\r\n    if (this.contentElement)\r\n      this.contentElement.contentEditable = String(editable)\r\n  }\r\n\r\n  /**\r\n   * 检查是否可编辑\r\n   */\r\n  isEditable(): boolean {\r\n    return this.editable\r\n  }\r\n\r\n  /**\r\n   * 扩展 Schema\r\n   */\r\n  extendSchema(spec: SchemaSpec): void {\r\n    // 合并节点\r\n    if (spec.nodes) {\r\n      Object.entries(spec.nodes).forEach(([name, nodeSpec]) => {\r\n        this.schema.nodes.set(name, nodeSpec)\r\n      })\r\n    }\r\n\r\n    // 合并标记\r\n    if (spec.marks) {\r\n      Object.entries(spec.marks).forEach(([name, markSpec]) => {\r\n        this.schema.marks.set(name, markSpec)\r\n      })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 事件系统\r\n   */\r\n  on(event: string, handler: (...args: any[]) => void): () => void {\r\n    return this.eventEmitter.on(event, handler)\r\n  }\r\n\r\n  once(event: string, handler: (...args: any[]) => void): void {\r\n    this.eventEmitter.once(event, handler)\r\n  }\r\n\r\n  off(event: string, handler: (...args: any[]) => void): void {\r\n    this.eventEmitter.off(event, handler)\r\n  }\r\n\r\n  emit(event: string, ...args: any[]): void {\r\n    this.eventEmitter.emit(event, ...args)\r\n  }\r\n\r\n  /**\r\n   * 销毁编辑器\r\n   */\r\n  destroy(): void {\r\n    if (this.destroyed)\r\n      return\r\n\r\n    // 清理插件\r\n    this.plugins.clear()\r\n\r\n    // 清理命令和快捷键\r\n    this.commands.clear()\r\n    this.keymap.clear()\r\n\r\n    // 清理事件\r\n    this.eventEmitter.clear()\r\n\r\n    // 清理 DOM\r\n    if (this.element)\r\n      this.element.innerHTML = ''\r\n\r\n    this.destroyed = true\r\n  }\r\n\r\n  /**\r\n   * 检查是否已销毁\r\n   */\r\n  isDestroyed(): boolean {\r\n    return this.destroyed\r\n  }\r\n}\r\n"],"names":["logger","createLogger","Editor","constructor","options","version","editable","element","contentElement","toolbarElement","destroyed","savedRange","eventEmitter","EventEmitter","schema","defaultSchema","document","Document","content","selectionManager","SelectionManager","commands","CommandManager","keymap","KeymapManager","plugins","PluginManager","mount","pluginsToLoad","length","debug","forEach","plugin","index","loadBuiltinPlugin","name","register","setupEventListeners","use","usePlugins","el","querySelector","Error","classList","add","toolbar","createElement","appendChild","Toolbar","container","items","toolbarItems","DEFAULT_TOOLBAR_ITEMS","contentEditable","String","placeholder","dataset","incrementalRender","enabled","incrementalRenderer","IncrementalRenderer","batchDelay","maxBatchSize","useRAF","useWorker","useVirtualDOM","observeElement","wasm","WasmAccelerator","isSupported","wasmAccelerator","enableDiff","enableParser","warmupStrategy","initialize","catch","error","warn","virtualScroll","virtualScroller","EditorVirtualScroller","editor","lineHeight","maxLines","enableSyntaxHighlight","enableLineNumbers","enableWordWrap","setContent","toText","render","autofocus","focus","debugPanel","DebugPanel","expanded","initialTab","theme","position","size","resizable","showInProduction","addEventListener","e","handleKeyDown","preventDefault","_e","handleInput","sel","window","getSelection","contains","anchorNode","syncFromDOM","emit","rangeCount","getRangeAt","cloneRange","onFocus","onBlur","html","innerHTML","getState","onUpdate","onChange","getHTML","toHTML","renderIncremental","selection","setSelection","newHTML","tempDiv","patches","calculatePatches","queuePatches","oldRoot","newRoot","oldChildren","Array","from","children","newChildren","oldChild","push","type","target","newChild","parent","newNode","cloneNode","outerHTML","then","module","ImagePlugin","BoldPlugin","ItalicPlugin","UnderlinePlugin","getElement","doc","toJSON","dispatch","tr","Selection","fromJSON","saveSelection","range","commonAncestorContainer","restoreSelection","removeAllRanges","addRange","getSelectedText","toString","setHTML","getJSON","setJSON","json","insertHTML","beforeLen","restored","createRange","selectNodeContents","collapse","collapsed","newRange","success","execCommand","err","afterLenCandidate","noChange","deleteContents","fragment","createDocumentFragment","firstChild","insertNode","afterLen","snapshot","imgCount","match","videoCount","audioCount","selNow","anchor","targetEl","nodeType","parentElement","scrollIntoView","block","inline","behavior","scrollTop","scrollHeight","clear","blur","setEditable","isEditable","extendSchema","spec","nodes","Object","entries","nodeSpec","set","marks","markSpec","on","event","handler","once","off","args","destroy","isDestroyed"],"mappings":"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"}