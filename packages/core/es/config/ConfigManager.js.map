{"version":3,"file":"ConfigManager.js","sources":["../../src/config/ConfigManager.ts"],"sourcesContent":["/**\r\n * 统一配置管理系统\r\n * 集中管理编辑器的所有配置：图标、主题、语言等\r\n */\r\n\r\nimport type { I18nConfig, I18nManager } from '../i18n'\r\n\r\nimport type { IconManager } from '../icons/IconManager'\r\nimport type { IconSetType } from '../icons/types'\r\nimport type { Theme, ThemeManager } from '../theme'\r\nimport { EventEmitter } from '../core/EventEmitter'\r\nimport { getI18n } from '../i18n'\r\nimport { getIconManager } from '../icons/IconManager'\r\nimport { getThemeManager } from '../theme'\r\n\r\n/**\r\n * 编辑器配置接口\r\n */\r\nexport interface EditorConfig {\r\n  // 图标配置\r\n  icons?: any // IconManagerConfig export issue workaround\r\n\r\n  // 主题配置\r\n  theme?: {\r\n    defaultTheme?: string\r\n    customThemes?: Theme[]\r\n    followSystem?: boolean\r\n  }\r\n\r\n  // 多语言配置\r\n  i18n?: Partial<I18nConfig>\r\n\r\n  // 功能特性\r\n  features?: {\r\n    enabled?: string[]\r\n    disabled?: string[]\r\n    lazy?: boolean\r\n  }\r\n\r\n  // 其他配置\r\n  autoSave?: boolean\r\n  autoSaveInterval?: number\r\n  spellCheck?: boolean\r\n  readOnly?: boolean\r\n}\r\n\r\n/**\r\n * 配置管理器\r\n * 提供统一的接口来管理编辑器的所有配置\r\n */\r\nexport class ConfigManager extends EventEmitter {\r\n  private config: EditorConfig = {}\r\n  private iconManager: IconManager\r\n  private themeManager: ThemeManager\r\n  private i18nManager: I18nManager\r\n\r\n  constructor(config: EditorConfig = {}) {\r\n    super()\r\n    this.config = config\r\n\r\n    // 初始化图标管理器\r\n    this.iconManager = getIconManager(config.icons)\r\n\r\n    // 初始化主题管理器\r\n    this.themeManager = getThemeManager()\r\n    if (config.theme) {\r\n      // 添加自定义主题\r\n      if (config.theme.customThemes) {\r\n        config.theme.customThemes.forEach((theme) => {\r\n          this.themeManager.addCustomTheme(theme)\r\n        })\r\n      }\r\n\r\n      // 设置默认主题\r\n      if (config.theme.defaultTheme)\r\n        this.themeManager.setTheme(config.theme.defaultTheme)\r\n\r\n      // 跟随系统主题\r\n      if (config.theme.followSystem)\r\n        this.themeManager.followSystemTheme()\r\n    }\r\n\r\n    // 初始化多语言管理器\r\n    this.i18nManager = getI18n(config.i18n)\r\n\r\n    // 监听各管理器的变化\r\n    this.setupListeners()\r\n  }\r\n\r\n  /**\r\n   * 设置监听器\r\n   */\r\n  private setupListeners(): void {\r\n    // 监听图标集变化\r\n    this.iconManager.on('iconset:changed', (data: any) => {\r\n      this.emit('config:changed', {\r\n        type: 'icons',\r\n        oldValue: data.oldSet,\r\n        newValue: data.newSet,\r\n      })\r\n    })\r\n\r\n    // 监听主题变化\r\n    this.themeManager.on('themeChange', (data: any) => {\r\n      this.emit('config:changed', {\r\n        type: 'theme',\r\n        oldValue: data.oldTheme,\r\n        newValue: data.newTheme,\r\n      })\r\n    })\r\n\r\n    // 监听语言变化\r\n    this.i18nManager.on('localeChange', (data: any) => {\r\n      this.emit('config:changed', {\r\n        type: 'locale',\r\n        oldValue: data.oldLocale,\r\n        newValue: data.newLocale,\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 获取图标管理器\r\n   */\r\n  getIconManager(): IconManager {\r\n    return this.iconManager\r\n  }\r\n\r\n  /**\r\n   * 获取主题管理器\r\n   */\r\n  getThemeManager(): ThemeManager {\r\n    return this.themeManager\r\n  }\r\n\r\n  /**\r\n   * 获取多语言管理器\r\n   */\r\n  getI18nManager(): I18nManager {\r\n    return this.i18nManager\r\n  }\r\n\r\n  /**\r\n   * 设置图标集\r\n   */\r\n  setIconSet(set: IconSetType): void {\r\n    this.iconManager.setDefaultIconSet(set)\r\n  }\r\n\r\n  /**\r\n   * 获取当前图标集\r\n   */\r\n  getIconSet(): IconSetType {\r\n    return this.iconManager.getCurrentIconSet()\r\n  }\r\n\r\n  /**\r\n   * 获取可用图标集\r\n   */\r\n  getAvailableIconSets(): IconSetType[] {\r\n    return this.iconManager.getAvailableIconSets()\r\n  }\r\n\r\n  /**\r\n   * 设置主题\r\n   */\r\n  setTheme(themeName: string): void {\r\n    this.themeManager.setTheme(themeName)\r\n  }\r\n\r\n  /**\r\n   * 获取当前主题\r\n   */\r\n  getTheme(): Theme | undefined {\r\n    return this.themeManager.getCurrentTheme()\r\n  }\r\n\r\n  /**\r\n   * 获取可用主题\r\n   */\r\n  getAvailableThemes(): string[] {\r\n    return this.themeManager.getAvailableThemes()\r\n  }\r\n\r\n  /**\r\n   * 添加自定义主题\r\n   */\r\n  addTheme(theme: Theme): void {\r\n    this.themeManager.addCustomTheme(theme)\r\n  }\r\n\r\n  /**\r\n   * 设置语言\r\n   */\r\n  async setLocale(locale: string): Promise<void> {\r\n    await this.i18nManager.setLocale(locale)\r\n  }\r\n\r\n  /**\r\n   * 获取当前语言\r\n   */\r\n  getLocale(): string {\r\n    return this.i18nManager.getLocale()\r\n  }\r\n\r\n  /**\r\n   * 获取可用语言\r\n   */\r\n  getAvailableLocales(): string[] {\r\n    return this.i18nManager.getAvailableLocales()\r\n  }\r\n\r\n  /**\r\n   * 翻译\r\n   */\r\n  t(key: string, params?: Record<string, any>): string {\r\n    return this.i18nManager.t(key, params)\r\n  }\r\n\r\n  /**\r\n   * 更新配置\r\n   */\r\n  updateConfig(config: Partial<EditorConfig>): void {\r\n    this.config = { ...this.config, ...config }\r\n    this.emit('config:updated', this.config)\r\n  }\r\n\r\n  /**\r\n   * 获取完整配置\r\n   */\r\n  getConfig(): EditorConfig {\r\n    return { ...this.config }\r\n  }\r\n\r\n  /**\r\n   * 导出配置（用于保存）\r\n   */\r\n  exportConfig(): string {\r\n    const exportData = {\r\n      iconSet: this.getIconSet(),\r\n      theme: this.themeManager.getCurrentThemeName(),\r\n      locale: this.getLocale(),\r\n      ...this.config,\r\n    }\r\n    return JSON.stringify(exportData, null, 2)\r\n  }\r\n\r\n  /**\r\n   * 导入配置（用于恢复）\r\n   */\r\n  importConfig(configJson: string): void {\r\n    try {\r\n      const importData = JSON.parse(configJson)\r\n\r\n      if (importData.iconSet)\r\n        this.setIconSet(importData.iconSet)\r\n\r\n      if (importData.theme)\r\n        this.setTheme(importData.theme)\r\n\r\n      if (importData.locale)\r\n        this.setLocale(importData.locale)\r\n\r\n      this.updateConfig(importData)\r\n    }\r\n    catch (error) {\r\n      console.error('导入配置失败:', error)\r\n      throw new Error('无效的配置文件')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置为默认配置\r\n   */\r\n  reset(): void {\r\n    this.setIconSet('lucide')\r\n    this.setTheme('light')\r\n    this.setLocale('zh-CN')\r\n    this.config = {}\r\n    this.emit('config:reset')\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy(): void {\r\n    this.iconManager.destroy()\r\n    if (typeof (this as any).removeAllListeners === 'function') {\r\n      (this as any).removeAllListeners()\r\n    }\r\n  }\r\n}\r\n\r\n// 全局单例\r\nlet globalConfigManager: ConfigManager | null = null\r\n\r\n/**\r\n * 获取全局配置管理器\r\n */\r\nexport function getConfigManager(config?: EditorConfig): ConfigManager {\r\n  if (!globalConfigManager)\r\n    globalConfigManager = new ConfigManager(config)\r\n\r\n  return globalConfigManager\r\n}\r\n\r\n/**\r\n * 重置全局配置管理器\r\n */\r\nexport function resetConfigManager(): void {\r\n  if (globalConfigManager) {\r\n    globalConfigManager.destroy()\r\n    globalConfigManager = null\r\n  }\r\n}\r\n"],"names":["ConfigManager","EventEmitter","constructor","config","iconManager","getIconManager","icons","themeManager","getThemeManager","theme","customThemes","forEach","addCustomTheme","defaultTheme","setTheme","followSystem","followSystemTheme","i18nManager","getI18n","i18n","setupListeners","on","data","emit","type","oldValue","oldSet","newValue","newSet","oldTheme","newTheme","oldLocale","newLocale","getI18nManager","setIconSet","set","setDefaultIconSet","getIconSet","getCurrentIconSet","getAvailableIconSets","themeName","getTheme","getCurrentTheme","getAvailableThemes","addTheme","setLocale","locale","getLocale","getAvailableLocales","t","key","params","updateConfig","getConfig","exportConfig","exportData","iconSet","getCurrentThemeName","JSON","stringify","importConfig","configJson","importData","parse","error","console","Error","reset","destroy","removeAllListeners","globalConfigManager","getConfigManager","resetConfigManager"],"mappings":"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"}