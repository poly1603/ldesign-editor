{"version":3,"file":"table-enhanced.js","sources":["../../../src/plugins/table/table-enhanced.ts"],"sourcesContent":["/**\r\n * Â¢ûÂº∫ÁöÑË°®Ê†ºÊèí‰ª∂ - ‰ΩøÁî®‰∏ãÊãâÁΩëÊ†ºÈÄâÊã©Âô®\r\n */\r\n\r\nimport type { Command, Plugin } from '../../types'\r\nimport { createPlugin } from '../../core/Plugin'\r\nimport { showEnhancedTableGridSelector } from '../../ui/TableGridSelector'\r\n\r\n/**\r\n * ÂàõÂª∫Ë°®Ê†ºÂÖÉÁ¥†\r\n */\r\nfunction createTableElement(rows: number, cols: number): HTMLElement {\r\n  const wrapper = document.createElement('div')\r\n  wrapper.className = 'table-wrapper'\r\n  wrapper.style.position = 'relative'\r\n  wrapper.style.display = 'inline-block'\r\n  wrapper.style.margin = '10px 0'\r\n\r\n  const table = document.createElement('table')\r\n  table.style.borderCollapse = 'collapse'\r\n  table.style.width = '100%'\r\n\r\n  // ÂàõÂª∫Ë°®Â§¥\r\n  const thead = document.createElement('thead')\r\n  const headerRow = document.createElement('tr')\r\n  for (let j = 0; j < cols; j++) {\r\n    const th = document.createElement('th')\r\n    th.textContent = `Âàó ${j + 1}`\r\n    th.style.border = '1px solid #ddd'\r\n    th.style.padding = '8px'\r\n    th.style.backgroundColor = '#f5f5f5'\r\n    th.setAttribute('contenteditable', 'true')\r\n    headerRow.appendChild(th)\r\n  }\r\n  thead.appendChild(headerRow)\r\n  table.appendChild(thead)\r\n\r\n  // ÂàõÂª∫Ë°®‰Ωì\r\n  const tbody = document.createElement('tbody')\r\n  for (let i = 0; i < rows; i++) {\r\n    const tr = document.createElement('tr')\r\n    for (let j = 0; j < cols; j++) {\r\n      const td = document.createElement('td')\r\n      td.innerHTML = '&nbsp;'\r\n      td.style.border = '1px solid #ddd'\r\n      td.style.padding = '8px'\r\n      td.setAttribute('contenteditable', 'true')\r\n      tr.appendChild(td)\r\n    }\r\n    tbody.appendChild(tr)\r\n  }\r\n  table.appendChild(tbody)\r\n\r\n  wrapper.appendChild(table)\r\n  return wrapper\r\n}\r\n\r\n/**\r\n * ÊèíÂÖ•Ë°®Ê†ºÂëΩ‰ª§\r\n */\r\nconst insertTableEnhanced: Command = (state, dispatch) => {\r\n  console.log('üìä [Enhanced Table] Command called')\r\n\r\n  if (!dispatch)\r\n    return true\r\n\r\n  // Ëé∑ÂèñÁºñËæëÂô®ÂÜÖÂÆπÂå∫Âüü\r\n  const editorContent = document.querySelector('.ldesign-editor-content') as HTMLElement\r\n  if (!editorContent) {\r\n    console.error('‚ùå Editor content not found')\r\n    return false\r\n  }\r\n\r\n  // ‰øùÂ≠òÂΩìÂâçÈÄâÂå∫\r\n  const selection = window.getSelection()\r\n  let savedRange: Range | null = null\r\n\r\n  if (selection && selection.rangeCount > 0) {\r\n    const range = selection.getRangeAt(0)\r\n    if (editorContent.contains(range.commonAncestorContainer))\r\n      savedRange = range.cloneRange()\r\n  }\r\n\r\n  // Êü•ÊâæË°®Ê†ºÊåâÈíÆ\r\n  const tableButton = document.querySelector('[data-name=\"enhancedTable\"]')\r\n    || document.querySelector('[data-name=\"table\"]') as HTMLElement\r\n\r\n  // ÊòæÁ§∫Â¢ûÂº∫ÁöÑÁΩëÊ†ºÈÄâÊã©Âô®\r\n  showEnhancedTableGridSelector({\r\n    button: tableButton,\r\n    onSelect: (rows: number, cols: number) => {\r\n      console.log(`üìä Inserting ${rows}x${cols} table`)\r\n\r\n      // È™åËØÅÂ∞∫ÂØ∏\r\n      if (rows < 1 || cols < 1 || rows > 50 || cols > 20) {\r\n        console.error('Invalid table size')\r\n        return\r\n      }\r\n\r\n      // ÂàõÂª∫Ë°®Ê†ºÂÖÉÁ¥†\r\n      const tableWrapper = createTableElement(rows, cols)\r\n\r\n      // ËÅöÁÑ¶ÁºñËæëÂô®\r\n      editorContent.focus()\r\n\r\n      // ÊèíÂÖ•Ë°®Ê†º\r\n      if (savedRange) {\r\n        // ÊÅ¢Â§ç‰øùÂ≠òÁöÑÈÄâÂå∫\r\n        const currentSelection = window.getSelection()\r\n        if (currentSelection) {\r\n          currentSelection.removeAllRanges()\r\n          currentSelection.addRange(savedRange)\r\n\r\n          try {\r\n            // Ê∏ÖÈô§ÈÄâ‰∏≠ÂÜÖÂÆπ\r\n            savedRange.deleteContents()\r\n\r\n            // Ëé∑ÂèñÂÆπÂô®ÂÖÉÁ¥†\r\n            const container = savedRange.commonAncestorContainer\r\n            const parentElement = container.nodeType === Node.TEXT_NODE\r\n              ? container.parentElement\r\n              : container as HTMLElement\r\n\r\n            if (parentElement && parentElement.tagName === 'P') {\r\n              // Âú®ÊÆµËêΩÂêéÊèíÂÖ•\r\n              parentElement.insertAdjacentElement('afterend', tableWrapper)\r\n\r\n              // Ê∑ªÂä†Êñ∞ÊÆµËêΩ‰æõÁªßÁª≠ËæìÂÖ•\r\n              const newP = document.createElement('p')\r\n              newP.innerHTML = '<br>'\r\n              tableWrapper.insertAdjacentElement('afterend', newP)\r\n\r\n              // Â∞ÜÂÖâÊ†áÁßªÂà∞Êñ∞ÊÆµËêΩ\r\n              setTimeout(() => {\r\n                const newRange = document.createRange()\r\n                newRange.selectNodeContents(newP)\r\n                newRange.collapse(false)\r\n                currentSelection.removeAllRanges()\r\n                currentSelection.addRange(newRange)\r\n              }, 50)\r\n            }\r\n            else {\r\n              // Áõ¥Êé•ÊèíÂÖ•\r\n              savedRange.insertNode(tableWrapper)\r\n            }\r\n          }\r\n          catch (error) {\r\n            console.error('Error inserting table:', error)\r\n            // Â§±Ë¥•Êó∂ËøΩÂä†Âà∞Êú´Â∞æ\r\n            editorContent.appendChild(tableWrapper)\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        // Ê≤°ÊúâÈÄâÂå∫Êó∂ËøΩÂä†Âà∞Êú´Â∞æ\r\n        const lastElement = editorContent.lastElementChild\r\n        if (lastElement && lastElement.tagName === 'P')\r\n          lastElement.insertAdjacentElement('afterend', tableWrapper)\r\n        else\r\n          editorContent.appendChild(tableWrapper)\r\n\r\n        // Ê∑ªÂä†Êñ∞ÊÆµËêΩ\r\n        const newP = document.createElement('p')\r\n        newP.innerHTML = '<br>'\r\n        tableWrapper.insertAdjacentElement('afterend', newP)\r\n      }\r\n\r\n      // Ëß¶ÂèëÊõ¥Êñ∞‰∫ã‰ª∂\r\n      const event = new Event('input', { bubbles: true })\r\n      editorContent.dispatchEvent(event)\r\n\r\n      // ÊªöÂä®Âà∞Ë°®Ê†º\r\n      tableWrapper.scrollIntoView({ behavior: 'smooth', block: 'nearest' })\r\n\r\n      console.log('‚úÖ Table inserted successfully')\r\n    },\r\n  })\r\n\r\n  return true\r\n}\r\n\r\n/**\r\n * Â¢ûÂº∫ÁöÑË°®Ê†ºÊèí‰ª∂\r\n */\r\nexport const EnhancedTablePlugin: Plugin = createPlugin({\r\n  name: 'enhancedTable',\r\n  commands: {\r\n    insertTableEnhanced,\r\n  },\r\n  toolbar: [{\r\n    name: 'enhancedTable',\r\n    title: 'ÊèíÂÖ•Ë°®Ê†ºÔºàÂ¢ûÂº∫ÁâàÔºâ',\r\n    icon: 'table',\r\n    command: insertTableEnhanced,\r\n  }],\r\n})\r\n"],"names":["createTableElement","rows","cols","wrapper","document","createElement","className","style","position","display","margin","table","borderCollapse","width","thead","headerRow","j","th","textContent","border","padding","backgroundColor","setAttribute","appendChild","tbody","i","tr","td","innerHTML","insertTableEnhanced","state","dispatch","console","log","editorContent","querySelector","error","selection","window","getSelection","savedRange","rangeCount","range","getRangeAt","contains","commonAncestorContainer","cloneRange","tableButton","showEnhancedTableGridSelector","button","onSelect","tableWrapper","focus","currentSelection","removeAllRanges","addRange","deleteContents","container","parentElement","nodeType","Node","TEXT_NODE","tagName","insertAdjacentElement","newP","setTimeout","newRange","createRange","selectNodeContents","collapse","insertNode","lastElement","lastElementChild","event","Event","bubbles","dispatchEvent","scrollIntoView","behavior","block","EnhancedTablePlugin","createPlugin","name","commands","toolbar","title","icon","command"],"mappings":"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"}