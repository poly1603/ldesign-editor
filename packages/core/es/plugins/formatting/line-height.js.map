{"version":3,"file":"line-height.js","sources":["../../../src/plugins/formatting/line-height.ts"],"sourcesContent":["/**\r\n * 行高插件\r\n */\r\n\r\nimport type { Command, Plugin } from '../../types'\r\nimport { createPlugin } from '../../core/Plugin'\r\n\r\n/**\r\n * 行高选项\r\n */\r\nexport const LINE_HEIGHTS = [\r\n  { label: '1.0', value: '1.0' },\r\n  { label: '1.15', value: '1.15' },\r\n  { label: '1.5', value: '1.5' },\r\n  { label: '1.75', value: '1.75' },\r\n  { label: '2.0', value: '2.0' },\r\n  { label: '2.5', value: '2.5' },\r\n  { label: '3.0', value: '3.0' },\r\n]\r\n\r\n/**\r\n * 设置行高\r\n */\r\nfunction setLineHeight(height: string): Command {\r\n  return (state, dispatch) => {\r\n    if (!dispatch)\r\n      return true\r\n\r\n    const selection = window.getSelection()\r\n    if (!selection || selection.rangeCount === 0)\r\n      return false\r\n\r\n    // 获取选中的块级元素或创建一个新的块\r\n    let node = selection.anchorNode\r\n    let block: HTMLElement | null = null\r\n\r\n    // 查找块级元素\r\n    while (node && node !== document.body) {\r\n      if (node.nodeType === Node.ELEMENT_NODE) {\r\n        const element = node as HTMLElement\r\n        const display = window.getComputedStyle(element).display\r\n        if (display === 'block' || element.tagName.match(/^(P|DIV|H[1-6]|BLOCKQUOTE|LI)$/)) {\r\n          block = element\r\n          break\r\n        }\r\n      }\r\n      node = node.parentNode\r\n    }\r\n\r\n    if (block) {\r\n      // 设置块级元素的行高\r\n      block.style.lineHeight = height\r\n    }\r\n    else {\r\n      // 如果没有找到块级元素，包装选中的内容\r\n      const range = selection.getRangeAt(0)\r\n      const selectedText = range.toString()\r\n\r\n      if (selectedText) {\r\n        const span = document.createElement('span')\r\n        span.style.lineHeight = height\r\n        span.style.display = 'inline-block'\r\n        range.surroundContents(span)\r\n      }\r\n    }\r\n\r\n    // 触发输入事件以更新编辑器状态\r\n    setTimeout(() => {\r\n      const editorContent = document.querySelector('.ldesign-editor-content') as HTMLElement\r\n      if (editorContent) {\r\n        const event = new Event('input', { bubbles: true, cancelable: true })\r\n        editorContent.dispatchEvent(event)\r\n      }\r\n    }, 0)\r\n\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * 行高插件\r\n */\r\nexport const LineHeightPlugin: Plugin = createPlugin({\r\n  name: 'lineHeight',\r\n  commands: {\r\n    setLineHeight: (state, dispatch, height: string) => {\r\n      return setLineHeight(height)(state, dispatch)\r\n    },\r\n  },\r\n  toolbar: [{\r\n    name: 'lineHeight',\r\n    title: '行高',\r\n    icon: 'line-height',\r\n    command: (state, dispatch) => {\r\n      return true\r\n    },\r\n  }],\r\n})\r\n"],"names":["LINE_HEIGHTS","label","value","setLineHeight","height","state","dispatch","selection","window","getSelection","rangeCount","node","anchorNode","block","document","body","nodeType","Node","ELEMENT_NODE","element","display","getComputedStyle","tagName","match","parentNode","style","lineHeight","range","getRangeAt","selectedText","toString","span","createElement","surroundContents","setTimeout","editorContent","querySelector","event","Event","bubbles","cancelable","dispatchEvent","LineHeightPlugin","createPlugin","name","commands","toolbar","title","icon","command"],"mappings":"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"}