{"version":3,"file":"image-toolbar.js","sources":["../../../src/plugins/media/image-toolbar.ts"],"sourcesContent":["/**\r\n * Image Toolbar Plugin\r\n * 图片悬浮工具栏 - 提供快捷操作按钮\r\n */\r\n\r\nimport type { Editor } from '../../core/Editor'\r\nimport { Plugin } from '../../core/Plugin'\r\nimport { getLucideIcon } from '../../ui/icons/lucide'\r\n\r\nexport interface ImageToolbarOptions {\r\n  /** 工具栏显示位置 */\r\n  position?: 'top' | 'bottom'\r\n  /** 是否显示对齐按钮 */\r\n  showAlign?: boolean\r\n  /** 是否显示链接按钮 */\r\n  showLink?: boolean\r\n  /** 是否显示删除按钮 */\r\n  showDelete?: boolean\r\n  /** 是否显示编辑按钮 */\r\n  showEdit?: boolean\r\n  /** 自定义工具栏项 */\r\n  customItems?: ToolbarItem[]\r\n}\r\n\r\nexport interface ToolbarItem {\r\n  name: string\r\n  icon: string\r\n  title: string\r\n  action: (image: HTMLImageElement, editor: Editor) => void\r\n}\r\n\r\nexport class ImageToolbarPlugin extends Plugin {\r\n  name = 'imageToolbar'\r\n  config = {\r\n    name: 'imageToolbar',\r\n    commands: {},\r\n    keys: {},\r\n  }\r\n\r\n  private options: ImageToolbarOptions\r\n  private toolbar: HTMLElement | null = null\r\n  private currentImage: HTMLImageElement | null = null\r\n\r\n  constructor(options: ImageToolbarOptions = {}) {\r\n    super()\r\n    this.options = {\r\n      position: 'top',\r\n      showAlign: true,\r\n      showLink: true,\r\n      showDelete: true,\r\n      showEdit: true,\r\n      ...options,\r\n    }\r\n  }\r\n\r\n  install(editor: Editor): void {\r\n    super.install(editor)\r\n    this.bindEvents()\r\n    console.log('[ImageToolbarPlugin] Installed')\r\n  }\r\n\r\n  private bindEvents(): void {\r\n    const editorElement = this.editor?.contentElement\r\n    if (!editorElement)\r\n      return\r\n\r\n    // 点击图片显示工具栏\r\n    editorElement.addEventListener('click', this.handleImageClick.bind(this))\r\n    \r\n    // 点击其他地方隐藏工具栏\r\n    document.addEventListener('click', this.handleDocumentClick.bind(this))\r\n    \r\n    // 滚动时更新位置\r\n    editorElement.addEventListener('scroll', this.updateToolbarPosition.bind(this))\r\n    window.addEventListener('scroll', this.updateToolbarPosition.bind(this))\r\n    window.addEventListener('resize', this.updateToolbarPosition.bind(this))\r\n  }\r\n\r\n  private handleImageClick(e: MouseEvent): void {\r\n    const target = e.target as HTMLElement\r\n    \r\n    if (target.tagName === 'IMG') {\r\n      e.stopPropagation()\r\n      this.showToolbar(target as HTMLImageElement)\r\n    }\r\n  }\r\n\r\n  private handleDocumentClick(e: MouseEvent): void {\r\n    const target = e.target as HTMLElement\r\n    \r\n    // 如果点击的不是图片也不是工具栏，则隐藏\r\n    if (target.tagName !== 'IMG' && !this.toolbar?.contains(target)) {\r\n      this.hideToolbar()\r\n    }\r\n  }\r\n\r\n  private showToolbar(image: HTMLImageElement): void {\r\n    // 先隐藏现有工具栏\r\n    this.hideToolbar()\r\n\r\n    this.currentImage = image\r\n    this.toolbar = this.createToolbar()\r\n    document.body.appendChild(this.toolbar)\r\n    this.updateToolbarPosition()\r\n  }\r\n\r\n  private hideToolbar(): void {\r\n    if (this.toolbar) {\r\n      this.toolbar.remove()\r\n      this.toolbar = null\r\n    }\r\n    this.currentImage = null\r\n  }\r\n\r\n  private createToolbar(): HTMLElement {\r\n    const toolbar = document.createElement('div')\r\n    toolbar.className = 'ldesign-image-toolbar'\r\n    toolbar.style.cssText = `\r\n      position: fixed;\r\n      display: flex;\r\n      gap: 2px;\r\n      padding: 4px;\r\n      background: #ffffff;\r\n      border: 1px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      z-index: 10001;\r\n      user-select: none;\r\n    `\r\n\r\n    // 对齐按钮组\r\n    if (this.options.showAlign) {\r\n      this.addToolbarGroup(toolbar, [\r\n        { name: 'alignLeft', icon: 'alignLeft', title: '左对齐', action: () => this.setAlign('left') },\r\n        { name: 'alignCenter', icon: 'alignCenter', title: '居中', action: () => this.setAlign('center') },\r\n        { name: 'alignRight', icon: 'alignRight', title: '右对齐', action: () => this.setAlign('right') },\r\n      ])\r\n      this.addSeparator(toolbar)\r\n    }\r\n\r\n    // 大小按钮组\r\n    this.addToolbarGroup(toolbar, [\r\n      { name: 'sizeSmall', icon: 'minimize2', title: '小尺寸 (25%)', action: () => this.setSize('25%') },\r\n      { name: 'sizeMedium', icon: 'square', title: '中尺寸 (50%)', action: () => this.setSize('50%') },\r\n      { name: 'sizeLarge', icon: 'maximize2', title: '大尺寸 (100%)', action: () => this.setSize('100%') },\r\n    ])\r\n    this.addSeparator(toolbar)\r\n\r\n    // 链接按钮\r\n    if (this.options.showLink) {\r\n      this.addToolbarButton(toolbar, {\r\n        name: 'link',\r\n        icon: 'link',\r\n        title: '添加链接',\r\n        action: () => this.addLink(),\r\n      })\r\n    }\r\n\r\n    // 编辑按钮\r\n    if (this.options.showEdit) {\r\n      this.addToolbarButton(toolbar, {\r\n        name: 'edit',\r\n        icon: 'settings',\r\n        title: '图片设置',\r\n        action: () => this.openStyleDialog(),\r\n      })\r\n    }\r\n\r\n    // 替换按钮\r\n    this.addToolbarButton(toolbar, {\r\n      name: 'replace',\r\n      icon: 'refreshCw',\r\n      title: '替换图片',\r\n      action: () => this.replaceImage(),\r\n    })\r\n\r\n    // 删除按钮\r\n    if (this.options.showDelete) {\r\n      this.addSeparator(toolbar)\r\n      this.addToolbarButton(toolbar, {\r\n        name: 'delete',\r\n        icon: 'trash2',\r\n        title: '删除图片',\r\n        action: () => this.deleteImage(),\r\n        danger: true,\r\n      })\r\n    }\r\n\r\n    // 自定义项\r\n    if (this.options.customItems?.length) {\r\n      this.addSeparator(toolbar)\r\n      this.options.customItems.forEach((item) => {\r\n        this.addToolbarButton(toolbar, {\r\n          ...item,\r\n          action: () => item.action(this.currentImage!, this.editor!),\r\n        })\r\n      })\r\n    }\r\n\r\n    return toolbar\r\n  }\r\n\r\n  private addToolbarGroup(container: HTMLElement, items: Array<{ name: string, icon: string, title: string, action: () => void }>): void {\r\n    const group = document.createElement('div')\r\n    group.style.cssText = 'display: flex; gap: 2px;'\r\n    \r\n    items.forEach((item) => {\r\n      this.addToolbarButton(group, item)\r\n    })\r\n    \r\n    container.appendChild(group)\r\n  }\r\n\r\n  private addToolbarButton(container: HTMLElement, item: { name: string, icon: string, title: string, action: () => void, danger?: boolean }): void {\r\n    const button = document.createElement('button')\r\n    button.className = `image-toolbar-btn btn-${item.name}`\r\n    button.title = item.title\r\n    button.style.cssText = `\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      width: 32px;\r\n      height: 32px;\r\n      padding: 0;\r\n      background: transparent;\r\n      border: none;\r\n      border-radius: 6px;\r\n      cursor: pointer;\r\n      color: ${item.danger ? '#ef4444' : '#374151'};\r\n      transition: all 0.2s;\r\n    `\r\n    button.innerHTML = getLucideIcon(item.icon)\r\n    \r\n    button.onmouseenter = () => {\r\n      button.style.background = item.danger ? '#fee2e2' : '#f3f4f6'\r\n    }\r\n    button.onmouseleave = () => {\r\n      button.style.background = 'transparent'\r\n    }\r\n    \r\n    button.onclick = (e) => {\r\n      e.stopPropagation()\r\n      item.action()\r\n    }\r\n    \r\n    container.appendChild(button)\r\n  }\r\n\r\n  private addSeparator(container: HTMLElement): void {\r\n    const separator = document.createElement('div')\r\n    separator.style.cssText = `\r\n      width: 1px;\r\n      height: 24px;\r\n      background: #e5e7eb;\r\n      margin: 4px 4px;\r\n    `\r\n    container.appendChild(separator)\r\n  }\r\n\r\n  private updateToolbarPosition(): void {\r\n    if (!this.toolbar || !this.currentImage)\r\n      return\r\n\r\n    const imgRect = this.currentImage.getBoundingClientRect()\r\n    const toolbarRect = this.toolbar.getBoundingClientRect()\r\n    \r\n    let top: number\r\n    if (this.options.position === 'bottom') {\r\n      top = imgRect.bottom + 8\r\n    } else {\r\n      top = imgRect.top - toolbarRect.height - 8\r\n    }\r\n    \r\n    // 确保工具栏在视口内\r\n    if (top < 10) {\r\n      top = imgRect.bottom + 8\r\n    }\r\n    if (top + toolbarRect.height > window.innerHeight - 10) {\r\n      top = imgRect.top - toolbarRect.height - 8\r\n    }\r\n    \r\n    let left = imgRect.left + (imgRect.width - toolbarRect.width) / 2\r\n    left = Math.max(10, Math.min(left, window.innerWidth - toolbarRect.width - 10))\r\n    \r\n    this.toolbar.style.top = `${top}px`\r\n    this.toolbar.style.left = `${left}px`\r\n  }\r\n\r\n  // 功能实现\r\n  private setAlign(align: 'left' | 'center' | 'right'): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    // 清除之前的对齐样式\r\n    this.currentImage.style.float = ''\r\n    this.currentImage.style.marginLeft = ''\r\n    this.currentImage.style.marginRight = ''\r\n    this.currentImage.style.display = ''\r\n\r\n    switch (align) {\r\n      case 'left':\r\n        this.currentImage.style.display = 'block'\r\n        this.currentImage.style.marginRight = 'auto'\r\n        break\r\n      case 'center':\r\n        this.currentImage.style.display = 'block'\r\n        this.currentImage.style.marginLeft = 'auto'\r\n        this.currentImage.style.marginRight = 'auto'\r\n        break\r\n      case 'right':\r\n        this.currentImage.style.display = 'block'\r\n        this.currentImage.style.marginLeft = 'auto'\r\n        break\r\n    }\r\n\r\n    this.triggerChange()\r\n  }\r\n\r\n  private setSize(size: string): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    this.currentImage.style.width = size\r\n    this.currentImage.style.height = 'auto'\r\n    this.updateToolbarPosition()\r\n    this.triggerChange()\r\n  }\r\n\r\n  private addLink(): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    const existingLink = this.currentImage.parentElement?.tagName === 'A'\r\n      ? (this.currentImage.parentElement as HTMLAnchorElement).href\r\n      : ''\r\n\r\n    const url = prompt('输入链接地址:', existingLink)\r\n    if (url === null)\r\n      return\r\n\r\n    if (url) {\r\n      // 如果已有链接，更新它\r\n      if (this.currentImage.parentElement?.tagName === 'A') {\r\n        (this.currentImage.parentElement as HTMLAnchorElement).href = url\r\n      } else {\r\n        // 创建新链接包裹图片\r\n        const link = document.createElement('a')\r\n        link.href = url\r\n        link.target = '_blank'\r\n        this.currentImage.parentNode?.insertBefore(link, this.currentImage)\r\n        link.appendChild(this.currentImage)\r\n      }\r\n    } else {\r\n      // 移除链接\r\n      if (this.currentImage.parentElement?.tagName === 'A') {\r\n        const link = this.currentImage.parentElement\r\n        link.parentNode?.insertBefore(this.currentImage, link)\r\n        link.remove()\r\n      }\r\n    }\r\n\r\n    this.triggerChange()\r\n  }\r\n\r\n  private openStyleDialog(): void {\r\n    if (!this.currentImage || !this.editor)\r\n      return\r\n\r\n    // 触发打开样式对话框事件\r\n    this.editor.emit('image:openStyleDialog', { image: this.currentImage })\r\n    \r\n    // 如果没有监听器处理，使用简单的 prompt\r\n    setTimeout(() => {\r\n      // 检查是否已经有对话框打开\r\n      if (document.querySelector('.ldesign-image-style-dialog'))\r\n        return\r\n\r\n      // 简单的样式设置\r\n      const borderRadius = prompt('设置圆角 (如: 0, 8px, 50%):', this.currentImage?.style.borderRadius || '0')\r\n      if (borderRadius !== null && this.currentImage) {\r\n        this.currentImage.style.borderRadius = borderRadius\r\n        this.triggerChange()\r\n      }\r\n    }, 100)\r\n  }\r\n\r\n  private replaceImage(): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    const input = document.createElement('input')\r\n    input.type = 'file'\r\n    input.accept = 'image/*'\r\n    input.onchange = (e) => {\r\n      const file = (e.target as HTMLInputElement).files?.[0]\r\n      if (file && this.currentImage) {\r\n        const reader = new FileReader()\r\n        reader.onload = (e) => {\r\n          if (this.currentImage) {\r\n            this.currentImage.src = e.target?.result as string\r\n            this.triggerChange()\r\n          }\r\n        }\r\n        reader.readAsDataURL(file)\r\n      }\r\n    }\r\n    input.click()\r\n  }\r\n\r\n  private deleteImage(): void {\r\n    if (!this.currentImage)\r\n      return\r\n\r\n    // 如果图片被链接包裹，删除链接\r\n    if (this.currentImage.parentElement?.tagName === 'A') {\r\n      this.currentImage.parentElement.remove()\r\n    } else {\r\n      this.currentImage.remove()\r\n    }\r\n\r\n    this.hideToolbar()\r\n    this.triggerChange()\r\n  }\r\n\r\n  private triggerChange(): void {\r\n    const event = new Event('input', { bubbles: true })\r\n    this.editor?.contentElement?.dispatchEvent(event)\r\n  }\r\n\r\n  destroy(): void {\r\n    this.hideToolbar()\r\n    \r\n    const editorElement = this.editor?.contentElement\r\n    if (editorElement) {\r\n      editorElement.removeEventListener('click', this.handleImageClick.bind(this))\r\n      editorElement.removeEventListener('scroll', this.updateToolbarPosition.bind(this))\r\n    }\r\n    \r\n    document.removeEventListener('click', this.handleDocumentClick.bind(this))\r\n    window.removeEventListener('scroll', this.updateToolbarPosition.bind(this))\r\n    window.removeEventListener('resize', this.updateToolbarPosition.bind(this))\r\n    \r\n    console.log('[ImageToolbarPlugin] Destroyed')\r\n  }\r\n}\r\n\r\nexport default ImageToolbarPlugin\r\n"],"names":["ImageToolbarPlugin","Plugin","constructor","options","name","config","commands","keys","toolbar","currentImage","position","showAlign","showLink","showDelete","showEdit","install","editor","bindEvents","console","log","editorElement","contentElement","addEventListener","handleImageClick","bind","document","handleDocumentClick","updateToolbarPosition","window","e","target","tagName","stopPropagation","showToolbar","contains","hideToolbar","image","createToolbar","body","appendChild","remove","createElement","className","style","cssText","addToolbarGroup","icon","title","action","setAlign","addSeparator","setSize","addToolbarButton","addLink","openStyleDialog","replaceImage","deleteImage","danger","customItems","length","forEach","item","container","items","group","button","innerHTML","getLucideIcon","onmouseenter","background","onmouseleave","onclick","separator","imgRect","getBoundingClientRect","toolbarRect","top","bottom","height","innerHeight","left","width","Math","max","min","innerWidth","align","float","marginLeft","marginRight","display","triggerChange","size","existingLink","parentElement","href","url","prompt","link","parentNode","insertBefore","emit","setTimeout","querySelector","borderRadius","input","type","accept","onchange","file","files","reader","FileReader","onload","src","result","readAsDataURL","click","event","Event","bubbles","dispatchEvent","destroy","removeEventListener"],"mappings":"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"}