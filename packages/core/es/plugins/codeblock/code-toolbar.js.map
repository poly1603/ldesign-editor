{"version":3,"file":"code-toolbar.js","sources":["../../../src/plugins/codeblock/code-toolbar.ts"],"sourcesContent":["/**\r\n * 代码块悬浮工具栏插件\r\n * 提供主题切换、行号开关、语言切换、复制等功能\r\n */\r\n\r\nimport type { Plugin } from '../../types'\r\nimport { createPlugin } from '../../core/Plugin'\r\n\r\n// 工具栏样式\r\nconst TOOLBAR_STYLES = `\r\n.code-toolbar {\r\n  position: absolute;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n  padding: 6px 10px;\r\n  background: rgba(0, 0, 0, 0.85);\r\n  border: 1px solid rgba(255, 255, 255, 0.1);\r\n  border-radius: 8px;\r\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);\r\n  z-index: 1000;\r\n  font-size: 12px;\r\n  user-select: none;\r\n  backdrop-filter: blur(8px);\r\n}\r\n\r\n.code-toolbar-group {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n  padding: 0 8px;\r\n  border-right: 1px solid rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.code-toolbar-group:last-child {\r\n  border-right: none;\r\n}\r\n\r\n.code-toolbar-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 4px;\r\n  height: 26px;\r\n  padding: 0 8px;\r\n  background: rgba(255, 255, 255, 0.05);\r\n  border: 1px solid rgba(255, 255, 255, 0.1);\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  color: #e5e7eb;\r\n  font-size: 11px;\r\n  font-weight: 500;\r\n  transition: all 0.15s ease;\r\n  white-space: nowrap;\r\n}\r\n\r\n.code-toolbar-btn:hover {\r\n  background: rgba(255, 255, 255, 0.15);\r\n  color: #fff;\r\n}\r\n\r\n.code-toolbar-btn:active {\r\n  background: rgba(255, 255, 255, 0.2);\r\n}\r\n\r\n.code-toolbar-btn.active {\r\n  background: #3b82f6;\r\n  border-color: #3b82f6;\r\n  color: #fff;\r\n}\r\n\r\n.code-toolbar-btn svg {\r\n  width: 14px;\r\n  height: 14px;\r\n}\r\n\r\n.code-toolbar-select {\r\n  height: 26px;\r\n  padding: 0 24px 0 8px;\r\n  background: rgba(255, 255, 255, 0.05);\r\n  border: 1px solid rgba(255, 255, 255, 0.1);\r\n  border-radius: 4px;\r\n  color: #e5e7eb;\r\n  font-size: 11px;\r\n  cursor: pointer;\r\n  appearance: none;\r\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23e5e7eb' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\r\n  background-repeat: no-repeat;\r\n  background-position: right 6px center;\r\n}\r\n\r\n.code-toolbar-select:hover {\r\n  background-color: rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.code-toolbar-select:focus {\r\n  outline: none;\r\n  border-color: #3b82f6;\r\n}\r\n\r\n.code-toolbar-select option {\r\n  background: #1f2937;\r\n  color: #e5e7eb;\r\n}\r\n\r\n.code-toolbar-label {\r\n  color: #9ca3af;\r\n  font-size: 11px;\r\n  margin-right: 4px;\r\n}\r\n\r\n.code-toolbar-divider {\r\n  width: 1px;\r\n  height: 16px;\r\n  background: rgba(255, 255, 255, 0.1);\r\n  margin: 0 4px;\r\n}\r\n\r\n/* 代码块选中效果 */\r\n.code-block-container.selected {\r\n  outline: 2px solid #3b82f6;\r\n  outline-offset: 2px;\r\n}\r\n\r\n/* 复制成功提示 */\r\n.code-toolbar-toast {\r\n  position: fixed;\r\n  top: 20px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  padding: 8px 16px;\r\n  background: #10b981;\r\n  color: #fff;\r\n  border-radius: 6px;\r\n  font-size: 13px;\r\n  font-weight: 500;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\r\n  z-index: 10000;\r\n  animation: fadeInOut 2s ease;\r\n}\r\n\r\n@keyframes fadeInOut {\r\n  0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }\r\n  15% { opacity: 1; transform: translateX(-50%) translateY(0); }\r\n  85% { opacity: 1; transform: translateX(-50%) translateY(0); }\r\n  100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }\r\n}\r\n`\r\n\r\n// SVG 图标\r\nconst ICONS = {\r\n  copy: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\"/><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/></svg>`,\r\n  lineNumbers: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 6h2M4 12h2M4 18h2M10 6h10M10 12h10M10 18h10\"/></svg>`,\r\n  theme: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"5\"/><path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/></svg>`,\r\n  wrap: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 6h18M3 12h15a3 3 0 1 1 0 6h-6l3-3M3 18h6\"/></svg>`,\r\n  delete: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/></svg>`,\r\n  format: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 7V4h16v3M9 20h6M12 4v16\"/></svg>`,\r\n  check: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20 6L9 17l-5-5\"/></svg>`,\r\n}\r\n\r\n// 支持的编程语言\r\nconst LANGUAGES = [\r\n  { value: 'plaintext', label: '纯文本' },\r\n  { value: 'javascript', label: 'JavaScript' },\r\n  { value: 'typescript', label: 'TypeScript' },\r\n  { value: 'python', label: 'Python' },\r\n  { value: 'java', label: 'Java' },\r\n  { value: 'cpp', label: 'C++' },\r\n  { value: 'c', label: 'C' },\r\n  { value: 'csharp', label: 'C#' },\r\n  { value: 'go', label: 'Go' },\r\n  { value: 'rust', label: 'Rust' },\r\n  { value: 'php', label: 'PHP' },\r\n  { value: 'ruby', label: 'Ruby' },\r\n  { value: 'swift', label: 'Swift' },\r\n  { value: 'kotlin', label: 'Kotlin' },\r\n  { value: 'html', label: 'HTML' },\r\n  { value: 'css', label: 'CSS' },\r\n  { value: 'scss', label: 'SCSS' },\r\n  { value: 'json', label: 'JSON' },\r\n  { value: 'xml', label: 'XML' },\r\n  { value: 'yaml', label: 'YAML' },\r\n  { value: 'sql', label: 'SQL' },\r\n  { value: 'bash', label: 'Bash' },\r\n  { value: 'shell', label: 'Shell' },\r\n  { value: 'markdown', label: 'Markdown' },\r\n]\r\n\r\n// 代码主题\r\nconst THEMES = [\r\n  { value: 'oneDark', label: 'One Dark', bg: '#282c34', fg: '#abb2bf' },\r\n  { value: 'vsLight', label: 'VS Light', bg: '#ffffff', fg: '#000000' },\r\n  { value: 'monokai', label: 'Monokai', bg: '#272822', fg: '#f8f8f2' },\r\n  { value: 'dracula', label: 'Dracula', bg: '#282a36', fg: '#f8f8f2' },\r\n  { value: 'github', label: 'GitHub', bg: '#f6f8fa', fg: '#24292e' },\r\n  { value: 'nord', label: 'Nord', bg: '#2e3440', fg: '#d8dee9' },\r\n]\r\n\r\n/**\r\n * 代码块工具栏类\r\n */\r\nclass CodeToolbar {\r\n  private toolbar: HTMLElement | null = null\r\n  private currentBlock: HTMLElement | null = null\r\n  private styleInjected = false\r\n\r\n  constructor() {\r\n    this.injectStyles()\r\n    this.setupEventListeners()\r\n  }\r\n\r\n  /**\r\n   * 注入样式\r\n   */\r\n  private injectStyles() {\r\n    if (this.styleInjected) return\r\n    \r\n    const styleId = 'code-toolbar-styles'\r\n    if (document.getElementById(styleId)) {\r\n      this.styleInjected = true\r\n      return\r\n    }\r\n\r\n    const style = document.createElement('style')\r\n    style.id = styleId\r\n    style.textContent = TOOLBAR_STYLES\r\n    document.head.appendChild(style)\r\n    this.styleInjected = true\r\n  }\r\n\r\n  /**\r\n   * 设置事件监听\r\n   */\r\n  private setupEventListeners() {\r\n    // 点击代码块显示工具栏\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement\r\n      const codeBlock = target.closest('.code-block-container') as HTMLElement\r\n\r\n      if (codeBlock) {\r\n        this.selectBlock(codeBlock)\r\n      } else if (!target.closest('.code-toolbar')) {\r\n        this.hideToolbar()\r\n      }\r\n    })\r\n\r\n    // ESC 隐藏工具栏\r\n    document.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Escape' && this.toolbar) {\r\n        this.hideToolbar()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 选中代码块\r\n   */\r\n  private selectBlock(block: HTMLElement) {\r\n    // 移除之前的选中状态\r\n    document.querySelectorAll('.code-block-container.selected').forEach(el => {\r\n      el.classList.remove('selected')\r\n    })\r\n\r\n    this.currentBlock = block\r\n    block.classList.add('selected')\r\n    this.showToolbar(block)\r\n  }\r\n\r\n  /**\r\n   * 显示工具栏\r\n   */\r\n  private showToolbar(block: HTMLElement) {\r\n    this.hideToolbar()\r\n\r\n    this.toolbar = this.createToolbar()\r\n    document.body.appendChild(this.toolbar)\r\n\r\n    this.positionToolbar(block)\r\n  }\r\n\r\n  /**\r\n   * 隐藏工具栏\r\n   */\r\n  private hideToolbar() {\r\n    if (this.toolbar) {\r\n      this.toolbar.remove()\r\n      this.toolbar = null\r\n    }\r\n\r\n    document.querySelectorAll('.code-block-container.selected').forEach(el => {\r\n      el.classList.remove('selected')\r\n    })\r\n    this.currentBlock = null\r\n  }\r\n\r\n  /**\r\n   * 定位工具栏\r\n   */\r\n  private positionToolbar(block: HTMLElement) {\r\n    if (!this.toolbar) return\r\n\r\n    const rect = block.getBoundingClientRect()\r\n    const toolbarRect = this.toolbar.getBoundingClientRect()\r\n\r\n    let top = rect.top - toolbarRect.height - 8\r\n    let left = rect.left + (rect.width - toolbarRect.width) / 2\r\n\r\n    // 边界检查\r\n    if (top < 10) {\r\n      top = rect.bottom + 8\r\n    }\r\n    if (left < 10) {\r\n      left = 10\r\n    }\r\n    if (left + toolbarRect.width > window.innerWidth - 10) {\r\n      left = window.innerWidth - toolbarRect.width - 10\r\n    }\r\n\r\n    this.toolbar.style.top = `${top + window.scrollY}px`\r\n    this.toolbar.style.left = `${left + window.scrollX}px`\r\n  }\r\n\r\n  /**\r\n   * 创建工具栏\r\n   */\r\n  private createToolbar(): HTMLElement {\r\n    const toolbar = document.createElement('div')\r\n    toolbar.className = 'code-toolbar'\r\n\r\n    // 语言选择组\r\n    const langGroup = document.createElement('div')\r\n    langGroup.className = 'code-toolbar-group'\r\n    \r\n    const langLabel = document.createElement('span')\r\n    langLabel.className = 'code-toolbar-label'\r\n    langLabel.textContent = '语言'\r\n    langGroup.appendChild(langLabel)\r\n    \r\n    langGroup.appendChild(this.createLanguageSelect())\r\n    toolbar.appendChild(langGroup)\r\n\r\n    // 主题选择组\r\n    const themeGroup = document.createElement('div')\r\n    themeGroup.className = 'code-toolbar-group'\r\n    \r\n    const themeLabel = document.createElement('span')\r\n    themeLabel.className = 'code-toolbar-label'\r\n    themeLabel.textContent = '主题'\r\n    themeGroup.appendChild(themeLabel)\r\n    \r\n    themeGroup.appendChild(this.createThemeSelect())\r\n    toolbar.appendChild(themeGroup)\r\n\r\n    // 功能按钮组\r\n    const actionGroup = document.createElement('div')\r\n    actionGroup.className = 'code-toolbar-group'\r\n    \r\n    actionGroup.appendChild(this.createButton('lineNumbers', '行号', () => this.toggleLineNumbers(), this.hasLineNumbers()))\r\n    actionGroup.appendChild(this.createButton('wrap', '换行', () => this.toggleWrap(), this.hasWrap()))\r\n    actionGroup.appendChild(this.createButton('copy', '复制', () => this.copyCode()))\r\n    \r\n    toolbar.appendChild(actionGroup)\r\n\r\n    // 删除按钮\r\n    const deleteGroup = document.createElement('div')\r\n    deleteGroup.className = 'code-toolbar-group'\r\n    deleteGroup.appendChild(this.createButton('delete', '删除', () => this.deleteBlock()))\r\n    toolbar.appendChild(deleteGroup)\r\n\r\n    return toolbar\r\n  }\r\n\r\n  /**\r\n   * 创建按钮\r\n   */\r\n  private createButton(icon: string, label: string, onClick: () => void, isActive = false): HTMLButtonElement {\r\n    const button = document.createElement('button')\r\n    button.className = 'code-toolbar-btn' + (isActive ? ' active' : '')\r\n    button.innerHTML = `${ICONS[icon as keyof typeof ICONS] || ''}${label}`\r\n    button.onclick = (e) => {\r\n      e.stopPropagation()\r\n      onClick()\r\n    }\r\n    return button\r\n  }\r\n\r\n  /**\r\n   * 创建语言选择器\r\n   */\r\n  private createLanguageSelect(): HTMLSelectElement {\r\n    const select = document.createElement('select')\r\n    select.className = 'code-toolbar-select'\r\n\r\n    const currentLang = this.getCurrentLanguage()\r\n\r\n    LANGUAGES.forEach(lang => {\r\n      const option = document.createElement('option')\r\n      option.value = lang.value\r\n      option.textContent = lang.label\r\n      if (lang.value === currentLang) {\r\n        option.selected = true\r\n      }\r\n      select.appendChild(option)\r\n    })\r\n\r\n    select.onchange = (e) => {\r\n      e.stopPropagation()\r\n      this.changeLanguage(select.value)\r\n    }\r\n\r\n    return select\r\n  }\r\n\r\n  /**\r\n   * 创建主题选择器\r\n   */\r\n  private createThemeSelect(): HTMLSelectElement {\r\n    const select = document.createElement('select')\r\n    select.className = 'code-toolbar-select'\r\n\r\n    const currentTheme = this.getCurrentTheme()\r\n\r\n    THEMES.forEach(theme => {\r\n      const option = document.createElement('option')\r\n      option.value = theme.value\r\n      option.textContent = theme.label\r\n      if (theme.value === currentTheme) {\r\n        option.selected = true\r\n      }\r\n      select.appendChild(option)\r\n    })\r\n\r\n    select.onchange = (e) => {\r\n      e.stopPropagation()\r\n      this.changeTheme(select.value)\r\n    }\r\n\r\n    return select\r\n  }\r\n\r\n  /**\r\n   * 获取当前语言\r\n   */\r\n  private getCurrentLanguage(): string {\r\n    if (!this.currentBlock) return 'plaintext'\r\n\r\n    const code = this.currentBlock.querySelector('code')\r\n    if (code) {\r\n      const classList = Array.from(code.classList)\r\n      const langClass = classList.find(c => c.startsWith('language-'))\r\n      if (langClass) {\r\n        return langClass.replace('language-', '')\r\n      }\r\n    }\r\n\r\n    const pre = this.currentBlock.querySelector('pre')\r\n    return pre?.getAttribute('data-language') || 'plaintext'\r\n  }\r\n\r\n  /**\r\n   * 获取当前主题\r\n   */\r\n  private getCurrentTheme(): string {\r\n    if (!this.currentBlock) return 'oneDark'\r\n    return this.currentBlock.getAttribute('data-theme') || 'oneDark'\r\n  }\r\n\r\n  /**\r\n   * 是否有行号\r\n   */\r\n  private hasLineNumbers(): boolean {\r\n    if (!this.currentBlock) return true\r\n    const lineNumbers = this.currentBlock.querySelector('.line-numbers')\r\n    return lineNumbers !== null && (lineNumbers as HTMLElement).style.display !== 'none'\r\n  }\r\n\r\n  /**\r\n   * 是否换行\r\n   */\r\n  private hasWrap(): boolean {\r\n    if (!this.currentBlock) return false\r\n    const code = this.currentBlock.querySelector('code')\r\n    return code?.style.whiteSpace === 'pre-wrap'\r\n  }\r\n\r\n  /**\r\n   * 切换行号显示\r\n   */\r\n  private toggleLineNumbers() {\r\n    if (!this.currentBlock) return\r\n\r\n    const lineNumbers = this.currentBlock.querySelector('.line-numbers') as HTMLElement\r\n    if (lineNumbers) {\r\n      const isHidden = lineNumbers.style.display === 'none'\r\n      lineNumbers.style.display = isHidden ? 'block' : 'none'\r\n      \r\n      // 更新按钮状态\r\n      this.refreshToolbar()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 切换换行模式\r\n   */\r\n  private toggleWrap() {\r\n    if (!this.currentBlock) return\r\n\r\n    const code = this.currentBlock.querySelector('code') as HTMLElement\r\n    if (code) {\r\n      const isWrap = code.style.whiteSpace === 'pre-wrap'\r\n      code.style.whiteSpace = isWrap ? 'pre' : 'pre-wrap'\r\n      code.style.wordBreak = isWrap ? 'normal' : 'break-word'\r\n      \r\n      // 更新按钮状态\r\n      this.refreshToolbar()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 复制代码\r\n   */\r\n  private copyCode() {\r\n    if (!this.currentBlock) return\r\n\r\n    const code = this.currentBlock.querySelector('code')\r\n    const text = code?.textContent || ''\r\n\r\n    navigator.clipboard.writeText(text).then(() => {\r\n      this.showToast('代码已复制到剪贴板')\r\n    }).catch(() => {\r\n      this.showToast('复制失败', false)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 显示提示\r\n   */\r\n  private showToast(message: string, success = true) {\r\n    const toast = document.createElement('div')\r\n    toast.className = 'code-toolbar-toast'\r\n    toast.textContent = message\r\n    if (!success) {\r\n      toast.style.background = '#ef4444'\r\n    }\r\n    document.body.appendChild(toast)\r\n\r\n    setTimeout(() => {\r\n      toast.remove()\r\n    }, 2000)\r\n  }\r\n\r\n  /**\r\n   * 切换语言\r\n   */\r\n  private changeLanguage(language: string) {\r\n    if (!this.currentBlock) return\r\n\r\n    const code = this.currentBlock.querySelector('code')\r\n    const pre = this.currentBlock.querySelector('pre')\r\n    const langLabel = this.currentBlock.querySelector('div > span:first-child')\r\n\r\n    if (code) {\r\n      // 更新类名\r\n      code.className = language === 'plaintext' ? '' : `language-${language}`\r\n    }\r\n\r\n    if (pre) {\r\n      pre.setAttribute('data-language', language)\r\n    }\r\n\r\n    if (langLabel) {\r\n      langLabel.textContent = language === 'plaintext' ? 'CODE' : language.toUpperCase()\r\n    }\r\n\r\n    // 触发重新高亮（如果有）\r\n    this.triggerHighlight(code as HTMLElement, language)\r\n    this.triggerUpdate()\r\n  }\r\n\r\n  /**\r\n   * 切换主题\r\n   */\r\n  private changeTheme(theme: string) {\r\n    if (!this.currentBlock) return\r\n\r\n    const themeConfig = THEMES.find(t => t.value === theme)\r\n    if (!themeConfig) return\r\n\r\n    this.currentBlock.setAttribute('data-theme', theme)\r\n    this.currentBlock.style.background = themeConfig.bg\r\n\r\n    const code = this.currentBlock.querySelector('code') as HTMLElement\r\n    if (code) {\r\n      code.style.color = themeConfig.fg\r\n    }\r\n\r\n    const header = this.currentBlock.querySelector('div:first-child') as HTMLElement\r\n    if (header) {\r\n      // 暗色主题用暗色背景，亮色主题用亮色背景\r\n      const isDark = ['oneDark', 'monokai', 'dracula', 'nord'].includes(theme)\r\n      header.style.background = isDark ? '#21252b' : '#f5f5f5'\r\n      header.style.borderBottomColor = isDark ? '#3a3f4a' : '#e5e7eb'\r\n      \r\n      // 更新标签和按钮颜色\r\n      const label = header.querySelector('span')\r\n      const button = header.querySelector('button')\r\n      if (label) {\r\n        label.style.color = isDark ? '#7f848e' : '#6b7280'\r\n      }\r\n      if (button) {\r\n        button.style.color = isDark ? '#abb2bf' : '#374151'\r\n      }\r\n    }\r\n\r\n    const lineNumbers = this.currentBlock.querySelector('.line-numbers') as HTMLElement\r\n    if (lineNumbers) {\r\n      const isDark = ['oneDark', 'monokai', 'dracula', 'nord'].includes(theme)\r\n      lineNumbers.style.background = isDark ? '#21252b' : '#f5f5f5'\r\n      lineNumbers.style.color = isDark ? '#5c6370' : '#6b7280'\r\n      lineNumbers.style.borderRightColor = isDark ? '#3a3f4a' : '#e5e7eb'\r\n    }\r\n\r\n    this.triggerUpdate()\r\n  }\r\n\r\n  /**\r\n   * 触发语法高亮\r\n   */\r\n  private triggerHighlight(code: HTMLElement, language: string) {\r\n    // 尝试使用已有的高亮函数\r\n    // 这里需要导入代码块插件中的高亮函数，或者重新实现\r\n    // 暂时不处理，保留原有高亮\r\n  }\r\n\r\n  /**\r\n   * 删除代码块\r\n   */\r\n  private deleteBlock() {\r\n    if (!this.currentBlock) return\r\n\r\n    if (confirm('确定要删除这个代码块吗？')) {\r\n      this.currentBlock.remove()\r\n      this.hideToolbar()\r\n      this.triggerUpdate()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 刷新工具栏\r\n   */\r\n  private refreshToolbar() {\r\n    if (!this.currentBlock) return\r\n\r\n    const block = this.currentBlock\r\n    this.hideToolbar()\r\n    this.selectBlock(block)\r\n  }\r\n\r\n  /**\r\n   * 触发编辑器更新\r\n   */\r\n  private triggerUpdate() {\r\n    const editorContent = document.querySelector('.ldesign-editor-content')\r\n    if (editorContent) {\r\n      const event = new Event('input', { bubbles: true })\r\n      editorContent.dispatchEvent(event)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁\r\n   */\r\n  destroy() {\r\n    this.hideToolbar()\r\n  }\r\n}\r\n\r\n// 工具栏实例\r\nlet codeToolbarInstance: CodeToolbar | null = null\r\n\r\n/**\r\n * 代码块工具栏插件\r\n */\r\nexport const CodeBlockToolbarPlugin: Plugin = createPlugin({\r\n  name: 'codeBlockToolbar',\r\n  init: () => {\r\n    if (!codeToolbarInstance) {\r\n      codeToolbarInstance = new CodeToolbar()\r\n    }\r\n  },\r\n  destroy: () => {\r\n    if (codeToolbarInstance) {\r\n      codeToolbarInstance.destroy()\r\n      codeToolbarInstance = null\r\n    }\r\n  },\r\n})\r\n"],"names":["TOOLBAR_STYLES","ICONS","copy","lineNumbers","theme","wrap","delete","format","check","LANGUAGES","value","label","THEMES","bg","fg","CodeToolbar","constructor","toolbar","currentBlock","styleInjected","injectStyles","setupEventListeners","styleId","document","getElementById","style","createElement","id","textContent","head","appendChild","addEventListener","e","target","codeBlock","closest","selectBlock","hideToolbar","key","block","querySelectorAll","forEach","el","classList","remove","add","showToolbar","createToolbar","body","positionToolbar","rect","getBoundingClientRect","toolbarRect","top","height","left","width","bottom","window","innerWidth","scrollY","scrollX","className","langGroup","langLabel","createLanguageSelect","themeGroup","themeLabel","createThemeSelect","actionGroup","createButton","toggleLineNumbers","hasLineNumbers","toggleWrap","hasWrap","copyCode","deleteGroup","deleteBlock","icon","onClick","isActive","button","innerHTML","onclick","stopPropagation","select","currentLang","getCurrentLanguage","lang","option","selected","onchange","changeLanguage","currentTheme","getCurrentTheme","changeTheme","code","querySelector","Array","from","langClass","find","c","startsWith","replace","pre","getAttribute","display","whiteSpace","isHidden","refreshToolbar","isWrap","wordBreak","text","navigator","clipboard","writeText","then","showToast","catch","message","success","toast","background","setTimeout","language","setAttribute","toUpperCase","triggerHighlight","triggerUpdate","themeConfig","t","color","header","isDark","includes","borderBottomColor","borderRightColor","confirm","editorContent","event","Event","bubbles","dispatchEvent","destroy","codeToolbarInstance","CodeBlockToolbarPlugin","createPlugin","name","init"],"mappings":"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"}