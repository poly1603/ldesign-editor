{"version":3,"file":"DiagramToolbar.js","sources":["../../../src/plugins/diagrams/DiagramToolbar.ts"],"sourcesContent":["/**\r\n * ÂõæË°®Â∑•ÂÖ∑Ê†è\r\n * Êèê‰æõÂõæË°®ÊèíÂÖ•ÂíåÁºñËæëÁöÑÂø´Êç∑Êìç‰Ωú\r\n */\r\n\r\nimport type { Editor } from '../../core/Editor'\r\nimport type { DiagramType } from './types'\r\nimport { createLogger } from '../../utils/logger'\r\n\r\nconst logger = createLogger('DiagramToolbar')\r\n\r\nexport interface DiagramToolbarOptions {\r\n  editor: Editor\r\n  onInsertDiagram: (type: DiagramType) => void\r\n  onEditDiagram: (node: HTMLElement) => void\r\n}\r\n\r\nexport class DiagramToolbar {\r\n  private editor: Editor\r\n  private onInsertDiagram: (type: DiagramType) => void\r\n  private onEditDiagram: (node: HTMLElement) => void\r\n  private container?: HTMLElement\r\n\r\n  constructor(options: DiagramToolbarOptions) {\r\n    this.editor = options.editor\r\n    this.onInsertDiagram = options.onInsertDiagram\r\n    this.onEditDiagram = options.onEditDiagram\r\n\r\n    this.createToolbar()\r\n  }\r\n\r\n  /**\r\n   * ÂàõÂª∫Â∑•ÂÖ∑Ê†è\r\n   */\r\n  private createToolbar(): void {\r\n    // Êü•ÊâæÊàñÂàõÂª∫Â∑•ÂÖ∑Ê†èÂÆπÂô®\r\n    const toolbar = this.editor.toolbar\r\n    if (!toolbar) {\r\n      logger.warn('No toolbar found')\r\n      return\r\n    }\r\n\r\n    // ÂàõÂª∫ÂõæË°®ÊåâÈíÆÁªÑ\r\n    const diagramGroup = document.createElement('div')\r\n    diagramGroup.className = 'toolbar-group diagram-group'\r\n    diagramGroup.style.cssText = `\r\n      display: inline-flex;\r\n      gap: 4px;\r\n      margin: 0 8px;\r\n      padding: 0 8px;\r\n      border-left: 1px solid #e0e0e0;\r\n      border-right: 1px solid #e0e0e0;\r\n    `\r\n\r\n    // ÂõæË°®Á±ªÂûã\r\n    const diagramTypes: Array<{ type: DiagramType, label: string, icon: string }> = [\r\n      { type: 'mindmap', label: 'ÊÄùÁª¥ÂØºÂõæ', icon: 'üß†' },\r\n      { type: 'flowchart', label: 'ÊµÅÁ®ãÂõæ', icon: 'üîÄ' },\r\n      { type: 'uml', label: 'UMLÂõæ', icon: 'üìê' },\r\n      { type: 'sequence', label: 'Êó∂Â∫èÂõæ', icon: 'üìä' },\r\n      { type: 'gantt', label: 'ÁîòÁâπÂõæ', icon: 'üìÖ' },\r\n    ]\r\n\r\n    diagramTypes.forEach(({ type, label, icon }) => {\r\n      const button = this.createButton(type, label, icon)\r\n      diagramGroup.appendChild(button)\r\n    })\r\n\r\n    // Â∞ÜÊåâÈíÆÁªÑÊ∑ªÂä†Âà∞Â∑•ÂÖ∑Ê†è\r\n    const toolbarElement = toolbar.element || toolbar.container\r\n    if (toolbarElement) {\r\n      toolbarElement.appendChild(diagramGroup)\r\n      this.container = diagramGroup\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ÂàõÂª∫ÊåâÈíÆ\r\n   */\r\n  private createButton(type: DiagramType, label: string, icon: string): HTMLElement {\r\n    const button = document.createElement('button')\r\n    button.className = `toolbar-button diagram-button diagram-button-${type}`\r\n    button.title = label\r\n    button.style.cssText = `\r\n      padding: 6px 10px;\r\n      background: transparent;\r\n      border: 1px solid transparent;\r\n      border-radius: 4px;\r\n      cursor: pointer;\r\n      font-size: 16px;\r\n      transition: all 0.2s;\r\n      display: inline-flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    `\r\n    button.innerHTML = icon\r\n\r\n    // ÊÇ¨ÂÅúÊïàÊûú\r\n    button.onmouseenter = () => {\r\n      button.style.background = '#f0f0f0'\r\n      button.style.borderColor = '#ddd'\r\n    }\r\n\r\n    button.onmouseleave = () => {\r\n      button.style.background = 'transparent'\r\n      button.style.borderColor = 'transparent'\r\n    }\r\n\r\n    // ÁÇπÂáª‰∫ã‰ª∂\r\n    button.onclick = () => {\r\n      logger.info(`Insert diagram: ${type}`)\r\n      this.onInsertDiagram(type)\r\n    }\r\n\r\n    return button\r\n  }\r\n\r\n  /**\r\n   * Êõ¥Êñ∞Áä∂ÊÄÅ\r\n   */\r\n  updateState(hasDiagram: boolean): void {\r\n    // ÂèØ‰ª•Ê†πÊçÆÁä∂ÊÄÅÊõ¥Êñ∞Â∑•ÂÖ∑Ê†èÊåâÈíÆÁöÑÂêØÁî®/Á¶ÅÁî®Áä∂ÊÄÅ\r\n    const buttons = this.container?.querySelectorAll('.diagram-button')\r\n    buttons?.forEach((button: Element) => {\r\n      const htmlButton = button as HTMLElement\r\n      htmlButton.style.opacity = hasDiagram ? '0.5' : '1'\r\n    })\r\n  }\r\n\r\n  /**\r\n   * ÈîÄÊØÅÂ∑•ÂÖ∑Ê†è\r\n   */\r\n  destroy(): void {\r\n    this.container?.remove()\r\n    this.container = undefined\r\n    logger.info('Diagram toolbar destroyed')\r\n  }\r\n}\r\n"],"names":["logger","createLogger","DiagramToolbar","constructor","options","editor","onInsertDiagram","onEditDiagram","createToolbar","toolbar","warn","diagramGroup","document","createElement","className","style","cssText","diagramTypes","type","label","icon","forEach","button","createButton","appendChild","toolbarElement","element","container","title","innerHTML","onmouseenter","background","borderColor","onmouseleave","onclick","info","updateState","hasDiagram","buttons","querySelectorAll","htmlButton","opacity","destroy","remove","undefined"],"mappings":"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"}