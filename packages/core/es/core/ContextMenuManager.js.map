{"version":3,"file":"ContextMenuManager.js","sources":["../../src/core/ContextMenuManager.ts"],"sourcesContent":["/**\r\n * 右键菜单管理器\r\n * 统一管理编辑器中所有的右键菜单，提供注册、注销、更新等功能\r\n */\r\n\r\nimport type { ContextMenuOptions, MenuItem } from '../ui/ContextMenuSystem'\r\nimport { ContextMenuSystem } from '../ui/ContextMenuSystem'\r\nimport { EventEmitter } from './EventEmitter'\r\n\r\nexport interface MenuRegistration {\r\n  id: string\r\n  selector: string // CSS选择器，用于匹配元素\r\n  priority?: number // 优先级，数字越大优先级越高\r\n  items: MenuItem[] | ((context: any) => MenuItem[]) // 菜单项，可以是静态的或动态生成的\r\n  condition?: (element: HTMLElement) => boolean // 额外的条件判断\r\n  onBeforeShow?: (menu: ContextMenuSystem, context: any) => void\r\n  onAfterShow?: (menu: ContextMenuSystem, context: any) => void\r\n  onBeforeHide?: (menu: ContextMenuSystem, context: any) => void\r\n  onAfterHide?: (menu: ContextMenuSystem, context: any) => void\r\n}\r\n\r\nexport interface ContextMenuManagerOptions {\r\n  theme?: 'light' | 'dark'\r\n  animation?: boolean\r\n  maxHeight?: number\r\n  minWidth?: number\r\n  zIndex?: number\r\n  enableDefault?: boolean // 是否启用默认右键菜单\r\n}\r\n\r\nexport class ContextMenuManager extends EventEmitter {\r\n  private registrations: Map<string, MenuRegistration> = new Map()\r\n  private activeMenu: ContextMenuSystem | null = null\r\n  private options: ContextMenuManagerOptions\r\n  private container: HTMLElement | null = null\r\n  private clickHandlers: Map<HTMLElement, (e: MouseEvent) => void> = new Map()\r\n\r\n  constructor(options: ContextMenuManagerOptions = {}) {\r\n    super()\r\n\r\n    this.options = {\r\n      theme: 'light',\r\n      animation: true,\r\n      maxHeight: window.innerHeight * 0.7,\r\n      minWidth: 220,\r\n      zIndex: 10000,\r\n      enableDefault: false,\r\n      ...options,\r\n    }\r\n\r\n    this.initialize()\r\n  }\r\n\r\n  private initialize(): void {\r\n    // 监听全局右键事件\r\n    document.addEventListener('contextmenu', this.handleGlobalContextMenu.bind(this), true)\r\n  }\r\n\r\n  /**\r\n   * 设置容器元素\r\n   */\r\n  public setContainer(element: HTMLElement): void {\r\n    this.container = element\r\n  }\r\n\r\n  /**\r\n   * 注册右键菜单\r\n   */\r\n  public register(registration: MenuRegistration): void {\r\n    if (!registration.id)\r\n      throw new Error('Menu registration must have an id')\r\n\r\n    // 设置默认优先级\r\n    if (registration.priority === undefined)\r\n      registration.priority = 0\r\n\r\n    this.registrations.set(registration.id, registration)\r\n    this.emit('menu-registered', registration)\r\n\r\n    console.log(`[ContextMenuManager] Registered menu: ${registration.id}`)\r\n  }\r\n\r\n  /**\r\n   * 注销右键菜单\r\n   */\r\n  public unregister(id: string): void {\r\n    if (this.registrations.has(id)) {\r\n      this.registrations.delete(id)\r\n      this.emit('menu-unregistered', id)\r\n      console.log(`[ContextMenuManager] Unregistered menu: ${id}`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新菜单项\r\n   */\r\n  public updateMenu(id: string, items: MenuItem[] | ((context: any) => MenuItem[])): void {\r\n    const registration = this.registrations.get(id)\r\n    if (registration) {\r\n      registration.items = items\r\n      this.emit('menu-updated', id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取注册的菜单\r\n   */\r\n  public getRegistration(id: string): MenuRegistration | undefined {\r\n    return this.registrations.get(id)\r\n  }\r\n\r\n  /**\r\n   * 获取所有注册的菜单\r\n   */\r\n  public getAllRegistrations(): MenuRegistration[] {\r\n    return Array.from(this.registrations.values())\r\n  }\r\n\r\n  /**\r\n   * 处理全局右键事件\r\n   */\r\n  private handleGlobalContextMenu(e: MouseEvent): void {\r\n    const target = e.target as HTMLElement\r\n\r\n    console.log('[ContextMenuManager] Right click on:', target, 'Classes:', target.className)\r\n\r\n    // 如果有容器限制，检查是否在容器内\r\n    if (this.container && !this.container.contains(target)) {\r\n      console.log('[ContextMenuManager] Target not in container')\r\n      return\r\n    }\r\n\r\n    // 查找匹配的菜单\r\n    const matchedMenus = this.findMatchingMenus(target)\r\n\r\n    console.log('[ContextMenuManager] Matched menus:', matchedMenus.map(m => m.id))\r\n\r\n    if (matchedMenus.length > 0) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n\r\n      // 按优先级排序\r\n      matchedMenus.sort((a, b) => (b.priority || 0) - (a.priority || 0))\r\n\r\n      // 使用优先级最高的菜单\r\n      const registration = matchedMenus[0]\r\n      console.log('[ContextMenuManager] Using menu:', registration.id, 'Priority:', registration.priority)\r\n      this.showMenu(e, target, registration)\r\n    }\r\n    else if (!this.options.enableDefault) {\r\n      // 如果没有匹配的菜单且禁用默认菜单，阻止默认行为\r\n      if (this.container && this.container.contains(target)) {\r\n        console.log('[ContextMenuManager] Preventing default context menu')\r\n        e.preventDefault()\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 查找匹配的菜单\r\n   */\r\n  private findMatchingMenus(element: HTMLElement): MenuRegistration[] {\r\n    const matched: MenuRegistration[] = []\r\n\r\n    for (const registration of this.registrations.values()) {\r\n      // 检查选择器是否匹配\r\n      if (element.matches(registration.selector) || element.closest(registration.selector)) {\r\n        // 检查额外条件\r\n        if (!registration.condition || registration.condition(element))\r\n          matched.push(registration)\r\n      }\r\n    }\r\n\r\n    return matched\r\n  }\r\n\r\n  /**\r\n   * 显示菜单\r\n   */\r\n  private showMenu(e: MouseEvent, element: HTMLElement, registration: MenuRegistration): void {\r\n    // 关闭之前的菜单\r\n    if (this.activeMenu) {\r\n      this.activeMenu.destroy()\r\n      this.activeMenu = null\r\n    }\r\n\r\n    // 创建上下文对象\r\n    const context = {\r\n      element,\r\n      event: e,\r\n      registration,\r\n      manager: this,\r\n    }\r\n\r\n    // 获取菜单项\r\n    const items = typeof registration.items === 'function'\r\n      ? registration.items(context)\r\n      : registration.items\r\n\r\n    // 创建菜单选项\r\n    const menuOptions: ContextMenuOptions = {\r\n      items,\r\n      context,\r\n      theme: this.options.theme,\r\n      animation: this.options.animation,\r\n      maxHeight: this.options.maxHeight,\r\n      minWidth: this.options.minWidth,\r\n      zIndex: this.options.zIndex,\r\n      onBeforeShow: (menu) => {\r\n        registration.onBeforeShow?.(menu, context)\r\n        this.emit('menu-before-show', { menu, context, registration })\r\n      },\r\n      onAfterShow: (menu) => {\r\n        registration.onAfterShow?.(menu, context)\r\n        this.emit('menu-after-show', { menu, context, registration })\r\n      },\r\n      onBeforeHide: (menu) => {\r\n        registration.onBeforeHide?.(menu, context)\r\n        this.emit('menu-before-hide', { menu, context, registration })\r\n      },\r\n      onAfterHide: (menu) => {\r\n        registration.onAfterHide?.(menu, context)\r\n        this.emit('menu-after-hide', { menu, context, registration })\r\n        // 清理活动菜单引用\r\n        if (this.activeMenu === menu)\r\n          this.activeMenu = null\r\n      },\r\n    }\r\n\r\n    // 创建并显示菜单\r\n    this.activeMenu = new ContextMenuSystem(menuOptions)\r\n    this.activeMenu.show(e.clientX, e.clientY, context)\r\n  }\r\n\r\n  /**\r\n   * 手动触发右键菜单\r\n   */\r\n  public trigger(e: MouseEvent, menuId: string, _context?: any): void {\r\n    const registration = this.registrations.get(menuId)\r\n    if (!registration) {\r\n      console.warn(`Menu with id \"${menuId}\" not found`)\r\n      return\r\n    }\r\n\r\n    const element = e.target as HTMLElement\r\n    this.showMenu(e, element, registration)\r\n  }\r\n\r\n  /**\r\n   * 关闭当前活动的菜单\r\n   */\r\n  public closeActiveMenu(): void {\r\n    if (this.activeMenu) {\r\n      this.activeMenu.hide()\r\n      this.activeMenu = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 为特定元素添加右键菜单\r\n   */\r\n  public addContextMenu(element: HTMLElement, items: MenuItem[], options?: Partial<MenuRegistration>): string {\r\n    const id = options?.id || `menu-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\r\n\r\n    // 创建一个唯一的类名\r\n    const className = `context-menu-${id}`\r\n    element.classList.add(className)\r\n\r\n    // 注册菜单\r\n    this.register({\r\n      id,\r\n      selector: `.${className}`,\r\n      items,\r\n      ...options,\r\n    })\r\n\r\n    return id\r\n  }\r\n\r\n  /**\r\n   * 批量注册菜单\r\n   */\r\n  public registerBatch(registrations: MenuRegistration[]): void {\r\n    registrations.forEach((registration) => {\r\n      this.register(registration)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 批量注销菜单\r\n   */\r\n  public unregisterBatch(ids: string[]): void {\r\n    ids.forEach((id) => {\r\n      this.unregister(id)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 清除所有注册的菜单\r\n   */\r\n  public clear(): void {\r\n    this.registrations.clear()\r\n    this.closeActiveMenu()\r\n    this.emit('menus-cleared')\r\n  }\r\n\r\n  /**\r\n   * 更新全局选项\r\n   */\r\n  public updateOptions(options: Partial<ContextMenuManagerOptions>): void {\r\n    this.options = {\r\n      ...this.options,\r\n      ...options,\r\n    }\r\n    this.emit('options-updated', this.options)\r\n  }\r\n\r\n  /**\r\n   * 获取当前选项\r\n   */\r\n  public getOptions(): ContextMenuManagerOptions {\r\n    return { ...this.options }\r\n  }\r\n\r\n  /**\r\n   * 销毁管理器\r\n   */\r\n  public destroy(): void {\r\n    this.clear()\r\n    document.removeEventListener('contextmenu', this.handleGlobalContextMenu.bind(this), true)\r\n    this.removeAllListeners()\r\n  }\r\n}\r\n\r\n// 创建全局单例\r\nlet globalManager: ContextMenuManager | null = null\r\n\r\n/**\r\n * 获取全局右键菜单管理器\r\n */\r\nexport function getContextMenuManager(): ContextMenuManager {\r\n  if (!globalManager)\r\n    globalManager = new ContextMenuManager()\r\n\r\n  return globalManager\r\n}\r\n\r\n/**\r\n * 快捷函数：注册右键菜单\r\n */\r\nexport function registerContextMenu(registration: MenuRegistration): void {\r\n  getContextMenuManager().register(registration)\r\n}\r\n\r\n/**\r\n * 快捷函数：为元素添加右键菜单\r\n */\r\nexport function addContextMenuToElement(\r\n  element: HTMLElement,\r\n  items: MenuItem[],\r\n  options?: Partial<MenuRegistration>,\r\n): string {\r\n  return getContextMenuManager().addContextMenu(element, items, options)\r\n}\r\n"],"names":["ContextMenuManager","EventEmitter","constructor","options","registrations","Map","activeMenu","container","clickHandlers","theme","animation","maxHeight","window","innerHeight","minWidth","zIndex","enableDefault","initialize","document","addEventListener","handleGlobalContextMenu","bind","setContainer","element","register","registration","id","Error","priority","undefined","set","emit","console","log","unregister","has","delete","updateMenu","items","get","getRegistration","getAllRegistrations","Array","from","values","e","target","className","contains","matchedMenus","findMatchingMenus","map","m","length","preventDefault","stopPropagation","sort","a","b","showMenu","matched","matches","selector","closest","condition","push","destroy","context","event","manager","menuOptions","onBeforeShow","menu","onAfterShow","onBeforeHide","onAfterHide","ContextMenuSystem","show","clientX","clientY","trigger","menuId","_context","warn","closeActiveMenu","hide","addContextMenu","Date","now","Math","random","toString","substr","classList","add","registerBatch","forEach","unregisterBatch","ids","clear","updateOptions","getOptions","removeEventListener","removeAllListeners","globalManager","getContextMenuManager","registerContextMenu"],"mappings":"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"}