{"version":3,"file":"IncrementalRenderer.js","sources":["../../src/core/IncrementalRenderer.ts"],"sourcesContent":["/**\r\n * 增量渲染引擎\r\n * 实现细粒度的DOM更新，最小化重绘和重排\r\n */\r\n\r\nimport { createLogger } from '../utils/logger'\r\nimport { getPerformanceMonitor } from '../utils/PerformanceMonitor'\r\n\r\nconst logger = createLogger('IncrementalRenderer')\r\n\r\nexport interface DOMPatch {\r\n  type: 'insert' | 'update' | 'remove' | 'move' | 'attributes' | 'text'\r\n  target?: Element | Text\r\n  parent?: Element\r\n  newNode?: Node\r\n  oldValue?: any\r\n  newValue?: any\r\n  index?: number\r\n  attributes?: Record<string, string | null>\r\n}\r\n\r\nexport interface RenderOptions {\r\n  /** 批处理延迟（ms） */\r\n  batchDelay?: number\r\n  /** 最大批处理大小 */\r\n  maxBatchSize?: number\r\n  /** 是否启用RAF调度 */\r\n  useRAF?: boolean\r\n  /** 是否启用Web Worker */\r\n  useWorker?: boolean\r\n  /** 是否启用虚拟DOM */\r\n  useVirtualDOM?: boolean\r\n}\r\n\r\ninterface VNode {\r\n  type: string\r\n  props: Record<string, any>\r\n  children: (VNode | string)[]\r\n  key?: string | number\r\n}\r\n\r\nexport class IncrementalRenderer {\r\n  private options: Required<RenderOptions>\r\n  private patchQueue: DOMPatch[] = []\r\n  private renderTimer: any\r\n  private isRendering = false\r\n  private performanceMonitor = getPerformanceMonitor()\r\n  private mutationObserver?: MutationObserver\r\n  private intersectionObserver?: IntersectionObserver\r\n  private resizeObserver?: ResizeObserver\r\n  private worker?: Worker\r\n  private frameId?: number\r\n  private lastRenderTime = 0\r\n  private renderStats = {\r\n    totalPatches: 0,\r\n    batchCount: 0,\r\n    averageBatchSize: 0,\r\n    totalRenderTime: 0,\r\n  }\r\n\r\n  constructor(options: RenderOptions = {}) {\r\n    this.options = {\r\n      batchDelay: 16, // 约60fps\r\n      maxBatchSize: 100,\r\n      useRAF: true,\r\n      useWorker: false,\r\n      useVirtualDOM: false,\r\n      ...options,\r\n    }\r\n\r\n    this.setupWorker()\r\n    this.setupObservers()\r\n  }\r\n\r\n  /**\r\n   * 添加补丁到队列\r\n   */\r\n  queuePatch(patch: DOMPatch): void {\r\n    this.patchQueue.push(patch)\r\n    this.scheduleRender()\r\n  }\r\n\r\n  /**\r\n   * 批量添加补丁\r\n   */\r\n  queuePatches(patches: DOMPatch[]): void {\r\n    this.patchQueue.push(...patches)\r\n    this.scheduleRender()\r\n  }\r\n\r\n  /**\r\n   * 立即执行所有补丁\r\n   */\r\n  flush(): void {\r\n    this.cancelScheduledRender()\r\n    this.processBatch()\r\n  }\r\n\r\n  /**\r\n   * 清空补丁队列\r\n   */\r\n  clear(): void {\r\n    this.patchQueue = []\r\n    this.cancelScheduledRender()\r\n  }\r\n\r\n  /**\r\n   * 销毁渲染器\r\n   */\r\n  destroy(): void {\r\n    this.clear()\r\n    this.mutationObserver?.disconnect()\r\n    this.intersectionObserver?.disconnect()\r\n    this.resizeObserver?.disconnect()\r\n    this.worker?.terminate()\r\n  }\r\n\r\n  /**\r\n   * 调度渲染\r\n   */\r\n  private scheduleRender(): void {\r\n    if (this.isRendering || this.renderTimer)\r\n      return\r\n\r\n    if (this.options.useRAF) {\r\n      this.frameId = requestAnimationFrame(() => {\r\n        this.renderTimer = null\r\n        this.processBatch()\r\n      })\r\n    }\r\n    else {\r\n      this.renderTimer = setTimeout(() => {\r\n        this.renderTimer = null\r\n        this.processBatch()\r\n      }, this.options.batchDelay)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 取消调度的渲染\r\n   */\r\n  private cancelScheduledRender(): void {\r\n    if (this.frameId) {\r\n      cancelAnimationFrame(this.frameId)\r\n      this.frameId = undefined\r\n    }\r\n    if (this.renderTimer) {\r\n      clearTimeout(this.renderTimer)\r\n      this.renderTimer = null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理批次\r\n   */\r\n  private processBatch(): void {\r\n    if (this.patchQueue.length === 0)\r\n      return\r\n\r\n    const timerName = 'incrementalRender.batch'\r\n    this.performanceMonitor.start(timerName)\r\n    this.isRendering = true\r\n\r\n    try {\r\n      // 获取要处理的补丁\r\n      const patches = this.patchQueue.splice(0, this.options.maxBatchSize)\r\n\r\n      // 优化补丁\r\n      const optimizedPatches = this.optimizePatches(patches)\r\n\r\n      // 应用补丁\r\n      if (this.options.useWorker && this.worker)\r\n        this.applyPatchesInWorker(optimizedPatches)\r\n      else\r\n        this.applyPatches(optimizedPatches)\r\n\r\n      // 更新统计\r\n      this.updateStats(optimizedPatches.length)\r\n\r\n      // 如果还有补丁，继续调度\r\n      if (this.patchQueue.length > 0)\r\n        this.scheduleRender()\r\n    }\r\n    finally {\r\n      this.isRendering = false\r\n      this.performanceMonitor.end(timerName)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 优化补丁\r\n   */\r\n  private optimizePatches(patches: DOMPatch[]): DOMPatch[] {\r\n    const patchMap = new Map<Element | Text, DOMPatch[]>()\r\n    const optimized: DOMPatch[] = []\r\n\r\n    // 按目标分组\r\n    patches.forEach((patch) => {\r\n      if (patch.target) {\r\n        if (!patchMap.has(patch.target))\r\n          patchMap.set(patch.target, [])\r\n\r\n        patchMap.get(patch.target)!.push(patch)\r\n      }\r\n      else {\r\n        optimized.push(patch)\r\n      }\r\n    })\r\n\r\n    // 合并同一目标的补丁\r\n    patchMap.forEach((targetPatches, target) => {\r\n      const merged = this.mergePatches(targetPatches)\r\n      optimized.push(...merged)\r\n    })\r\n\r\n    // 排序：先删除，再更新，最后插入\r\n    return optimized.sort((a, b) => {\r\n      const order = { remove: 0, update: 1, attributes: 1, text: 1, move: 2, insert: 3 }\r\n      return (order[a.type] || 99) - (order[b.type] || 99)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 合并补丁\r\n   */\r\n  private mergePatches(patches: DOMPatch[]): DOMPatch[] {\r\n    if (patches.length <= 1)\r\n      return patches\r\n\r\n    const merged: DOMPatch[] = []\r\n    const attributeUpdates: Record<string, string | null> = {}\r\n    let lastTextUpdate: DOMPatch | null = null\r\n\r\n    patches.forEach((patch) => {\r\n      switch (patch.type) {\r\n        case 'attributes':\r\n          // 合并属性更新\r\n          Object.assign(attributeUpdates, patch.attributes)\r\n          break\r\n\r\n        case 'text':\r\n          // 只保留最后一次文本更新\r\n          lastTextUpdate = patch\r\n          break\r\n\r\n        default:\r\n          // 其他类型直接添加\r\n          merged.push(patch)\r\n      }\r\n    })\r\n\r\n    // 添加合并的属性更新\r\n    if (Object.keys(attributeUpdates).length > 0) {\r\n      merged.push({\r\n        type: 'attributes',\r\n        target: patches[0].target,\r\n        attributes: attributeUpdates,\r\n      })\r\n    }\r\n\r\n    // 添加最后的文本更新\r\n    if (lastTextUpdate)\r\n      merged.push(lastTextUpdate)\r\n\r\n    return merged\r\n  }\r\n\r\n  /**\r\n   * 应用补丁\r\n   */\r\n  private applyPatches(patches: DOMPatch[]): void {\r\n    // 使用文档片段批量操作\r\n    const fragment = document.createDocumentFragment()\r\n    const insertPatches: DOMPatch[] = []\r\n\r\n    patches.forEach((patch) => {\r\n      try {\r\n        switch (patch.type) {\r\n          case 'insert':\r\n            if (patch.newNode && patch.parent) {\r\n              if (patch.index !== undefined) {\r\n                const refNode = patch.parent.children[patch.index]\r\n                patch.parent.insertBefore(patch.newNode, refNode)\r\n              }\r\n              else {\r\n                // 收集插入操作，稍后批量处理\r\n                insertPatches.push(patch)\r\n              }\r\n            }\r\n            break\r\n\r\n          case 'update':\r\n            if (patch.target && patch.newNode)\r\n              patch.target.replaceWith(patch.newNode)\r\n\r\n            break\r\n\r\n          case 'remove':\r\n            if (patch.target)\r\n              patch.target.remove()\r\n\r\n            break\r\n\r\n          case 'move':\r\n            if (patch.target && patch.parent && patch.index !== undefined) {\r\n              const refNode = patch.parent.children[patch.index]\r\n              patch.parent.insertBefore(patch.target, refNode)\r\n            }\r\n            break\r\n\r\n          case 'attributes':\r\n            if (patch.target instanceof Element && patch.attributes)\r\n              this.updateAttributes(patch.target, patch.attributes)\r\n\r\n            break\r\n\r\n          case 'text':\r\n            if (patch.target && patch.newValue !== undefined)\r\n              patch.target.textContent = patch.newValue\r\n\r\n            break\r\n        }\r\n      }\r\n      catch (error) {\r\n        logger.error('Failed to apply patch:', patch, error)\r\n      }\r\n    })\r\n\r\n    // 批量处理插入操作\r\n    if (insertPatches.length > 0) {\r\n      insertPatches.forEach((patch) => {\r\n        if (patch.newNode)\r\n          fragment.appendChild(patch.newNode)\r\n      })\r\n\r\n      // 一次性插入所有节点\r\n      const firstPatch = insertPatches[0]\r\n      if (firstPatch.parent)\r\n        firstPatch.parent.appendChild(fragment)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新属性\r\n   */\r\n  private updateAttributes(element: Element, attributes: Record<string, string | null>): void {\r\n    Object.entries(attributes).forEach(([name, value]) => {\r\n      if (value === null) {\r\n        element.removeAttribute(name)\r\n      }\r\n      else {\r\n        // 特殊处理某些属性\r\n        if (name === 'class')\r\n          element.className = value\r\n        else if (name === 'style')\r\n          (element as HTMLElement).style.cssText = value\r\n        else if (name.startsWith('data-'))\r\n          (element as HTMLElement).dataset[name.slice(5)] = value\r\n        else\r\n          element.setAttribute(name, value)\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 设置Worker\r\n   */\r\n  private setupWorker(): void {\r\n    if (!this.options.useWorker)\r\n      return\r\n\r\n    const workerCode = `\r\n      self.onmessage = function(e) {\r\n        const { patches } = e.data\r\n        \r\n        // 在Worker中进行补丁优化\r\n        const optimized = optimizePatches(patches)\r\n        \r\n        self.postMessage({ optimized })\r\n      }\r\n      \r\n      function optimizePatches(patches) {\r\n        // Worker中的优化逻辑\r\n        return patches\r\n      }\r\n    `\r\n\r\n    const blob = new Blob([workerCode], { type: 'application/javascript' })\r\n    this.worker = new Worker(URL.createObjectURL(blob))\r\n\r\n    this.worker.onmessage = (e) => {\r\n      const { optimized } = e.data\r\n      this.applyPatches(optimized)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 在Worker中应用补丁\r\n   */\r\n  private applyPatchesInWorker(patches: DOMPatch[]): void {\r\n    if (!this.worker) {\r\n      this.applyPatches(patches)\r\n      return\r\n    }\r\n\r\n    // 序列化补丁（移除DOM引用）\r\n    const serializedPatches = patches.map(patch => ({\r\n      ...patch,\r\n      target: null,\r\n      parent: null,\r\n      newNode: null,\r\n    }))\r\n\r\n    this.worker.postMessage({ patches: serializedPatches })\r\n  }\r\n\r\n  /**\r\n   * 设置观察器\r\n   */\r\n  private setupObservers(): void {\r\n    // Mutation Observer - 监听DOM变化\r\n    this.mutationObserver = new MutationObserver((mutations) => {\r\n      const patches: DOMPatch[] = []\r\n\r\n      mutations.forEach((mutation) => {\r\n        switch (mutation.type) {\r\n          case 'attributes':\r\n            patches.push({\r\n              type: 'attributes',\r\n              target: mutation.target as Element,\r\n              attributes: {\r\n                [mutation.attributeName!]: (mutation.target as Element).getAttribute(mutation.attributeName!),\r\n              },\r\n            })\r\n            break\r\n\r\n          case 'childList':\r\n            mutation.removedNodes.forEach((node) => {\r\n              patches.push({\r\n                type: 'remove',\r\n                target: node as Element,\r\n              })\r\n            })\r\n            mutation.addedNodes.forEach((node) => {\r\n              patches.push({\r\n                type: 'insert',\r\n                newNode: node,\r\n                parent: mutation.target as Element,\r\n              })\r\n            })\r\n            break\r\n\r\n          case 'characterData':\r\n            patches.push({\r\n              type: 'text',\r\n              target: mutation.target as Text,\r\n              newValue: mutation.target.textContent,\r\n            })\r\n            break\r\n        }\r\n      })\r\n\r\n      if (patches.length > 0)\r\n        this.queuePatches(patches)\r\n    })\r\n\r\n    // Intersection Observer - 监听可见性\r\n    this.intersectionObserver = new IntersectionObserver((entries) => {\r\n      entries.forEach((entry) => {\r\n        if (entry.isIntersecting) {\r\n          // 元素进入视口，可能需要渲染\r\n          logger.debug('Element entered viewport:', entry.target)\r\n        }\r\n      })\r\n    })\r\n\r\n    // Resize Observer - 监听大小变化\r\n    this.resizeObserver = new ResizeObserver((entries) => {\r\n      entries.forEach((entry) => {\r\n        // 元素大小改变，可能需要重新布局\r\n        logger.debug('Element resized:', entry.target)\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 开始观察元素\r\n   */\r\n  observeElement(element: Element): void {\r\n    this.mutationObserver?.observe(element, {\r\n      attributes: true,\r\n      childList: true,\r\n      subtree: true,\r\n      characterData: true,\r\n    })\r\n\r\n    this.intersectionObserver?.observe(element)\r\n    this.resizeObserver?.observe(element)\r\n  }\r\n\r\n  /**\r\n   * 停止观察元素\r\n   */\r\n  unobserveElement(element: Element): void {\r\n    this.mutationObserver?.disconnect()\r\n    this.intersectionObserver?.unobserve(element)\r\n    this.resizeObserver?.unobserve(element)\r\n  }\r\n\r\n  /**\r\n   * 更新统计信息\r\n   */\r\n  private updateStats(patchCount: number): void {\r\n    this.renderStats.totalPatches += patchCount\r\n    this.renderStats.batchCount++\r\n    this.renderStats.averageBatchSize\r\n      = this.renderStats.totalPatches / this.renderStats.batchCount\r\n  }\r\n\r\n  /**\r\n   * 获取渲染统计\r\n   */\r\n  getStats() {\r\n    return {\r\n      ...this.renderStats,\r\n      queueSize: this.patchQueue.length,\r\n      isRendering: this.isRendering,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建虚拟节点（用于虚拟DOM模式）\r\n   */\r\n  createVNode(type: string, props: Record<string, any> = {}, children: (VNode | string)[] = []): VNode {\r\n    return { type, props, children }\r\n  }\r\n\r\n  /**\r\n   * 比较虚拟节点并生成补丁\r\n   */\r\n  diff(oldVNode: VNode | null, newVNode: VNode | null): DOMPatch[] {\r\n    const patches: DOMPatch[] = []\r\n\r\n    if (!oldVNode && newVNode) {\r\n      // 新增节点\r\n      patches.push({\r\n        type: 'insert',\r\n        newNode: this.createDOMFromVNode(newVNode),\r\n      })\r\n    }\r\n    else if (oldVNode && !newVNode) {\r\n      // 删除节点\r\n      patches.push({\r\n        type: 'remove',\r\n      })\r\n    }\r\n    else if (oldVNode && newVNode) {\r\n      // 更新节点\r\n      if (oldVNode.type !== newVNode.type) {\r\n        patches.push({\r\n          type: 'update',\r\n          newNode: this.createDOMFromVNode(newVNode),\r\n        })\r\n      }\r\n      else {\r\n        // 比较属性\r\n        const propPatches = this.diffProps(oldVNode.props, newVNode.props)\r\n        patches.push(...propPatches)\r\n\r\n        // 比较子节点\r\n        const childPatches = this.diffChildren(oldVNode.children, newVNode.children)\r\n        patches.push(...childPatches)\r\n      }\r\n    }\r\n\r\n    return patches\r\n  }\r\n\r\n  /**\r\n   * 比较属性\r\n   */\r\n  private diffProps(oldProps: Record<string, any>, newProps: Record<string, any>): DOMPatch[] {\r\n    const patches: DOMPatch[] = []\r\n    const attributes: Record<string, string | null> = {}\r\n\r\n    // 检查新增和修改的属性\r\n    Object.keys(newProps).forEach((key) => {\r\n      if (oldProps[key] !== newProps[key])\r\n        attributes[key] = newProps[key]\r\n    })\r\n\r\n    // 检查删除的属性\r\n    Object.keys(oldProps).forEach((key) => {\r\n      if (!(key in newProps))\r\n        attributes[key] = null\r\n    })\r\n\r\n    if (Object.keys(attributes).length > 0) {\r\n      patches.push({\r\n        type: 'attributes',\r\n        attributes,\r\n      })\r\n    }\r\n\r\n    return patches\r\n  }\r\n\r\n  /**\r\n   * 比较子节点\r\n   */\r\n  private diffChildren(oldChildren: (VNode | string)[], newChildren: (VNode | string)[]): DOMPatch[] {\r\n    const patches: DOMPatch[] = []\r\n    const maxLength = Math.max(oldChildren.length, newChildren.length)\r\n\r\n    for (let i = 0; i < maxLength; i++) {\r\n      const oldChild = oldChildren[i]\r\n      const newChild = newChildren[i]\r\n\r\n      if (typeof oldChild === 'string' || typeof newChild === 'string') {\r\n        if (oldChild !== newChild) {\r\n          patches.push({\r\n            type: 'text',\r\n            newValue: String(newChild || ''),\r\n          })\r\n        }\r\n      }\r\n      else {\r\n        const childPatches = this.diff(\r\n          oldChild as VNode | null,\r\n          newChild as VNode | null,\r\n        )\r\n        patches.push(...childPatches)\r\n      }\r\n    }\r\n\r\n    return patches\r\n  }\r\n\r\n  /**\r\n   * 从虚拟节点创建DOM\r\n   */\r\n  private createDOMFromVNode(vnode: VNode): Node {\r\n    const element = document.createElement(vnode.type)\r\n\r\n    // 设置属性\r\n    Object.entries(vnode.props).forEach(([key, value]) => {\r\n      if (key === 'className') {\r\n        element.className = value\r\n      }\r\n      else if (key === 'style' && typeof value === 'object') {\r\n        Object.assign(element.style, value)\r\n      }\r\n      else if (key.startsWith('on')) {\r\n        const eventName = key.slice(2).toLowerCase()\r\n        element.addEventListener(eventName, value)\r\n      }\r\n      else {\r\n        element.setAttribute(key, value)\r\n      }\r\n    })\r\n\r\n    // 添加子节点\r\n    vnode.children.forEach((child) => {\r\n      if (typeof child === 'string')\r\n        element.appendChild(document.createTextNode(child))\r\n      else\r\n        element.appendChild(this.createDOMFromVNode(child))\r\n    })\r\n\r\n    return element\r\n  }\r\n}\r\n"],"names":["logger","createLogger","IncrementalRenderer","constructor","options","patchQueue","isRendering","performanceMonitor","getPerformanceMonitor","lastRenderTime","renderStats","totalPatches","batchCount","averageBatchSize","totalRenderTime","batchDelay","maxBatchSize","useRAF","useWorker","useVirtualDOM","setupWorker","setupObservers","queuePatch","patch","push","scheduleRender","queuePatches","patches","flush","cancelScheduledRender","processBatch","clear","destroy","mutationObserver","disconnect","intersectionObserver","resizeObserver","worker","terminate","renderTimer","frameId","requestAnimationFrame","setTimeout","cancelAnimationFrame","undefined","clearTimeout","length","timerName","start","splice","optimizedPatches","optimizePatches","applyPatchesInWorker","applyPatches","updateStats","end","patchMap","Map","optimized","forEach","target","has","set","get","targetPatches","merged","mergePatches","sort","a","b","order","remove","update","attributes","text","move","insert","type","attributeUpdates","lastTextUpdate","Object","assign","keys","fragment","document","createDocumentFragment","insertPatches","newNode","parent","index","refNode","children","insertBefore","replaceWith","Element","updateAttributes","newValue","textContent","error","appendChild","firstPatch","element","entries","name","value","removeAttribute","className","style","cssText","startsWith","dataset","slice","setAttribute","workerCode","blob","Blob","Worker","URL","createObjectURL","onmessage","e","data","serializedPatches","map","postMessage","MutationObserver","mutations","mutation","attributeName","getAttribute","removedNodes","node","addedNodes","IntersectionObserver","entry","isIntersecting","debug","ResizeObserver","observeElement","observe","childList","subtree","characterData","unobserveElement","unobserve","patchCount","getStats","queueSize","createVNode","props","diff","oldVNode","newVNode","createDOMFromVNode","propPatches","diffProps","childPatches","diffChildren","oldProps","newProps","key","oldChildren","newChildren","maxLength","Math","max","i","oldChild","newChild","String","vnode","createElement","eventName","toLowerCase","addEventListener","child","createTextNode"],"mappings":"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"}