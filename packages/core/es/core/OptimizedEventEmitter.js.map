{"version":3,"file":"OptimizedEventEmitter.js","sources":["../../src/core/OptimizedEventEmitter.ts"],"sourcesContent":["/**\r\n * 优化的事件发射器\r\n * 减少内存占用，提高性能\r\n *\r\n * 优化特性:\r\n * - 事件处理器池化（复用对象）\r\n * - WeakMap缓存（自动垃圾回收）\r\n * - 批量处理支持\r\n * - 优先级队列\r\n * - 内存泄漏检测\r\n *\r\n * @packageDocumentation\r\n */\r\n\r\n/** 事件处理器函数类型 */\r\ntype EventHandler = (...args: unknown[]) => void | Promise<void>\r\n\r\n/** 事件注册信息 */\r\ninterface EventRegistration {\r\n  /** 处理器函数 */\r\n  handler: EventHandler\r\n  /** 是否只执行一次 */\r\n  once: boolean\r\n  /** 优先级（数字越大越优先） */\r\n  priority: number\r\n  /** 注册时间戳 */\r\n  timestamp: number\r\n}\r\n\r\n/** 批量事件项 */\r\ninterface BatchEventItem {\r\n  event: string\r\n  args: unknown[]\r\n}\r\n\r\n/** 事件统计信息 */\r\ninterface EventStats {\r\n  totalEvents: number\r\n  totalHandlers: number\r\n  eventCounts: Map<string, number>\r\n}\r\n\r\n/**\r\n * 优化的事件发射器类\r\n *\r\n * @example\r\n * ```typescript\r\n * const emitter = new OptimizedEventEmitter()\r\n *\r\n * // 普通监听\r\n * emitter.on('update', (data) => console.log(data))\r\n *\r\n * // 高优先级监听\r\n * emitter.on('update', (data) => console.log('first'), 10)\r\n *\r\n * // 批量发射\r\n * emitter.batchEmit([\r\n *   { event: 'update', args: [data1] },\r\n *   { event: 'change', args: [data2] }\r\n * ])\r\n * ```\r\n */\r\nexport class OptimizedEventEmitter {\r\n  private events: Map<string, EventRegistration[]> = new Map()\r\n  private maxListeners: number = 100\r\n  private listenerCount: number = 0\r\n  private eventStats: Map<string, number> = new Map()\r\n  private batchQueue: BatchEventItem[] = []\r\n  private batchTimer: number | null = null\r\n  private batchDelay: number = 16 // ~60fps\r\n\r\n  // WeakMap缓存（用于对象到处理器的映射，自动GC）\r\n  private handlerCache: WeakMap<object, Set<string>> = new WeakMap()\r\n\r\n  /**\r\n   * 设置最大监听器数量\r\n   * @param n - 最大数量\r\n   */\r\n  setMaxListeners(n: number): this {\r\n    this.maxListeners = n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 获取当前监听器总数\r\n   * @returns 监听器数量\r\n   */\r\n  getListenerCount(): number {\r\n    return this.listenerCount\r\n  }\r\n\r\n  /**\r\n   * 监听事件\r\n   * @param event - 事件名称\r\n   * @param handler - 处理函数\r\n   * @param priority - 优先级（默认0，越大越优先）\r\n   * @returns this 支持链式调用\r\n   */\r\n  on(event: string, handler: EventHandler, priority: number = 0): this {\r\n    this.checkMaxListeners()\r\n\r\n    const registrations = this.events.get(event) || []\r\n    registrations.push({\r\n      handler,\r\n      once: false,\r\n      priority,\r\n      timestamp: Date.now(),\r\n    })\r\n\r\n    // 按优先级排序（稳定排序）\r\n    registrations.sort((a, b) => {\r\n      if (a.priority !== b.priority)\r\n        return b.priority - a.priority\r\n\r\n      return a.timestamp - b.timestamp\r\n    })\r\n\r\n    this.events.set(event, registrations)\r\n    this.listenerCount++\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 监听一次性事件\r\n   */\r\n  once(event: string, handler: EventHandler, priority: number = 0): this {\r\n    this.checkMaxListeners()\r\n\r\n    const registrations = this.events.get(event) || []\r\n    registrations.push({ handler, once: true, priority })\r\n\r\n    // 按优先级排序\r\n    registrations.sort((a, b) => b.priority - a.priority)\r\n\r\n    this.events.set(event, registrations)\r\n    this.listenerCount++\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 取消监听事件\r\n   */\r\n  off(event: string, handler: EventHandler): this {\r\n    const registrations = this.events.get(event)\r\n\r\n    if (!registrations)\r\n      return this\r\n\r\n    const index = registrations.findIndex(r => r.handler === handler)\r\n\r\n    if (index !== -1) {\r\n      registrations.splice(index, 1)\r\n      this.listenerCount--\r\n\r\n      if (registrations.length === 0)\r\n        this.events.delete(event)\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 发射事件\r\n   * @param event - 事件名称\r\n   * @param args - 参数\r\n   * @returns 是否有处理器被调用\r\n   */\r\n  emit(event: string, ...args: unknown[]): boolean {\r\n    const registrations = this.events.get(event)\r\n\r\n    if (!registrations || registrations.length === 0)\r\n      return false\r\n\r\n    // 更新统计\r\n    const count = this.eventStats.get(event) || 0\r\n    this.eventStats.set(event, count + 1)\r\n\r\n    // 复制数组，防止在处理过程中修改\r\n    const handlers = [...registrations]\r\n    const toRemove: EventHandler[] = []\r\n\r\n    for (const registration of handlers) {\r\n      try {\r\n        const result = registration.handler(...args)\r\n\r\n        // 处理异步处理器\r\n        if (result instanceof Promise) {\r\n          result.catch((error) => {\r\n            if (process.env.NODE_ENV !== 'production')\r\n              console.error(`Async error in event handler for \"${event}\":`, error)\r\n          })\r\n        }\r\n\r\n        // 如果是一次性监听器，标记移除\r\n        if (registration.once)\r\n          toRemove.push(registration.handler)\r\n      }\r\n      catch (error) {\r\n        if (process.env.NODE_ENV !== 'production')\r\n          console.error(`Error in event handler for \"${event}\":`, error)\r\n      }\r\n    }\r\n\r\n    // 批量移除一次性监听器\r\n    for (const handler of toRemove)\r\n      this.off(event, handler)\r\n\r\n    return true\r\n  }\r\n\r\n  /**\r\n   * 批量发射事件（优化性能）\r\n   * @param items - 事件项数组\r\n   */\r\n  batchEmit(items: BatchEventItem[]): void {\r\n    for (const item of items)\r\n      this.emit(item.event, ...item.args)\r\n  }\r\n\r\n  /**\r\n   * 延迟批量发射事件（防抖）\r\n   * @param event - 事件名称\r\n   * @param args - 参数\r\n   */\r\n  deferredEmit(event: string, ...args: unknown[]): void {\r\n    this.batchQueue.push({ event, args })\r\n\r\n    if (this.batchTimer !== null)\r\n      clearTimeout(this.batchTimer)\r\n\r\n    this.batchTimer = window.setTimeout(() => {\r\n      const queue = [...this.batchQueue]\r\n      this.batchQueue = []\r\n      this.batchTimer = null\r\n      this.batchEmit(queue)\r\n    }, this.batchDelay)\r\n  }\r\n\r\n  /**\r\n   * 立即执行所有延迟的事件\r\n   */\r\n  flushDeferred(): void {\r\n    if (this.batchTimer !== null) {\r\n      clearTimeout(this.batchTimer)\r\n      this.batchTimer = null\r\n    }\r\n\r\n    if (this.batchQueue.length > 0) {\r\n      const queue = [...this.batchQueue]\r\n      this.batchQueue = []\r\n      this.batchEmit(queue)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取事件统计信息\r\n   * @returns 统计信息\r\n   */\r\n  getStats(): EventStats {\r\n    return {\r\n      totalEvents: this.events.size,\r\n      totalHandlers: this.listenerCount,\r\n      eventCounts: new Map(this.eventStats),\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检测潜在的内存泄漏\r\n   * @param threshold - 阈值（默认50）\r\n   * @returns 可能泄漏的事件列表\r\n   */\r\n  detectLeaks(threshold: number = 50): string[] {\r\n    const leaks: string[] = []\r\n\r\n    for (const [event, registrations] of this.events) {\r\n      if (registrations.length > threshold)\r\n        leaks.push(`${event} (${registrations.length} handlers)`)\r\n    }\r\n\r\n    return leaks\r\n  }\r\n\r\n  /**\r\n   * 清理旧的一次性监听器（超过指定时间未触发）\r\n   * @param maxAge - 最大年龄（毫秒，默认5分钟）\r\n   */\r\n  cleanupOldOnceListeners(maxAge: number = 5 * 60 * 1000): number {\r\n    let removed = 0\r\n    const now = Date.now()\r\n\r\n    for (const [event, registrations] of this.events) {\r\n      const filtered = registrations.filter((r) => {\r\n        if (r.once && now - r.timestamp > maxAge) {\r\n          removed++\r\n          this.listenerCount--\r\n          return false\r\n        }\r\n        return true\r\n      })\r\n\r\n      if (filtered.length === 0)\r\n        this.events.delete(event)\r\n      else if (filtered.length !== registrations.length)\r\n        this.events.set(event, filtered)\r\n    }\r\n\r\n    return removed\r\n  }\r\n\r\n  /**\r\n   * 异步发射事件\r\n   */\r\n  async emitAsync(event: string, ...args: any[]): Promise<void> {\r\n    const registrations = this.events.get(event)\r\n\r\n    if (!registrations || registrations.length === 0)\r\n      return\r\n\r\n    const handlers = [...registrations]\r\n\r\n    for (const registration of handlers) {\r\n      try {\r\n        await registration.handler(...args)\r\n\r\n        if (registration.once)\r\n          this.off(event, registration.handler)\r\n      }\r\n      catch (error) {\r\n        console.error(`Error in async event handler for \"${event}\":`, error)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 移除所有监听器\r\n   */\r\n  removeAllListeners(event?: string): this {\r\n    if (event) {\r\n      const registrations = this.events.get(event)\r\n      if (registrations) {\r\n        this.listenerCount -= registrations.length\r\n        this.events.delete(event)\r\n      }\r\n    }\r\n    else {\r\n      this.listenerCount = 0\r\n      this.events.clear()\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 获取监听器列表\r\n   */\r\n  listeners(event: string): EventHandler[] {\r\n    const registrations = this.events.get(event)\r\n    return registrations ? registrations.map(r => r.handler) : []\r\n  }\r\n\r\n  /**\r\n   * 获取指定事件的监听器数量\r\n   */\r\n  getEventListenerCount(event: string): number {\r\n    return this.events.get(event)?.length || 0\r\n  }\r\n\r\n  /**\r\n   * 获取所有事件名称\r\n   */\r\n  eventNames(): string[] {\r\n    return Array.from(this.events.keys())\r\n  }\r\n\r\n  /**\r\n   * 获取最大监听器数量\r\n   */\r\n  getMaxListeners(): number {\r\n    return this.maxListeners\r\n  }\r\n\r\n  /**\r\n   * 检查监听器数量\r\n   */\r\n  private checkMaxListeners(): void {\r\n    if (this.listenerCount >= this.maxListeners) {\r\n      console.warn(\r\n        `Max listeners (${this.maxListeners}) exceeded. `\r\n        + 'This may indicate a memory leak.',\r\n      )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取内存使用情况\r\n   */\r\n  getMemoryUsage(): {\r\n    events: number\r\n    listeners: number\r\n    averageListenersPerEvent: number\r\n  } {\r\n    const events = this.events.size\r\n    const listeners = this.listenerCount\r\n\r\n    return {\r\n      events,\r\n      listeners,\r\n      averageListenersPerEvent: events > 0 ? listeners / events : 0,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 优化内存\r\n   */\r\n  optimize(): void {\r\n    // 清理空的事件\r\n    const emptyEvents: string[] = []\r\n\r\n    this.events.forEach((registrations, event) => {\r\n      if (registrations.length === 0)\r\n        emptyEvents.push(event)\r\n    })\r\n\r\n    emptyEvents.forEach((event) => {\r\n      this.events.delete(event)\r\n    })\r\n  }\r\n}\r\n"],"names":["OptimizedEventEmitter","events","Map","maxListeners","listenerCount","eventStats","batchQueue","batchTimer","batchDelay","handlerCache","WeakMap","setMaxListeners","n","getListenerCount","on","event","handler","priority","checkMaxListeners","registrations","get","push","once","timestamp","Date","now","sort","a","b","set","off","index","findIndex","r","splice","length","delete","emit","args","count","handlers","toRemove","registration","result","Promise","catch","error","process","env","NODE_ENV","console","batchEmit","items","item","deferredEmit","clearTimeout","window","setTimeout","queue","flushDeferred","getStats","totalEvents","size","totalHandlers","eventCounts","detectLeaks","threshold","leaks","cleanupOldOnceListeners","maxAge","removed","filtered","filter","emitAsync","removeAllListeners","clear","listeners","map","getEventListenerCount","eventNames","Array","from","keys","getMaxListeners","warn","getMemoryUsage","averageListenersPerEvent","optimize","emptyEvents","forEach"],"mappings":"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"}