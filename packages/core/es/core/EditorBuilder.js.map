{"version":3,"file":"EditorBuilder.js","sources":["../../src/core/EditorBuilder.ts"],"sourcesContent":["/**\r\n * 编辑器构建器\r\n * 提供流式API，简化编辑器配置和初始化\r\n */\r\n\r\nimport type { IconSetType } from '../icons/types'\r\nimport type { EditorOptions } from '../types'\r\nimport { getConfigManager } from '../config/ConfigManager'\r\nimport { ToolbarManager } from '../ui/ToolbarManager'\r\nimport { Editor } from './Editor'\r\nimport { FeatureCategory, getFeatureFlags } from './FeatureFlags'\r\nimport { getLazyLoader } from './LazyLoader'\r\nimport { getPluginRegistry } from './PluginRegistry'\r\n\r\n/**\r\n * 编辑器构建器类\r\n */\r\nexport class EditorBuilder {\r\n  private options: Partial<EditorOptions> = {}\r\n  private features = getFeatureFlags()\r\n  private registry = getPluginRegistry()\r\n  private loader = getLazyLoader()\r\n  private config = getConfigManager()\r\n  private toolbarConfig: any = {}\r\n\r\n  /**\r\n   * 设置容器元素\r\n   */\r\n  element(selector: string | HTMLElement): this {\r\n    this.options.element = selector\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置初始内容\r\n   */\r\n  content(html: string): this {\r\n    this.options.content = html\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置是否可编辑\r\n   */\r\n  editable(value: boolean = true): this {\r\n    this.options.editable = value\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 启用功能\r\n   */\r\n  enableFeature(featureId: string): this {\r\n    this.features.enable(featureId)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 禁用功能\r\n   */\r\n  disableFeature(featureId: string): this {\r\n    this.features.disable(featureId)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 启用分类下所有功能\r\n   */\r\n  enableCategory(category: FeatureCategory): this {\r\n    this.features.enableCategory(category)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 禁用分类下所有功能\r\n   */\r\n  disableCategory(category: FeatureCategory): this {\r\n    this.features.disableCategory(category)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 只启用指定功能\r\n   */\r\n  onlyEnable(featureIds: string[]): this {\r\n    // 先禁用所有\r\n    this.features.getAllFeatures().forEach((f) => {\r\n      f.enabled = false\r\n    })\r\n\r\n    // 再启用指定的\r\n    featureIds.forEach((id) => {\r\n      this.features.enable(id)\r\n    })\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置图标集\r\n   */\r\n  icons(iconSet: IconSetType): this {\r\n    this.config.setIconSet(iconSet)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置主题\r\n   */\r\n  theme(themeName: string): this {\r\n    this.config.setTheme(themeName)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 设置语言\r\n   */\r\n  async locale(locale: string): Promise<this> {\r\n    await this.config.setLocale(locale)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 使用轻量级预设\r\n   */\r\n  lightweight(): this {\r\n    // 只启用核心功能\r\n    this.onlyEnable([\r\n      'basic-editing',\r\n      'selection',\r\n      'history',\r\n      'bold',\r\n      'italic',\r\n      'underline',\r\n      'heading',\r\n      'paragraph',\r\n      'bullet-list',\r\n      'ordered-list',\r\n      'link',\r\n    ])\r\n\r\n    this.toolbarConfig = {\r\n      compact: true,\r\n      showLabels: false,\r\n      lazyLoad: true,\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 使用功能完整预设\r\n   */\r\n  fullFeatured(): this {\r\n    // 启用所有功能\r\n    this.features.getAllFeatures().forEach((f) => {\r\n      f.enabled = true\r\n    })\r\n\r\n    this.toolbarConfig = {\r\n      compact: false,\r\n      showLabels: false,\r\n      lazyLoad: true,\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 只启用格式化功能\r\n   */\r\n  formatOnly(): this {\r\n    this.onlyEnable([\r\n      'basic-editing',\r\n      'selection',\r\n      'history',\r\n      'bold',\r\n      'italic',\r\n      'underline',\r\n      'strikethrough',\r\n      'heading',\r\n      'paragraph',\r\n      'bullet-list',\r\n      'ordered-list',\r\n    ])\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 启用所有媒体功能\r\n   */\r\n  withMedia(): this {\r\n    this.enableCategory(FeatureCategory.MEDIA)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 启用AI功能\r\n   */\r\n  withAI(apiKey?: string, provider: 'openai' | 'claude' | 'deepseek' = 'deepseek'): this {\r\n    this.enableCategory(FeatureCategory.AI)\r\n\r\n    if (apiKey) {\r\n      const ai = require('../ai/AIService').getAIService()\r\n      ai.updateApiKey(provider, apiKey)\r\n      ai.setProvider(provider)\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 启用表格功能\r\n   */\r\n  withTable(): this {\r\n    this.enableCategory(FeatureCategory.TABLE)\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 配置工具栏\r\n   */\r\n  toolbar(config: any): this {\r\n    this.toolbarConfig = { ...this.toolbarConfig, ...config }\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 紧凑模式\r\n   */\r\n  compact(value: boolean = true): this {\r\n    this.toolbarConfig.compact = value\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 显示标签\r\n   */\r\n  showLabels(value: boolean = true): this {\r\n    this.toolbarConfig.showLabels = value\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 构建编辑器\r\n   */\r\n  async build(): Promise<Editor> {\r\n    // 创建编辑器实例\r\n    const editor = new Editor(this.options)\r\n\r\n    // 设置编辑器到注册中心\r\n    this.registry.setEditor(editor)\r\n\r\n    // 加载立即需要的功能\r\n    const eagerFeatures = this.features.getEagerFeatures()\r\n    const eagerIds = eagerFeatures.map(f => f.id)\r\n\r\n    if (eagerIds.length > 0)\r\n      await this.loader.loadBatch(eagerIds)\r\n\r\n    // 预加载懒加载功能\r\n    const lazyFeatures = this.features.getLazyFeatures()\r\n    const lazyIds = lazyFeatures.map(f => f.id)\r\n\r\n    if (lazyIds.length > 0) {\r\n      // 后台预加载\r\n      this.loader.preload(lazyIds)\r\n    }\r\n\r\n    // 创建工具栏\r\n    if (this.toolbarConfig && Object.keys(this.toolbarConfig).length > 0) {\r\n      const toolbar = new ToolbarManager(editor, this.toolbarConfig)\r\n      const toolbarElement = toolbar.render()\r\n\r\n      if (editor.element)\r\n        editor.element.insertBefore(toolbarElement, editor.contentElement)\r\n    }\r\n\r\n    return editor\r\n  }\r\n}\r\n\r\n/**\r\n * 创建编辑器构建器\r\n */\r\nexport function createEditor(): EditorBuilder {\r\n  return new EditorBuilder()\r\n}\r\n\r\n/**\r\n * 便捷函数：快速创建轻量级编辑器\r\n */\r\nexport async function createLightweightEditor(element: string | HTMLElement): Promise<Editor> {\r\n  return createEditor()\r\n    .element(element)\r\n    .lightweight()\r\n    .build()\r\n}\r\n\r\n/**\r\n * 便捷函数：快速创建功能完整编辑器\r\n */\r\nexport async function createFullFeaturedEditor(element: string | HTMLElement): Promise<Editor> {\r\n  return createEditor()\r\n    .element(element)\r\n    .fullFeatured()\r\n    .build()\r\n}\r\n\r\n/**\r\n * 便捷函数：快速创建仅格式化编辑器\r\n */\r\nexport async function createFormatOnlyEditor(element: string | HTMLElement): Promise<Editor> {\r\n  return createEditor()\r\n    .element(element)\r\n    .formatOnly()\r\n    .build()\r\n}\r\n"],"names":["EditorBuilder","options","features","getFeatureFlags","registry","getPluginRegistry","loader","getLazyLoader","config","getConfigManager","toolbarConfig","element","selector","content","html","editable","value","enableFeature","featureId","enable","disableFeature","disable","enableCategory","category","disableCategory","onlyEnable","featureIds","getAllFeatures","forEach","f","enabled","id","icons","iconSet","setIconSet","theme","themeName","setTheme","locale","setLocale","lightweight","compact","showLabels","lazyLoad","fullFeatured","formatOnly","withMedia","FeatureCategory","MEDIA","withAI","apiKey","provider","AI","ai","require","getAIService","updateApiKey","setProvider","withTable","TABLE","toolbar","build","editor","Editor","setEditor","eagerFeatures","getEagerFeatures","eagerIds","map","length","loadBatch","lazyFeatures","getLazyFeatures","lazyIds","preload","Object","keys","ToolbarManager","toolbarElement","render","insertBefore","contentElement","createEditor","createLightweightEditor","createFullFeaturedEditor","createFormatOnlyEditor"],"mappings":"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"}