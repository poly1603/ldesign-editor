{"version":3,"file":"BasePlugin.js","sources":["../../../src/core/base/BasePlugin.ts"],"sourcesContent":["/**\r\n * 插件基类\r\n * 提供通用的插件功能，减少重复代码\r\n */\r\n\r\nimport type { Editor } from '../Editor'\r\nimport { EventEmitter } from '../EventEmitter'\r\n\r\n/**\r\n * 插件基础配置\r\n */\r\nexport interface BasePluginConfig {\r\n  enabled?: boolean\r\n  toolbar?: {\r\n    visible?: boolean\r\n    position?: 'left' | 'right' | 'center'\r\n    order?: number\r\n  }\r\n  [key: string]: any\r\n}\r\n\r\n/**\r\n * 插件基类\r\n */\r\nexport abstract class BasePlugin<T extends BasePluginConfig = BasePluginConfig> extends EventEmitter {\r\n  public name: string\r\n  public config: T\r\n  protected editor?: Editor\r\n  protected initialized: boolean = false\r\n\r\n  constructor(name: string, config: T) {\r\n    super()\r\n    this.name = name\r\n    this.config = { ...this.getDefaultConfig(), ...config } as T\r\n  }\r\n\r\n  /**\r\n   * 获取默认配置\r\n   */\r\n  protected abstract getDefaultConfig(): Partial<T>\r\n\r\n  /**\r\n   * 初始化插件\r\n   */\r\n  async init(editor: Editor): Promise<void> {\r\n    if (this.initialized) {\r\n      console.warn(`Plugin \"${this.name}\" is already initialized`)\r\n      return\r\n    }\r\n\r\n    this.editor = editor\r\n\r\n    try {\r\n      await this.onInit()\r\n      this.initialized = true\r\n      this.emit('plugin:initialized', { name: this.name })\r\n    }\r\n    catch (error) {\r\n      console.error(`Failed to initialize plugin \"${this.name}\":`, error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 插件初始化逻辑（子类实现）\r\n   */\r\n  protected abstract onInit(): Promise<void> | void\r\n\r\n  /**\r\n   * 销毁插件\r\n   */\r\n  async destroy(): Promise<void> {\r\n    if (!this.initialized)\r\n      return\r\n\r\n    try {\r\n      await this.onDestroy()\r\n      this.initialized = false\r\n      this.removeAllListeners()\r\n      this.emit('plugin:destroyed', { name: this.name })\r\n    }\r\n    catch (error) {\r\n      console.error(`Failed to destroy plugin \"${this.name}\":`, error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 插件销毁逻辑（子类实现）\r\n   */\r\n  protected abstract onDestroy(): Promise<void> | void\r\n\r\n  /**\r\n   * 更新配置\r\n   */\r\n  updateConfig(config: Partial<T>): void {\r\n    this.config = { ...this.config, ...config }\r\n    this.onConfigUpdate(config)\r\n    this.emit('plugin:config-updated', { name: this.name, config })\r\n  }\r\n\r\n  /**\r\n   * 配置更新回调（子类可选实现）\r\n   */\r\n  protected onConfigUpdate(config: Partial<T>): void {\r\n    // 子类可选择实现\r\n  }\r\n\r\n  /**\r\n   * 启用插件\r\n   */\r\n  enable(): void {\r\n    if (!this.config.enabled) {\r\n      this.config.enabled = true\r\n      this.onEnable()\r\n      this.emit('plugin:enabled', { name: this.name })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 禁用插件\r\n   */\r\n  disable(): void {\r\n    if (this.config.enabled) {\r\n      this.config.enabled = false\r\n      this.onDisable()\r\n      this.emit('plugin:disabled', { name: this.name })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 启用回调（子类可选实现）\r\n   */\r\n  protected onEnable(): void {\r\n    // 子类可选择实现\r\n  }\r\n\r\n  /**\r\n   * 禁用回调（子类可选实现）\r\n   */\r\n  protected onDisable(): void {\r\n    // 子类可选择实现\r\n  }\r\n\r\n  /**\r\n   * 检查插件是否已初始化\r\n   */\r\n  isInitialized(): boolean {\r\n    return this.initialized\r\n  }\r\n\r\n  /**\r\n   * 检查插件是否已启用\r\n   */\r\n  isEnabled(): boolean {\r\n    return this.config.enabled !== false\r\n  }\r\n\r\n  /**\r\n   * 获取编辑器实例\r\n   */\r\n  protected getEditor(): Editor {\r\n    if (!this.editor)\r\n      throw new Error('Editor instance is not available')\r\n\r\n    return this.editor\r\n  }\r\n}\r\n"],"names":["BasePlugin","EventEmitter","constructor","name","config","initialized","getDefaultConfig","init","editor","console","warn","onInit","emit","error","destroy","onDestroy","removeAllListeners","updateConfig","onConfigUpdate","enable","enabled","onEnable","disable","onDisable","isInitialized","isEnabled","getEditor","Error"],"mappings":"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"}