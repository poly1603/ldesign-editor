{"version":3,"file":"DOMUtils.js","sources":["../../src/utils/DOMUtils.ts"],"sourcesContent":["/**\r\n * DOM 操作工具函数\r\n * 统一管理DOM相关操作，避免重复代码\r\n */\r\n\r\n/**\r\n * 创建元素并设置属性\r\n */\r\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\r\n  tag: K,\r\n  attrs?: Partial<HTMLElementTagNameMap[K]> & { style?: string | Partial<CSSStyleDeclaration> },\r\n  ...children: (Node | string)[]\r\n): HTMLElementTagNameMap[K] {\r\n  const element = document.createElement(tag)\r\n\r\n  if (attrs) {\r\n    Object.entries(attrs).forEach(([key, value]) => {\r\n      if (key === 'style') {\r\n        if (typeof value === 'string')\r\n          element.style.cssText = value\r\n        else if (typeof value === 'object')\r\n          Object.assign(element.style, value)\r\n      }\r\n      else if (key === 'className') {\r\n        element.className = value as string\r\n      }\r\n      else if (key.startsWith('data-')) {\r\n        element.setAttribute(key, String(value))\r\n      }\r\n      else {\r\n        (element as any)[key] = value\r\n      }\r\n    })\r\n  }\r\n\r\n  children.forEach((child) => {\r\n    if (typeof child === 'string')\r\n      element.appendChild(document.createTextNode(child))\r\n    else\r\n      element.appendChild(child)\r\n  })\r\n\r\n  return element\r\n}\r\n\r\n/**\r\n * 查询单个元素\r\n */\r\nexport function $(selector: string, parent: Element | Document = document): HTMLElement | null {\r\n  return parent.querySelector(selector) as HTMLElement | null\r\n}\r\n\r\n/**\r\n * 查询多个元素\r\n */\r\nexport function $$(selector: string, parent: Element | Document = document): HTMLElement[] {\r\n  return Array.from(parent.querySelectorAll(selector))\r\n}\r\n\r\n/**\r\n * 添加事件监听器（支持事件委托）\r\n */\r\nexport function on<K extends keyof HTMLElementEventMap>(\r\n  element: Element | Document | Window,\r\n  event: K,\r\n  handler: (e: HTMLElementEventMap[K]) => void,\r\n  options?: boolean | AddEventListenerOptions,\r\n): () => void\r\nexport function on(\r\n  element: Element | Document | Window,\r\n  event: string,\r\n  selector: string,\r\n  handler: (e: Event) => void,\r\n): () => void\r\nexport function on(\r\n  element: Element | Document | Window,\r\n  event: string,\r\n  selectorOrHandler: string | ((e: Event) => void),\r\n  handlerOrOptions?: ((e: Event) => void) | boolean | AddEventListenerOptions,\r\n): () => void {\r\n  if (typeof selectorOrHandler === 'function') {\r\n    // 直接绑定\r\n    element.addEventListener(event, selectorOrHandler as EventListener, handlerOrOptions as boolean | AddEventListenerOptions)\r\n    return () => element.removeEventListener(event, selectorOrHandler as EventListener)\r\n  }\r\n  else {\r\n    // 事件委托\r\n    const selector = selectorOrHandler\r\n    const handler = handlerOrOptions as (e: Event) => void\r\n    const delegatedHandler = (e: Event) => {\r\n      const target = e.target as Element\r\n      const matched = target.closest(selector)\r\n      if (matched && element.contains(matched))\r\n        handler.call(matched, e)\r\n    }\r\n    element.addEventListener(event, delegatedHandler)\r\n    return () => element.removeEventListener(event, delegatedHandler)\r\n  }\r\n}\r\n\r\n/**\r\n * 显示/隐藏元素\r\n */\r\nexport function show(element: HTMLElement): void {\r\n  element.style.display = ''\r\n}\r\n\r\nexport function hide(element: HTMLElement): void {\r\n  element.style.display = 'none'\r\n}\r\n\r\nexport function toggle(element: HTMLElement, force?: boolean): void {\r\n  if (force !== undefined)\r\n    element.style.display = force ? '' : 'none'\r\n  else\r\n    element.style.display = element.style.display === 'none' ? '' : 'none'\r\n}\r\n\r\n/**\r\n * 添加/移除类名\r\n */\r\nexport function addClass(element: Element, ...classNames: string[]): void {\r\n  element.classList.add(...classNames)\r\n}\r\n\r\nexport function removeClass(element: Element, ...classNames: string[]): void {\r\n  element.classList.remove(...classNames)\r\n}\r\n\r\nexport function toggleClass(element: Element, className: string, force?: boolean): void {\r\n  element.classList.toggle(className, force)\r\n}\r\n\r\nexport function hasClass(element: Element, className: string): boolean {\r\n  return element.classList.contains(className)\r\n}\r\n\r\n/**\r\n * 获取元素位置\r\n */\r\nexport function getPosition(element: HTMLElement): { top: number, left: number, width: number, height: number } {\r\n  const rect = element.getBoundingClientRect()\r\n  return {\r\n    top: rect.top + window.scrollY,\r\n    left: rect.left + window.scrollX,\r\n    width: rect.width,\r\n    height: rect.height,\r\n  }\r\n}\r\n\r\n/**\r\n * 设置元素位置\r\n */\r\nexport function setPosition(element: HTMLElement, position: { top?: number, left?: number, right?: number, bottom?: number }): void {\r\n  if (position.top !== undefined)\r\n    element.style.top = `${position.top}px`\r\n  if (position.left !== undefined)\r\n    element.style.left = `${position.left}px`\r\n  if (position.right !== undefined)\r\n    element.style.right = `${position.right}px`\r\n  if (position.bottom !== undefined)\r\n    element.style.bottom = `${position.bottom}px`\r\n}\r\n\r\n/**\r\n * 移除元素\r\n */\r\nexport function remove(element: Element): void {\r\n  element.remove()\r\n}\r\n\r\n/**\r\n * 清空元素内容\r\n */\r\nexport function empty(element: Element): void {\r\n  element.innerHTML = ''\r\n}\r\n\r\n/**\r\n * 防抖函数\r\n */\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number,\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: NodeJS.Timeout\r\n  return function (this: any, ...args: Parameters<T>) {\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(() => func.apply(this, args), wait)\r\n  }\r\n}\r\n\r\n/**\r\n * 节流函数\r\n */\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number,\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle: boolean\r\n  return function (this: any, ...args: Parameters<T>) {\r\n    if (!inThrottle) {\r\n      func.apply(this, args)\r\n      inThrottle = true\r\n      setTimeout(() => inThrottle = false, wait)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 等待DOM元素出现\r\n */\r\nexport function waitForElement(selector: string, timeout = 5000): Promise<HTMLElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const element = $(selector)\r\n    if (element)\r\n      return resolve(element)\r\n\r\n    const observer = new MutationObserver(() => {\r\n      const element = $(selector)\r\n      if (element) {\r\n        observer.disconnect()\r\n        resolve(element)\r\n      }\r\n    })\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    })\r\n\r\n    setTimeout(() => {\r\n      observer.disconnect()\r\n      reject(new Error(`Element ${selector} not found within ${timeout}ms`))\r\n    }, timeout)\r\n  })\r\n}\r\n"],"names":["createElement","tag","attrs","children","element","document","Object","entries","forEach","key","value","style","cssText","assign","className","startsWith","setAttribute","String","child","appendChild","createTextNode","$","selector","parent","querySelector"],"mappings":";;;;;;;;;AAQO,SAASA,aAAAA,CACdC,GAAAA,EACAC,KAAAA,EAAAA,GACGC,QAAAA,EACuB;AAC1B,EAAA,MAAMC,OAAAA,GAAUC,QAAAA,CAASL,aAAAA,CAAcC,GAAG,CAAA;AAE1C,EAAA,IAAIC,KAAAA,EAAO;AACTI,IAAAA,MAAAA,CAAOC,OAAAA,CAAQL,KAAK,CAAA,CAAEM,OAAAA,CAAQ,CAAC,CAACC,GAAAA,EAAKC,KAAK,CAAA,KAAM;AAC9C,MAAA,IAAID,QAAQ,OAAA,EAAS;AACnB,QAAA,IAAI,OAAOC,KAAAA,KAAU,QAAA;AACnBN,UAAAA,OAAAA,CAAQO,MAAMC,OAAAA,GAAUF,KAAAA;AAAAA,aAAAA,IACjB,OAAOA,KAAAA,KAAU,QAAA;AACxBJ,UAAAA,MAAAA,CAAOO,MAAAA,CAAOT,OAAAA,CAAQO,KAAAA,EAAOD,KAAK,CAAA;AAAA,MACtC,CAAA,MAAA,IACSD,QAAQ,WAAA,EAAa;AAC5BL,QAAAA,OAAAA,CAAQU,SAAAA,GAAYJ,KAAAA;AAAAA,MACtB,CAAA,MAAA,IACSD,GAAAA,CAAIM,UAAAA,CAAW,OAAO,CAAA,EAAG;AAChCX,QAAAA,OAAAA,CAAQY,YAAAA,CAAaP,GAAAA,EAAKQ,MAAAA,CAAOP,KAAK,CAAC,CAAA;AAAA,MACzC,CAAA,MACK;AACH,QAACN,OAAAA,CAAgBK,GAAG,CAAA,GAAIC,KAAAA;AAAAA,MAC1B;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AAEAP,EAAAA,QAAAA,CAASK,QAASU,CAAAA,KAAAA,KAAU;AAC1B,IAAA,IAAI,OAAOA,KAAAA,KAAU,QAAA;AACnBd,MAAAA,OAAAA,CAAQe,WAAAA,CAAYd,QAAAA,CAASe,cAAAA,CAAeF,KAAK,CAAC,CAAA;AAAA;AAElDd,MAAAA,OAAAA,CAAQe,YAAYD,KAAK,CAAA;AAAA,EAC7B,CAAC,CAAA;AAED,EAAA,OAAOd,OAAAA;AACT;AAKO,SAASiB,CAAAA,CAAEC,QAAAA,EAAkBC,MAAAA,GAA6BlB,QAAAA,EAA8B;AAC7F,EAAA,OAAOkB,MAAAA,CAAOC,cAAcF,QAAQ,CAAA;AACtC;;;;;;;"}