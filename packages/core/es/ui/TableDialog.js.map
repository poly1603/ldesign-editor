{"version":3,"file":"TableDialog.js","sources":["../../src/ui/TableDialog.ts"],"sourcesContent":["/**\r\n * 表格插入对话框\r\n * 使用统一对话框组件实现\r\n */\r\n\r\nimport { showUnifiedDialog } from './UnifiedDialog'\r\n\r\nexport interface TableDialogOptions {\r\n  onConfirm: (rows: number, cols: number) => void\r\n  onCancel?: () => void\r\n}\r\n\r\n/**\r\n * 创建表格选择器网格组件\r\n */\r\nfunction createTableSelector(onChange: (rows: number, cols: number) => void): HTMLElement {\r\n  const container = document.createElement('div')\r\n  container.style.cssText = `\r\n    padding: 16px 0;\r\n    text-align: center;\r\n  `\r\n\r\n  const selectorTitle = document.createElement('div')\r\n  selectorTitle.style.cssText = `\r\n    font-size: 14px;\r\n    color: #6b7280;\r\n    margin-bottom: 12px;\r\n  `\r\n  selectorTitle.textContent = '鼠标悬停选择表格大小'\r\n  container.appendChild(selectorTitle)\r\n\r\n  const selector = document.createElement('div')\r\n  selector.style.cssText = `\r\n    display: inline-grid;\r\n    grid-template-columns: repeat(10, 20px);\r\n    grid-template-rows: repeat(10, 20px);\r\n    gap: 2px;\r\n    padding: 8px;\r\n    background: #f9fafb;\r\n    border-radius: 6px;\r\n  `\r\n\r\n  const maxRows = 10\r\n  const maxCols = 10\r\n  let selectedRows = 0\r\n  let selectedCols = 0\r\n\r\n  // 创建网格\r\n  for (let i = 0; i < maxRows; i++) {\r\n    for (let j = 0; j < maxCols; j++) {\r\n      const cell = document.createElement('div')\r\n      cell.style.cssText = `\r\n        background: white;\r\n        border: 1px solid #d1d5db;\r\n        cursor: pointer;\r\n        transition: all 0.15s;\r\n      `\r\n      cell.dataset.row = String(i)\r\n      cell.dataset.col = String(j)\r\n\r\n      cell.addEventListener('mouseenter', () => {\r\n        selectedRows = i + 1\r\n        selectedCols = j + 1\r\n        updatePreview()\r\n        updateLabel()\r\n        onChange(selectedRows, selectedCols)\r\n      })\r\n\r\n      cell.addEventListener('mouseleave', () => {\r\n        if (!selector.matches(':hover')) {\r\n          selectedRows = 0\r\n          selectedCols = 0\r\n          updatePreview()\r\n          updateLabel()\r\n        }\r\n      })\r\n\r\n      selector.appendChild(cell)\r\n    }\r\n  }\r\n\r\n  function updatePreview() {\r\n    const cells = selector.querySelectorAll('div')\r\n    cells.forEach((cell) => {\r\n      const el = cell as HTMLElement\r\n      const row = Number.parseInt(el.dataset.row || '0')\r\n      const col = Number.parseInt(el.dataset.col || '0')\r\n\r\n      if (row < selectedRows && col < selectedCols) {\r\n        el.style.background = '#3b82f6'\r\n        el.style.borderColor = '#3b82f6'\r\n      }\r\n      else {\r\n        el.style.background = 'white'\r\n        el.style.borderColor = '#d1d5db'\r\n      }\r\n    })\r\n  }\r\n\r\n  const label = document.createElement('div')\r\n  label.style.cssText = `\r\n    margin-top: 8px;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    color: #111827;\r\n  `\r\n  label.textContent = '0 × 0'\r\n\r\n  function updateLabel() {\r\n    label.textContent = selectedRows > 0 ? `${selectedRows} × ${selectedCols}` : '请选择表格大小'\r\n  }\r\n\r\n  container.appendChild(selector)\r\n  container.appendChild(label)\r\n\r\n  return container\r\n}\r\n\r\n/**\r\n * 显示表格插入对话框\r\n */\r\nexport function showTableDialog(options: TableDialogOptions): void {\r\n  const { onConfirm, onCancel } = options\r\n\r\n  let previewRows = 3\r\n  let previewCols = 3\r\n\r\n  // 创建表格选择器组件\r\n  const selectorComponent = createTableSelector((rows, cols) => {\r\n    previewRows = rows\r\n    previewCols = cols\r\n  })\r\n\r\n  // 创建自定义内容容器\r\n  const content = document.createElement('div')\r\n  content.appendChild(selectorComponent)\r\n\r\n  showUnifiedDialog({\r\n    title: '插入表格',\r\n    icon: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/>\r\n      <line x1=\"3\" y1=\"9\" x2=\"21\" y2=\"9\"/>\r\n      <line x1=\"3\" y1=\"15\" x2=\"21\" y2=\"15\"/>\r\n      <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"/>\r\n      <line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"21\"/>\r\n    </svg>`,\r\n    content,\r\n    fields: [\r\n      {\r\n        id: 'rows',\r\n        type: 'number',\r\n        label: '行数',\r\n        placeholder: '请输入行数',\r\n        defaultValue: 3,\r\n        min: 1,\r\n        max: 50,\r\n        required: true,\r\n      },\r\n      {\r\n        id: 'cols',\r\n        type: 'number',\r\n        label: '列数',\r\n        placeholder: '请输入列数',\r\n        defaultValue: 3,\r\n        min: 1,\r\n        max: 50,\r\n        required: true,\r\n      },\r\n    ],\r\n    buttons: [\r\n      {\r\n        id: 'cancel',\r\n        label: '取消',\r\n        type: 'secondary',\r\n        onClick: () => onCancel?.(),\r\n        closeOnClick: true,\r\n      },\r\n      {\r\n        id: 'confirm',\r\n        label: '插入',\r\n        type: 'primary',\r\n        onClick: (dialog) => {\r\n          const rows = dialog.getFieldValue('rows') || previewRows\r\n          const cols = dialog.getFieldValue('cols') || previewCols\r\n\r\n          if (rows >= 1 && cols >= 1 && rows <= 50 && cols <= 50) {\r\n            onConfirm(rows, cols)\r\n            dialog.close()\r\n          }\r\n          else {\r\n            dialog.showError('请输入有效的行数和列数（1-50）')\r\n          }\r\n        },\r\n      },\r\n    ],\r\n    onSubmit: (data) => {\r\n      const rows = data.rows || previewRows\r\n      const cols = data.cols || previewCols\r\n\r\n      if (rows >= 1 && cols >= 1 && rows <= 50 && cols <= 50)\r\n        onConfirm(rows, cols)\r\n    },\r\n  })\r\n}\r\n"],"names":["createTableSelector","onChange","container","document","createElement","style","cssText","selectorTitle","textContent","appendChild","selector","maxRows","maxCols","selectedRows","selectedCols","i","j","cell","dataset","row","String","col","addEventListener","updatePreview","updateLabel","matches","cells","querySelectorAll","forEach","el","Number","parseInt","background","borderColor","label","showTableDialog","options","onConfirm","onCancel","previewRows","previewCols","selectorComponent","rows","cols","content","showUnifiedDialog","title","icon","fields","id","type","placeholder","defaultValue","min","max","required","buttons","onClick","closeOnClick","dialog","getFieldValue","close","showError","onSubmit","data"],"mappings":"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"}