{"version":3,"file":"MediaInsert.js","sources":["../../src/ui/MediaInsert.ts"],"sourcesContent":["/**\r\n * 媒体插入功能\r\n * 支持图片、视频、音频的本地上传和网络地址插入\r\n */\r\n\r\nimport { createIcon } from '../ui/icons'\r\nimport { showDropdown } from './Dropdown'\r\nimport { showUnifiedDialog } from './UnifiedDialog'\r\n\r\nexport type MediaType = 'image' | 'video' | 'audio'\r\n\r\nexport interface MediaInsertOptions {\r\n  type: MediaType\r\n  onInsert: (urls: string[], alt?: string) => void\r\n  accept?: string // 文件类型限制\r\n  multiple?: boolean // 是否支持多选\r\n}\r\n\r\n/**\r\n * 显示媒体插入下拉框\r\n */\r\nexport function showMediaInsert(\r\n  button: HTMLElement,\r\n  options: MediaInsertOptions,\r\n): void {\r\n  const { type, onInsert, accept, multiple = true } = options\r\n\r\n  // 媒体类型配置\r\n  const mediaConfig = {\r\n    image: {\r\n      title: '插入图片',\r\n      localLabel: '本地上传',\r\n      networkLabel: '网络图片',\r\n      accept: accept || 'image/*',\r\n      icon: 'image',\r\n      localIcon: 'upload',\r\n      networkIcon: 'globe',\r\n      placeholder: '请输入图片地址',\r\n      dialogTitle: '插入网络图片',\r\n    },\r\n    video: {\r\n      title: '插入视频',\r\n      localLabel: '本地上传',\r\n      networkLabel: '网络视频',\r\n      accept: accept || 'video/*',\r\n      icon: 'video',\r\n      localIcon: 'upload',\r\n      networkIcon: 'globe',\r\n      placeholder: '请输入视频地址',\r\n      dialogTitle: '插入网络视频',\r\n    },\r\n    audio: {\r\n      title: '插入音频',\r\n      localLabel: '本地上传',\r\n      networkLabel: '网络音频',\r\n      accept: accept || 'audio/*',\r\n      icon: 'audio',\r\n      localIcon: 'upload',\r\n      networkIcon: 'globe',\r\n      placeholder: '请输入音频地址',\r\n      dialogTitle: '插入网络音频',\r\n    },\r\n  }\r\n\r\n  const config = mediaConfig[type]\r\n\r\n  // 创建自定义内容\r\n  const customContent = document.createElement('div')\r\n  customContent.style.cssText = 'padding: 8px 0;'\r\n\r\n  // 本地上传选项\r\n  const localOption = createMediaOption(\r\n    config.localIcon,\r\n    config.localLabel,\r\n    '从本地选择文件上传',\r\n    () => {\r\n      handleLocalUpload(config.accept, multiple, onInsert)\r\n      closeDropdown()\r\n    },\r\n  )\r\n\r\n  // 网络地址选项\r\n  const networkOption = createMediaOption(\r\n    config.networkIcon,\r\n    config.networkLabel,\r\n    '输入网络地址',\r\n    () => {\r\n      showNetworkDialog(config, onInsert)\r\n      closeDropdown()\r\n    },\r\n  )\r\n\r\n  customContent.appendChild(localOption)\r\n  customContent.appendChild(networkOption)\r\n\r\n  // 显示下拉框\r\n  showDropdown(button, {\r\n    customContent,\r\n    width: 220,\r\n  })\r\n\r\n  // 关闭下拉框函数\r\n  function closeDropdown() {\r\n    const dropdown = document.querySelector('.editor-dropdown')\r\n    if (dropdown) {\r\n      dropdown.classList.add('closing')\r\n      setTimeout(() => dropdown.remove(), 150)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 创建媒体选项\r\n */\r\nfunction createMediaOption(\r\n  iconName: string,\r\n  title: string,\r\n  description: string,\r\n  onClick: () => void,\r\n): HTMLElement {\r\n  const option = document.createElement('div')\r\n  option.className = 'editor-media-option'\r\n  option.style.cssText = `\r\n    padding: 12px 16px;\r\n    cursor: pointer;\r\n    transition: background 0.2s;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n  `\r\n\r\n  // 图标容器\r\n  const iconContainer = document.createElement('div')\r\n  iconContainer.style.cssText = `\r\n    width: 24px;\r\n    height: 24px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: #6b7280;\r\n  `\r\n\r\n  // 创建 SVG 图标\r\n  const iconSvg = createIcon(iconName)\r\n  if (iconSvg) {\r\n    iconSvg.style.width = '20px'\r\n    iconSvg.style.height = '20px'\r\n    iconContainer.appendChild(iconSvg)\r\n  }\r\n\r\n  // 文本容器\r\n  const textContainer = document.createElement('div')\r\n  textContainer.style.cssText = 'flex: 1;'\r\n\r\n  // 标题\r\n  const titleEl = document.createElement('div')\r\n  titleEl.style.cssText = `\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    color: #111827;\r\n  `\r\n  titleEl.textContent = title\r\n\r\n  // 描述\r\n  const descEl = document.createElement('div')\r\n  descEl.style.cssText = `\r\n    font-size: 12px;\r\n    color: #6b7280;\r\n    margin-top: 2px;\r\n  `\r\n  descEl.textContent = description\r\n\r\n  textContainer.appendChild(titleEl)\r\n  textContainer.appendChild(descEl)\r\n\r\n  option.appendChild(iconContainer)\r\n  option.appendChild(textContainer)\r\n\r\n  // 悬停效果\r\n  option.addEventListener('mouseenter', () => {\r\n    option.style.backgroundColor = '#f9fafb'\r\n  })\r\n\r\n  option.addEventListener('mouseleave', () => {\r\n    option.style.backgroundColor = 'transparent'\r\n  })\r\n\r\n  // 点击事件\r\n  option.addEventListener('click', (e) => {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    onClick()\r\n  })\r\n\r\n  // 防止获取焦点\r\n  option.addEventListener('mousedown', (e) => {\r\n    e.preventDefault()\r\n  })\r\n\r\n  return option\r\n}\r\n\r\n/**\r\n * 处理本地文件上传\r\n */\r\nfunction handleLocalUpload(\r\n  accept: string,\r\n  multiple: boolean,\r\n  onInsert: (urls: string[]) => void,\r\n): void {\r\n  // 创建隐藏的文件输入框\r\n  const fileInput = document.createElement('input')\r\n  fileInput.type = 'file'\r\n  fileInput.accept = accept\r\n  fileInput.multiple = multiple\r\n  fileInput.style.display = 'none'\r\n\r\n  // 文件选择处理\r\n  fileInput.addEventListener('change', () => {\r\n    const files = Array.from(fileInput.files || [])\r\n    if (files.length === 0)\r\n      return\r\n\r\n    // 处理文件（这里简化处理，实际应用中需要上传到服务器）\r\n    const urls: string[] = []\r\n    let processed = 0\r\n\r\n    files.forEach((file) => {\r\n      const reader = new FileReader()\r\n\r\n      reader.onload = (e) => {\r\n        const url = e.target?.result as string\r\n        urls.push(url)\r\n        processed++\r\n\r\n        // 所有文件处理完成\r\n        if (processed === files.length)\r\n          onInsert(urls)\r\n      }\r\n\r\n      reader.onerror = () => {\r\n        processed++\r\n        console.error('文件读取失败:', file.name)\r\n\r\n        if (processed === files.length && urls.length > 0)\r\n          onInsert(urls)\r\n      }\r\n\r\n      // 读取文件为 Data URL\r\n      reader.readAsDataURL(file)\r\n    })\r\n\r\n    // 清理\r\n    document.body.removeChild(fileInput)\r\n  })\r\n\r\n  // 取消选择处理\r\n  fileInput.addEventListener('cancel', () => {\r\n    document.body.removeChild(fileInput)\r\n  })\r\n\r\n  // 添加到页面并触发点击\r\n  document.body.appendChild(fileInput)\r\n  fileInput.click()\r\n}\r\n\r\n/**\r\n * 显示网络地址对话框\r\n */\r\nfunction showNetworkDialog(\r\n  config: any,\r\n  onInsert: (urls: string[]) => void,\r\n): void {\r\n  // 保存当前的选区\r\n  const selection = window.getSelection()\r\n  let savedRange: Range | null = null\r\n\r\n  if (selection && selection.rangeCount > 0)\r\n    savedRange = selection.getRangeAt(0).cloneRange()\r\n\r\n  const iconMap: Record<string, string> = {\r\n    插入网络音频: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <polygon points=\"11 5 6 9 2 9 2 15 6 15 11 19 11 5\"></polygon>\r\n      <path d=\"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07\"></path>\r\n    </svg>`,\r\n    插入网络视频: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <polygon points=\"23 7 16 12 23 17 23 7\"></polygon>\r\n      <rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\"></rect>\r\n    </svg>`,\r\n    插入网络图片: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n      <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\r\n      <polyline points=\"21 15 16 10 5 21\"></polyline>\r\n    </svg>`,\r\n  }\r\n\r\n  showUnifiedDialog({\r\n    title: config.dialogTitle,\r\n    icon: iconMap[config.dialogTitle] || iconMap['插入网络图片'],\r\n    width: 560, // 设置更宽的宽度\r\n    fields: [\r\n      {\r\n        id: 'urls',\r\n        type: 'textarea',\r\n        label: '地址（每行一个，可插入多个）',\r\n        placeholder: `${config.placeholder}\\n${config.placeholder}\\n...`,\r\n        required: true,\r\n        rows: 5,\r\n        helpText: `请输入${config.placeholder.replace('请输入', '')}，每行一个URL地址，支持批量插入`,\r\n        validator: (value) => {\r\n          if (!value || !value.trim())\r\n            return '请输入至少一个URL地址'\r\n\r\n          const urls = value.split('\\n').map((url: string) => url.trim()).filter((url: string) => url)\r\n          if (urls.length === 0)\r\n            return '请输入至少一个URL地址'\r\n\r\n          // 验证每个URL\r\n          for (const url of urls) {\r\n            try {\r\n              new URL(url)\r\n            }\r\n            catch {\r\n              return `无效的URL地址: ${url as string}`\r\n            }\r\n          }\r\n          return null\r\n        },\r\n      },\r\n      {\r\n        id: 'alt',\r\n        type: 'text',\r\n        label: '描述文字（全部媒体共用）',\r\n        placeholder: '可选，用于SEO和无障碍访问',\r\n        required: false,\r\n      },\r\n    ],\r\n    onSubmit: (data) => {\r\n      // 分割URL并过滤空行\r\n      const urls = data.urls.split('\\n')\r\n        .map((url: string) => url.trim())\r\n        .filter((url: string) => url)\r\n\r\n      // 延迟恢复选区和插入，等待对话框关闭动画完成\r\n      setTimeout(() => {\r\n        // 恢复选区\r\n        const editorContent = document.querySelector('.ldesign-editor-content') as HTMLElement\r\n        if (editorContent) {\r\n          editorContent.focus()\r\n\r\n          if (savedRange && selection) {\r\n            selection.removeAllRanges()\r\n            selection.addRange(savedRange)\r\n          }\r\n        }\r\n\r\n        // 调用插入函数，传递alt文本\r\n        onInsert(urls)\r\n      }, 250) // 等待对话框关闭动画（200ms）后再执行\r\n    },\r\n  })\r\n}\r\n\r\n/**\r\n * 插入媒体元素到编辑器\r\n */\r\nexport function insertMedia(\r\n  type: MediaType,\r\n  urls: string[],\r\n  options?: {\r\n    alt?: string\r\n    width?: number\r\n    height?: number\r\n    controls?: boolean\r\n  },\r\n): void {\r\n  const { alt = '', width, height, controls = true } = options || {}\r\n\r\n  // 确保编辑器有焦点\r\n  const editorContent = document.querySelector('.ldesign-editor-content') as HTMLElement\r\n  if (!editorContent) {\r\n    console.error('[MediaInsert] Editor content element not found')\r\n    return\r\n  }\r\n\r\n  // 检查选区\r\n  const selection = window.getSelection()\r\n  if (!selection || selection.rangeCount === 0) {\r\n    // 如果没有选区，创建一个在编辑器末尾的选区\r\n    const range = document.createRange()\r\n    range.selectNodeContents(editorContent)\r\n    range.collapse(false) // 折叠到末尾\r\n    selection?.removeAllRanges()\r\n    selection?.addRange(range)\r\n  }\r\n\r\n  urls.forEach((url, index) => {\r\n    let html = ''\r\n\r\n    switch (type) {\r\n      case 'image':\r\n        html = `<img src=\"${url}\" alt=\"${alt}\"${width ? ` width=\"${width}\"` : ''}${height ? ` height=\"${height}\"` : ''} style=\"max-width: 100%; height: auto;\">`\r\n        break\r\n      case 'video':\r\n        html = `<video src=\"${url}\"${controls ? ' controls' : ''}${width ? ` width=\"${width}\"` : ''}${height ? ` height=\"${height}\"` : ''} style=\"max-width: 100%;\"></video>`\r\n        break\r\n      case 'audio':\r\n        html = `<audio src=\"${url}\"${controls ? ' controls' : ''}></audio>`\r\n        break\r\n    }\r\n\r\n    if (html) {\r\n      // 在多个媒体之间添加空格或换行\r\n      if (index > 0)\r\n        html = `<br>${html}`\r\n\r\n      const success = document.execCommand('insertHTML', false, html)\r\n      if (!success) {\r\n        console.error('[MediaInsert] Failed to insert HTML:', html)\r\n        // 作为备用方案，直接插入到当前位置\r\n        try {\r\n          const range = selection?.getRangeAt(0)\r\n          if (range) {\r\n            const fragment = document.createRange().createContextualFragment(html)\r\n            range.insertNode(fragment)\r\n            range.collapse(false)\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.error('[MediaInsert] Fallback insertion failed:', e)\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  // 触发更新事件\r\n  editorContent.dispatchEvent(new Event('input', { bubbles: true }))\r\n}\r\n"],"names":["showMediaInsert","button","options","type","onInsert","accept","multiple","mediaConfig","image","title","localLabel","networkLabel","icon","localIcon","networkIcon","placeholder","dialogTitle","video","audio","config","customContent","document","createElement","style","cssText","localOption","createMediaOption","handleLocalUpload","closeDropdown","networkOption","showNetworkDialog","appendChild","showDropdown","width","dropdown","querySelector","classList","add","setTimeout","remove","iconName","description","onClick","option","className","iconContainer","iconSvg","createIcon","height","textContainer","titleEl","textContent","descEl","addEventListener","backgroundColor","e","preventDefault","stopPropagation","fileInput","display","files","Array","from","length","urls","processed","forEach","file","reader","FileReader","onload","url","target","result","push","onerror","console","error","name","readAsDataURL","body","removeChild","click","selection","window","getSelection","savedRange","rangeCount","getRangeAt","cloneRange","iconMap","插入网络音频","插入网络视频","插入网络图片","showUnifiedDialog","fields","id","label","required","rows","helpText","replace","validator","value","trim","split","map","filter","URL","onSubmit","data","editorContent","focus","removeAllRanges","addRange","insertMedia","alt","controls","range","createRange","selectNodeContents","collapse","index","html","success","execCommand","fragment","createContextualFragment","insertNode","dispatchEvent","Event","bubbles"],"mappings":"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"}