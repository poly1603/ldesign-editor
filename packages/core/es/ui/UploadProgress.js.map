{"version":3,"file":"UploadProgress.js","sources":["../../src/ui/UploadProgress.ts"],"sourcesContent":["/**\r\n * 上传进度组件\r\n * 显示文件上传进度和状态\r\n */\r\n\r\nexport interface UploadProgressOptions {\r\n  fileName?: string\r\n  fileSize?: number\r\n  onCancel?: () => void\r\n}\r\n\r\nexport class UploadProgress {\r\n  private container: HTMLElement\r\n  private progressBar: HTMLElement\r\n  private percentText: HTMLElement\r\n  private statusText: HTMLElement\r\n  private options: UploadProgressOptions\r\n  private cancelled: boolean = false\r\n\r\n  constructor(options: UploadProgressOptions = {}) {\r\n    this.options = options\r\n    this.container = this.createContainer()\r\n    this.progressBar = this.container.querySelector('.progress-fill')!\r\n    this.percentText = this.container.querySelector('.percent')!\r\n    this.statusText = this.container.querySelector('.status')!\r\n  }\r\n\r\n  /**\r\n   * 创建容器\r\n   */\r\n  private createContainer(): HTMLElement {\r\n    const container = document.createElement('div')\r\n    container.className = 'upload-progress'\r\n    container.style.cssText = `\r\n      position: fixed;\r\n      bottom: 20px;\r\n      right: 20px;\r\n      width: 320px;\r\n      background: white;\r\n      border-radius: 8px;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      padding: 16px;\r\n      z-index: 10000;\r\n      animation: slideIn 0.3s ease;\r\n    `\r\n\r\n    // 添加动画\r\n    this.addAnimation()\r\n\r\n    container.innerHTML = `\r\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\r\n        <div>\r\n          <div style=\"font-weight: 600; font-size: 14px; margin-bottom: 4px;\">\r\n            ${this.options.fileName || '上传文件'}\r\n          </div>\r\n          <div class=\"status\" style=\"font-size: 12px; color: #6b7280;\">\r\n            准备上传...\r\n          </div>\r\n        </div>\r\n        <button class=\"cancel-btn\" style=\"border: none; background: none; font-size: 20px; cursor: pointer; color: #666; padding: 0; width: 24px; height: 24px;\">&times;</button>\r\n      </div>\r\n      \r\n      <div style=\"margin-bottom: 8px;\">\r\n        <div style=\"display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-bottom: 4px;\">\r\n          <span class=\"percent\">0%</span>\r\n          <span class=\"size\">${this.formatSize(this.options.fileSize || 0)}</span>\r\n        </div>\r\n        <div style=\"height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;\">\r\n          <div class=\"progress-fill\" style=\"height: 100%; width: 0%; background: linear-gradient(90deg, #3b82f6, #10b981); transition: width 0.3s ease;\"></div>\r\n        </div>\r\n      </div>\r\n    `\r\n\r\n    // 取消按钮\r\n    const cancelBtn = container.querySelector('.cancel-btn')\r\n    cancelBtn?.addEventListener('click', () => {\r\n      this.cancel()\r\n    })\r\n\r\n    return container\r\n  }\r\n\r\n  /**\r\n   * 添加动画样式\r\n   */\r\n  private addAnimation(): void {\r\n    if (document.getElementById('upload-progress-animation'))\r\n      return\r\n\r\n    const style = document.createElement('style')\r\n    style.id = 'upload-progress-animation'\r\n    style.textContent = `\r\n      @keyframes slideIn {\r\n        from {\r\n          transform: translateX(400px);\r\n          opacity: 0;\r\n        }\r\n        to {\r\n          transform: translateX(0);\r\n          opacity: 1;\r\n        }\r\n      }\r\n      \r\n      @keyframes slideOut {\r\n        from {\r\n          transform: translateX(0);\r\n          opacity: 1;\r\n        }\r\n        to {\r\n          transform: translateX(400px);\r\n          opacity: 0;\r\n        }\r\n      }\r\n    `\r\n    document.head.appendChild(style)\r\n  }\r\n\r\n  /**\r\n   * 更新进度\r\n   */\r\n  updateProgress(percent: number, status?: string): void {\r\n    const clampedPercent = Math.min(100, Math.max(0, percent))\r\n\r\n    this.progressBar.style.width = `${clampedPercent}%`\r\n    this.percentText.textContent = `${Math.round(clampedPercent)}%`\r\n\r\n    if (status) {\r\n      this.statusText.textContent = status\r\n    }\r\n    else {\r\n      if (clampedPercent === 0)\r\n        this.statusText.textContent = '准备上传...'\r\n      else if (clampedPercent < 100)\r\n        this.statusText.textContent = '上传中...'\r\n      else\r\n        this.statusText.textContent = '上传完成！'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置为成功状态\r\n   */\r\n  success(message: string = '上传成功！'): void {\r\n    this.progressBar.style.background = '#10b981'\r\n    this.statusText.textContent = message\r\n    this.statusText.style.color = '#10b981'\r\n\r\n    setTimeout(() => {\r\n      this.hide()\r\n    }, 2000)\r\n  }\r\n\r\n  /**\r\n   * 设置为错误状态\r\n   */\r\n  error(message: string = '上传失败'): void {\r\n    this.progressBar.style.background = '#ef4444'\r\n    this.statusText.textContent = message\r\n    this.statusText.style.color = '#ef4444'\r\n\r\n    setTimeout(() => {\r\n      this.hide()\r\n    }, 3000)\r\n  }\r\n\r\n  /**\r\n   * 取消上传\r\n   */\r\n  cancel(): void {\r\n    this.cancelled = true\r\n    this.statusText.textContent = '已取消'\r\n    this.statusText.style.color = '#f59e0b'\r\n\r\n    if (this.options.onCancel)\r\n      this.options.onCancel()\r\n\r\n    setTimeout(() => {\r\n      this.hide()\r\n    }, 1000)\r\n  }\r\n\r\n  /**\r\n   * 检查是否已取消\r\n   */\r\n  isCancelled(): boolean {\r\n    return this.cancelled\r\n  }\r\n\r\n  /**\r\n   * 显示\r\n   */\r\n  show(): void {\r\n    if (!this.container.parentElement)\r\n      document.body.appendChild(this.container)\r\n  }\r\n\r\n  /**\r\n   * 隐藏\r\n   */\r\n  hide(): void {\r\n    this.container.style.animation = 'slideOut 0.3s ease'\r\n    setTimeout(() => {\r\n      if (this.container.parentElement)\r\n        this.container.parentElement.removeChild(this.container)\r\n    }, 300)\r\n  }\r\n\r\n  /**\r\n   * 格式化文件大小\r\n   */\r\n  private formatSize(bytes: number): string {\r\n    if (bytes === 0)\r\n      return '0 B'\r\n\r\n    const units = ['B', 'KB', 'MB', 'GB']\r\n    const k = 1024\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\r\n\r\n    return `${(bytes / k ** i).toFixed(2)} ${units[i]}`\r\n  }\r\n}\r\n\r\n/**\r\n * 创建上传进度实例\r\n */\r\nexport function createUploadProgress(options?: UploadProgressOptions): UploadProgress {\r\n  return new UploadProgress(options)\r\n}\r\n\r\n/**\r\n * 显示上传进度\r\n */\r\nexport function showUploadProgress(options?: UploadProgressOptions): UploadProgress {\r\n  const progress = new UploadProgress(options)\r\n  progress.show()\r\n  return progress\r\n}\r\n"],"names":["UploadProgress","constructor","options","cancelled","container","createContainer","progressBar","querySelector","percentText","statusText","document","createElement","className","style","cssText","addAnimation","innerHTML","fileName","formatSize","fileSize","cancelBtn","addEventListener","cancel","getElementById","id","textContent","head","appendChild","updateProgress","percent","status","clampedPercent","Math","min","max","width","round","success","message","background","color","setTimeout","hide","error","onCancel","isCancelled","show","parentElement","body","animation","removeChild","bytes","units","k","i","floor","log","toFixed","createUploadProgress","showUploadProgress","progress"],"mappings":";;;;;;;;;AAWO,MAAMA,cAAAA,CAAe;AAAA,EAQ1BC,WAAAA,CAAYC,OAAAA,GAAiC,EAAC,EAAG;AAFjD,IAAA,IAAA,CAAQC,SAAAA,GAAqB,KAAA;AAG3B,IAAA,IAAA,CAAKD,OAAAA,GAAUA,OAAAA;AACf,IAAA,IAAA,CAAKE,SAAAA,GAAY,KAAKC,eAAAA,EAAgB;AACtC,IAAA,IAAA,CAAKC,WAAAA,GAAc,IAAA,CAAKF,SAAAA,CAAUG,aAAAA,CAAc,gBAAgB,CAAA;AAChE,IAAA,IAAA,CAAKC,WAAAA,GAAc,IAAA,CAAKJ,SAAAA,CAAUG,aAAAA,CAAc,UAAU,CAAA;AAC1D,IAAA,IAAA,CAAKE,UAAAA,GAAa,IAAA,CAAKL,SAAAA,CAAUG,aAAAA,CAAc,SAAS,CAAA;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKQF,eAAAA,GAA+B;AACrC,IAAA,MAAMD,SAAAA,GAAYM,QAAAA,CAASC,aAAAA,CAAc,KAAK,CAAA;AAC9CP,IAAAA,SAAAA,CAAUQ,SAAAA,GAAY,iBAAA;AACtBR,IAAAA,SAAAA,CAAUS,MAAMC,OAAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAc1B,IAAA,IAAA,CAAKC,YAAAA,EAAa;AAElBX,IAAAA,SAAAA,CAAUY,SAAAA,GAAY;AAAA;AAAA;AAAA;AAAA,YAAA,EAIZ,IAAA,CAAKd,OAAAA,CAAQe,QAAAA,IAAY,0BAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAA,EAYd,KAAKC,UAAAA,CAAW,IAAA,CAAKhB,OAAAA,CAAQiB,QAAAA,IAAY,CAAC,CAAC,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAStE,IAAA,MAAMC,SAAAA,GAAYhB,SAAAA,CAAUG,aAAAA,CAAc,aAAa,CAAA;AACvDa,IAAAA,SAAAA,EAAWC,gBAAAA,CAAiB,SAAS,MAAM;AACzC,MAAA,IAAA,CAAKC,MAAAA,EAAO;AAAA,IACd,CAAC,CAAA;AAED,IAAA,OAAOlB,SAAAA;AAAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQW,YAAAA,GAAqB;AAC3B,IAAA,IAAIL,QAAAA,CAASa,eAAe,2BAA2B,CAAA;AACrD,MAAA;AAEF,IAAA,MAAMV,KAAAA,GAAQH,QAAAA,CAASC,aAAAA,CAAc,OAAO,CAAA;AAC5CE,IAAAA,KAAAA,CAAMW,EAAAA,GAAK,2BAAA;AACXX,IAAAA,KAAAA,CAAMY,WAAAA,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAuBpBf,IAAAA,QAAAA,CAASgB,IAAAA,CAAKC,YAAYd,KAAK,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKAe,cAAAA,CAAeC,SAAiBC,MAAAA,EAAuB;AACrD,IAAA,MAAMC,cAAAA,GAAiBC,KAAKC,GAAAA,CAAI,GAAA,EAAKD,KAAKE,GAAAA,CAAI,CAAA,EAAGL,OAAO,CAAC,CAAA;AAEzD,IAAA,IAAA,CAAKvB,WAAAA,CAAYO,KAAAA,CAAMsB,KAAAA,GAAQ,CAAA,EAAGJ,cAAc,CAAA,CAAA,CAAA;AAChD,IAAA,IAAA,CAAKvB,YAAYiB,WAAAA,GAAc,CAAA,EAAGO,IAAAA,CAAKI,KAAAA,CAAML,cAAc,CAAC,CAAA,CAAA,CAAA;AAE5D,IAAA,IAAID,MAAAA,EAAQ;AACV,MAAA,IAAA,CAAKrB,WAAWgB,WAAAA,GAAcK,MAAAA;AAAAA,IAChC,CAAA,MACK;AACH,MAAA,IAAIC,cAAAA,KAAmB,CAAA;AACrB,QAAA,IAAA,CAAKtB,WAAWgB,WAAAA,GAAc,6BAAA;AAAA,WAAA,IACvBM,cAAAA,GAAiB,GAAA;AACxB,QAAA,IAAA,CAAKtB,WAAWgB,WAAAA,GAAc,uBAAA;AAAA;AAE9B,QAAA,IAAA,CAAKhB,WAAWgB,WAAAA,GAAc,gCAAA;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKAY,OAAAA,CAAQC,UAAkB,gCAAA,EAAe;AACvC,IAAA,IAAA,CAAKhC,WAAAA,CAAYO,MAAM0B,UAAAA,GAAa,SAAA;AACpC,IAAA,IAAA,CAAK9B,WAAWgB,WAAAA,GAAca,OAAAA;AAC9B,IAAA,IAAA,CAAK7B,UAAAA,CAAWI,MAAM2B,KAAAA,GAAQ,SAAA;AAE9BC,IAAAA,UAAAA,CAAW,MAAM;AACf,MAAA,IAAA,CAAKC,IAAAA,EAAK;AAAA,IACZ,GAAG,GAAI,CAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKAC,KAAAA,CAAML,UAAkB,0BAAA,EAAc;AACpC,IAAA,IAAA,CAAKhC,WAAAA,CAAYO,MAAM0B,UAAAA,GAAa,SAAA;AACpC,IAAA,IAAA,CAAK9B,WAAWgB,WAAAA,GAAca,OAAAA;AAC9B,IAAA,IAAA,CAAK7B,UAAAA,CAAWI,MAAM2B,KAAAA,GAAQ,SAAA;AAE9BC,IAAAA,UAAAA,CAAW,MAAM;AACf,MAAA,IAAA,CAAKC,IAAAA,EAAK;AAAA,IACZ,GAAG,GAAI,CAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKApB,MAAAA,GAAe;AACb,IAAA,IAAA,CAAKnB,SAAAA,GAAY,IAAA;AACjB,IAAA,IAAA,CAAKM,WAAWgB,WAAAA,GAAc,oBAAA;AAC9B,IAAA,IAAA,CAAKhB,UAAAA,CAAWI,MAAM2B,KAAAA,GAAQ,SAAA;AAE9B,IAAA,IAAI,KAAKtC,OAAAA,CAAQ0C,QAAAA;AACf,MAAA,IAAA,CAAK1C,QAAQ0C,QAAAA,EAAS;AAExBH,IAAAA,UAAAA,CAAW,MAAM;AACf,MAAA,IAAA,CAAKC,IAAAA,EAAK;AAAA,IACZ,GAAG,GAAI,CAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKAG,WAAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK1C,SAAAA;AAAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA2C,IAAAA,GAAa;AACX,IAAA,IAAI,CAAC,KAAK1C,SAAAA,CAAU2C,aAAAA;AAClBrC,MAAAA,QAAAA,CAASsC,IAAAA,CAAKrB,WAAAA,CAAY,IAAA,CAAKvB,SAAS,CAAA;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKAsC,IAAAA,GAAa;AACX,IAAA,IAAA,CAAKtC,SAAAA,CAAUS,MAAMoC,SAAAA,GAAY,oBAAA;AACjCR,IAAAA,UAAAA,CAAW,MAAM;AACf,MAAA,IAAI,KAAKrC,SAAAA,CAAU2C,aAAAA;AACjB,QAAA,IAAA,CAAK3C,SAAAA,CAAU2C,aAAAA,CAAcG,WAAAA,CAAY,IAAA,CAAK9C,SAAS,CAAA;AAAA,IAC3D,GAAG,GAAG,CAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKQc,WAAWiC,KAAAA,EAAuB;AACxC,IAAA,IAAIA,KAAAA,KAAU,CAAA;AACZ,MAAA,OAAO,KAAA;AAET,IAAA,MAAMC,KAAAA,GAAQ,CAAC,GAAA,EAAK,IAAA,EAAM,MAAM,IAAI,CAAA;AACpC,IAAA,MAAMC,CAAAA,GAAI,IAAA;AACV,IAAA,MAAMC,CAAAA,GAAItB,IAAAA,CAAKuB,KAAAA,CAAMvB,IAAAA,CAAKwB,GAAAA,CAAIL,KAAK,CAAA,GAAInB,IAAAA,CAAKwB,GAAAA,CAAIH,CAAC,CAAC,CAAA;AAElD,IAAA,OAAO,CAAA,EAAA,CAAIF,KAAAA,GAAQE,CAAAA,IAAKC,CAAAA,EAAGG,OAAAA,CAAQ,CAAC,CAAC,CAAA,CAAA,EAAIL,KAAAA,CAAME,CAAC,CAAC,CAAA,CAAA;AAAA,EACnD;AACF;AAKO,SAASI,qBAAqBxD,OAAAA,EAAiD;AACpF,EAAA,OAAO,IAAIF,eAAeE,OAAO,CAAA;AACnC;AAKO,SAASyD,mBAAmBzD,OAAAA,EAAiD;AAClF,EAAA,MAAM0D,QAAAA,GAAW,IAAI5D,cAAAA,CAAeE,OAAO,CAAA;AAC3C0D,EAAAA,QAAAA,CAASd,IAAAA,EAAK;AACd,EAAA,OAAOc,QAAAA;AACT;;;;;;;"}